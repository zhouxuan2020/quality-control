<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>GWAS Quality Control</title>
  <meta name="description" content="GWAS Quality Control" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="GWAS Quality Control" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="GWAS Quality Control" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">GWAS Quality Control</h1>
<p class="author"><em></em></p>
<p class="date"><em>updated on 2022-03-03</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#general-info"><span class="toc-section-number">1</span> General Info</a>
<ul>
<li><a href="#topic"><span class="toc-section-number">1.1</span> Topic</a></li>
<li><a href="#frequently-used-commands"><span class="toc-section-number">1.2</span> Frequently used commands</a></li>
</ul></li>
<li><a href="#summaries"><span class="toc-section-number">2</span> Summaries</a>
<ul>
<li><a href="#good-gwas"><span class="toc-section-number">2.1</span> Good GWAS</a>
<ul>
<li><a href="#ldsc-sumher"><span class="toc-section-number">2.1.1</span> ldsc &amp; sumher</a></li>
<li><a href="#haseman-elston-regression"><span class="toc-section-number">2.1.2</span> Haseman Elston Regression</a></li>
</ul></li>
<li><a href="#bad-gwas"><span class="toc-section-number">2.2</span> Bad GWAS</a>
<ul>
<li><a href="#ldsc-sumher-1"><span class="toc-section-number">2.2.1</span> ldsc &amp; sumher</a></li>
<li><a href="#haseman-elston-regression-1"><span class="toc-section-number">2.2.2</span> Haseman Elston Regression</a></li>
</ul></li>
<li><a href="#ukbb-recommended"><span class="toc-section-number">2.3</span> UKBB recommended</a>
<ul>
<li><a href="#ldsc-sumher-2"><span class="toc-section-number">2.3.1</span> ldsc &amp; sumher</a></li>
<li><a href="#haseman-elston-regression-2"><span class="toc-section-number">2.3.2</span> Haseman Elston Regression</a></li>
</ul></li>
<li><a href="#control-gwas"><span class="toc-section-number">2.4</span> Control GWAS</a>
<ul>
<li><a href="#ldsc-sumher-3"><span class="toc-section-number">2.4.1</span> ldsc &amp; sumher</a></li>
<li><a href="#haseman-elston-regression-3"><span class="toc-section-number">2.4.2</span> Haseman Elston Regression</a></li>
</ul></li>
</ul></li>
<li><a href="#good-vs-bad-gwas"><span class="toc-section-number">3</span> Good VS Bad GWAS</a>
<ul>
<li><a href="#test-statistics-ld-score"><span class="toc-section-number">3.1</span> test statistics ~ LD score</a></li>
<li><a href="#new-models"><span class="toc-section-number">3.2</span> New models?</a></li>
<li><a href="#ld-scores-based-on-individual-level-data"><span class="toc-section-number">3.3</span> LD scores based on individual level data</a></li>
<li><a href="#test-the-new-model"><span class="toc-section-number">3.4</span> Test the new model</a></li>
<li><a href="#predictors-of-inflation"><span class="toc-section-number">3.5</span> predictors of inflation?</a></li>
<li><a href="#regress-bad-chisq-mean-r2_j"><span class="toc-section-number">3.6</span> regress bad chisq ~ mean r^2_j</a></li>
</ul></li>
<li><a href="#mathematical-details"><span class="toc-section-number">4</span> Mathematical Details</a>
<ul>
<li><a href="#trk_rightk_left"><span class="toc-section-number">4.1</span> <span class="math inline">\(tr(K_{right}K_{left})\)</span></a></li>
<li><a href="#verification"><span class="toc-section-number">4.2</span> verification</a></li>
</ul></li>
<li><a href="#chi-square-overliner2_j"><span class="toc-section-number">5</span> chi square ~ <span class="math inline">\(\overline{r^2_j}\)</span></a>
<ul>
<li><a href="#overliner2_j-choice-of-snps"><span class="toc-section-number">5.1</span> <span class="math inline">\(\overline{r^2_j}\)</span> &amp; choice of SNPs</a>
<ul>
<li><a href="#number-of-snps"><span class="toc-section-number">5.1.1</span> number of SNPs</a></li>
<li><a href="#maf"><span class="toc-section-number">5.1.2</span> maf</a></li>
<li><a href="#summary"><span class="toc-section-number">5.1.3</span> summary</a></li>
</ul></li>
<li><a href="#varying-levels-of-confouding"><span class="toc-section-number">5.2</span> varying levels of confouding</a></li>
<li><a href="#results-summary"><span class="toc-section-number">5.3</span> results summary</a></li>
</ul></li>
<li><a href="#good"><span class="toc-section-number">6</span> Good GWAS</a>
<ul>
<li><a href="#goodid"><span class="toc-section-number">6.1</span> QC of hp3 SNPs</a></li>
<li><a href="#extract-covariates"><span class="toc-section-number">6.2</span> extract covariates</a></li>
<li><a href="#gwas"><span class="toc-section-number">6.3</span> GWAS</a></li>
<li><a href="#ldsc-intercept"><span class="toc-section-number">6.4</span> ldsc intercept</a>
<ul>
<li><a href="#under-gcta"><span class="toc-section-number">6.4.1</span> under gcta</a></li>
<li><a href="#under-ldak-thin"><span class="toc-section-number">6.4.2</span> under ldak-thin</a></li>
<li><a href="#summary-1"><span class="toc-section-number">6.4.3</span> summary</a></li>
</ul></li>
<li><a href="#reml"><span class="toc-section-number">6.5</span> REML</a>
<ul>
<li><a href="#making-grms"><span class="toc-section-number">6.5.1</span> making grms</a></li>
<li><a href="#fast-reml"><span class="toc-section-number">6.5.2</span> fast-reml</a></li>
<li><a href="#inflation-test"><span class="toc-section-number">6.5.3</span> inflation test</a></li>
</ul></li>
<li><a href="#he"><span class="toc-section-number">6.6</span> HE</a>
<ul>
<li><a href="#estimation"><span class="toc-section-number">6.6.1</span> estimation</a></li>
<li><a href="#summary-2"><span class="toc-section-number">6.6.2</span> summary</a></li>
</ul></li>
</ul></li>
<li><a href="#bad"><span class="toc-section-number">7</span> Bad GWAS</a>
<ul>
<li><a href="#badid"><span class="toc-section-number">7.1</span> ID list</a>
<ul>
<li><a href="#initial-selection"><span class="toc-section-number">7.1.1</span> initial selection</a></li>
<li><a href="#relatedness-filtering"><span class="toc-section-number">7.1.2</span> relatedness filtering</a></li>
<li><a href="#final-list"><span class="toc-section-number">7.1.3</span> final list</a></li>
</ul></li>
<li><a href="#gwas-lm"><span class="toc-section-number">7.2</span> GWAS-lm</a>
<ul>
<li><a href="#basic-cov"><span class="toc-section-number">7.2.1</span> basic cov</a></li>
<li><a href="#basic-cov-pc"><span class="toc-section-number">7.2.2</span> basic cov + PC</a></li>
</ul></li>
<li><a href="#gwas-bolt-lmm"><span class="toc-section-number">7.3</span> GWAS-bolt-lmm</a></li>
<li><a href="#aver2_j"><span class="toc-section-number">7.4</span> aver2_j</a>
<ul>
<li><a href="#calc-aver2_j"><span class="toc-section-number">7.4.1</span> calc aver2_j</a></li>
<li><a href="#bolt-lmm"><span class="toc-section-number">7.4.2</span> bolt-lmm</a></li>
<li><a href="#basic-cov-pc-1"><span class="toc-section-number">7.4.3</span> basic cov + PC</a></li>
</ul></li>
<li><a href="#ldsc-intercept-1"><span class="toc-section-number">7.5</span> ldsc intercept</a>
<ul>
<li><a href="#under-gcta-1"><span class="toc-section-number">7.5.1</span> under gcta</a></li>
<li><a href="#under-ldak-thin-1"><span class="toc-section-number">7.5.2</span> under ldak-thin</a></li>
<li><a href="#summary-3"><span class="toc-section-number">7.5.3</span> summary</a></li>
</ul></li>
<li><a href="#reml-1"><span class="toc-section-number">7.6</span> REML</a>
<ul>
<li><a href="#making-grms-1"><span class="toc-section-number">7.6.1</span> making grms</a></li>
<li><a href="#fast-reml-1"><span class="toc-section-number">7.6.2</span> fast-reml</a></li>
<li><a href="#inflation-test-1"><span class="toc-section-number">7.6.3</span> inflation test</a></li>
</ul></li>
<li><a href="#he-1"><span class="toc-section-number">7.7</span> HE</a>
<ul>
<li><a href="#estimation-1"><span class="toc-section-number">7.7.1</span> estimation</a></li>
<li><a href="#summary-4"><span class="toc-section-number">7.7.2</span> summary</a></li>
</ul></li>
</ul></li>
<li><a href="#ukbb"><span class="toc-section-number">8</span> UKBB recommended</a>
<ul>
<li><a href="#total-n-337k"><span class="toc-section-number">8.1</span> total N = 337k</a></li>
<li><a href="#qc-of-hp3-snps"><span class="toc-section-number">8.2</span> QC of hp3 SNPs</a></li>
<li><a href="#gwas-100k"><span class="toc-section-number">8.3</span> GWAS-100k</a></li>
<li><a href="#gwas-337k"><span class="toc-section-number">8.4</span> GWAS-337k</a></li>
<li><a href="#ldsc-100k"><span class="toc-section-number">8.5</span> ldsc-100k</a>
<ul>
<li><a href="#under-gcta-2"><span class="toc-section-number">8.5.1</span> under gcta</a></li>
<li><a href="#under-ldak-thin-2"><span class="toc-section-number">8.5.2</span> under ldak-thin</a></li>
<li><a href="#summary-5"><span class="toc-section-number">8.5.3</span> summary</a></li>
</ul></li>
<li><a href="#ldsc-337k"><span class="toc-section-number">8.6</span> ldsc-337k</a></li>
<li><a href="#aver2_j-337k"><span class="toc-section-number">8.7</span> aver2_j-337k</a>
<ul>
<li><a href="#calc"><span class="toc-section-number">8.7.1</span> calc</a></li>
<li><a href="#organize-data"><span class="toc-section-number">8.7.2</span> organize data</a></li>
<li><a href="#chisq-aver2_j"><span class="toc-section-number">8.7.3</span> chisq ~ aver2_j</a></li>
</ul></li>
<li><a href="#he-2"><span class="toc-section-number">8.8</span> HE</a>
<ul>
<li><a href="#making-grms-2"><span class="toc-section-number">8.8.1</span> making grms</a></li>
<li><a href="#estimation-2"><span class="toc-section-number">8.8.2</span> estimation</a></li>
<li><a href="#summary-6"><span class="toc-section-number">8.8.3</span> summary</a></li>
</ul></li>
</ul></li>
<li><a href="#control"><span class="toc-section-number">9</span> control GWAS</a>
<ul>
<li><a href="#id-list"><span class="toc-section-number">9.1</span> ID list</a></li>
<li><a href="#qc-of-hp3-snps-1"><span class="toc-section-number">9.2</span> QC of hp3 SNPs</a></li>
<li><a href="#gwas-1"><span class="toc-section-number">9.3</span> GWAS</a></li>
<li><a href="#ldsc-intercept-2"><span class="toc-section-number">9.4</span> ldsc intercept</a>
<ul>
<li><a href="#under-gcta-3"><span class="toc-section-number">9.4.1</span> under gcta</a></li>
<li><a href="#under-ldak-thin-3"><span class="toc-section-number">9.4.2</span> under ldak-thin</a></li>
<li><a href="#summary-7"><span class="toc-section-number">9.4.3</span> summary</a></li>
</ul></li>
<li><a href="#he-3"><span class="toc-section-number">9.5</span> HE</a>
<ul>
<li><a href="#making-grms-3"><span class="toc-section-number">9.5.1</span> making grms</a></li>
<li><a href="#estimation-3"><span class="toc-section-number">9.5.2</span> estimation</a></li>
<li><a href="#summary-8"><span class="toc-section-number">9.5.3</span> summary</a></li>
</ul></li>
</ul></li>
<li><a href="#inclusive-gwas"><span class="toc-section-number">10</span> inclusive GWAS</a>
<ul>
<li><a href="#qc"><span class="toc-section-number">10.1</span> QC</a></li>
<li><a href="#gwas-telomere-length"><span class="toc-section-number">10.2</span> gwas-telomere length</a>
<ul>
<li><a href="#aver2_j-1"><span class="toc-section-number">10.2.1</span> aver2_j</a></li>
<li><a href="#organize-data-1"><span class="toc-section-number">10.2.2</span> organize data</a></li>
<li><a href="#chisq-aver2_j-1"><span class="toc-section-number">10.2.3</span> chisq ~ aver2_j</a></li>
</ul></li>
<li><a href="#notesconcerns"><span class="toc-section-number">10.3</span> notes/concerns</a></li>
</ul></li>
<li><a href="#related-individuals"><span class="toc-section-number">11</span> related individuals</a>
<ul>
<li><a href="#genotyped-snps"><span class="toc-section-number">11.1</span> genotyped SNPs</a>
<ul>
<li><a href="#aver2_j-2"><span class="toc-section-number">11.1.1</span> aver2_j</a></li>
<li><a href="#gwas-2"><span class="toc-section-number">11.1.2</span> gwas</a></li>
<li><a href="#organize-data-2"><span class="toc-section-number">11.1.3</span> organize data</a></li>
<li><a href="#summary-9"><span class="toc-section-number">11.1.4</span> summary</a></li>
</ul></li>
<li><a href="#hapmap3-snps"><span class="toc-section-number">11.2</span> hapmap3 SNPs</a>
<ul>
<li><a href="#genotype-data"><span class="toc-section-number">11.2.1</span> genotype data</a></li>
<li><a href="#gwas-3"><span class="toc-section-number">11.2.2</span> gwas</a></li>
<li><a href="#aver2_j-3"><span class="toc-section-number">11.2.3</span> aver2_j</a></li>
<li><a href="#organize-data-3"><span class="toc-section-number">11.2.4</span> organize data</a></li>
<li><a href="#chisq-aver2_j-2"><span class="toc-section-number">11.2.5</span> chisq ~ aver2_j</a></li>
<li><a href="#inflation-aver2_j"><span class="toc-section-number">11.2.6</span> inflation ~ aver2_j</a></li>
</ul></li>
<li><a href="#mix-unrel-rel"><span class="toc-section-number">11.3</span> mix unrel &amp; rel</a>
<ul>
<li><a href="#genotype"><span class="toc-section-number">11.3.1</span> genotype</a></li>
<li><a href="#gwas-4"><span class="toc-section-number">11.3.2</span> gwas</a></li>
<li><a href="#aver2_j-4"><span class="toc-section-number">11.3.3</span> aver2_j</a></li>
<li><a href="#organize-data-4"><span class="toc-section-number">11.3.4</span> organize data</a></li>
<li><a href="#chisq-aver2_j-3"><span class="toc-section-number">11.3.5</span> chisq ~ aver2_j</a></li>
<li><a href="#inflation-aver2_j-1"><span class="toc-section-number">11.3.6</span> inflation ~ aver2_j</a></li>
</ul></li>
</ul></li>
<li><a href="#calc_aver2_j"><span class="toc-section-number">12</span> compute <span class="math inline">\(\sum_{i,j}^{m_1, m_2}r^2_{i,j}\)</span></a>
<ul>
<li><a href="#good-gwas-all-qced-snps"><span class="toc-section-number">12.1</span> good GWAS-all qced snps</a></li>
<li><a href="#good-gwass--ldak-thin-snps"><span class="toc-section-number">12.2</span> good GWASs- ldak-thin snps</a></li>
<li><a href="#bad-gwass-all-qced-snps"><span class="toc-section-number">12.3</span> bad GWASs-all qced snps</a></li>
<li><a href="#summary-10"><span class="toc-section-number">12.4</span> summary</a></li>
<li><a href="#compute-overliner2_j"><span class="toc-section-number">12.5</span> compute <span class="math inline">\(\overline{r^2_j}\)</span></a></li>
<li><a href="#mixed-pop-gwas-with-pc-as-covariates"><span class="toc-section-number">12.6</span> mixed pop GWAS with PC as covariates</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GWAS Quality Control</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="general-info" class="section level1" number="1">
<h1><span class="header-section-number">1</span> General Info</h1>
<div id="topic" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Topic</h2>
<p>We propose a new method to detect the inflation of GWAS test statistics caused by population stratification (&amp; cryptic relatedness). Here we document all analyses and results.</p>
<p><strong>Background</strong>:</p>
<ol style="list-style-type: decimal">
<li>Existing methods: use summary statistics to detect and correct inflation in GWAS test statistics.</li>
</ol>
<ul>
<li>genomic inflation factor:
<ul>
<li><span class="math inline">\(S_{median}\)</span>/<span class="math inline">\(\chi^2 (1)_{median}\)</span> &gt; 1 ?</li>
<li>does not account for inflation due to polygenicity</li>
</ul></li>
<li>LD score regression <span class="citation">(<a href="#ref-bulik2015ld" role="doc-biblioref">Bulik-Sullivan et al., 2015</a>)</span> (LDSC):
<ul>
<li><span class="math inline">\(S_{j} = 1 + n_{j}a + n_{j}\sum_{i}^{k}(r_{ji}^2 \ q_{i}/Q) h^2_{snp} + \epsilon_{j}\)</span>
<ul>
<li>under GCTA: <span class="math inline">\(q_{i}=1, Q=\sum_{i}^{m}q_i=m\)</span></li>
<li>under LDAK-thin: <span class="math inline">\(q_{i}=I_{i}[f_{i}(1-f_{i})]^{0.75}\)</span></li>
</ul></li>
<li>It separates the inflation due to confounding (intercept) and the inflation due to polygenicity (slope).</li>
<li>The inflation due to confounding may not be constant but SNP specific instead <span class="citation">(<a href="#ref-holmes" role="doc-biblioref">Holmes et al., 2019</a>)</span>. Hence, summary statistics may not be good after all to detect the inflation due to confounding.</li>
</ul></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Proposed method: use individual level data to detect inflation and maybe extended to summary statistics (?).</li>
</ol>
<ul>
<li><span class="math inline">\(T = (\hat{h^2}_{right} + \hat{h^2}_{left}) - \hat{h^2}_{whole} &gt; 0\)</span> ?</li>
<li>Confounding causes cross-chromosome correlations, such that each part of the genome tags each other. Hence, for confounded GWASs, <span class="math inline">\(T = (\hat{h^2}_{right} + \hat{h^2}_{left}) - \hat{h^2}_{whole} &gt; 0\)</span>.</li>
<li>when <span class="math inline">\(h_{right}^2, h_{left}^2, h_{whole}^2\)</span> are estimated using Haseman Elston regression, this test amounts to testing <span class="math inline">\(tr(K_{left}K_{right}) = 0\)</span> or average SNP correlation^2 (between left and right) = 0.</li>
<li>Challenge: We do not know the distribution of <span class="math inline">\(T\)</span> under the null (i.e., no confounding). Consequently, the test is an approximate test. We hope to get an exact test. Also we want to simplify the test by directly testing if <span class="math inline">\(tr(K_{left}K_{right}) = 0\)</span> or average SNP correlation^2 (between left and right) = 0. Still we need to work out the distribution of average SNP correlation^2 (between left and right) under the null (i.e., no association).</li>
</ul>
<p><strong>Design</strong>:</p>
<ul>
<li>good GWASs: 100k unrelated white British</li>
<li>bad or confounded GWASs: 93k unrelated white British + 7k blacks &amp; Asians</li>
<li>control GWASs: 93k unrelated white British + 7k unrelated white British (who are not included in the good GWASs)</li>
<li>We also checked if confouding is evident for the UKBB recommended white British (a randomly selection of 100k out of 337k), on which most UKBB GWASs are based.</li>
</ul>
<p><strong>Results</strong>:</p>
<p>So far the proposed and existing methods perform equally well.</p>
<ul>
<li>good GWAS: no sig. inflation due to confounding</li>
<li>bad GWAS: sig. inflation due to confounding</li>
<li>control GWAS: no sig. inflation due to confounding</li>
<li>UKBB recommended: no evidence of inflation by any of the methods.</li>
</ul>
<p>The proposed method does not seem to be more advantageous than existing methods. However, this does not mean that the existing methods are without problems. The inflation may not be constant as assumed by existing methods.</p>
</div>
<div id="frequently-used-commands" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Frequently used commands</h2>
<p><code>ssh -l zhoux login.genome.au.dk</code></p>
<p><code>sftp zhoux@login.genome.au.dk</code></p>
<p><code>lcd /home/zhoux/Dropbox/github/quality-control/main-files</code></p>
<p><code>cd /home/zhoux/dsmwpred/xuan/quality-control/qc-10oct</code></p>
<p><code>srun --mem=15g -c 2 -t 5:0:0 --constraint "s04|s05" -A snpher --pty /bin/bash</code></p>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="summaries" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Summaries</h1>
<p>To compare the proposed method against existing ones, we performed good and bad GWASs for 14 traits using N = 100k. While both sets of GWASs were based on quality-controlled genotype data, bad GWASs used individuals of different ethnicity and hence were confounded by population stratification, which is known to cause inflation in test statistics. As expected, for the good GWASs, no inflation was detected by the methods, though with some exceptions ( Tables @ref(tab:ldsc-sumher-good) ). In contrast, for the bad GWASs significant inflation was evident based on all methods ( see Tables @ref(tab:ldsc-sumher-bad) &amp; @ref(tab:he-bad) ). The detected inflation for the GWASs is not due to random errors because no inflation was observed for the control GWASs ( see Tables @ref(tab:ldsc-sumher-control) &amp; @ref(tab:he-control) )</p>
<div id="good-gwas" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Good GWAS</h2>
<p>Code for the good GWAS can be found in section @ref(good). Basically, we used 100k unrelated white British with quality-controlled genotype data for the GWASs. We tested the GWAS test statistics for inflation using ldsc, sumher and the proposed method (based on individual level data using Haseman Elston regression)</p>
<div id="ldsc-sumher" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> ldsc &amp; sumher</h3>
<div style="border: 0px;overflow-x: scroll; width:100%; border-bottom: 0;">
<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:ldsc-sumher-good)Good GWAS: LDSC regression line intercept estimates (SE) using ldsc and sumher
</caption>
<thead>
<tr>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
ldsc
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
sumher-gcta
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
sumher-ldak-thin
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
trait
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
awake
</td>
<td style="text-align:right;">
1.002
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.8e-01</span>
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.8e-01</span>
</td>
<td style="text-align:right;">
0.995
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.8e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
bmi
</td>
<td style="text-align:right;">
1.017
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.2e-02</span>
</td>
<td style="text-align:right;">
0.994
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.3e-01</span>
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.3e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
chron
</td>
<td style="text-align:right;">
1.012
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.2e-01</span>
</td>
<td style="text-align:right;">
1.011
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.0e-01</span>
</td>
<td style="text-align:right;">
1.013
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.4e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ever
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">9.4e-01</span>
</td>
<td style="text-align:right;">
0.996
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.1e-01</span>
</td>
<td style="text-align:right;">
0.995
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.6e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
fvc
</td>
<td style="text-align:right;">
1.032
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: red !important;">1.4e-03</span>
</td>
<td style="text-align:right;">
1.014
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.4e-01</span>
</td>
<td style="text-align:right;">
1.007
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.6e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
height
</td>
<td style="text-align:right;">
1.094
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:left;">
<span style="     color: red !important;">1.9e-08</span>
</td>
<td style="text-align:right;">
1.018
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.4e-01</span>
</td>
<td style="text-align:right;">
1.031
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.9e-03</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
hyper
</td>
<td style="text-align:right;">
1.018
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.6e-02</span>
</td>
<td style="text-align:right;">
1.013
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.5e-01</span>
</td>
<td style="text-align:right;">
1.002
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.6e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
imp
</td>
<td style="text-align:right;">
1.016
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.3e-01</span>
</td>
<td style="text-align:right;">
0.987
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.8e-01</span>
</td>
<td style="text-align:right;">
0.991
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.4e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
neur
</td>
<td style="text-align:right;">
1.004
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.8e-01</span>
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.1e-01</span>
</td>
<td style="text-align:right;">
0.996
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.5e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
pulse
</td>
<td style="text-align:right;">
1.029
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: red !important;">2.3e-03</span>
</td>
<td style="text-align:right;">
1.016
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.5e-02</span>
</td>
<td style="text-align:right;">
1.019
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.2e-02</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
quals
</td>
<td style="text-align:right;">
1.020
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.5e-02</span>
</td>
<td style="text-align:right;">
1.014
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.3e-01</span>
</td>
<td style="text-align:right;">
1.012
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.1e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
reaction
</td>
<td style="text-align:right;">
1.010
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.6e-01</span>
</td>
<td style="text-align:right;">
1.007
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.0e-01</span>
</td>
<td style="text-align:right;">
1.003
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
sbp
</td>
<td style="text-align:right;">
1.007
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.9e-01</span>
</td>
<td style="text-align:right;">
0.999
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.8e-01</span>
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.2e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
snoring
</td>
<td style="text-align:right;">
1.008
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.6e-01</span>
</td>
<td style="text-align:right;">
1.004
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.3e-01</span>
</td>
<td style="text-align:right;">
1.004
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.4e-01</span>
</td>
</tr>
</tbody>
</table>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<span style="font-style: italic;">Note: </span> <sup></sup> p-values are based on the wald test that compares the ldsc regression line intercept against 1. p-values &lt;= Bonferroni corrected alpha (i.e., 0.05/14) are highlighted
</td>
</tr>
</tfoot>
</div>
</div>
<div id="haseman-elston-regression" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Haseman Elston Regression</h3>
<div style="border: 0px;overflow-x: scroll; width:100%; border-bottom: 0;">
<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:he-good)Good GWAS: Heritability estimates (SE) using Haseman Elston regression under assumed heritability models
</caption>
<thead>
<tr>
<th style="text-align:left;">
trait
</th>
<th style="text-align:right;">
right_est
</th>
<th style="text-align:right;">
right_sd
</th>
<th style="text-align:right;">
left_est
</th>
<th style="text-align:right;">
left_sd
</th>
<th style="text-align:right;">
all_est
</th>
<th style="text-align:right;">
all_sd
</th>
<th style="text-align:left;">
p_inflation
</th>
</tr>
</thead>
<tbody>
<tr grouplength="14">
<td colspan="8" style="background-color: #666; color: #fff;">
<strong>under gcta</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
awake
</td>
<td style="text-align:right;">
0.040
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.073
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
bmi
</td>
<td style="text-align:right;">
0.137
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.126
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.263
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
chron
</td>
<td style="text-align:right;">
0.060
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.048
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.108
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.8e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
ever
</td>
<td style="text-align:right;">
0.041
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.043
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.085
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.1e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
fvc
</td>
<td style="text-align:right;">
0.110
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.210
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
height
</td>
<td style="text-align:right;">
0.294
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.264
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.558
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.8e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
imp
</td>
<td style="text-align:right;">
0.154
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.141
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.295
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
neur
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.057
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.121
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
pulse
</td>
<td style="text-align:right;">
0.081
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.076
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.156
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
quals
</td>
<td style="text-align:right;">
0.088
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.089
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.177
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.1e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
reaction
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.038
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.072
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.1e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
sbp
</td>
<td style="text-align:right;">
0.086
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.076
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.162
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
snoring
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.068
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
hyper
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.049
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.114
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.8e-01</span>
</td>
</tr>
<tr grouplength="14">
<td colspan="8" style="background-color: #666; color: #fff;">
<strong>under ldak-thin</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
awake
</td>
<td style="text-align:right;">
0.037
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.070
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
bmi
</td>
<td style="text-align:right;">
0.134
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.122
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
chron
</td>
<td style="text-align:right;">
0.056
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.048
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.104
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
ever
</td>
<td style="text-align:right;">
0.039
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.041
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.080
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
fvc
</td>
<td style="text-align:right;">
0.105
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.205
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
height
</td>
<td style="text-align:right;">
0.269
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.253
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.522
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
imp
</td>
<td style="text-align:right;">
0.149
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.135
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.284
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
neur
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.056
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.120
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
pulse
</td>
<td style="text-align:right;">
0.077
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.073
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.150
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
quals
</td>
<td style="text-align:right;">
0.085
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.089
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.173
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
reaction
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.038
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.072
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
sbp
</td>
<td style="text-align:right;">
0.088
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.076
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.163
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
snoring
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
hyper
</td>
<td style="text-align:right;">
0.068
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.049
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.117
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
</tbody>
</table>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<span style="font-style: italic;">Note: </span> <sup></sup> p-values are for testing whether the sum of ‘left’ and ‘right’ heritability estimates are greater than the heritability estimate based on the whole genome. p-values &lt;= Bonferroni corrected alpha (i.e., 0.05/14) are highlighted
</td>
</tr>
</tfoot>
</div>
</div>
</div>
<div id="bad-gwas" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Bad GWAS</h2>
<p>Code for the bad GWAS can be found in section @ref(bad). Basically, we used 100k unrelated individuals that consist of 93,528 whites and 6,472 blacks and Asians (i.e., mixed populations). Hence, the GWASs were confounded by population stratification. We performed the confounded GWASs and tested the test statistics for inflation using ldsc, sumher and the proposed method (based on individual level data using Haseman Elston regression)</p>
<div id="ldsc-sumher-1" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> ldsc &amp; sumher</h3>
<div style="border: 0px;overflow-x: scroll; width:100%; border-bottom: 0;">
<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:ldsc-sumher-bad)Bad GWAS: LDSC regression line intercept estimates (SE) using ldsc and sumher
</caption>
<thead>
<tr>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
ldsc
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
sumher-gcta
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
sumher-ldak-thin
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
trait
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
awake
</td>
<td style="text-align:right;">
3.441
</td>
<td style="text-align:right;">
0.027
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
3.513
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
3.758
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
bmi
</td>
<td style="text-align:right;">
5.040
</td>
<td style="text-align:right;">
0.030
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
8.893
</td>
<td style="text-align:right;">
0.066
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
9.536
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
chron
</td>
<td style="text-align:right;">
1.453
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:left;">
<span style="     color: red !important;">1.9e-311</span>
</td>
<td style="text-align:right;">
1.402
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:left;">
<span style="     color: red !important;">2.4e-283</span>
</td>
<td style="text-align:right;">
1.465
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ever
</td>
<td style="text-align:right;">
6.838
</td>
<td style="text-align:right;">
0.028
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
15.830
</td>
<td style="text-align:right;">
0.114
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
16.885
</td>
<td style="text-align:right;">
0.080
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
fvc
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
<span style="     color: black !important;"> NA</span>
</td>
<td style="text-align:right;">
78.325
</td>
<td style="text-align:right;">
0.564
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
83.464
</td>
<td style="text-align:right;">
0.393
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
height
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
<span style="     color: black !important;"> NA</span>
</td>
<td style="text-align:right;">
14.197
</td>
<td style="text-align:right;">
0.107
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
15.475
</td>
<td style="text-align:right;">
0.103
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
hyper
</td>
<td style="text-align:right;">
4.673
</td>
<td style="text-align:right;">
0.029
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
6.891
</td>
<td style="text-align:right;">
0.050
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
7.320
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
imp
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
<span style="     color: black !important;"> NA</span>
</td>
<td style="text-align:right;">
8.930
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
9.467
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
neur
</td>
<td style="text-align:right;">
4.179
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
5.349
</td>
<td style="text-align:right;">
0.038
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
5.682
</td>
<td style="text-align:right;">
0.027
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
pulse
</td>
<td style="text-align:right;">
1.444
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:left;">
<span style="     color: red !important;">7.8e-260</span>
</td>
<td style="text-align:right;">
1.406
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:left;">
<span style="     color: red !important;">1.5e-269</span>
</td>
<td style="text-align:right;">
1.452
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:left;">
<span style="     color: red !important;">2.5e-323</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
quals
</td>
<td style="text-align:right;">
2.082
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
2.023
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
2.147
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
reaction
</td>
<td style="text-align:right;">
8.123
</td>
<td style="text-align:right;">
0.031
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
33.822
</td>
<td style="text-align:right;">
0.241
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
35.822
</td>
<td style="text-align:right;">
0.169
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
sbp
</td>
<td style="text-align:right;">
3.028
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
3.050
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
<td style="text-align:right;">
3.313
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
snoring
</td>
<td style="text-align:right;">
1.050
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 3.1e-11</span>
</td>
<td style="text-align:right;">
1.052
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 5.2e-10</span>
</td>
<td style="text-align:right;">
1.047
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: red !important;"> 6.3e-08</span>
</td>
</tr>
</tbody>
</table>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<span style="font-style: italic;">Note: </span> <sup></sup> p-values are based on the wald test that compares the ldsc regression line intercept against 1. p-values &lt;= Bonferroni corrected alpha (i.e., 0.05/14) are highlighted
</td>
</tr>
</tfoot>
</div>
</div>
<div id="haseman-elston-regression-1" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Haseman Elston Regression</h3>
<div style="border: 0px;overflow-x: scroll; width:100%; border-bottom: 0;">
<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:he-bad)Bad GWAS: Heritability estimates (SE) using Haseman Elston regression under assumed heritability models
</caption>
<thead>
<tr>
<th style="text-align:left;">
trait
</th>
<th style="text-align:right;">
right_est
</th>
<th style="text-align:right;">
right_sd
</th>
<th style="text-align:right;">
left_est
</th>
<th style="text-align:right;">
left_sd
</th>
<th style="text-align:right;">
all_est
</th>
<th style="text-align:right;">
all_sd
</th>
<th style="text-align:left;">
p_inflation
</th>
</tr>
</thead>
<tbody>
<tr grouplength="14">
<td colspan="8" style="background-color: #666; color: #fff;">
<strong>under gcta</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
awake
</td>
<td style="text-align:right;">
0.075
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.075
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.080
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:left;">
<span style="     color: red !important;">1.8e-04</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
bmi
</td>
<td style="text-align:right;">
0.237
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.235
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.249
</td>
<td style="text-align:right;">
0.025
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
chron
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.0e-02</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
ever
</td>
<td style="text-align:right;">
0.439
</td>
<td style="text-align:right;">
0.028
</td>
<td style="text-align:right;">
0.434
</td>
<td style="text-align:right;">
0.027
</td>
<td style="text-align:right;">
0.461
</td>
<td style="text-align:right;">
0.029
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
fvc
</td>
<td style="text-align:right;">
2.280
</td>
<td style="text-align:right;">
0.063
</td>
<td style="text-align:right;">
2.237
</td>
<td style="text-align:right;">
0.062
</td>
<td style="text-align:right;">
2.384
</td>
<td style="text-align:right;">
0.067
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
height
</td>
<td style="text-align:right;">
0.406
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.402
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.426
</td>
<td style="text-align:right;">
0.024
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
imp
</td>
<td style="text-align:right;">
0.228
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
0.227
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
0.240
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
neur
</td>
<td style="text-align:right;">
0.128
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
0.129
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
0.136
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:left;">
<span style="     color: red !important;">1.0e-05</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
pulse
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.019
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.020
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:left;">
<span style="     color: red !important;">2.6e-03</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
quals
</td>
<td style="text-align:right;">
0.037
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.038
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.040
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: red !important;">2.9e-04</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
reaction
</td>
<td style="text-align:right;">
0.959
</td>
<td style="text-align:right;">
0.059
</td>
<td style="text-align:right;">
0.950
</td>
<td style="text-align:right;">
0.059
</td>
<td style="text-align:right;">
1.008
</td>
<td style="text-align:right;">
0.063
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
sbp
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
0.068
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:left;">
<span style="     color: red !important;">4.6e-04</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
snoring
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:left;">
<span style="     color: red !important;">3.1e-03</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
hyper
</td>
<td style="text-align:right;">
0.175
</td>
<td style="text-align:right;">
0.020
</td>
<td style="text-align:right;">
0.172
</td>
<td style="text-align:right;">
0.020
</td>
<td style="text-align:right;">
0.183
</td>
<td style="text-align:right;">
0.021
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr grouplength="14">
<td colspan="8" style="background-color: #666; color: #fff;">
<strong>under ldak-thin</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
awake
</td>
<td style="text-align:right;">
0.090
</td>
<td style="text-align:right;">
0.014
</td>
<td style="text-align:right;">
0.090
</td>
<td style="text-align:right;">
0.014
</td>
<td style="text-align:right;">
0.080
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:left;">
<span style="     color: red !important;">2.0e-05</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
bmi
</td>
<td style="text-align:right;">
0.278
</td>
<td style="text-align:right;">
0.027
</td>
<td style="text-align:right;">
0.273
</td>
<td style="text-align:right;">
0.027
</td>
<td style="text-align:right;">
0.249
</td>
<td style="text-align:right;">
0.025
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
chron
</td>
<td style="text-align:right;">
0.021
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.021
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:left;">
<span style="     color: red !important;">1.8e-03</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
ever
</td>
<td style="text-align:right;">
0.533
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.525
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:right;">
0.461
</td>
<td style="text-align:right;">
0.029
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
fvc
</td>
<td style="text-align:right;">
2.782
</td>
<td style="text-align:right;">
0.076
</td>
<td style="text-align:right;">
2.734
</td>
<td style="text-align:right;">
0.074
</td>
<td style="text-align:right;">
2.384
</td>
<td style="text-align:right;">
0.067
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
height
</td>
<td style="text-align:right;">
0.527
</td>
<td style="text-align:right;">
0.029
</td>
<td style="text-align:right;">
0.526
</td>
<td style="text-align:right;">
0.029
</td>
<td style="text-align:right;">
0.426
</td>
<td style="text-align:right;">
0.024
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
imp
</td>
<td style="text-align:right;">
0.283
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
0.281
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
0.240
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
neur
</td>
<td style="text-align:right;">
0.150
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
0.150
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
0.136
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
pulse
</td>
<td style="text-align:right;">
0.024
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.025
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.020
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:left;">
<span style="     color: red !important;">1.0e-05</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
quals
</td>
<td style="text-align:right;">
0.049
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.050
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.040
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
reaction
</td>
<td style="text-align:right;">
1.146
</td>
<td style="text-align:right;">
0.070
</td>
<td style="text-align:right;">
1.135
</td>
<td style="text-align:right;">
0.069
</td>
<td style="text-align:right;">
1.008
</td>
<td style="text-align:right;">
0.063
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
sbp
</td>
<td style="text-align:right;">
0.077
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.075
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.068
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:left;">
<span style="     color: red !important;">1.0e-05</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
snoring
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:left;">
<span style="     color: red !important;">5.0e-05</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
hyper
</td>
<td style="text-align:right;">
0.206
</td>
<td style="text-align:right;">
0.024
</td>
<td style="text-align:right;">
0.202
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.183
</td>
<td style="text-align:right;">
0.021
</td>
<td style="text-align:left;">
<span style="     color: red !important;">0.0e+00</span>
</td>
</tr>
</tbody>
</table>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<span style="font-style: italic;">Note: </span> <sup></sup> p-values are for testing whether the sum of ‘left’ and ‘right’ heritability estimates are greater than the heritability estimate based on the whole genome. p-values &lt;= Bonferroni corrected alpha (i.e., 0.05/14) are highlighted
</td>
</tr>
</tfoot>
</div>
</div>
</div>
<div id="ukbb-recommended" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> UKBB recommended</h2>
<p>Code for this GWAS can be found in section @ref(ukbb). Basically, we randomly selected 100k white British from a total of 337k individuals that are recommended by the UKBB (i.e., QCed by the UKBB). We performed the GWASs and tested the test statistics for inflation using ldsc, sumher and the proposed method (based on individual level data using Haseman Elston regression).</p>
<div id="ldsc-sumher-2" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> ldsc &amp; sumher</h3>
<div style="border: 0px;overflow-x: scroll; width:100%; border-bottom: 0;">
<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:ldsc-sumher-ukbb)UKBB recommended: LDSC regression line intercept estimates (SE) using ldsc and sumher
</caption>
<thead>
<tr>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
ldsc
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
sumher-gcta
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
sumher-ldak-thin
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
trait
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
awake
</td>
<td style="text-align:right;">
1.017
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">9.8e-03</span>
</td>
<td style="text-align:right;">
1.015
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.0e-02</span>
</td>
<td style="text-align:right;">
1.012
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
bmi
</td>
<td style="text-align:right;">
1.016
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.4e-02</span>
</td>
<td style="text-align:right;">
0.995
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.1e-01</span>
</td>
<td style="text-align:right;">
0.996
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.6e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
chron
</td>
<td style="text-align:right;">
1.014
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.2e-02</span>
</td>
<td style="text-align:right;">
1.008
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.4e-01</span>
</td>
<td style="text-align:right;">
1.010
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.4e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ever
</td>
<td style="text-align:right;">
0.990
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.3e-01</span>
</td>
<td style="text-align:right;">
0.986
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.1e-01</span>
</td>
<td style="text-align:right;">
0.986
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.1e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
fvc
</td>
<td style="text-align:right;">
1.036
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: red !important;">2.8e-05</span>
</td>
<td style="text-align:right;">
1.021
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.4e-02</span>
</td>
<td style="text-align:right;">
1.018
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.4e-02</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
height
</td>
<td style="text-align:right;">
1.102
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:left;">
<span style="     color: red !important;">2.9e-11</span>
</td>
<td style="text-align:right;">
1.030
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.1e-02</span>
</td>
<td style="text-align:right;">
1.043
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:left;">
<span style="     color: red !important;">2.4e-04</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
hyper
</td>
<td style="text-align:right;">
1.010
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.7e-01</span>
</td>
<td style="text-align:right;">
1.003
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.9e-01</span>
</td>
<td style="text-align:right;">
1.003
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.3e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
imp
</td>
<td style="text-align:right;">
1.029
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: red !important;">1.2e-03</span>
</td>
<td style="text-align:right;">
1.004
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.9e-01</span>
</td>
<td style="text-align:right;">
1.005
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.8e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
neur
</td>
<td style="text-align:right;">
1.010
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.9e-01</span>
</td>
<td style="text-align:right;">
1.007
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.1e-01</span>
</td>
<td style="text-align:right;">
1.001
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
pulse
</td>
<td style="text-align:right;">
1.007
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.2e-01</span>
</td>
<td style="text-align:right;">
0.992
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.0e-01</span>
</td>
<td style="text-align:right;">
0.995
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.6e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
quals
</td>
<td style="text-align:right;">
1.015
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.4e-02</span>
</td>
<td style="text-align:right;">
1.004
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.9e-01</span>
</td>
<td style="text-align:right;">
1.002
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.5e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
reaction
</td>
<td style="text-align:right;">
1.016
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.1e-02</span>
</td>
<td style="text-align:right;">
1.015
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.1e-02</span>
</td>
<td style="text-align:right;">
1.016
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.1e-02</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
sbp
</td>
<td style="text-align:right;">
1.022
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.9e-03</span>
</td>
<td style="text-align:right;">
1.016
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.0e-02</span>
</td>
<td style="text-align:right;">
1.011
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.1e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
snoring
</td>
<td style="text-align:right;">
1.005
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.6e-01</span>
</td>
<td style="text-align:right;">
1.002
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.5e-01</span>
</td>
<td style="text-align:right;">
1.001
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.9e-01</span>
</td>
</tr>
</tbody>
</table>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<span style="font-style: italic;">Note: </span> <sup></sup> p-values are based on the wald test that compares the ldsc regression line intercept against 1. p-values &lt;= Bonferroni corrected alpha (i.e., 0.05/14) are highlighted
</td>
</tr>
</tfoot>
</div>
</div>
<div id="haseman-elston-regression-2" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Haseman Elston Regression</h3>
<div style="border: 0px;overflow-x: scroll; width:100%; border-bottom: 0;">
<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:he-ukbb) UKBB recommended: Heritability estimates (SE) using Haseman Elston regression under assumed heritability models
</caption>
<thead>
<tr>
<th style="text-align:left;">
trait
</th>
<th style="text-align:right;">
right_est
</th>
<th style="text-align:right;">
right_sd
</th>
<th style="text-align:right;">
left_est
</th>
<th style="text-align:right;">
left_sd
</th>
<th style="text-align:right;">
all_est
</th>
<th style="text-align:right;">
all_sd
</th>
<th style="text-align:left;">
p_inflation
</th>
</tr>
</thead>
<tbody>
<tr grouplength="14">
<td colspan="8" style="background-color: #666; color: #fff;">
<strong>under gcta</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
awake
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.030
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:right;">
0.062
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
bmi
</td>
<td style="text-align:right;">
0.135
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.124
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.251
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
chron
</td>
<td style="text-align:right;">
0.061
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.048
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.104
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
ever
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.040
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.071
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
fvc
</td>
<td style="text-align:right;">
0.098
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.103
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.194
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.4e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
height
</td>
<td style="text-align:right;">
0.274
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.264
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.522
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.7e-02</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
imp
</td>
<td style="text-align:right;">
0.142
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.142
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.276
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
neur
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.055
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.115
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.3e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
pulse
</td>
<td style="text-align:right;">
0.084
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.077
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.155
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.5e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
quals
</td>
<td style="text-align:right;">
0.084
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.089
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.168
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.4e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
reaction
</td>
<td style="text-align:right;">
0.037
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.040
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.075
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
sbp
</td>
<td style="text-align:right;">
0.086
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.073
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.154
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.8e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
snoring
</td>
<td style="text-align:right;">
0.038
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.067
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
hyper
</td>
<td style="text-align:right;">
0.057
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.046
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.2e-01</span>
</td>
</tr>
<tr grouplength="14">
<td colspan="8" style="background-color: #666; color: #fff;">
<strong>under ldak-thin</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
awake
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.031
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:right;">
0.062
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.2e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
bmi
</td>
<td style="text-align:right;">
0.134
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.122
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.251
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
chron
</td>
<td style="text-align:right;">
0.059
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.047
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.104
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
ever
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.039
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.071
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
fvc
</td>
<td style="text-align:right;">
0.094
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.101
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.194
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.3e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
height
</td>
<td style="text-align:right;">
0.257
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.249
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.522
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">9.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
imp
</td>
<td style="text-align:right;">
0.138
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.135
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.276
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
neur
</td>
<td style="text-align:right;">
0.069
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.055
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.115
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
pulse
</td>
<td style="text-align:right;">
0.081
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.074
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.155
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.6e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
quals
</td>
<td style="text-align:right;">
0.083
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.088
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.168
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.8e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
reaction
</td>
<td style="text-align:right;">
0.036
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.038
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.075
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.1e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
sbp
</td>
<td style="text-align:right;">
0.085
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.072
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.154
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
snoring
</td>
<td style="text-align:right;">
0.035
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.067
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
hyper
</td>
<td style="text-align:right;">
0.055
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
</tbody>
</table>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<span style="font-style: italic;">Note: </span> <sup></sup> p-values are for testing whether the sum of ‘left’ and ‘right’ heritability estimates are greater than the heritability estimate based on the whole genome. p-values &lt;= Bonferroni corrected alpha (i.e., 0.05/14) are highlighted
</td>
</tr>
</tfoot>
</div>
</div>
</div>
<div id="control-gwas" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Control GWAS</h2>
<p>Code for this GWAS can be found in section @ref(control). In short, we performed GWASs that serve as the control for the good versus bad GWASs comparison. This to ascertain that the observed inflation of bad GWAS test statistics is due to population stratification not random errors. We used a total of 100k that included 93,528 unrelated white British (also included in the bad and good GWAS) and 6,472 unrelated white British that were neither included in the good GWASs nor bad GWASs.</p>
<div id="ldsc-sumher-3" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> ldsc &amp; sumher</h3>
<div style="border: 0px;overflow-x: scroll; width:100%; border-bottom: 0;">
<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:ldsc-sumher-control)Control GWASs: LDSC regression line intercept estimates (SE) using ldsc and sumher
</caption>
<thead>
<tr>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
ldsc
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
sumher-gcta
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
sumher-ldak-thin
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
trait
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:left;">
wald_p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
awake
</td>
<td style="text-align:right;">
0.996
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.4e-01</span>
</td>
<td style="text-align:right;">
0.992
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.6e-01</span>
</td>
<td style="text-align:right;">
0.994
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.5e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
bmi
</td>
<td style="text-align:right;">
1.014
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.1e-01</span>
</td>
<td style="text-align:right;">
0.991
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.9e-01</span>
</td>
<td style="text-align:right;">
0.991
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.6e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
chron
</td>
<td style="text-align:right;">
1.009
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.2e-01</span>
</td>
<td style="text-align:right;">
1.008
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.4e-01</span>
</td>
<td style="text-align:right;">
1.011
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ever
</td>
<td style="text-align:right;">
0.999
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">9.2e-01</span>
</td>
<td style="text-align:right;">
0.996
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.4e-01</span>
</td>
<td style="text-align:right;">
0.993
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
fvc
</td>
<td style="text-align:right;">
1.034
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: red !important;">5.1e-04</span>
</td>
<td style="text-align:right;">
1.015
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.3e-01</span>
</td>
<td style="text-align:right;">
1.007
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.6e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
height
</td>
<td style="text-align:right;">
1.097
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:left;">
<span style="     color: red !important;">7.0e-09</span>
</td>
<td style="text-align:right;">
1.019
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.1e-01</span>
</td>
<td style="text-align:right;">
1.032
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.5e-03</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
hyper
</td>
<td style="text-align:right;">
1.017
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.9e-02</span>
</td>
<td style="text-align:right;">
1.011
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.3e-01</span>
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">9.6e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
imp
</td>
<td style="text-align:right;">
1.012
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.8e-01</span>
</td>
<td style="text-align:right;">
0.983
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">9.5e-02</span>
</td>
<td style="text-align:right;">
0.988
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.1e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
neur
</td>
<td style="text-align:right;">
1.001
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">9.4e-01</span>
</td>
<td style="text-align:right;">
0.995
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.0e-01</span>
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">6.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
pulse
</td>
<td style="text-align:right;">
1.028
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: red !important;">2.8e-03</span>
</td>
<td style="text-align:right;">
1.012
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.8e-01</span>
</td>
<td style="text-align:right;">
1.015
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">9.9e-02</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
quals
</td>
<td style="text-align:right;">
1.020
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.8e-02</span>
</td>
<td style="text-align:right;">
1.014
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.5e-01</span>
</td>
<td style="text-align:right;">
1.012
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.2e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
reaction
</td>
<td style="text-align:right;">
1.013
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">7.4e-02</span>
</td>
<td style="text-align:right;">
1.008
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.4e-01</span>
</td>
<td style="text-align:right;">
1.006
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
sbp
</td>
<td style="text-align:right;">
1.010
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.7e-01</span>
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">9.8e-01</span>
</td>
<td style="text-align:right;">
0.999
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">9.2e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
snoring
</td>
<td style="text-align:right;">
1.010
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.7e-01</span>
</td>
<td style="text-align:right;">
1.007
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.3e-01</span>
</td>
<td style="text-align:right;">
1.008
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.8e-01</span>
</td>
</tr>
</tbody>
</table>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<span style="font-style: italic;">Note: </span> <sup></sup> p-values are based on the wald test that compares the ldsc regression line intercept against 1. p-values &lt;= Bonferroni corrected alpha (i.e., 0.05/14) are highlighted
</td>
</tr>
</tfoot>
</div>
</div>
<div id="haseman-elston-regression-3" class="section level3" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Haseman Elston Regression</h3>
<div style="border: 0px;overflow-x: scroll; width:100%; border-bottom: 0;">
<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:he-control) Control GWASs: Heritability estimates (SE) using Haseman Elston regression under assumed heritability models
</caption>
<thead>
<tr>
<th style="text-align:left;">
trait
</th>
<th style="text-align:right;">
right_est
</th>
<th style="text-align:right;">
right_sd
</th>
<th style="text-align:right;">
left_est
</th>
<th style="text-align:right;">
left_sd
</th>
<th style="text-align:right;">
all_est
</th>
<th style="text-align:right;">
all_sd
</th>
<th style="text-align:left;">
p_inflation
</th>
</tr>
</thead>
<tbody>
<tr grouplength="14">
<td colspan="8" style="background-color: #666; color: #fff;">
<strong>under gcta</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
awake
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.030
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:right;">
0.062
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
bmi
</td>
<td style="text-align:right;">
0.135
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.124
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.251
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
chron
</td>
<td style="text-align:right;">
0.061
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.048
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.104
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
ever
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.040
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.071
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
fvc
</td>
<td style="text-align:right;">
0.098
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.103
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.194
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.4e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
height
</td>
<td style="text-align:right;">
0.274
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.264
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.522
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">8.7e-02</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
imp
</td>
<td style="text-align:right;">
0.142
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.142
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.276
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
neur
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.055
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.115
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.3e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
pulse
</td>
<td style="text-align:right;">
0.084
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.077
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.155
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.5e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
quals
</td>
<td style="text-align:right;">
0.084
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.089
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.168
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.4e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
reaction
</td>
<td style="text-align:right;">
0.037
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.040
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.075
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
sbp
</td>
<td style="text-align:right;">
0.086
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.073
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.154
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">2.8e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
snoring
</td>
<td style="text-align:right;">
0.038
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.067
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
hyper
</td>
<td style="text-align:right;">
0.057
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.046
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.2e-01</span>
</td>
</tr>
<tr grouplength="14">
<td colspan="8" style="background-color: #666; color: #fff;">
<strong>under ldak-thin</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
awake
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.031
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:right;">
0.062
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.2e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
bmi
</td>
<td style="text-align:right;">
0.134
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.122
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.251
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
chron
</td>
<td style="text-align:right;">
0.059
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.047
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.104
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
ever
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.039
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.071
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
fvc
</td>
<td style="text-align:right;">
0.094
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.101
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.194
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.3e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
height
</td>
<td style="text-align:right;">
0.257
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.249
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.522
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<span style="     color: black !important;">9.0e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
imp
</td>
<td style="text-align:right;">
0.138
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.135
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.276
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
neur
</td>
<td style="text-align:right;">
0.069
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.055
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.115
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.9e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
pulse
</td>
<td style="text-align:right;">
0.081
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.074
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.155
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.6e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
quals
</td>
<td style="text-align:right;">
0.083
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.088
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.168
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.8e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
reaction
</td>
<td style="text-align:right;">
0.036
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.038
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.075
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.1e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
sbp
</td>
<td style="text-align:right;">
0.085
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.072
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.154
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
<span style="     color: black !important;">3.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
snoring
</td>
<td style="text-align:right;">
0.035
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.067
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<span style="     color: black !important;">4.7e-01</span>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
hyper
</td>
<td style="text-align:right;">
0.055
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:left;">
<span style="     color: black !important;">5.0e-01</span>
</td>
</tr>
</tbody>
</table>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<span style="font-style: italic;">Note: </span> <sup></sup> p-values are for testing whether the sum of ‘left’ and ‘right’ heritability estimates are greater than the heritability estimate based on the whole genome. p-values &lt;= Bonferroni corrected alpha (i.e., 0.05/14) are highlighted
</td>
</tr>
</tfoot>
</div>
<!--chapter:end:01-summaries.Rmd-->
</div>
</div>
</div>
<div id="good-vs-bad-gwas" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Good VS Bad GWAS</h1>
<p>Here we investigate the inflation in test statistics from the bad GWASs. We want to find out 1) if the inflation is constant; 2) if it can be predicted in some way.</p>
<div id="test-statistics-ld-score" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> test statistics ~ LD score</h2>
<p>The inflation in GWAS test statistics due to confouding is not always constant, as assumed by LDSC. Below we plotted the chi-square test statistics from the bad (colored in red), good (orange), and control (gray) GWASs as a function of LD score ( Fig @ref(fig:good-vs-bad-by-ldscorebin) ). The linear model assumed by LDSC is only appropriate for four traits, namely chron, pulse, quals, and snoring. For these traits, LDSC accounts for the inflation due to confounding (i.e., intercept) and the inflation due to polygenity (i.e., slope). However, LDSC is inadequate for other traits, where the inflation is non-linear. More specifically, for these traits, the test statistics for SNPs with a low LD score are much more inflated than would be expected by LDSC. Thus, although LDSC can detect the inflation in GWAS test statistics due to confounding, it cannot be used to correct the inflation for some traits.</p>
<div class="figure" style="text-align: left">
<img src="fig-to-insert/gwas-stat-by-ldscbin.png" alt="Test statistics by LD score for good, bad and control GWASs." width="100%" />
<p class="caption">
(#fig:good-vs-bad-by-ldscorebin)Test statistics by LD score for good, bad and control GWASs.
</p>
</div>
</div>
<div id="new-models" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> New models?</h2>
<ol style="list-style-type: decimal">
<li><ul>
<li><span class="math inline">\(S_{j} = 1 + n_{j}a + n_{j}\sum_{i}^{m}(r_{ji}^2 \ q_{i}/Q) h^2_{snp} + \epsilon_{j}\)</span>
<ul>
<li>under GCTA: <span class="math inline">\(q_{i}=1, Q=\sum_{i}^{m}q_i=m\)</span></li>
<li>under LDAK-thin: <span class="math inline">\(q_{i}=I_{i}[f_{i}(1-f_{i})]^{0.75}\)</span></li>
</ul></li>
</ul></li>
<li><ul>
<li><span class="math inline">\(S_{j} = 1 + n_{j}a + n_{j}\sum_{i}^{k}(r_{ji}^2 \ q_{i}/Q) h^2_{snp} + n_j \sum ()h + \epsilon_{j}\)</span>
<ul>
<li>under GCTA: <span class="math inline">\(q_{i}=1, Q=\sum_{i}^{m}q_i=m\)</span></li>
<li>under LDAK-thin: <span class="math inline">\(q_{i}=I_{i}[f_{i}(1-f_{i})]^{0.75}\)</span></li>
</ul></li>
</ul></li>
</ol>
</div>
<div id="ld-scores-based-on-individual-level-data" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> LD scores based on individual level data</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ldsc/ldscore-individual-data</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gen/snps-unrel-inds-by-chrom</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># divide snp list by chrom</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;{split($0, a , &quot;:&quot;)} (a[1]==i) {print $0}&#39;</span> gen/snps-unrel-inds.use <span class="op">&gt;</span> gen/snps-unrel-inds-by-chrom/snps-unrel-inds-<span class="va">$i</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># compute LD scores</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 80G</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="st">.././ldsc.py </span><span class="dt">\</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="st">      --bfile ../../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="st">      --extract ../../gen/snps-unrel-inds-by-chrom/snps-unrel-inds-</span><span class="va">$i</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="st">      --keep ../../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="st">      --l2 </span><span class="dt">\</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="st">      --ld-wind-cm 1 </span><span class="dt">\</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="st">      --out ../ldscore-individual-data/ldsc-mix-</span><span class="va">$i</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/compute-ldsc-<span class="va">$i</span>.sh</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/compute-ldsc-<span class="va">$i</span>.sh</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../../job-records/compute-ldsc-mix</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/compute-ldsc-mix</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="test-the-new-model" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Test the new model</h2>
<p>Inflation = np^2 (h2-h2local) &lt;=np^2</p>
<ol style="list-style-type: decimal">
<li><p>extract heritability estimates from good GWASs</p></li>
<li><p>n<em>p2</em>h2</p></li>
<li><p><span class="math inline">\(S_{true}\)</span> vs <span class="math inline">\(\hat{S}_{ldsc}\)</span> vs <span class="math inline">\(\hat{S}_{new}\)</span></p></li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract heritability estimates</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>h2_gcta<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-gcta-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>h2_ldak<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-ldak-thin-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># average r_ij^2</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>r2_good<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;inflation/summary/ave-r2-1k-snps-goodgwas&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>r2_bad<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;inflation/summary/ave-r2-1k-snps-badgwas&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>r2_good<span class="ot">=</span><span class="fu">mean</span>(r2_good<span class="sc">$</span>V1)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>r2_bad<span class="ot">=</span><span class="fu">mean</span>(r2_bad<span class="sc">$</span>V1)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept estimates</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>ldsc_bad<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;summary/ldsc-mix&quot;</span>, <span class="at">header=</span>F, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># GWAS test stats &amp; LD scores</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;vroom&quot;</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># c(&quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;)</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/predcited-chisq-by-ldscbin.png&quot;</span>),</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">100000</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>ldsc_intercept<span class="ot">=</span>ldsc_bad<span class="sc">$</span>V2[ldsc_bad<span class="sc">$</span>V1<span class="sc">==</span>trait]</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>h2<span class="ot">=</span>h2_ldak<span class="sc">$</span>all_est[h2_ldak<span class="sc">$</span>code<span class="sc">==</span>trait]</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>,trait,<span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>chisq_ldsc<span class="ot">=</span>dat<span class="sc">$</span>good_chisq<span class="sc">+</span>ldsc_intercept<span class="dv">-1</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>chisq_new<span class="ot">=</span>dat<span class="sc">$</span>good_chisq<span class="sc">+</span>n<span class="sc">*</span>r2_bad<span class="sc">*</span>h2</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">ave_ldscore=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>ldsc_ref,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_chisq_ldsc=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq_ldsc,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_chisq_new=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq_new,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_good_chisq=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>good_chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_bad_chisq=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>bad_chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean))</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>end<span class="ot">=</span><span class="fu">round</span>(<span class="fu">max</span>(<span class="fu">c</span>(out[,<span class="dv">2</span>], out[,<span class="dv">3</span>], out[,<span class="dv">4</span>]), out[,<span class="dv">5</span>]),<span class="dv">0</span>)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="fu">round</span>(<span class="fu">min</span>(<span class="fu">c</span>(out[,<span class="dv">2</span>], out[,<span class="dv">3</span>], out[,<span class="dv">4</span>]), out[,<span class="dv">5</span>]),<span class="dv">0</span>)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>ave_ldscore, out<span class="sc">$</span>ave_bad_chisq,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ldscore bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisquare&quot;</span>, </span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out<span class="sc">$</span>ave_ldscore, out<span class="sc">$</span>ave_chisq_new,</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>)</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out<span class="sc">$</span>ave_ldscore, out<span class="sc">$</span>ave_chisq_ldsc,</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="co">#points(out$ave_ldscore, out$ave_good_chisq,</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="co">#       cex = 1.5, pch=21, col=&quot;white&quot;, bg=&quot;gray&quot;)</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="predictors-of-inflation" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> predictors of inflation?</h2>
<p>Potential predictors considered:
1. MAF
2. ave r^2_ij for each j cross chromsomes [10k SNPs]</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># prep: convert snp labels to rs system</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1]; b[$1]=$2; next}($1 in a){print b[$1], $2, $3, $5}&#39;</span> doug/ukbb.ldsc gen/geno-unrel.stats <span class="op">&gt;</span> gen/geno-unrel-rs.maf</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="st">&quot;vroom&quot;</span><span class="kw">)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># files for maf &amp; ave r2 by snp</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="va">stat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;gen/geno-unrel-rs.maf&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="va">r2_good</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;summary/ave-r2-by-snp-goodgwas-rs&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="va">r2_bad</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;summary/ave-r2-by-snp-badgwas-rs&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># compute inflation in chisq (good vs. bad) by trait</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="va">inflation</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">snp</span><span class="op">=</span>dat<span class="va">$SNP</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                     <span class="va">inflation</span><span class="op">=</span>dat<span class="va">$bad_chisq</span>-dat<span class="va">$good_chisq</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                     <span class="va">bad_chisq</span><span class="op">=</span>dat<span class="va">$bad_chisq</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>                     <span class="va">good_chisq</span><span class="op">=</span>dat<span class="va">$good_chisq</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>                     <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">inflation</span><span class="va">$snp</span><span class="ex">,</span> stat<span class="va">$X1</span><span class="kw">)</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">inflation</span><span class="va">$snp</span><span class="ex">,r2_good</span><span class="va">$X1</span><span class="kw">)</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">inflation</span><span class="va">$snp</span><span class="ex">,r2_bad</span><span class="va">$X1</span><span class="kw">)</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="ex">inflation,</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>               <span class="va">maf</span><span class="op">=</span>stat<span class="va">$X4</span>[m1], </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>               <span class="va">r2_good</span><span class="op">=</span>r2_good<span class="va">$X2</span>[m2],</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>               <span class="va">r2_bad</span><span class="op">=</span>r2_bad<span class="va">$X2</span>[m2], <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co"># bin maf &amp; r2_bad according to quantiles</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="va">cutoff1</span><span class="op">=</span>quantile<span class="kw">(</span><span class="ex">out</span><span class="va">$maf</span><span class="ex">,</span> probs = seq<span class="er">(</span><span class="ex">0,</span> 1, 0.005<span class="kw">)</span><span class="ex">,</span> na.rm=T<span class="kw">)</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="va">cutoff2</span><span class="op">=</span>quantile<span class="kw">(</span><span class="ex">out</span><span class="va">$r2_bad</span><span class="ex">,</span> probs = seq<span class="er">(</span><span class="ex">0,</span> 1, 0.005<span class="kw">)</span><span class="ex">,</span> na.rm=T<span class="kw">)</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$maf_bin</span><span class="ex">=cut</span><span class="er">(</span><span class="ex">out</span><span class="va">$maf</span><span class="ex">,</span> breaks=cutoff1, labels=1:<span class="er">(</span><span class="ex">length</span><span class="er">(</span><span class="ex">cutoff1</span><span class="kw">)</span><span class="ex">-1</span><span class="kw">))</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$r2_bad_bin</span><span class="ex">=cut</span><span class="er">(</span><span class="ex">out</span><span class="va">$r2_bad</span><span class="ex">,</span> breaks=cutoff2, labels=1:<span class="er">(</span><span class="ex">length</span><span class="er">(</span><span class="ex">cutoff2</span><span class="kw">)</span><span class="ex">-1</span><span class="kw">))</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;inflation/summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-inflation-by-maf-r2&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co"># plot by maf</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> </span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="ex">png</span><span class="er">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;fig/inflation-by-mafbin.png&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="ex">width</span> =40, height = 30, units = <span class="st">&quot;cm&quot;</span>, res=600<span class="kw">)</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="ex">par</span><span class="er">(</span><span class="va">mfrow</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">3,4</span><span class="kw">))</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-inflation-by-maf-r2&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>dat[,c<span class="kw">(</span><span class="st">&quot;snp&quot;</span><span class="ex">,</span><span class="st">&quot;inflation&quot;</span><span class="ex">,</span><span class="st">&quot;maf&quot;</span><span class="ex">,</span><span class="st">&quot;maf_bin&quot;</span><span class="kw">)</span><span class="ex">]</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>sel[complete.cases<span class="kw">(</span><span class="ex">sel</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">inflation</span><span class="op">=</span>tapply<span class="kw">(</span><span class="ex">sel</span><span class="va">$inflation</span><span class="ex">,INDEX=sel</span><span class="va">$maf_bin</span><span class="ex">,</span> mean<span class="kw">))</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$maf_bin</span><span class="ex">=1:dim</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">[1]</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$maf_bin_val</span><span class="ex">=tapply</span><span class="er">(</span><span class="ex">sel</span><span class="va">$maf</span><span class="ex">,INDEX=sel</span><span class="va">$maf_bin</span><span class="ex">,</span> mean<span class="kw">)</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="ex">plot</span><span class="er">(</span><span class="ex">out</span><span class="va">$maf_bin_val</span><span class="ex">,</span> out<span class="va">$inflation</span>,</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>     <span class="va">xlab</span><span class="op">=</span><span class="st">&quot;maf bin&quot;</span>, <span class="va">ylab</span><span class="op">=</span><span class="st">&quot;mean inflation&quot;</span>,</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>     <span class="va">main</span><span class="op">=</span>trait, <span class="va">las</span><span class="op">=</span>1,</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>     <span class="ex">cex</span> = 1.5, pch=21,  bg=<span class="st">&quot;grey&quot;</span>, col=<span class="st">&quot;white&quot;</span>, lwd=0.5<span class="kw">)</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off()</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="co"># plot by r2_bad bin</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> </span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="ex">png</span><span class="er">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;fig/inflation-by-aver2.png&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    <span class="ex">width</span> =40, height = 30, units = <span class="st">&quot;cm&quot;</span>, res=600<span class="kw">)</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="ex">par</span><span class="er">(</span><span class="va">mfrow</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">3,4</span><span class="kw">))</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-inflation-by-maf-r2&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>dat[,c<span class="kw">(</span><span class="st">&quot;snp&quot;</span><span class="ex">,</span><span class="st">&quot;inflation&quot;</span><span class="ex">,</span><span class="st">&quot;r2_bad&quot;</span><span class="ex">,</span><span class="st">&quot;r2_bad_bin&quot;</span><span class="kw">)</span><span class="ex">]</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>sel[complete.cases<span class="kw">(</span><span class="ex">sel</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">inflation</span><span class="op">=</span>tapply<span class="kw">(</span><span class="ex">sel</span><span class="va">$inflation</span><span class="ex">,INDEX=sel</span><span class="va">$r2_bad_bin</span><span class="ex">,</span> mean<span class="kw">))</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$r2_bad_bin</span><span class="ex">=1:dim</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">[1]</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$r2_bad_bin_val</span><span class="ex">=tapply</span><span class="er">(</span><span class="ex">sel</span><span class="va">$r2_bad</span><span class="ex">,INDEX=sel</span><span class="va">$r2_bad_bin</span><span class="ex">,</span> mean<span class="kw">)</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="ex">plot</span><span class="er">(</span><span class="ex">out</span><span class="va">$r2_bad_bin_val</span><span class="ex">,</span> out<span class="va">$inflation</span>,</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>     <span class="va">xlab</span><span class="op">=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="va">ylab</span><span class="op">=</span><span class="st">&quot;mean inflation&quot;</span>,</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>     <span class="va">main</span><span class="op">=</span>trait, <span class="va">las</span><span class="op">=</span>1,</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>     <span class="ex">cex</span> = 1.5, pch=21,  bg=<span class="st">&quot;grey&quot;</span>, col=<span class="st">&quot;white&quot;</span>, lwd=0.5<span class="kw">)</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off()</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## inflation by raw ave r2 </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fvc&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-by-aver2-raw.png&quot;</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;inflation&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>)]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_bad, sel<span class="sc">$</span>inflation,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation&quot;</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-by-aver2-goodgwas-raw.png&quot;</span>),</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;inflation&quot;</span>,<span class="st">&quot;r2_good&quot;</span>)]</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_good, sel<span class="sc">$</span>inflation,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation&quot;</span>,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="do">## histogram</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/hist-aver2-goodgwas.png&quot;</span>),</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;inflation&quot;</span>,<span class="st">&quot;r2_good&quot;</span>)]</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(sel<span class="sc">$</span>r2_good, <span class="at">breaks=</span><span class="dv">100</span>, <span class="at">main=</span>trait)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="regress-bad-chisq-mean-r2_j" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> regress bad chisq ~ mean r^2_j</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># by binned ave r2</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># bad chisq by binned ave r2 </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/badgwas-chisq-by-aver2-bin.png&quot;</span>),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;bad_chisq&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>,<span class="st">&quot;r2_bad_bin&quot;</span>)]</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">bad_chisq=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>bad_chisq,<span class="at">INDEX=</span>sel<span class="sc">$</span>r2_bad_bin, mean))</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_bad_bin<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(out)[<span class="dv">1</span>]</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_bad_bin_val<span class="ot">=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>r2_bad,<span class="at">INDEX=</span>sel<span class="sc">$</span>r2_bad_bin, mean)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>r2_bad_bin_val, out<span class="sc">$</span>bad_chisq,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq test stat&quot;</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co"># by raw ave r2</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co"># bad chisq by raw ave r2 </span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/badgwas-chisq-by-aver2.png&quot;</span>),</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;bad_chisq&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>)]</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_bad, sel<span class="sc">$</span>bad_chisq,</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq test stat&quot;</span>,</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="co"># good chisq by raw ave r2 </span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/goodgwas-chisq-by-aver2.png&quot;</span>),</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;good_chisq&quot;</span>,<span class="st">&quot;r2_good&quot;</span>)]</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_good, sel<span class="sc">$</span>good_chisq,</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq test stat&quot;</span>,</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a><span class="co"># regression: chisq test stats ~ ave r^2_j --------------------------------------</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;bad_chisq&quot;</span>,<span class="st">&quot;good_chisq&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>, <span class="st">&quot;r2_good&quot;</span>, <span class="st">&quot;maf&quot;</span>)]</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>sel<span class="sc">$</span>maf2<span class="ot">=</span>sel<span class="sc">$</span>maf<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>mod1<span class="ot">=</span><span class="fu">lm</span>(sel<span class="sc">$</span>bad_chisq<span class="sc">~</span>sel<span class="sc">$</span>r2_bad)</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.1=lm(sel$bad_chisq~sel$maf)</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.2=lm(sel$bad_chisq~ sel$maf + sel$maf2)</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.3=lm(sel$bad_chisq~sel$r2_bad+sel$maf)</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.4=lm(sel$bad_chisq~sel$r2_bad+sel$maf+sel$maf2)</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>mod2<span class="ot">=</span><span class="fu">lm</span>(sel<span class="sc">$</span>good_chisq<span class="sc">~</span>sel<span class="sc">$</span>r2_good)</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>slope0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope_bad=</span><span class="fu">coef</span>(mod1)[<span class="dv">2</span>],</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>                  <span class="at">p_bad=</span><span class="fu">summary</span>(mod1)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope_good=</span><span class="fu">coef</span>(mod2)[<span class="dv">2</span>],</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>                  <span class="at">p_good=</span><span class="fu">summary</span>(mod2)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){slope<span class="ot">=</span>slope0} <span class="cf">else</span> {slope<span class="ot">=</span><span class="fu">rbind</span>(slope,slope0)}</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>slope<span class="sc">$</span>good_div_n<span class="ot">=</span>slope<span class="sc">$</span>slope_good<span class="sc">/</span><span class="dv">100000</span></span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>slope<span class="sc">$</span>bad_div_n<span class="ot">=</span>slope<span class="sc">$</span>slope_bad<span class="sc">/</span><span class="dv">100000</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a><span class="co"># heritability estimates</span></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>h2_gcta<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-gcta-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>h2_ldak<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-ldak-thin-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>h2<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>h2_gcta<span class="sc">$</span>code,<span class="at">gcta=</span>h2_gcta<span class="sc">$</span>all_est, <span class="at">ldak=</span>h2_ldak<span class="sc">$</span>all_est)</span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a><span class="co"># together</span></span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span><span class="fu">match</span>(slope<span class="sc">$</span>trait,h2<span class="sc">$</span>trait)</span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>all<span class="ot">=</span><span class="fu">cbind</span>(slope,h2[m,<span class="sc">-</span><span class="dv">1</span>])</span></code></pre></div>
<!--chapter:end:02-inflation.Rmd-->
</div>
</div>
<div id="mathematical-details" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Mathematical Details</h1>
<p>Here we detail the mathematics behind the project.</p>
<div id="trk_rightk_left" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> <span class="math inline">\(tr(K_{right}K_{left})\)</span></h2>
</div>
<div id="verification" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> verification</h2>
<p>Here we want to verify the followings:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(r^2_{i,j} \overset{H_0}{\sim} beta (\alpha=(k-1)/2, \beta=(n-k)/2)\)</span>, where k= # of regressors including the intercept (so for an univariate regression, k=2), and n = sample size.</li>
</ol>
<ul>
<li><span class="math inline">\(E[r^2_{i,j}]=\alpha/(\alpha + \beta)\)</span></li>
<li><span class="math inline">\(var[r^2_{i,j}]=\alpha \beta/[(\alpha+\beta)^2(\alpha+\beta+1)]\)</span></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><span class="math inline">\(T = \sum_{i,j}^{m_1,m_2} r^2_{i,j} \overset{H_0}{\sim} N(1/n, var[r^2_{i,j}])\)</span></li>
</ol>
<p>To do so, we computed <span class="math inline">\(r^2_{i,j}=cor(x_i, x_j)^2\)</span> for <span class="math inline">\(n = 1k , m_1=m_2=1k\)</span> in following ways.</p>
<ol style="list-style-type: decimal">
<li><p>simulated data: <span class="math inline">\(x \sim N(0,1)\)</span></p></li>
<li><p>real genotype data: <span class="math inline">\(x\)</span> from two chromosomes.</p></li>
</ol>
<p>We expect to see:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(r^2_{i,j} \overset{H_0}{\sim} beta (\alpha=0.5, \beta=499)\)</span></li>
<li><span class="math inline">\(T \overset{H_0}{\sim} N(1/1000, var[r^2_{i,j}])\)</span></li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># verify distribution of r^2</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">100000</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>k<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>alpha<span class="ot">=</span>(k<span class="dv">-1</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>beta<span class="ot">=</span>(n<span class="sc">-</span>k)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span><span class="dv">1000</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m){</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  x1<span class="ot">=</span><span class="fu">rnorm</span>(n)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  x2<span class="ot">=</span><span class="fu">rnorm</span>(n)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  y<span class="ot">=</span><span class="fu">cor</span>(x1,x2)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){out<span class="ot">=</span>y} <span class="cf">else</span> {out<span class="ot">=</span><span class="fu">c</span>(out,y)}</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">seq</span>(<span class="fl">0.00000001</span>,<span class="fl">0.0015</span>,<span class="fl">0.000001</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>density<span class="ot">=</span><span class="fu">dbeta</span>(x, alpha, beta)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">0</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(out, <span class="at">breaks=</span><span class="dv">100</span>, <span class="at">freq=</span>F, <span class="at">main=</span><span class="st">&quot;&quot;</span>, </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">&quot;lightgray&quot;</span>, <span class="at">border=</span><span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;r^2&quot;</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, density, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">#mean(out)</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">#1/n</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>exp<span class="ot">=</span>alpha<span class="sc">/</span>(alpha<span class="sc">+</span>beta)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>var<span class="ot">=</span>alpha<span class="sc">*</span>beta<span class="sc">/</span>(((alpha<span class="sc">+</span>beta)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>(alpha<span class="sc">+</span>beta<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>exp</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>var</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>exp<span class="sc">*</span>n</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>var<span class="sc">*</span>n</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>using real data</li>
</ol>
<!--chapter:end:03-maths.Rmd-->
</div>
</div>
<div id="chi-square-overliner2_j" class="section level1" number="5">
<h1><span class="header-section-number">5</span> chi square ~ <span class="math inline">\(\overline{r^2_j}\)</span></h1>
<p>New measure of inflation, <span class="math inline">\(\overline{r^2_j}\)</span> - average correlation between SNP j and distant SNPs.</p>
<ol style="list-style-type: decimal">
<li>Check if the maths in ldak function is correct. Use –make-snps to generate clean data, and check estimates of average r2j are not significant.</li>
</ol>
<p>We did 10 runs and results are non-significant.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:00:0</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="st">for i in {1..10}; do</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="st">  dir=../inflation/random-snps</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="st">  # simulate random snps -------------------------------------------------------</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="st">  ./ldak5.1 --make-snps </span><span class="dt">\$</span><span class="st">dir/20k-snps-100k-inds --num-samples 100000 --num-snps 20000</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="st">  # create snp lists -----------------------------------------------------------</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="st">  awk &#39;NR &lt;= 10000 {print </span><span class="dt">\$</span><span class="st">2}&#39; </span><span class="dt">\$</span><span class="st">dir/20k-snps-100k-inds.bim &gt; </span><span class="dt">\$</span><span class="st">dir/lista</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="st">  awk &#39;NR &gt; 10000 {print </span><span class="dt">\$</span><span class="st">2}&#39; </span><span class="dt">\$</span><span class="st">dir/20k-snps-100k-inds.bim &gt; </span><span class="dt">\$</span><span class="st">dir/listb</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="st">  # compute r_ij --------------------------------------------------------------</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="st">  ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="st">            --calc-inflation </span><span class="dt">\$</span><span class="st">dir/out/20k-random-snps-100k-inds </span><span class="dt">\</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="st">            --bfile </span><span class="dt">\$</span><span class="st">dir/20k-snps-100k-inds </span><span class="dt">\</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="st">            --lista </span><span class="dt">\$</span><span class="st">dir/lista </span><span class="dt">\</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="st">            --listb </span><span class="dt">\$</span><span class="st">dir/listb</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="st">done</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-ave-r2j</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-ave-r2j <span class="op">&gt;</span>../job-records/calc-ave-r2j-random-snps</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co"># results</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="st">&quot;Average squared correlation&quot;</span> sh_out/calc-ave-r2j-60721312.out <span class="op">&gt;</span> inflation/random-snps/out/ave-r2j.out</span></code></pre></div>
<div id="overliner2_j-choice-of-snps" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> <span class="math inline">\(\overline{r^2_j}\)</span> &amp; choice of SNPs</h2>
<div id="number-of-snps" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> number of SNPs</h3>
<ol start="2" style="list-style-type: decimal">
<li>Ideally, we show <span class="math inline">\(\overline{r^2_j}\)</span> is robust - e.g., it is not sensitive to choice of SNPs (e.g., randomly pick 1000, then a different 1000). It is not sensitive to MAF threshold (e.g., if you restrict to MAF&gt;.1, MAF&gt;.01, MAF&gt;.001).</li>
</ol>
<p>To test the robustness of <span class="math inline">\(\overline{r^2_j}\)</span>, we randomly chose 1k SNPs from chromosomes 1-7 and computed the <span class="math inline">\(\overline{r^2_j}\)</span> for these SNPs using 1k, 5k, 10k and 20k SNPs chosen randomly from chromosomes 8-22. We resampled the SNPs and repeated the calculation for 100 times.</p>
<p>So we want to test if <span class="math inline">\(\overline{r^2_j}\)</span> is sensitive to
* the choice of SNPs? var(r^2_j) for a given j.
* the number of SNPs? 1k, 5k, 10k, 20k
* the MAF threshold? MAF &gt; .1, MAF &gt; 0.01, MAF &gt; 0.001</p>
<ul>
<li>For MAF &gt; 0.01, <span class="math inline">\(\overline{r^2_j}\)</span> is not sensitive to the choice of SNPs and slightly sensitive to the number of SNPs. Based on different set of SNPs, <span class="math inline">\(\overline{r^2_j}\)</span> align well. The alignment is better for m &gt; 10k than for m &lt; 10k.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define a R function to compute ave r_j^2 for each i</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># To be used below</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="va">stringsAsFactors</span><span class="op">=</span>FALSE<span class="kw">)</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ex">ip</span><span class="op">&lt;</span>-commandArgs<span class="er">(</span><span class="va">trailingOnly</span><span class="op">=</span>TRUE<span class="kw">)</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="va">warn</span><span class="op">=</span>1<span class="kw">)</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="va">compute_ave_r2</span><span class="op">=</span>function<span class="kw">(</span><span class="ex">m,nm,maf</span><span class="kw">){</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>as.numeric<span class="kw">(</span><span class="ex">m</span><span class="kw">)</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>as.character<span class="kw">(</span><span class="fu">nm</span><span class="kw">)</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>as.character<span class="kw">(</span><span class="ex">maf</span><span class="kw">)</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;../inflation/sensitivity/maf&quot;</span><span class="ex">,maf</span><span class="kw">)</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="va">names</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;good&quot;</span><span class="ex">,</span> <span class="st">&quot;bad&quot;</span><span class="kw">)</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">names</span><span class="kw">)){</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>names[i]</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;/out/&quot;</span>, nm,<span class="st">&quot;-maf&quot;</span>,maf,<span class="st">&quot;-snps-&quot;</span>, gwas,<span class="st">&quot;.pairwise&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>dat[,-c<span class="kw">(</span><span class="ex">m+1</span><span class="kw">)</span><span class="ex">]^2</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>t<span class="kw">(</span><span class="ex">data.frame</span><span class="er">(</span><span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,1,</span> mean<span class="kw">)))</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;/ave-r2-&quot;</span>,nm,<span class="st">&quot;-&quot;</span>,gwas<span class="kw">)</span><span class="ex">,</span> col.names=F, row.names=F, quote=F, append=T<span class="kw">)</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a> <span class="kw">}</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="ex">compute_ave_r2</span><span class="er">(</span><span class="va">ip</span><span class="op">[</span><span class="dv">1</span><span class="op">]</span><span class="ex">,ip[2],ip[3]</span><span class="kw">)</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 0. compute r^2</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co"># lista: 1k from chrom1-7. This is list is fixed for all conditions</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>inflation/sensitivity</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>.01</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;); if (a[1]&lt;8) print $1 }&#39;</span> gen/snps-unrel-inds.use <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 1000 <span class="op">&gt;</span><span class="va">$dir</span>/lista-maf<span class="va">$maf</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co"># m=1k &amp; maf = .01 </span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co"># to change</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>1k</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>.01</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:00:0</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="st"># 0. define vars &amp; create snp lists</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="st">for i in {1..100}; do</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="st"># to change</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="st">use=../gen/snps-unrel-inds.use</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="st">m=1000</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="st">nm=1k</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="st">maf=.01</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="st">lista=../inflation/sensitivity/lista-maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="st">dir=../inflation/sensitivity/maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="st">listb=</span><span class="dt">\$</span><span class="st">dir/listb-</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="st">  # 1. select list b [to be recycled]</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="st">  awk &#39;{split(</span><span class="dt">\$</span><span class="st">1, a, </span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">); if (a[1]&gt;=8) print </span><span class="dt">\$</span><span class="st">1 }&#39; </span><span class="dt">\$</span><span class="st">use | shuf | head -n </span><span class="dt">\$</span><span class="st">m &gt;</span><span class="dt">\$</span><span class="st">listb</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a><span class="st">  # 2. good gwas</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="st">  id=../unrelated/rand.100000</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a><span class="st">  bfile=../gen/geno-unrel</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="st">  out=</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf-snps-good</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a><span class="st">  ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="st">            --calc-inflation </span><span class="dt">\$</span><span class="st">dir/out/</span><span class="dt">\$</span><span class="st">out </span><span class="dt">\</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="st">            --bfile </span><span class="dt">\$</span><span class="st">bfile </span><span class="dt">\</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="st">            --keep </span><span class="dt">\$</span><span class="st">id </span><span class="dt">\</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a><span class="st">            --lista </span><span class="dt">\$</span><span class="st">lista </span><span class="dt">\</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a><span class="st">            --listb </span><span class="dt">\$</span><span class="st">listb </span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="st">  # 3. bad gwas</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a><span class="st">  id=../mix-pop-gwas.id</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="st">  bfile=../gen/geno-mix</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="st">  out=</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf-snps-bad</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a><span class="st">  ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a><span class="st">            --calc-inflation </span><span class="dt">\$</span><span class="st">dir/out/</span><span class="dt">\$</span><span class="st">out </span><span class="dt">\</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a><span class="st">            --bfile </span><span class="dt">\$</span><span class="st">bfile </span><span class="dt">\</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="st">            --keep </span><span class="dt">\$</span><span class="st">id </span><span class="dt">\</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a><span class="st">            --lista </span><span class="dt">\$</span><span class="st">lista </span><span class="dt">\</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a><span class="st">            --listb </span><span class="dt">\$</span><span class="st">listb </span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a><span class="st">  # 4. compute ave r2 [each column corresponds to a SNP in lista]</span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a><span class="st">  Rscript --vanilla ../inflation/sensitivity/calc-ave-r2.r </span><span class="dt">\$</span><span class="st">m </span><span class="dt">\$</span><span class="st">nm </span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a><span class="st">done</span></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>1k</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>.01</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span> <span class="op">&gt;</span>../job-records/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span></span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a><span class="co"># m=5k &amp; maf = .01</span></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a><span class="co"># to change</span></span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>5k</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>.01</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:00:0</span></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a><span class="st"># 0. define vars &amp; create snp lists</span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a><span class="st">for i in {1..100}; do</span></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a><span class="st"># to change</span></span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a><span class="st">use=../gen/snps-unrel-inds.use</span></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a><span class="st">m=5000</span></span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a><span class="st">nm=5k</span></span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a><span class="st">maf=.01</span></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a><span class="st">lista=../inflation/sensitivity/lista-maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a><span class="st">dir=../inflation/sensitivity/maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a><span class="st">listb=</span><span class="dt">\$</span><span class="st">dir/listb-</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a><span class="st">  # 1. select list b [to be recycled]</span></span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a><span class="st">  awk &#39;{split(</span><span class="dt">\$</span><span class="st">1, a, </span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">); if (a[1]&gt;=8) print </span><span class="dt">\$</span><span class="st">1 }&#39; </span><span class="dt">\$</span><span class="st">use | shuf | head -n </span><span class="dt">\$</span><span class="st">m &gt;</span><span class="dt">\$</span><span class="st">listb</span></span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a><span class="st">  # 2. good gwas</span></span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a><span class="st">  id=../unrelated/rand.100000</span></span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a><span class="st">  bfile=../gen/geno-unrel</span></span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a><span class="st">  out=</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf-snps-good</span></span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a><span class="st">  ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a><span class="st">            --calc-inflation </span><span class="dt">\$</span><span class="st">dir/out/</span><span class="dt">\$</span><span class="st">out </span><span class="dt">\</span></span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a><span class="st">            --bfile </span><span class="dt">\$</span><span class="st">bfile </span><span class="dt">\</span></span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a><span class="st">            --keep </span><span class="dt">\$</span><span class="st">id </span><span class="dt">\</span></span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a><span class="st">            --lista </span><span class="dt">\$</span><span class="st">lista </span><span class="dt">\</span></span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a><span class="st">            --listb </span><span class="dt">\$</span><span class="st">listb </span></span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a><span class="st">  # 3. bad gwas</span></span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a><span class="st">  id=../mix-pop-gwas.id</span></span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a><span class="st">  bfile=../gen/geno-mix</span></span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a><span class="st">  out=</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf-snps-bad</span></span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a><span class="st">  ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a><span class="st">            --calc-inflation </span><span class="dt">\$</span><span class="st">dir/out/</span><span class="dt">\$</span><span class="st">out </span><span class="dt">\</span></span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a><span class="st">            --bfile </span><span class="dt">\$</span><span class="st">bfile </span><span class="dt">\</span></span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a><span class="st">            --keep </span><span class="dt">\$</span><span class="st">id </span><span class="dt">\</span></span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a><span class="st">            --lista </span><span class="dt">\$</span><span class="st">lista </span><span class="dt">\</span></span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a><span class="st">            --listb </span><span class="dt">\$</span><span class="st">listb </span></span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a><span class="st">  # 4. compute ave r2 [each column corresponds to a SNP in lista]</span></span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a><span class="st">  Rscript --vanilla ../inflation/sensitivity/calc-ave-r2.r </span><span class="dt">\$</span><span class="st">m </span><span class="dt">\$</span><span class="st">nm </span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a><span class="st">done</span></span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span></span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>5k</span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>.01</span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span> <span class="op">&gt;</span>../job-records/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span></span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a><span class="co"># m=10k &amp; maf = .01</span></span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a><span class="co"># to change</span></span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>10k</span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>.01</span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:00:0</span></span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a><span class="st"># 0. define vars &amp; create snp lists</span></span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a><span class="st">for i in {1..100}; do</span></span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a><span class="st"># to change</span></span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a><span class="st">use=../gen/snps-unrel-inds.use</span></span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a><span class="st">m=10000</span></span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a><span class="st">nm=10k</span></span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a><span class="st">maf=.01</span></span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a><span class="st">lista=../inflation/sensitivity/lista-maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a><span class="st">dir=../inflation/sensitivity/maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a><span class="st">listb=</span><span class="dt">\$</span><span class="st">dir/listb-</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a><span class="st">  # 1. select list b [to be recycled]</span></span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a><span class="st">  awk &#39;{split(</span><span class="dt">\$</span><span class="st">1, a, </span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">); if (a[1]&gt;=8) print </span><span class="dt">\$</span><span class="st">1 }&#39; </span><span class="dt">\$</span><span class="st">use | shuf | head -n </span><span class="dt">\$</span><span class="st">m &gt;</span><span class="dt">\$</span><span class="st">listb</span></span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a><span class="st">  # 2. good gwas</span></span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a><span class="st">  id=../unrelated/rand.100000</span></span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a><span class="st">  bfile=../gen/geno-unrel</span></span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a><span class="st">  out=</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf-snps-good</span></span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a><span class="st">  ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a><span class="st">            --calc-inflation </span><span class="dt">\$</span><span class="st">dir/out/</span><span class="dt">\$</span><span class="st">out </span><span class="dt">\</span></span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a><span class="st">            --bfile </span><span class="dt">\$</span><span class="st">bfile </span><span class="dt">\</span></span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a><span class="st">            --keep </span><span class="dt">\$</span><span class="st">id </span><span class="dt">\</span></span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a><span class="st">            --lista </span><span class="dt">\$</span><span class="st">lista </span><span class="dt">\</span></span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a><span class="st">            --listb </span><span class="dt">\$</span><span class="st">listb </span></span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a><span class="st">  # 3. bad gwas</span></span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a><span class="st">  id=../mix-pop-gwas.id</span></span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a><span class="st">  bfile=../gen/geno-mix</span></span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a><span class="st">  out=</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf-snps-bad</span></span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a><span class="st">  ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a><span class="st">            --calc-inflation </span><span class="dt">\$</span><span class="st">dir/out/</span><span class="dt">\$</span><span class="st">out </span><span class="dt">\</span></span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a><span class="st">            --bfile </span><span class="dt">\$</span><span class="st">bfile </span><span class="dt">\</span></span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a><span class="st">            --keep </span><span class="dt">\$</span><span class="st">id </span><span class="dt">\</span></span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a><span class="st">            --lista </span><span class="dt">\$</span><span class="st">lista </span><span class="dt">\</span></span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true" tabindex="-1"></a><span class="st">            --listb </span><span class="dt">\$</span><span class="st">listb </span></span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true" tabindex="-1"></a><span class="st">  # 4. compute ave r2 [each column corresponds to a SNP in lista]</span></span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true" tabindex="-1"></a><span class="st">  Rscript --vanilla ../inflation/sensitivity/calc-ave-r2.r </span><span class="dt">\$</span><span class="st">m </span><span class="dt">\$</span><span class="st">nm </span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true" tabindex="-1"></a><span class="st">done</span></span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span></span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>10k</span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>.01</span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span> <span class="op">&gt;</span>../job-records/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span></span>
<span id="cb8-286"><a href="#cb8-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-287"><a href="#cb8-287" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true" tabindex="-1"></a><span class="co"># m=20k &amp; maf = .01</span></span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true" tabindex="-1"></a><span class="co"># to change</span></span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>20k</span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>.01</span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:00:0</span></span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true" tabindex="-1"></a><span class="st"># 0. define vars &amp; create snp lists</span></span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true" tabindex="-1"></a><span class="st">for i in {1..100}; do</span></span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true" tabindex="-1"></a><span class="st"># to change</span></span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true" tabindex="-1"></a><span class="st">use=../gen/snps-unrel-inds.use</span></span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true" tabindex="-1"></a><span class="st">m=20000</span></span>
<span id="cb8-311"><a href="#cb8-311" aria-hidden="true" tabindex="-1"></a><span class="st">nm=20k</span></span>
<span id="cb8-312"><a href="#cb8-312" aria-hidden="true" tabindex="-1"></a><span class="st">maf=.01</span></span>
<span id="cb8-313"><a href="#cb8-313" aria-hidden="true" tabindex="-1"></a><span class="st">lista=../inflation/sensitivity/lista-maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-314"><a href="#cb8-314" aria-hidden="true" tabindex="-1"></a><span class="st">dir=../inflation/sensitivity/maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-315"><a href="#cb8-315" aria-hidden="true" tabindex="-1"></a><span class="st">listb=</span><span class="dt">\$</span><span class="st">dir/listb-</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-316"><a href="#cb8-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-317"><a href="#cb8-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-318"><a href="#cb8-318" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-319"><a href="#cb8-319" aria-hidden="true" tabindex="-1"></a><span class="st">  # 1. select list b [to be recycled]</span></span>
<span id="cb8-320"><a href="#cb8-320" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-321"><a href="#cb8-321" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-322"><a href="#cb8-322" aria-hidden="true" tabindex="-1"></a><span class="st">  awk &#39;{split(</span><span class="dt">\$</span><span class="st">1, a, </span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">); if (a[1]&gt;=8) print </span><span class="dt">\$</span><span class="st">1 }&#39; </span><span class="dt">\$</span><span class="st">use | shuf | head -n </span><span class="dt">\$</span><span class="st">m &gt;</span><span class="dt">\$</span><span class="st">listb</span></span>
<span id="cb8-323"><a href="#cb8-323" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-324"><a href="#cb8-324" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-325"><a href="#cb8-325" aria-hidden="true" tabindex="-1"></a><span class="st">  # 2. good gwas</span></span>
<span id="cb8-326"><a href="#cb8-326" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-327"><a href="#cb8-327" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-328"><a href="#cb8-328" aria-hidden="true" tabindex="-1"></a><span class="st">  id=../unrelated/rand.100000</span></span>
<span id="cb8-329"><a href="#cb8-329" aria-hidden="true" tabindex="-1"></a><span class="st">  bfile=../gen/geno-unrel</span></span>
<span id="cb8-330"><a href="#cb8-330" aria-hidden="true" tabindex="-1"></a><span class="st">  out=</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf-snps-good</span></span>
<span id="cb8-331"><a href="#cb8-331" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-332"><a href="#cb8-332" aria-hidden="true" tabindex="-1"></a><span class="st">  ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb8-333"><a href="#cb8-333" aria-hidden="true" tabindex="-1"></a><span class="st">            --calc-inflation </span><span class="dt">\$</span><span class="st">dir/out/</span><span class="dt">\$</span><span class="st">out </span><span class="dt">\</span></span>
<span id="cb8-334"><a href="#cb8-334" aria-hidden="true" tabindex="-1"></a><span class="st">            --bfile </span><span class="dt">\$</span><span class="st">bfile </span><span class="dt">\</span></span>
<span id="cb8-335"><a href="#cb8-335" aria-hidden="true" tabindex="-1"></a><span class="st">            --keep </span><span class="dt">\$</span><span class="st">id </span><span class="dt">\</span></span>
<span id="cb8-336"><a href="#cb8-336" aria-hidden="true" tabindex="-1"></a><span class="st">            --lista </span><span class="dt">\$</span><span class="st">lista </span><span class="dt">\</span></span>
<span id="cb8-337"><a href="#cb8-337" aria-hidden="true" tabindex="-1"></a><span class="st">            --listb </span><span class="dt">\$</span><span class="st">listb </span></span>
<span id="cb8-338"><a href="#cb8-338" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-339"><a href="#cb8-339" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-340"><a href="#cb8-340" aria-hidden="true" tabindex="-1"></a><span class="st">  # 3. bad gwas</span></span>
<span id="cb8-341"><a href="#cb8-341" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-342"><a href="#cb8-342" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-343"><a href="#cb8-343" aria-hidden="true" tabindex="-1"></a><span class="st">  id=../mix-pop-gwas.id</span></span>
<span id="cb8-344"><a href="#cb8-344" aria-hidden="true" tabindex="-1"></a><span class="st">  bfile=../gen/geno-mix</span></span>
<span id="cb8-345"><a href="#cb8-345" aria-hidden="true" tabindex="-1"></a><span class="st">  out=</span><span class="dt">\$</span><span class="st">nm-maf</span><span class="dt">\$</span><span class="st">maf-snps-bad</span></span>
<span id="cb8-346"><a href="#cb8-346" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-347"><a href="#cb8-347" aria-hidden="true" tabindex="-1"></a><span class="st">  ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb8-348"><a href="#cb8-348" aria-hidden="true" tabindex="-1"></a><span class="st">            --calc-inflation </span><span class="dt">\$</span><span class="st">dir/out/</span><span class="dt">\$</span><span class="st">out </span><span class="dt">\</span></span>
<span id="cb8-349"><a href="#cb8-349" aria-hidden="true" tabindex="-1"></a><span class="st">            --bfile </span><span class="dt">\$</span><span class="st">bfile </span><span class="dt">\</span></span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true" tabindex="-1"></a><span class="st">            --keep </span><span class="dt">\$</span><span class="st">id </span><span class="dt">\</span></span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true" tabindex="-1"></a><span class="st">            --lista </span><span class="dt">\$</span><span class="st">lista </span><span class="dt">\</span></span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true" tabindex="-1"></a><span class="st">            --listb </span><span class="dt">\$</span><span class="st">listb </span></span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true" tabindex="-1"></a><span class="st">  # 4. compute ave r2 [each column corresponds to a SNP in lista]</span></span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true" tabindex="-1"></a><span class="st">  #::</span></span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true" tabindex="-1"></a><span class="st">  Rscript --vanilla ../inflation/sensitivity/calc-ave-r2.r </span><span class="dt">\$</span><span class="st">m </span><span class="dt">\$</span><span class="st">nm </span><span class="dt">\$</span><span class="st">maf</span></span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true" tabindex="-1"></a><span class="st">done</span></span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span></span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>20k</span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>.01</span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span> <span class="op">&gt;</span>../job-records/calc-ave-r2-<span class="va">$nm</span>-maf<span class="va">$maf</span></span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true" tabindex="-1"></a><span class="co">#    summary</span></span>
<span id="cb8-371"><a href="#cb8-371" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb8-372"><a href="#cb8-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-373"><a href="#cb8-373" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb8-374"><a href="#cb8-374" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span><span class="st">&quot;inflation/sensitivity/maf.01/&quot;</span></span>
<span id="cb8-375"><a href="#cb8-375" aria-hidden="true" tabindex="-1"></a><span class="va">snps</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;/out/1k-maf.01-snps-bad.predictorsa&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb8-376"><a href="#cb8-376" aria-hidden="true" tabindex="-1"></a>                <span class="ex">stringsAsFactors</span> = F, header=F<span class="kw">)</span></span>
<span id="cb8-377"><a href="#cb8-377" aria-hidden="true" tabindex="-1"></a><span class="co"># note: the snp set for list a is constant across different m&#39;s</span></span>
<span id="cb8-378"><a href="#cb8-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-379"><a href="#cb8-379" aria-hidden="true" tabindex="-1"></a><span class="co"># extract data</span></span>
<span id="cb8-380"><a href="#cb8-380" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;1k&quot;</span><span class="ex">,</span><span class="st">&quot;5k&quot;</span><span class="ex">,</span><span class="st">&quot;10k&quot;</span><span class="ex">,</span> <span class="st">&quot;20k&quot;</span><span class="kw">)</span></span>
<span id="cb8-381"><a href="#cb8-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-382"><a href="#cb8-382" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">m</span><span class="kw">)){</span></span>
<span id="cb8-383"><a href="#cb8-383" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-384"><a href="#cb8-384" aria-hidden="true" tabindex="-1"></a>  <span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;ave-r2-&quot;</span>,m[i],<span class="st">&quot;-bad&quot;</span><span class="kw">)</span><span class="ex">,col_names=F</span><span class="kw">)</span></span>
<span id="cb8-385"><a href="#cb8-385" aria-hidden="true" tabindex="-1"></a>  <span class="va">ave0</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,2,mean</span><span class="kw">)</span></span>
<span id="cb8-386"><a href="#cb8-386" aria-hidden="true" tabindex="-1"></a>  <span class="va">sd0</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,2,sd</span><span class="kw">)</span></span>
<span id="cb8-387"><a href="#cb8-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-388"><a href="#cb8-388" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{ave=data.frame</span><span class="er">(</span><span class="va">snp</span><span class="op">=</span>snps<span class="va">$V1</span>,ave0, <span class="ex">stringsAsFactors</span> = F<span class="kw">);</span></span>
<span id="cb8-389"><a href="#cb8-389" aria-hidden="true" tabindex="-1"></a>            <span class="ex">names</span><span class="er">(</span><span class="ex">ave</span><span class="kw">)</span><span class="ex">[i+1]=paste0</span><span class="er">(</span><span class="st">&quot;m_&quot;</span><span class="ex">,m[i]</span><span class="kw">)</span></span>
<span id="cb8-390"><a href="#cb8-390" aria-hidden="true" tabindex="-1"></a>            <span class="va">sd</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">snp</span><span class="op">=</span>snps<span class="va">$V1</span>,sd0, <span class="ex">stringsAsFactors</span> = F<span class="kw">);</span></span>
<span id="cb8-391"><a href="#cb8-391" aria-hidden="true" tabindex="-1"></a>            <span class="ex">names</span><span class="er">(</span><span class="ex">sd</span><span class="kw">)</span><span class="ex">[i+1]=paste0</span><span class="er">(</span><span class="st">&quot;m_&quot;</span><span class="ex">,m[i]</span><span class="kw">)</span></span>
<span id="cb8-392"><a href="#cb8-392" aria-hidden="true" tabindex="-1"></a>  <span class="kw">}</span> <span class="cf">else</span> <span class="ex">{ave=cbind</span><span class="er">(</span><span class="ex">ave,ave0</span><span class="kw">);</span> </span>
<span id="cb8-393"><a href="#cb8-393" aria-hidden="true" tabindex="-1"></a>          <span class="ex">names</span><span class="er">(</span><span class="ex">ave</span><span class="kw">)</span><span class="ex">[i+1]=paste0</span><span class="er">(</span><span class="st">&quot;m_&quot;</span><span class="ex">,m[i]</span><span class="kw">)</span></span>
<span id="cb8-394"><a href="#cb8-394" aria-hidden="true" tabindex="-1"></a>          <span class="va">sd</span><span class="op">=</span>cbind<span class="kw">(</span><span class="ex">sd,sd0</span><span class="kw">);</span> </span>
<span id="cb8-395"><a href="#cb8-395" aria-hidden="true" tabindex="-1"></a>          <span class="ex">names</span><span class="er">(</span><span class="ex">sd</span><span class="kw">)</span><span class="ex">[i+1]=paste0</span><span class="er">(</span><span class="st">&quot;m_&quot;</span><span class="ex">,m[i]</span><span class="kw">)</span></span>
<span id="cb8-396"><a href="#cb8-396" aria-hidden="true" tabindex="-1"></a>          <span class="er">}</span> </span>
<span id="cb8-397"><a href="#cb8-397" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb8-398"><a href="#cb8-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-399"><a href="#cb8-399" aria-hidden="true" tabindex="-1"></a><span class="co"># organize data</span></span>
<span id="cb8-400"><a href="#cb8-400" aria-hidden="true" tabindex="-1"></a><span class="va">ord</span><span class="op">=</span>order<span class="kw">(</span><span class="ex">ave</span><span class="va">$m_20k</span><span class="ex">,decreasing=F</span><span class="kw">)</span></span>
<span id="cb8-401"><a href="#cb8-401" aria-hidden="true" tabindex="-1"></a><span class="va">ave</span><span class="op">=</span>ave[ord,]</span>
<span id="cb8-402"><a href="#cb8-402" aria-hidden="true" tabindex="-1"></a><span class="va">sd</span><span class="op">=</span>sd[ord,]</span>
<span id="cb8-403"><a href="#cb8-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-404"><a href="#cb8-404" aria-hidden="true" tabindex="-1"></a><span class="va">cutoff</span><span class="op">=</span>quantile<span class="kw">(</span><span class="ex">ave</span><span class="va">$m_20k</span><span class="ex">,</span> probs = seq<span class="er">(</span><span class="ex">0,</span> 1, 0.01<span class="kw">))</span></span>
<span id="cb8-405"><a href="#cb8-405" aria-hidden="true" tabindex="-1"></a><span class="ex">ave</span><span class="va">$quant_bin</span><span class="ex">=cut</span><span class="er">(</span><span class="ex">ave</span><span class="va">$m_20k</span><span class="ex">,</span> breaks=cutoff, </span>
<span id="cb8-406"><a href="#cb8-406" aria-hidden="true" tabindex="-1"></a>                  <span class="ex">include.lowest=T,</span></span>
<span id="cb8-407"><a href="#cb8-407" aria-hidden="true" tabindex="-1"></a>                  <span class="va">labels</span><span class="op">=</span>1:<span class="kw">(</span><span class="ex">length</span><span class="er">(</span><span class="ex">cutoff</span><span class="kw">)</span><span class="ex">-1</span><span class="kw">))</span></span>
<span id="cb8-408"><a href="#cb8-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-409"><a href="#cb8-409" aria-hidden="true" tabindex="-1"></a><span class="co"># check alignment of ave r^2_j for different m</span></span>
<span id="cb8-410"><a href="#cb8-410" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb8-411"><a href="#cb8-411" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span><span class="st">&quot;inflation/sensitivity/maf.01/&quot;</span></span>
<span id="cb8-412"><a href="#cb8-412" aria-hidden="true" tabindex="-1"></a><span class="va">snps</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;/out/1k-maf.01-snps-bad.predictorsa&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb8-413"><a href="#cb8-413" aria-hidden="true" tabindex="-1"></a>                <span class="ex">stringsAsFactors</span> = F, header=F<span class="kw">)</span></span>
<span id="cb8-414"><a href="#cb8-414" aria-hidden="true" tabindex="-1"></a><span class="co"># note: the snp set for list a is constant across different m&#39;s</span></span>
<span id="cb8-415"><a href="#cb8-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-416"><a href="#cb8-416" aria-hidden="true" tabindex="-1"></a><span class="co"># extract data</span></span>
<span id="cb8-417"><a href="#cb8-417" aria-hidden="true" tabindex="-1"></a><span class="ex">png</span><span class="er">(</span><span class="st">&quot;fig/ave-r2-1st-vs-2nd-run-by-m.png&quot;</span><span class="ex">,</span> res=400 , width=40, height=10, units=<span class="st">&quot;cm&quot;</span><span class="kw">)</span></span>
<span id="cb8-418"><a href="#cb8-418" aria-hidden="true" tabindex="-1"></a><span class="ex">par</span><span class="er">(</span><span class="va">mfrow</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">1,4</span><span class="kw">)</span><span class="ex">,</span> pty=<span class="st">&quot;s&quot;</span><span class="kw">)</span></span>
<span id="cb8-419"><a href="#cb8-419" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;1k&quot;</span><span class="ex">,</span><span class="st">&quot;5k&quot;</span><span class="ex">,</span><span class="st">&quot;10k&quot;</span><span class="ex">,</span> <span class="st">&quot;20k&quot;</span><span class="kw">)</span></span>
<span id="cb8-420"><a href="#cb8-420" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">m</span><span class="kw">)){</span></span>
<span id="cb8-421"><a href="#cb8-421" aria-hidden="true" tabindex="-1"></a>  <span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;ave-r2-&quot;</span>,m[i],<span class="st">&quot;-bad&quot;</span><span class="kw">)</span><span class="ex">,col_names=F</span><span class="kw">)</span></span>
<span id="cb8-422"><a href="#cb8-422" aria-hidden="true" tabindex="-1"></a>  <span class="va">sel</span><span class="op">=</span>t<span class="kw">(</span><span class="va">dat</span><span class="op">[</span>c(5,20),<span class="op">]</span><span class="kw">)</span></span>
<span id="cb8-423"><a href="#cb8-423" aria-hidden="true" tabindex="-1"></a>  <span class="va">start</span><span class="op">=</span>min<span class="kw">(</span><span class="ex">c</span><span class="er">(</span><span class="va">sel</span><span class="op">[</span>,1<span class="op">]</span><span class="ex">,sel[,2]</span><span class="kw">))</span></span>
<span id="cb8-424"><a href="#cb8-424" aria-hidden="true" tabindex="-1"></a>  <span class="va">end</span><span class="op">=</span>max<span class="kw">(</span><span class="ex">c</span><span class="er">(</span><span class="va">sel</span><span class="op">[</span>,1<span class="op">]</span><span class="ex">,sel[,2]</span><span class="kw">))</span></span>
<span id="cb8-425"><a href="#cb8-425" aria-hidden="true" tabindex="-1"></a>  <span class="ex">plot</span><span class="er">(</span><span class="va">sel</span><span class="op">[</span>,1<span class="op">]</span><span class="ex">,</span> sel[,2],</span>
<span id="cb8-426"><a href="#cb8-426" aria-hidden="true" tabindex="-1"></a>       <span class="va">xlim</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">start,end</span><span class="kw">)</span><span class="ex">,</span> ylim=c<span class="er">(</span><span class="ex">start,</span> end<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb8-427"><a href="#cb8-427" aria-hidden="true" tabindex="-1"></a>      <span class="va">xlab</span><span class="op">=</span><span class="st">&quot;1st run&quot;</span>, <span class="va">ylab</span><span class="op">=</span><span class="st">&quot;2nd run&quot;</span>, <span class="va">main</span><span class="op">=</span>m[i], <span class="va">las</span><span class="op">=</span>1,</span>
<span id="cb8-428"><a href="#cb8-428" aria-hidden="true" tabindex="-1"></a>     <span class="ex">cex</span> = 1, pch=21,  bg=<span class="st">&quot;darkgray&quot;</span>, col=<span class="st">&quot;white&quot;</span>, lwd=0.5<span class="kw">)</span></span>
<span id="cb8-429"><a href="#cb8-429" aria-hidden="true" tabindex="-1"></a><span class="ex">abline</span><span class="er">(</span><span class="ex">0,</span> 1, col=<span class="st">&quot;darkgray&quot;</span>, lwd=1.5, lty=1<span class="kw">)</span></span>
<span id="cb8-430"><a href="#cb8-430" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb8-431"><a href="#cb8-431" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off()</span></span></code></pre></div>
</div>
<div id="maf" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> maf</h3>
<p>For a given list of SNPs, We computed their correlations with distant SNPs, i.e., <span class="math inline">\(\overline{r^2_j}\)</span>, using SNPs with a MAF &lt; 0.1 and ones with a MAF &gt; 0.1. We did it in a systematic way.</p>
<ol style="list-style-type: decimal">
<li>maf: &lt; .1 vs. &gt; .1.</li>
<li>level of confounding: 0k, 1k, 2k, …, 6k.</li>
<li>number of distant SNPs: 1k, 5k, 10k, 20k.</li>
</ol>
<div id="st-run" class="section level4" number="5.1.2.1">
<h4><span class="header-section-number">5.1.2.1</span> 1st run</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># compute maf of mix pops</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># script file</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$n</span> <span class="ot">==</span> 0k <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../rand.100000</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../mix-pop-gwas-<span class="va">$n</span>-noneuro.id</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-stats ../gen/maf/geno-mix-</span><span class="va">$n</span><span class="st">-noneuro-stats </span><span class="dt">\</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix-maf.001 </span><span class="dt">\</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/calc-maf-<span class="va">$n</span>-noneuro.sh</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-maf-<span class="va">$n</span>-noneuro.sh</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/calc-maf</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co"># SNP lists</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co"># lista (1k): fixed for all analyses</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co"># chosen from chrom 1-7. maf &gt; 0.01</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>inflation/sensitivity/maf.1</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;); </span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&lt;8 &amp;&amp; $5&gt;0.1 &amp;&amp; $6&gt;=0.95) </span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="st">    print $1}&#39;</span> gen/geno-mix-maf.001.stats <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 1000 <span class="op">&gt;</span> <span class="va">$dir</span>/lista-1k</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co"># listb</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co"># this will vary depending on the mix pop</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>inflation/sensitivity/maf.1/listb</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span><span class="va">(</span>1000 5000 10000 20000<span class="va">)</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span><span class="va">(</span>1k 5k 10k 20k<span class="va">)</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">0</span><span class="dt">..</span><span class="dv">3</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gen/maf/geno-mix-<span class="va">$n</span>-noneuro-stats.stats</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &gt; 0.1</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;); </span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&gt;=8 &amp;&amp; $5&gt;=0.1 &amp;&amp; $6&gt;=0.95) </span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="st">    print $1}&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">${m</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> <span class="op">&gt;</span> <span class="va">$dir</span>/listb-maf-g.1-<span class="va">${nm</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>-snps-mix-pop-<span class="va">$n</span>-noneuro </span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &lt; 0.1</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;); </span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&gt;=8 &amp;&amp; $5&gt;0.01 &amp;&amp; $5&lt;0.1 &amp;&amp; $6&gt;=0.95) </span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="st">    print $1}&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">${m</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> <span class="op">&gt;</span> <span class="va">$dir</span>/listb-maf-l.1-<span class="va">${nm</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>-snps-mix-pop-<span class="va">$n</span>-noneuro  </span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a><span class="co"># actually it is easier to create pool of the right for maf &gt; .1 &amp; maf&lt;.1.</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="co"># then we can choose a completely different listb for another run. So let&#39;s do that</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>inflation/sensitivity/maf.1/listb</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gen/maf/geno-mix-<span class="va">$n</span>-noneuro-stats.stats</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &gt; 0.1</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;); </span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&gt;=8 &amp;&amp; $5&gt;=0.1 &amp;&amp; $6&gt;=0.95 &amp;&amp; NR &gt;1 ) </span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="st">    print $1}&#39;</span> <span class="va">$infile</span> <span class="op">&gt;</span> <span class="va">$dir</span>/right-maf-g.1-mix-pop-<span class="va">$n</span>-noneuro </span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &lt; 0.1</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;); </span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&gt;=8 &amp;&amp; $5&gt;0.01 &amp;&amp; $5&lt;0.1 &amp;&amp; $6&gt;=0.95 &amp;&amp; NR &gt;1) </span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="st">    print $1}&#39;</span> <span class="va">$infile</span> <span class="op">&gt;</span> <span class="va">$dir</span>/right-maf-l.1-mix-pop-<span class="va">$n</span>-noneuro  </span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a><span class="co"># compute ave r^2_j</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a><span class="co"># compute r_ij using ldak-------------------------------------------------------</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>../inflation/sensitivity/maf.1</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-mix-maf.001</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> m <span class="kw">in</span> <span class="dt">{1k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">10k</span><span class="op">,</span><span class="dt">20k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{g.1</span><span class="op">,</span><span class="dt">l.1}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a><span class="co"># define vars</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span><span class="va">$dir</span>/lista-1k</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span><span class="va">$dir</span>/listb/listb-maf-<span class="va">$j</span>-<span class="va">$m</span>-snps-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$dir</span>/out/maf-<span class="va">$j</span>-<span class="va">$m</span>-snps-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$n</span> <span class="ot">==</span> 0k <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../rand.100000</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> </span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../mix-pop-gwas-<span class="va">$n</span>-noneuro.id</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:10:0</span></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-cor-maf-<span class="va">$j</span>-<span class="va">$m</span>-snps-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> m <span class="kw">in</span> <span class="dt">{1k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">10k</span><span class="op">,</span><span class="dt">20k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{g.1</span><span class="op">,</span><span class="dt">l.1}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-cor-maf-<span class="va">$j</span>-<span class="va">$m</span>-snps-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/calc-r-sensitivity</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a><span class="co"># compute ave r^2_j using R-----------------------------------------------------</span></span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a><span class="va">n</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;0k&quot;</span><span class="ex">,</span><span class="st">&quot;1k&quot;</span><span class="ex">,</span> <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span><span class="kw">)</span></span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;1k&quot;</span><span class="ex">,</span><span class="st">&quot;5k&quot;</span><span class="ex">,</span> <span class="st">&quot;10k&quot;</span>, <span class="st">&quot;20k&quot;</span><span class="kw">)</span></span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a><span class="va">m_num</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">1000,5000,</span> 10000,20000<span class="kw">)</span></span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a><span class="va">l</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;g.1&quot;</span><span class="ex">,</span><span class="st">&quot;l.1&quot;</span><span class="kw">)</span></span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span><span class="st">&quot;inflation/sensitivity/maf.1/&quot;</span></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">j</span> in 1:length<span class="er">(</span><span class="ex">m</span><span class="kw">)){</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">k</span> in 1:length<span class="er">(</span><span class="ex">l</span><span class="kw">)){</span></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">n</span><span class="kw">)){</span></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>    <span class="va">nm</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;maf-&quot;</span><span class="ex">,l[k],</span><span class="st">&quot;-&quot;</span><span class="ex">,m[j],</span><span class="st">&quot;-snps-mix-pop-&quot;</span><span class="ex">,n[i],</span><span class="st">&quot;-noneuro&quot;</span><span class="kw">)</span></span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;out/&quot;</span>,nm,<span class="st">&quot;.pairwise&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>    <span class="va">lista</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;out/&quot;</span>,nm,<span class="st">&quot;.predictorsa&quot;</span><span class="kw">)</span><span class="ex">,</span> stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>    <span class="va">listb</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;out/&quot;</span>,nm,<span class="st">&quot;.predictorsb&quot;</span><span class="kw">)</span><span class="ex">,</span> stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>dat[,-c<span class="kw">(</span><span class="va">m_num</span><span class="op">[</span>j<span class="op">]</span><span class="ex">+1</span><span class="kw">)</span><span class="ex">]^2</span></span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>    <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>lista<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,1,</span> mean<span class="kw">))</span></span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>    <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;summary/ave-r2-&quot;</span>,nm<span class="kw">)</span><span class="ex">,</span> col.names=F, row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>  <span class="kw">}</span></span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
</div>
<div id="st-run-1" class="section level4" number="5.1.2.2">
<h4><span class="header-section-number">5.1.2.2</span> 2st run</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SNP lists</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># listb</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># we want to generate a completely different listb</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="va">dir1</span><span class="op">=</span>inflation/sensitivity/maf.1/listb</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="va">dir2</span><span class="op">=</span>inflation/sensitivity/maf.1/listb-run2</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span><span class="va">(</span>1000 5000 10000 20000<span class="va">)</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span><span class="va">(</span>1k 5k 10k 20k<span class="va">)</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">0</span><span class="dt">..</span><span class="dv">3</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># right snp list based on dif. mix pop. i.e., our pools to draw snps</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="va">pool1</span><span class="op">=</span><span class="va">$dir1</span>/right-maf-g.1-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="va">pool2</span><span class="op">=</span><span class="va">$dir1</span>/right-maf-l.1-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># list b for run #1</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="va">old1</span><span class="op">=</span><span class="va">$dir1</span>/listb-maf-g.1-<span class="va">${nm</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>-snps-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="va">old2</span><span class="op">=</span><span class="va">$dir1</span>/listb-maf-l.1-<span class="va">${nm</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>-snps-mix-pop-<span class="va">$n</span>-noneuro </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># new list b for run #2</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="va">new1</span><span class="op">=</span><span class="va">$dir2</span>/listb-maf-g.1-<span class="va">${nm</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>-snps-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="va">new2</span><span class="op">=</span><span class="va">$dir2</span>/listb-maf-l.1-<span class="va">${nm</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>-snps-mix-pop-<span class="va">$n</span>-noneuro </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &gt; 0.1</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; next} </span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="st">     !($1 in a) {print $1}&#39;</span> <span class="va">$old1</span> <span class="va">$pool1</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">${m</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> <span class="op">&gt;</span> <span class="va">$new1</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &lt; 0.1</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; next} </span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="st">     !($1 in a) {print $1}&#39;</span> <span class="va">$old2</span> <span class="va">$pool2</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">${m</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> <span class="op">&gt;</span> <span class="va">$new2</span> </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co"># compute ave r^2_j</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># compute r_ij using ldak-------------------------------------------------------</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>../inflation/sensitivity/maf.1</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-mix-maf.001</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> m <span class="kw">in</span> <span class="dt">{1k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">10k</span><span class="op">,</span><span class="dt">20k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{g.1</span><span class="op">,</span><span class="dt">l.1}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="co"># define vars</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span><span class="va">$dir</span>/lista-1k</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span><span class="va">$dir</span>/listb-run2/listb-maf-<span class="va">$j</span>-<span class="va">$m</span>-snps-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$dir</span>/out-run2/maf-<span class="va">$j</span>-<span class="va">$m</span>-snps-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$n</span> <span class="ot">==</span> 0k <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../rand.100000</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> </span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../mix-pop-gwas-<span class="va">$n</span>-noneuro.id</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:10:0</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-cor-maf-<span class="va">$j</span>-<span class="va">$m</span>-snps-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> m <span class="kw">in</span> <span class="dt">{1k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">10k</span><span class="op">,</span><span class="dt">20k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{g.1</span><span class="op">,</span><span class="dt">l.1}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-cor-maf-<span class="va">$j</span>-<span class="va">$m</span>-snps-mix-pop-<span class="va">$n</span>-noneuro</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/calc-r-sensitivity-run2</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="co"># compute ave r^2_j using R-----------------------------------------------------</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a><span class="va">n</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;0k&quot;</span><span class="ex">,</span><span class="st">&quot;1k&quot;</span><span class="ex">,</span> <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span><span class="kw">)</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;1k&quot;</span><span class="ex">,</span><span class="st">&quot;5k&quot;</span><span class="ex">,</span> <span class="st">&quot;10k&quot;</span>, <span class="st">&quot;20k&quot;</span><span class="kw">)</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a><span class="va">m_num</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">1000,5000,</span> 10000,20000<span class="kw">)</span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="va">l</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;g.1&quot;</span><span class="ex">,</span><span class="st">&quot;l.1&quot;</span><span class="kw">)</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span><span class="st">&quot;inflation/sensitivity/maf.1/&quot;</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">j</span> in 1:length<span class="er">(</span><span class="ex">m</span><span class="kw">)){</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">k</span> in 1:length<span class="er">(</span><span class="ex">l</span><span class="kw">)){</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">n</span><span class="kw">)){</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>    <span class="va">nm</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;maf-&quot;</span><span class="ex">,l[k],</span><span class="st">&quot;-&quot;</span><span class="ex">,m[j],</span><span class="st">&quot;-snps-mix-pop-&quot;</span><span class="ex">,n[i],</span><span class="st">&quot;-noneuro&quot;</span><span class="kw">)</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;out-run2/&quot;</span>,nm,<span class="st">&quot;.pairwise&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>    <span class="va">lista</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;out-run2/&quot;</span>,nm,<span class="st">&quot;.predictorsa&quot;</span><span class="kw">)</span><span class="ex">,</span> stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>    <span class="va">listb</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;out-run2/&quot;</span>,nm,<span class="st">&quot;.predictorsb&quot;</span><span class="kw">)</span><span class="ex">,</span> stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>dat[,-c<span class="kw">(</span><span class="va">m_num</span><span class="op">[</span>j<span class="op">]</span><span class="ex">+1</span><span class="kw">)</span><span class="ex">]^2</span></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>    <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>lista<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,1,</span> mean<span class="kw">))</span></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>    <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="fu">dir</span>,<span class="st">&quot;summary-run2/ave-r2-&quot;</span>,nm<span class="kw">)</span><span class="ex">,</span> col.names=F, row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>  <span class="kw">}</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
</div>
</div>
<div id="summary" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> summary</h3>
<p>Here we check the alignment between 1st and 2nd run under different settings.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1st run vs. 2nd run</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0k&quot;</span>,<span class="st">&quot;1k&quot;</span>, <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;1k&quot;</span>,<span class="st">&quot;5k&quot;</span>, <span class="st">&quot;10k&quot;</span>, <span class="st">&quot;20k&quot;</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>dir<span class="ot">=</span><span class="st">&quot;inflation/sensitivity/maf.1/&quot;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ave-r2-1st-vs-2nd-run.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">40</span>, <span class="at">height=</span><span class="dv">70</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">4</span>), <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(n)){</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(m)){</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    nm1<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;maf-g.1-&quot;</span>,m[j],<span class="st">&quot;-snps-mix-pop-&quot;</span>,n[i],<span class="st">&quot;-noneuro&quot;</span>) <span class="co"># maf &gt; .1</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    nm2<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;maf-l.1-&quot;</span>,m[j],<span class="st">&quot;-snps-mix-pop-&quot;</span>,n[i],<span class="st">&quot;-noneuro&quot;</span>) <span class="co"># maf &lt; .1</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    dat1<span class="fl">.1</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary/ave-r2-&quot;</span>,nm1),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    dat2<span class="fl">.1</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary-run2/ave-r2-&quot;</span>,nm1),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    dat1<span class="fl">.2</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary/ave-r2-&quot;</span>,nm2),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    dat2<span class="fl">.2</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary-run2/ave-r2-&quot;</span>,nm2),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(dat1<span class="fl">.1</span><span class="sc">$</span>V2,dat1<span class="fl">.2</span><span class="sc">$</span>V2,dat2<span class="fl">.1</span><span class="sc">$</span>V2,dat2<span class="fl">.2</span><span class="sc">$</span>V2))</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(dat1<span class="fl">.1</span><span class="sc">$</span>V2,dat1<span class="fl">.2</span><span class="sc">$</span>V2,dat2<span class="fl">.1</span><span class="sc">$</span>V2,dat2<span class="fl">.2</span><span class="sc">$</span>V2))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(dat1<span class="fl">.1</span><span class="sc">$</span>V2, dat2<span class="fl">.1</span><span class="sc">$</span>V2,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlim=</span><span class="fu">c</span>(start,end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;1st run&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;2nd run&quot;</span>, </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span><span class="fu">paste0</span>(m[j],<span class="st">&quot; snps&quot;</span>,<span class="st">&quot; &quot;</span>,n[i],<span class="st">&quot; non-european&quot;</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">points</span>(dat1<span class="fl">.2</span><span class="sc">$</span>V2, dat2<span class="fl">.2</span><span class="sc">$</span>V2,</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="dv">1</span>) {<span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;maf &gt; .1&quot;</span>,<span class="st">&quot;maf &lt; .1&quot;</span>), </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;darkgray&quot;</span>, <span class="st">&quot;orange&quot;</span>), <span class="at">cex=</span><span class="fl">1.5</span>, <span class="at">box.lty=</span><span class="dv">0</span>)}</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &gt; .1 vs. maf &lt; .1</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0k&quot;</span>,<span class="st">&quot;1k&quot;</span>, <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;1k&quot;</span>,<span class="st">&quot;5k&quot;</span>, <span class="st">&quot;10k&quot;</span>, <span class="st">&quot;20k&quot;</span>)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>dir<span class="ot">=</span><span class="st">&quot;inflation/sensitivity/maf.1/&quot;</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ave-r2-maf-g.1-vs-l.1.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">40</span>, <span class="at">height=</span><span class="dv">70</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">4</span>), <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(n)){</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(m)){</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    nm1<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;maf-g.1-&quot;</span>,m[j],<span class="st">&quot;-snps-mix-pop-&quot;</span>,n[i],<span class="st">&quot;-noneuro&quot;</span>) <span class="co"># maf &gt; .1</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    nm2<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;maf-l.1-&quot;</span>,m[j],<span class="st">&quot;-snps-mix-pop-&quot;</span>,n[i],<span class="st">&quot;-noneuro&quot;</span>) <span class="co"># maf &lt; .1</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>    dat1<span class="fl">.1</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary/ave-r2-&quot;</span>,nm1),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>    dat1<span class="fl">.2</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary/ave-r2-&quot;</span>,nm2),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>    dat2<span class="fl">.1</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary-run2/ave-r2-&quot;</span>,nm1),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    dat2<span class="fl">.2</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary-run2/ave-r2-&quot;</span>,nm2),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(dat1<span class="fl">.1</span><span class="sc">$</span>V2,dat1<span class="fl">.2</span><span class="sc">$</span>V2,dat2<span class="fl">.1</span><span class="sc">$</span>V2,dat2<span class="fl">.2</span><span class="sc">$</span>V2))</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(dat1<span class="fl">.1</span><span class="sc">$</span>V2,dat1<span class="fl">.2</span><span class="sc">$</span>V2,dat2<span class="fl">.1</span><span class="sc">$</span>V2,dat2<span class="fl">.2</span><span class="sc">$</span>V2))</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(dat1<span class="fl">.1</span><span class="sc">$</span>V2, dat1<span class="fl">.2</span><span class="sc">$</span>V2,</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlim=</span><span class="fu">c</span>(start,end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;maf &gt; .1&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;maf &lt; .1&quot;</span>, </span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span><span class="fu">paste0</span>(m[j],<span class="st">&quot; snps&quot;</span>,<span class="st">&quot; &quot;</span>,n[i],<span class="st">&quot; non-european&quot;</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;lightgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">points</span>(dat2<span class="fl">.1</span><span class="sc">$</span>V2, dat2<span class="fl">.2</span><span class="sc">$</span>V2,</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="dv">1</span>) {<span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;1st run&quot;</span>,<span class="st">&quot;2nd run&quot;</span>), </span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;lightgray&quot;</span>, <span class="st">&quot;orange&quot;</span>), <span class="at">cex=</span><span class="fl">1.5</span>, <span class="at">box.lty=</span><span class="dv">0</span>)}</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<div class="figure" style="text-align: left">
<img src="fig-to-insert/ave-r2-1st-vs-2nd-run.png" alt="robustness of ave r2_j: 1st run vs. 2nd run" width="100%" />
<p class="caption">
(#fig:aver2-alignment-by-run)robustness of ave r2_j: 1st run vs. 2nd run
</p>
</div>
<div class="figure" style="text-align: left">
<img src="fig-to-insert/ave-r2-maf-g.1-vs-l.1.png" alt="robustness of ave r2_j: maf &gt; .1 vs. maf &lt; .1" width="100%" />
<p class="caption">
(#fig:aver2-alignment-by-maf)robustness of ave r2_j: maf &gt; .1 vs. maf &lt; .1
</p>
</div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0k&quot;</span>,<span class="st">&quot;1k&quot;</span>, <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;1k&quot;</span>,<span class="st">&quot;5k&quot;</span>, <span class="st">&quot;10k&quot;</span>, <span class="st">&quot;20k&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>dir<span class="ot">=</span><span class="st">&quot;inflation/sensitivity/maf.1/&quot;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ave-r2-1st-vs-2nd-run.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">40</span>, <span class="at">height=</span><span class="dv">70</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">4</span>), <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(n)){</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(m)){</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    nm1<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;maf-g.1-&quot;</span>,m[j],<span class="st">&quot;-snps-mix-pop-&quot;</span>,n[i],<span class="st">&quot;-noneuro&quot;</span>) <span class="co"># maf &gt; .1</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    nm2<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;maf-l.1-&quot;</span>,m[j],<span class="st">&quot;-snps-mix-pop-&quot;</span>,n[i],<span class="st">&quot;-noneuro&quot;</span>) <span class="co"># maf &lt; .1</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    dat1<span class="fl">.1</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary/ave-r2-&quot;</span>,nm1),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    dat2<span class="fl">.1</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary-run2/ave-r2-&quot;</span>,nm1),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    dat1<span class="fl">.2</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary/ave-r2-&quot;</span>,nm2),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    dat2<span class="fl">.2</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;summary-run2/ave-r2-&quot;</span>,nm2),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    test1<span class="ot">=</span><span class="fu">cor.test</span>(dat1<span class="fl">.1</span><span class="sc">$</span>V2, dat2<span class="fl">.1</span><span class="sc">$</span>V2)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    test2<span class="ot">=</span><span class="fu">cor.test</span>(dat1<span class="fl">.2</span><span class="sc">$</span>V2, dat2<span class="fl">.2</span><span class="sc">$</span>V2)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    out1<span class="fl">.0</span><span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">maf=</span><span class="st">&quot;&gt;.1&quot;</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">n_noneuro=</span>n[i],</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">m=</span>m[j],</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">est=</span>test1<span class="sc">$</span>estimate,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">low_95=</span>test1<span class="sc">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">up_95=</span>test1<span class="sc">$</span>conf.int[<span class="dv">2</span>], <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    out2<span class="fl">.0</span><span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">maf=</span><span class="st">&quot;&lt;.1&quot;</span>,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">n_noneuro=</span>n[i],</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">m=</span>m[j],</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">est=</span>test2<span class="sc">$</span>estimate,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">low_95=</span>test2<span class="sc">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">up_95=</span>test2<span class="sc">$</span>conf.int[<span class="dv">2</span>], <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>        out1<span class="fl">.1</span><span class="ot">=</span>out1<span class="fl">.0</span>; </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>        out2<span class="fl">.1</span><span class="ot">=</span>out2<span class="fl">.0</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>          out1<span class="fl">.1</span><span class="ot">=</span><span class="fu">rbind</span>(out1<span class="fl">.1</span>,out1<span class="fl">.0</span>)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>          out2<span class="fl">.1</span><span class="ot">=</span><span class="fu">rbind</span>(out2<span class="fl">.1</span>,out2<span class="fl">.0</span>)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="varying-levels-of-confouding" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> varying levels of confouding</h2>
<ol start="3" style="list-style-type: decimal">
<li>Show that estimated inflation correlates well with difference in <span class="math inline">\(\overline{r_j^2}\)</span> between bad and good GWAS.
I guess it will be nice to have more variety. E.g., instead of good and bad, have good, a bit bad (e.g., 1000 non-europeans), a bit more bad (2000 non-europeans), … bad (7000 non-europeans).</li>
</ol>
<p>Would be great to know the slope of this regression. Can you estimate it by regressing <span class="math inline">\(S_j\)</span> on <span class="math inline">\(\overline{r_j^2}\)</span> from the bad GWAS? But if we can, we just say the slope is less than n</p>
<p>You showed that if you regress inflation on <span class="math inline">\(\overline{r_j^2}\)</span> and MAF, that MAF is not significant (nor if you use log(MAF) or exp(MAF) or (MAFX(1-MAF))).
Can you also include info score - hopefully this is also not significant.
If Maf and Info scores are redundant, this strengthens argument for using r2j</p>
<p>So we ran the bad GWASs once again using different number of Europeans (n1) &amp; Non-europeans (n2) while keep N = n1+n2=100. We did so for different MAF. For these GWASs, we regress the chi square test statistics on <span class="math inline">\(\overline{r_j^2}\)</span>, MAF &amp; info score.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create directories</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> 0k 1k 2k 3k 4k 5k 6k<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-mix-<span class="va">$i</span>-noneuro</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># note: previously, the mixed population GWAS was based on 6,472 non-europeans </span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> 0k 1k 2k 3k 4k 5k 6k<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> .1 .01 .001<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-mix-<span class="va">$i</span>-noneuro/maf<span class="va">$j</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># create id lists &amp; snp lists</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># id lists---------------------------------------------------------------------</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># note we used id lists from previous bad GWAS</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># noneuropean id  </span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> relatedness/asian-cut.05.keep relatedness/black-cut.05.keep <span class="op">&gt;</span> noneuro-unrel.id</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co"># mixed pop id</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="va">n1</span><span class="op">=</span><span class="va">(</span>1000 2000 3000 4000 5000 6000<span class="va">)</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span><span class="va">(</span>1k 2k 3k 4k 5k 6k<span class="va">)</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="va">n2</span><span class="op">=</span><span class="va">(</span>99000 98000 97000 96000 95000 94000<span class="va">)</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">0</span><span class="dt">..</span><span class="dv">5</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="ex">shuf</span> noneuro-unrel.id <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">${n1</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> <span class="op">&gt;</span> noneuro-unrel.rand.<span class="va">${n1</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="ex">shuf</span> rand.100000 <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">${n2</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> <span class="op">&gt;</span> white-unrel.rand.<span class="va">${n2</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> white-unrel.rand.<span class="va">${n2</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> noneuro-unrel.rand.<span class="va">${n1</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> <span class="op">&gt;</span> mix-pop-gwas-<span class="va">${nm</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>-noneuro.id</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co"># snp list----------------------------------------------------------------------</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="co"># note: for the initial bad gwas, we used the snp list for good gwas</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e., ../gen/snps-unrel-inds.use</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co"># gen/geno-unrel.stats is based on QCed genotype data of rand.100000 before maf...</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="co"># ... call-rate screening </span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="co"># here we want to get snp list of different maf thresholds</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> maf <span class="kw">in</span> .1 .01 .001<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> gen/geno-unrel.stats <span class="at">-v</span> maf=<span class="va">$maf</span> <span class="st">&#39;($5&gt;maf &amp;&amp; $6&gt;=0.95 &amp;&amp; NR&gt;1){print $1}&#39;</span> <span class="op">&gt;</span> gen/snps-unrel-maf<span class="va">$maf</span>.use</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> gen/snps-unrel-maf<span class="va">$maf</span>.use</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &gt; 0.1 : 856,746 snps-unrel-maf.1.use</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &gt; 0.01 : 1,103,209 snps-unrel-maf.01.use</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &gt; 0.001 : 1,111,494 snps-unrel-maf.001.use</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a><span class="co">#  extract genotype data for mixed pop</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a><span class="co"># note: previously geno-mix is based on snps-unrel-inds.use, which is a snp list...</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a><span class="co">#... after filtering for maf (maf&gt;0.01) and call rate. So genotype data does not...</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a><span class="co">#... contain snps with maf &lt; 0.01. So we need to extract genotype data for this...</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="co">#... set of analysis using overlap-mixed-complete-cov.id and snps-unrel-maf.001.use...</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a><span class="co">#...(see above for how the snp list is generated)</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a><span class="co"># bfiles by chr-----------------------------------------------------------------</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../overlap-mixed-complete-cov.id </span><span class="dt">\</span></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract ../gen/snps-unrel-maf.001.use </span><span class="dt">\</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a><span class="st">         --make-bed </span><span class="dt">\</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-mix </span><span class="dt">\</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3 </span><span class="dt">\</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/chr<span class="va">$j</span>-mix.sh</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/chr<span class="va">$i</span>-mix.sh</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/mkbfile-mix-pop-new</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a><span class="co"># merge bfiles------------------------------------------------------------------</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> bfile-mix-new.list</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span>  <span class="st">&quot;../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-mix&quot;</span> <span class="op">&gt;&gt;</span>bfile-mix-new.list</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --make-bed ../gen/geno-mix-maf.001 </span><span class="dt">\</span></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a><span class="st">          --mbfile ../gen/bfile-mix-new.list </span><span class="dt">\</span></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a><span class="st">          --exclude-dups YES  </span></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/merge-mbfiles-mix.sh</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the script</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/merge-mbfiles-mix.sh <span class="op">&gt;</span>../job-records/merge-mbfiles-mix-pop-maf.001</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a><span class="co">#  get INFO score</span></span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a><span class="co"># here we repeat the QC step for the good gwas to compute the INFO score</span></span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a><span class="co"># note: since the MAF is based on snp list after QC for rand.100000, here we compute...</span></span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a><span class="co">#...INFO based on the same list of participants.</span></span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a><span class="co"># make QCed pgen files---------------------------------------------------------- </span></span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../unrelated/rand.100000 </span><span class="dt">\</span></span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract ../doug/ukbb.ldsc </span><span class="dt">\</span></span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a><span class="st">         --hwe 0.0001 </span><span class="dt">\</span></span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a><span class="st">         --hard-call-threshold .05 </span><span class="dt">\</span></span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a><span class="st">         --mach-r2-filter 0.8 2 </span><span class="dt">\</span></span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a><span class="st">         --make-pgen </span><span class="dt">\</span></span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-unrel </span><span class="dt">\</span></span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3</span></span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/qc-unrel-pgen</span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a><span class="co"># compute info score------------------------------------------------------------</span></span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb13-147"><a href="#cb13-147" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb13-148"><a href="#cb13-148" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb13-149"><a href="#cb13-149" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb13-150"><a href="#cb13-150" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb13-151"><a href="#cb13-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-152"><a href="#cb13-152" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-unrel </span><span class="dt">\</span></span>
<span id="cb13-153"><a href="#cb13-153" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../unrelated/rand.100000 </span><span class="dt">\</span></span>
<span id="cb13-154"><a href="#cb13-154" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3 </span><span class="dt">\</span></span>
<span id="cb13-155"><a href="#cb13-155" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb13-156"><a href="#cb13-156" aria-hidden="true" tabindex="-1"></a><span class="st">         --freq cols=chrom,ref,alt,altfreq,machr2 </span><span class="dt">\</span></span>
<span id="cb13-157"><a href="#cb13-157" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/info/chr</span><span class="va">$j</span><span class="st"> </span></span>
<span id="cb13-158"><a href="#cb13-158" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb13-159"><a href="#cb13-159" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/info-chr<span class="va">$j</span>.sh</span>
<span id="cb13-160"><a href="#cb13-160" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-161"><a href="#cb13-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-162"><a href="#cb13-162" aria-hidden="true" tabindex="-1"></a><span class="co"># submit file</span></span>
<span id="cb13-163"><a href="#cb13-163" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-164"><a href="#cb13-164" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/info-chr<span class="va">$j</span>.sh</span>
<span id="cb13-165"><a href="#cb13-165" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/compute-info-score</span>
<span id="cb13-166"><a href="#cb13-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-167"><a href="#cb13-167" aria-hidden="true" tabindex="-1"></a><span class="co"># combine files</span></span>
<span id="cb13-168"><a href="#cb13-168" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>gen/info</span>
<span id="cb13-169"><a href="#cb13-169" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">$dir</span>/rand.100000-qced-afreq </span>
<span id="cb13-170"><a href="#cb13-170" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-171"><a href="#cb13-171" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$i</span> <span class="ot">==</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb13-172"><a href="#cb13-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$dir</span>/chr<span class="va">$i</span>.afreq <span class="op">&gt;</span> <span class="va">$dir</span>/rand.100000-qced.afreq</span>
<span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> </span>
<span id="cb13-174"><a href="#cb13-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$dir</span>/chr<span class="va">$i</span>.afreq <span class="op">&gt;&gt;</span> <span class="va">$dir</span>/rand.100000-qced.afreq</span>
<span id="cb13-175"><a href="#cb13-175" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb13-176"><a href="#cb13-176" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-177"><a href="#cb13-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-178"><a href="#cb13-178" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-179"><a href="#cb13-179" aria-hidden="true" tabindex="-1"></a><span class="co"># GWASs</span></span>
<span id="cb13-180"><a href="#cb13-180" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-181"><a href="#cb13-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-182"><a href="#cb13-182" aria-hidden="true" tabindex="-1"></a><span class="co">## </span><span class="al">NOTE</span><span class="co">: for maf &gt;0.001, we will have to redo the GWAS, because geno-mix only ...</span></span>
<span id="cb13-183"><a href="#cb13-183" aria-hidden="true" tabindex="-1"></a><span class="co">#...contains snps with maf &gt; 0.01. See below</span></span>
<span id="cb13-184"><a href="#cb13-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-185"><a href="#cb13-185" aria-hidden="true" tabindex="-1"></a><span class="co"># for 0k, i.e., the good gwas without PC as covariates--------------------------------------</span></span>
<span id="cb13-186"><a href="#cb13-186" aria-hidden="true" tabindex="-1"></a><span class="va">n</span><span class="op">=</span>0k</span>
<span id="cb13-187"><a href="#cb13-187" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-188"><a href="#cb13-188" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> maf <span class="kw">in</span> <span class="dt">{.1</span><span class="op">,</span><span class="dt">.01</span><span class="op">,</span><span class="dt">.001}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-189"><a href="#cb13-189" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb13-190"><a href="#cb13-190" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb13-191"><a href="#cb13-191" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb13-192"><a href="#cb13-192" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 7G</span></span>
<span id="cb13-193"><a href="#cb13-193" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb13-194"><a href="#cb13-194" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 2:00:0</span></span>
<span id="cb13-195"><a href="#cb13-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-196"><a href="#cb13-196" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../gwas-mix-</span><span class="va">$n</span><span class="st">-noneuro/maf</span><span class="va">$maf</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb13-197"><a href="#cb13-197" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb13-198"><a href="#cb13-198" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb13-199"><a href="#cb13-199" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb13-200"><a href="#cb13-200" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../rand.100000 </span><span class="dt">\</span></span>
<span id="cb13-201"><a href="#cb13-201" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-unrel-maf</span><span class="va">$maf</span><span class="st">.use </span><span class="dt">\</span></span>
<span id="cb13-202"><a href="#cb13-202" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2</span></span>
<span id="cb13-203"><a href="#cb13-203" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-<span class="va">$n</span>-noneuro-maf-<span class="va">$maf</span>.sh</span>
<span id="cb13-204"><a href="#cb13-204" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-205"><a href="#cb13-205" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-206"><a href="#cb13-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-207"><a href="#cb13-207" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb13-208"><a href="#cb13-208" aria-hidden="true" tabindex="-1"></a><span class="va">n</span><span class="op">=</span>0k</span>
<span id="cb13-209"><a href="#cb13-209" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-210"><a href="#cb13-210" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> maf <span class="kw">in</span> <span class="dt">{.1</span><span class="op">,</span><span class="dt">.01</span><span class="op">,</span><span class="dt">.001}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-211"><a href="#cb13-211" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-<span class="va">$n</span>-noneuro-maf-<span class="va">$maf</span>.sh</span>
<span id="cb13-212"><a href="#cb13-212" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-213"><a href="#cb13-213" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/bad-gwas-0k-noneuro</span>
<span id="cb13-214"><a href="#cb13-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-215"><a href="#cb13-215" aria-hidden="true" tabindex="-1"></a><span class="co"># for 1k to 6k------------------------------------------------------------------</span></span>
<span id="cb13-216"><a href="#cb13-216" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-217"><a href="#cb13-217" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-218"><a href="#cb13-218" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> maf <span class="kw">in</span> <span class="dt">{.1</span><span class="op">,</span><span class="dt">.01</span><span class="op">,</span><span class="dt">.001}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-219"><a href="#cb13-219" aria-hidden="true" tabindex="-1"></a><span class="co">#for j in {1..22}; do</span></span>
<span id="cb13-220"><a href="#cb13-220" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb13-221"><a href="#cb13-221" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb13-222"><a href="#cb13-222" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb13-223"><a href="#cb13-223" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 7G</span></span>
<span id="cb13-224"><a href="#cb13-224" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb13-225"><a href="#cb13-225" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 8:00:0</span></span>
<span id="cb13-226"><a href="#cb13-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-227"><a href="#cb13-227" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../gwas-mix-</span><span class="va">$n</span><span class="st">-noneuro/maf</span><span class="va">$maf</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb13-228"><a href="#cb13-228" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb13-229"><a href="#cb13-229" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb13-230"><a href="#cb13-230" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb13-231"><a href="#cb13-231" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas-</span><span class="va">$n</span><span class="st">-noneuro.id </span><span class="dt">\</span></span>
<span id="cb13-232"><a href="#cb13-232" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-unrel-maf</span><span class="va">$maf</span><span class="st">.use </span><span class="dt">\</span></span>
<span id="cb13-233"><a href="#cb13-233" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2</span></span>
<span id="cb13-234"><a href="#cb13-234" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-<span class="va">$n</span>-noneuro-maf-<span class="va">$maf</span>.sh</span>
<span id="cb13-235"><a href="#cb13-235" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-236"><a href="#cb13-236" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-237"><a href="#cb13-237" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-238"><a href="#cb13-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-239"><a href="#cb13-239" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb13-240"><a href="#cb13-240" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-241"><a href="#cb13-241" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-242"><a href="#cb13-242" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> maf <span class="kw">in</span> <span class="dt">{.1</span><span class="op">,</span><span class="dt">.01</span><span class="op">,</span><span class="dt">.001}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-243"><a href="#cb13-243" aria-hidden="true" tabindex="-1"></a><span class="co">#for j in {1..22}; do</span></span>
<span id="cb13-244"><a href="#cb13-244" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-<span class="va">$n</span>-noneuro-maf-<span class="va">$maf</span>.sh</span>
<span id="cb13-245"><a href="#cb13-245" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-246"><a href="#cb13-246" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-247"><a href="#cb13-247" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/bad-gwas</span>
<span id="cb13-248"><a href="#cb13-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-249"><a href="#cb13-249" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion</span></span>
<span id="cb13-250"><a href="#cb13-250" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/bad-gwas</span>
<span id="cb13-251"><a href="#cb13-251" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb13-252"><a href="#cb13-252" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb13-253"><a href="#cb13-253" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-254"><a href="#cb13-254" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb13-255"><a href="#cb13-255" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb13-256"><a href="#cb13-256" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb13-257"><a href="#cb13-257" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb13-258"><a href="#cb13-258" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb13-259"><a href="#cb13-259" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-260"><a href="#cb13-260" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb13-261"><a href="#cb13-261" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb13-262"><a href="#cb13-262" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb13-263"><a href="#cb13-263" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb13-264"><a href="#cb13-264" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb13-265"><a href="#cb13-265" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb13-266"><a href="#cb13-266" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb13-267"><a href="#cb13-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-268"><a href="#cb13-268" aria-hidden="true" tabindex="-1"></a><span class="co"># combine results for some--------------------------------------------------- </span></span>
<span id="cb13-269"><a href="#cb13-269" aria-hidden="true" tabindex="-1"></a><span class="co"># only for .summaries &amp; .pvalues</span></span>
<span id="cb13-270"><a href="#cb13-270" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb13-271"><a href="#cb13-271" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-272"><a href="#cb13-272" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$j</span> <span class="ot">==</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb13-273"><a href="#cb13-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.summaries <span class="op">&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb13-274"><a href="#cb13-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.pvalues <span class="op">&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb13-275"><a href="#cb13-275" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> </span>
<span id="cb13-276"><a href="#cb13-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.summaries <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb13-277"><a href="#cb13-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.pvalues <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb13-278"><a href="#cb13-278" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb13-279"><a href="#cb13-279" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-280"><a href="#cb13-280" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-281"><a href="#cb13-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-282"><a href="#cb13-282" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat gwas for maf&gt;.001 -----------------------------------------------------</span></span>
<span id="cb13-283"><a href="#cb13-283" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>.001</span>
<span id="cb13-284"><a href="#cb13-284" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-mix-maf.001</span>
<span id="cb13-285"><a href="#cb13-285" aria-hidden="true" tabindex="-1"></a><span class="va">n</span><span class="op">=</span><span class="va">(</span>0k 1k 2k 3k 4k 5k 6k<span class="va">)</span></span>
<span id="cb13-286"><a href="#cb13-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-287"><a href="#cb13-287" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-288"><a href="#cb13-288" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">0</span><span class="dt">..</span><span class="dv">6</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-289"><a href="#cb13-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-290"><a href="#cb13-290" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../gwas-mix-<span class="va">${n</span><span class="op">[</span><span class="va">$j</span><span class="op">]</span><span class="va">}</span>-noneuro/maf<span class="va">$maf</span>/<span class="va">$i</span>-linear</span>
<span id="cb13-291"><a href="#cb13-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-292"><a href="#cb13-292" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$j</span> <span class="ot">==</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb13-293"><a href="#cb13-293" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../rand.100000</span>
<span id="cb13-294"><a href="#cb13-294" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb13-295"><a href="#cb13-295" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../mix-pop-gwas-<span class="va">${n</span><span class="op">[</span><span class="va">$j</span><span class="op">]</span><span class="va">}</span>-noneuro.id</span>
<span id="cb13-296"><a href="#cb13-296" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb13-297"><a href="#cb13-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-298"><a href="#cb13-298" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb13-299"><a href="#cb13-299" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb13-300"><a href="#cb13-300" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb13-301"><a href="#cb13-301" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 7G</span></span>
<span id="cb13-302"><a href="#cb13-302" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb13-303"><a href="#cb13-303" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 01:30:0</span></span>
<span id="cb13-304"><a href="#cb13-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-305"><a href="#cb13-305" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb13-306"><a href="#cb13-306" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb13-307"><a href="#cb13-307" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb13-308"><a href="#cb13-308" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb13-309"><a href="#cb13-309" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb13-310"><a href="#cb13-310" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-unrel-maf</span><span class="va">$maf</span><span class="st">.use </span><span class="dt">\</span></span>
<span id="cb13-311"><a href="#cb13-311" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2</span></span>
<span id="cb13-312"><a href="#cb13-312" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-<span class="va">${n</span><span class="op">[</span><span class="va">$j</span><span class="op">]</span><span class="va">}</span>-noneuro-maf-<span class="va">$maf</span>.sh</span>
<span id="cb13-313"><a href="#cb13-313" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-314"><a href="#cb13-314" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-315"><a href="#cb13-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-316"><a href="#cb13-316" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb13-317"><a href="#cb13-317" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>.001</span>
<span id="cb13-318"><a href="#cb13-318" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-319"><a href="#cb13-319" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-320"><a href="#cb13-320" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-<span class="va">$n</span>-noneuro-maf-<span class="va">$maf</span>.sh</span>
<span id="cb13-321"><a href="#cb13-321" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-322"><a href="#cb13-322" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/bad-gwas</span>
<span id="cb13-323"><a href="#cb13-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-324"><a href="#cb13-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-325"><a href="#cb13-325" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-326"><a href="#cb13-326" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r^2_j</span></span>
<span id="cb13-327"><a href="#cb13-327" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-328"><a href="#cb13-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-329"><a href="#cb13-329" aria-hidden="true" tabindex="-1"></a><span class="co"># create snp lists--------------------------------------------------------------</span></span>
<span id="cb13-330"><a href="#cb13-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-331"><a href="#cb13-331" aria-hidden="true" tabindex="-1"></a><span class="co"># note: we do this for three snp lists</span></span>
<span id="cb13-332"><a href="#cb13-332" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &gt; 0.1 : 856,746 gen/snps-unrel-maf.1.use</span></span>
<span id="cb13-333"><a href="#cb13-333" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &gt; 0.01 : 1,103,209 gen/snps-unrel-maf.01.use</span></span>
<span id="cb13-334"><a href="#cb13-334" aria-hidden="true" tabindex="-1"></a><span class="co"># maf &gt; 0.001 : 1,111,494 gen/snps-unrel-maf.001.use</span></span>
<span id="cb13-335"><a href="#cb13-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-336"><a href="#cb13-336" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>10000</span>
<span id="cb13-337"><a href="#cb13-337" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>10k</span>
<span id="cb13-338"><a href="#cb13-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-339"><a href="#cb13-339" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{.1</span><span class="op">,</span><span class="dt">.01</span><span class="op">,</span><span class="dt">.001}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-340"><a href="#cb13-340" aria-hidden="true" tabindex="-1"></a><span class="co"># define vars</span></span>
<span id="cb13-341"><a href="#cb13-341" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gen/snps-unrel-maf<span class="va">$i</span>.use</span>
<span id="cb13-342"><a href="#cb13-342" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>inflation/left-snps-unrel-maf<span class="va">$i</span>-<span class="va">$nm</span></span>
<span id="cb13-343"><a href="#cb13-343" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>inflation/right-snps-unrel-maf<span class="va">$i</span>-<span class="va">$nm</span></span>
<span id="cb13-344"><a href="#cb13-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-345"><a href="#cb13-345" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;);</span></span>
<span id="cb13-346"><a href="#cb13-346" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&lt;8) print $1 }&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$left</span>  </span>
<span id="cb13-347"><a href="#cb13-347" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;);</span></span>
<span id="cb13-348"><a href="#cb13-348" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&gt;=8) print $1 }&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$right</span></span>
<span id="cb13-349"><a href="#cb13-349" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-350"><a href="#cb13-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-351"><a href="#cb13-351" aria-hidden="true" tabindex="-1"></a><span class="co"># compute r_ij using ldak -------------------------------------------------------</span></span>
<span id="cb13-352"><a href="#cb13-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-353"><a href="#cb13-353" aria-hidden="true" tabindex="-1"></a><span class="va">n</span><span class="op">=</span><span class="va">(</span>0k 1k 2k 3k 4k 5k 6k<span class="va">)</span></span>
<span id="cb13-354"><a href="#cb13-354" aria-hidden="true" tabindex="-1"></a><span class="va">indir</span><span class="op">=</span>../inflation</span>
<span id="cb13-355"><a href="#cb13-355" aria-hidden="true" tabindex="-1"></a><span class="va">outdir</span><span class="op">=</span>../inflation/out</span>
<span id="cb13-356"><a href="#cb13-356" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-mix-maf.001</span>
<span id="cb13-357"><a href="#cb13-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-358"><a href="#cb13-358" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">0</span><span class="dt">..</span><span class="dv">6</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-359"><a href="#cb13-359" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{.1</span><span class="op">,</span><span class="dt">.01</span><span class="op">,</span><span class="dt">.001}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-360"><a href="#cb13-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-361"><a href="#cb13-361" aria-hidden="true" tabindex="-1"></a><span class="co"># define vars</span></span>
<span id="cb13-362"><a href="#cb13-362" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span><span class="va">$indir</span>/right-snps-unrel-maf<span class="va">$i</span>-10k</span>
<span id="cb13-363"><a href="#cb13-363" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span><span class="va">$indir</span>/left-snps-unrel-maf<span class="va">$i</span>-10k</span>
<span id="cb13-364"><a href="#cb13-364" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$outdir</span>/10k-snps-mix-pop-gwas-<span class="va">${n</span><span class="op">[</span><span class="va">$j</span><span class="op">]</span><span class="va">}</span>-noneuro-maf<span class="va">$i</span></span>
<span id="cb13-365"><a href="#cb13-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-366"><a href="#cb13-366" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$j</span> <span class="ot">==</span> 0 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb13-367"><a href="#cb13-367" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../rand.100000</span>
<span id="cb13-368"><a href="#cb13-368" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> </span>
<span id="cb13-369"><a href="#cb13-369" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../mix-pop-gwas-<span class="va">${n</span><span class="op">[</span><span class="va">$j</span><span class="op">]</span><span class="va">}</span>-noneuro.id</span>
<span id="cb13-370"><a href="#cb13-370" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb13-371"><a href="#cb13-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-372"><a href="#cb13-372" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb13-373"><a href="#cb13-373" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb13-374"><a href="#cb13-374" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb13-375"><a href="#cb13-375" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb13-376"><a href="#cb13-376" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb13-377"><a href="#cb13-377" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 2:00:0</span></span>
<span id="cb13-378"><a href="#cb13-378" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb13-379"><a href="#cb13-379" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb13-380"><a href="#cb13-380" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb13-381"><a href="#cb13-381" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb13-382"><a href="#cb13-382" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb13-383"><a href="#cb13-383" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb13-384"><a href="#cb13-384" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-r-10k-snps-mix-pop-gwas-<span class="va">${n</span><span class="op">[</span><span class="va">$j</span><span class="op">]</span><span class="va">}</span>-noneuro-maf<span class="va">$i</span></span>
<span id="cb13-385"><a href="#cb13-385" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-386"><a href="#cb13-386" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-387"><a href="#cb13-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-388"><a href="#cb13-388" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb13-389"><a href="#cb13-389" aria-hidden="true" tabindex="-1"></a><span class="va">n</span><span class="op">=</span><span class="va">(</span>0k 1k 2k 3k 4k 5k 6k<span class="va">)</span></span>
<span id="cb13-390"><a href="#cb13-390" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">0</span><span class="dt">..</span><span class="dv">6</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-391"><a href="#cb13-391" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{.1</span><span class="op">,</span><span class="dt">.01</span><span class="op">,</span><span class="dt">.001}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-392"><a href="#cb13-392" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-r-10k-snps-mix-pop-gwas-<span class="va">${n</span><span class="op">[</span><span class="va">$j</span><span class="op">]</span><span class="va">}</span>-noneuro-maf<span class="va">$i</span></span>
<span id="cb13-393"><a href="#cb13-393" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-394"><a href="#cb13-394" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/calc-r</span>
<span id="cb13-395"><a href="#cb13-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-396"><a href="#cb13-396" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r_j^2 for each i-------------------------------------------------</span></span>
<span id="cb13-397"><a href="#cb13-397" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb13-398"><a href="#cb13-398" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb13-399"><a href="#cb13-399" aria-hidden="true" tabindex="-1"></a><span class="va">n</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;0k&quot;</span><span class="ex">,</span><span class="st">&quot;1k&quot;</span><span class="ex">,</span> <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span><span class="kw">)</span></span>
<span id="cb13-400"><a href="#cb13-400" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;.1&quot;</span><span class="ex">,</span><span class="st">&quot;.01&quot;</span><span class="ex">,</span><span class="st">&quot;.001&quot;</span><span class="kw">)</span></span>
<span id="cb13-401"><a href="#cb13-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-402"><a href="#cb13-402" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">j</span> in 1:length<span class="er">(</span><span class="ex">maf</span><span class="kw">)){</span></span>
<span id="cb13-403"><a href="#cb13-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-404"><a href="#cb13-404" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">n</span><span class="kw">)){</span></span>
<span id="cb13-405"><a href="#cb13-405" aria-hidden="true" tabindex="-1"></a>    <span class="va">nm</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;10k-snps-mix-pop-gwas-&quot;</span><span class="ex">,n[i],</span><span class="st">&quot;-noneuro-maf&quot;</span><span class="ex">,maf[j]</span><span class="kw">)</span></span>
<span id="cb13-406"><a href="#cb13-406" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.pairwise&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb13-407"><a href="#cb13-407" aria-hidden="true" tabindex="-1"></a>    <span class="va">lista</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsa&quot;</span><span class="kw">)</span><span class="ex">,</span> stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb13-408"><a href="#cb13-408" aria-hidden="true" tabindex="-1"></a>    <span class="va">listb</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsb&quot;</span><span class="kw">)</span><span class="ex">,</span> stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb13-409"><a href="#cb13-409" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-410"><a href="#cb13-410" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>dat[,-c<span class="kw">(</span><span class="ex">10001</span><span class="kw">)</span><span class="ex">]^2</span></span>
<span id="cb13-411"><a href="#cb13-411" aria-hidden="true" tabindex="-1"></a>    <span class="va">outb</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>listb<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,2,</span> mean<span class="kw">))</span></span>
<span id="cb13-412"><a href="#cb13-412" aria-hidden="true" tabindex="-1"></a>    <span class="va">outa</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>lista<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,1,</span> mean<span class="kw">))</span></span>
<span id="cb13-413"><a href="#cb13-413" aria-hidden="true" tabindex="-1"></a>    <span class="va">out</span><span class="op">=</span>rbind<span class="kw">(</span><span class="ex">outa,outb</span><span class="kw">)</span></span>
<span id="cb13-414"><a href="#cb13-414" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-415"><a href="#cb13-415" aria-hidden="true" tabindex="-1"></a>    <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;summary/ave-r2-&quot;</span><span class="ex">,nm</span><span class="kw">)</span><span class="ex">,</span> col.names=F, row.names=F, quote=F<span class="kw">)</span>  </span>
<span id="cb13-416"><a href="#cb13-416" aria-hidden="true" tabindex="-1"></a>  <span class="kw">}</span></span>
<span id="cb13-417"><a href="#cb13-417" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb13-418"><a href="#cb13-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-419"><a href="#cb13-419" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-420"><a href="#cb13-420" aria-hidden="true" tabindex="-1"></a><span class="co"># extract LD score</span></span>
<span id="cb13-421"><a href="#cb13-421" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-422"><a href="#cb13-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-423"><a href="#cb13-423" aria-hidden="true" tabindex="-1"></a><span class="co"># convert snp list to rs system ------------------------------------------------</span></span>
<span id="cb13-424"><a href="#cb13-424" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gen/snps-unrel-maf.001.use</span>
<span id="cb13-425"><a href="#cb13-425" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>gen/snps-unrel-maf.001.use-rs</span>
<span id="cb13-426"><a href="#cb13-426" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1]; b[$1]=$2; next}</span></span>
<span id="cb13-427"><a href="#cb13-427" aria-hidden="true" tabindex="-1"></a><span class="st">     ($1 in a){print b[$1], $2}&#39;</span> doug/ukbb.ldsc <span class="va">$infile</span> <span class="op">&gt;</span> <span class="va">$outfile</span></span>
<span id="cb13-428"><a href="#cb13-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-429"><a href="#cb13-429" aria-hidden="true" tabindex="-1"></a><span class="co">#  extract ld scores -----------------------------------------------------------</span></span>
<span id="cb13-430"><a href="#cb13-430" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>ldsc/eur_w_ld_chr</span>
<span id="cb13-431"><a href="#cb13-431" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chrom <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-432"><a href="#cb13-432" aria-hidden="true" tabindex="-1"></a><span class="fu">zcat</span> <span class="va">$dir</span>/<span class="va">$chrom</span>.l2.ldscore.gz <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $2, $6}&#39;</span> <span class="op">&gt;</span> ldscore</span>
<span id="cb13-433"><a href="#cb13-433" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}($1 in a){print $0}&#39;</span> gen/snps-unrel-maf.001.use-rs ldscore <span class="op">&gt;</span> temp</span>
<span id="cb13-434"><a href="#cb13-434" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$chrom</span> <span class="ot">-eq</span> 1 <span class="bu">]</span></span>
<span id="cb13-435"><a href="#cb13-435" aria-hidden="true" tabindex="-1"></a><span class="cf">then</span> </span>
<span id="cb13-436"><a href="#cb13-436" aria-hidden="true" tabindex="-1"></a> <span class="fu">mv</span> temp snps-unrel-maf.001.ldscore</span>
<span id="cb13-437"><a href="#cb13-437" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb13-438"><a href="#cb13-438" aria-hidden="true" tabindex="-1"></a> <span class="fu">cat</span> snps-unrel-maf.001.ldscore temp <span class="op">&gt;</span> temp2</span>
<span id="cb13-439"><a href="#cb13-439" aria-hidden="true" tabindex="-1"></a> <span class="fu">mv</span> temp2 snps-unrel-maf.001.ldscore</span>
<span id="cb13-440"><a href="#cb13-440" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb13-441"><a href="#cb13-441" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$chrom</span></span>
<span id="cb13-442"><a href="#cb13-442" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-443"><a href="#cb13-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-444"><a href="#cb13-444" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-445"><a href="#cb13-445" aria-hidden="true" tabindex="-1"></a><span class="co">#  put info together</span></span>
<span id="cb13-446"><a href="#cb13-446" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb13-447"><a href="#cb13-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-448"><a href="#cb13-448" aria-hidden="true" tabindex="-1"></a><span class="co"># INFO: gen/info rand.100000-qced.afreq </span></span>
<span id="cb13-449"><a href="#cb13-449" aria-hidden="true" tabindex="-1"></a><span class="co"># maf: gen/geno-mix-maf.001.stats</span></span>
<span id="cb13-450"><a href="#cb13-450" aria-hidden="true" tabindex="-1"></a><span class="co"># chi square : trait-linear.summaries</span></span>
<span id="cb13-451"><a href="#cb13-451" aria-hidden="true" tabindex="-1"></a><span class="co"># ave r^2_j: e.g, summary/ave-r2-10k-snps-mix-pop-gwas-$i-noneuro-maf$j</span></span>
<span id="cb13-452"><a href="#cb13-452" aria-hidden="true" tabindex="-1"></a><span class="co"># ld score from ldsc ref panel: snps-unrel-maf.001.ldscore; in rs</span></span>
<span id="cb13-453"><a href="#cb13-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-454"><a href="#cb13-454" aria-hidden="true" tabindex="-1"></a><span class="co"># required files</span></span>
<span id="cb13-455"><a href="#cb13-455" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>gen/geno-mix-maf.001.stats <span class="co"># use as the snp list to integrate all info</span></span>
<span id="cb13-456"><a href="#cb13-456" aria-hidden="true" tabindex="-1"></a><span class="va">info</span><span class="op">=</span>gen/info/rand.100000-qced.afreq</span>
<span id="cb13-457"><a href="#cb13-457" aria-hidden="true" tabindex="-1"></a><span class="va">rs</span><span class="op">=</span>doug/ukbb.ldsc</span>
<span id="cb13-458"><a href="#cb13-458" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-unrel-maf.001.ldscore</span>
<span id="cb13-459"><a href="#cb13-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-460"><a href="#cb13-460" aria-hidden="true" tabindex="-1"></a><span class="co"># temporary files</span></span>
<span id="cb13-461"><a href="#cb13-461" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR &gt; 1 {print $1, $5 }&#39;</span> <span class="va">$maf</span> <span class="op">&gt;</span> tmp/maf.tmp</span>
<span id="cb13-462"><a href="#cb13-462" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$2]; b[$2]=$6; next} </span></span>
<span id="cb13-463"><a href="#cb13-463" aria-hidden="true" tabindex="-1"></a><span class="st">              {if ($1 in a) print b[$1] ;</span></span>
<span id="cb13-464"><a href="#cb13-464" aria-hidden="true" tabindex="-1"></a><span class="st">               else print &quot;NA&quot;}&#39;</span> <span class="va">$info</span> tmp/maf.tmp  <span class="op">&gt;</span> tmp/info.tmp</span>
<span id="cb13-465"><a href="#cb13-465" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$2]; b[$2]=$1; next} ($1 in a) {print b[$1], $0}&#39;</span> <span class="va">$rs</span> <span class="va">$ldsc</span> <span class="op">&gt;</span> tmp/ldsc.tmp1</span>
<span id="cb13-466"><a href="#cb13-466" aria-hidden="true" tabindex="-1"></a><span class="co"># here we make sure the order of the rows are the same as maf.tmp</span></span>
<span id="cb13-467"><a href="#cb13-467" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; c[$1]=$3 ; next} </span></span>
<span id="cb13-468"><a href="#cb13-468" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1], c[$1];</span></span>
<span id="cb13-469"><a href="#cb13-469" aria-hidden="true" tabindex="-1"></a><span class="st">      else print &quot;NA&quot;}&#39;</span> tmp/ldsc.tmp1 tmp/maf.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb13-470"><a href="#cb13-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-471"><a href="#cb13-471" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-472"><a href="#cb13-472" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-473"><a href="#cb13-473" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{.1</span><span class="op">,</span><span class="dt">.01</span><span class="op">,</span><span class="dt">.001}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-474"><a href="#cb13-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-475"><a href="#cb13-475" aria-hidden="true" tabindex="-1"></a><span class="co"># define files</span></span>
<span id="cb13-476"><a href="#cb13-476" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-mix-<span class="va">$n</span>-noneuro/maf<span class="va">$j</span>/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb13-477"><a href="#cb13-477" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-mix-pop-gwas-<span class="va">$n</span>-noneuro-maf<span class="va">$j</span></span>
<span id="cb13-478"><a href="#cb13-478" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-mix-all-out/<span class="va">$trait</span>-mix-pop-gwas-<span class="va">$n</span>-noneuro-maf<span class="va">$j</span>.out</span>
<span id="cb13-479"><a href="#cb13-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-480"><a href="#cb13-480" aria-hidden="true" tabindex="-1"></a><span class="co"># create temporary files</span></span>
<span id="cb13-481"><a href="#cb13-481" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb13-482"><a href="#cb13-482" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb13-483"><a href="#cb13-483" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/maf.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb13-484"><a href="#cb13-484" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb13-485"><a href="#cb13-485" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$5; next} </span></span>
<span id="cb13-486"><a href="#cb13-486" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb13-487"><a href="#cb13-487" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$gwas</span> tmp/maf.tmp <span class="op">&gt;</span> tmp/gwas.tmp     </span>
<span id="cb13-488"><a href="#cb13-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-489"><a href="#cb13-489" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb13-490"><a href="#cb13-490" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/maf.tmp <span class="dt">\</span></span>
<span id="cb13-491"><a href="#cb13-491" aria-hidden="true" tabindex="-1"></a>      tmp/info.tmp <span class="dt">\</span></span>
<span id="cb13-492"><a href="#cb13-492" aria-hidden="true" tabindex="-1"></a>      tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb13-493"><a href="#cb13-493" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb13-494"><a href="#cb13-494" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb13-495"><a href="#cb13-495" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot;;print &quot;snp;maf;info;chisq;aver2;rs;ldsc&quot;}</span></span>
<span id="cb13-496"><a href="#cb13-496" aria-hidden="true" tabindex="-1"></a><span class="st">              {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb13-497"><a href="#cb13-497" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-498"><a href="#cb13-498" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-499"><a href="#cb13-499" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="results-summary" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> results summary</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2_j</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># function to plot a single trait---------------------------------------------------</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>make_plot<span class="ot">=</span><span class="cf">function</span>(trait, maf, n_noneuro){</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define variables</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  n_noneuro<span class="ot">=</span>n_noneuro</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>trait</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  maf<span class="ot">=</span>maf</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define color</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(RColorBrewer)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  qual_col_pals <span class="ot">=</span> brewer.pal.info[brewer.pal.info<span class="sc">$</span>category <span class="sc">==</span> <span class="st">&#39;qual&#39;</span>,]</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  col_vector <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">mapply</span>(brewer.pal, qual_col_pals<span class="sc">$</span>maxcolors, <span class="fu">rownames</span>(qual_col_pals)))</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  mycol<span class="ot">=</span><span class="fu">sample</span>(col_vector,<span class="dv">7</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">length</span>(n_noneuro)<span class="sc">:</span><span class="dv">1</span>){</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    n<span class="ot">=</span>n_noneuro[i]</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-mix-all-out/&quot;</span>,trait,<span class="st">&quot;-mix-pop-gwas-&quot;</span>,n,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;-noneuro-maf&quot;</span>,maf,<span class="st">&quot;.out&quot;</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bin a variable by quantile</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># average chisq by bin values</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">==</span><span class="fu">length</span>(n_noneuro)){</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave chisq&quot;</span>,</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">points</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span>mycol[i], <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    } <span class="co"># end of conditional statement</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  } <span class="co"># end of loop over n</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>   <span class="co"># add a legend</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(trait<span class="sc">==</span><span class="st">&quot;awake&quot;</span>){</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>     <span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">legend=</span>n_noneuro, <span class="at">col=</span>mycol, <span class="at">cex=</span><span class="fl">1.5</span>, <span class="at">box.lty=</span><span class="dv">0</span>)}</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>} <span class="co"># end of function</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot ------------------------------------------------------------------</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="co"># maf = .01----------------------------</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>n_noneuro<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0k&quot;</span>,<span class="st">&quot;1k&quot;</span>, <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span>)</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>maf_threshold<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;.1&quot;</span>,<span class="st">&quot;.01&quot;</span>,<span class="st">&quot;.001&quot;</span>)</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>maf<span class="ot">=</span>maf_threshold[<span class="dv">2</span>]</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/mix-pop-gwas-chisq-by-aver2-bin.png&quot;</span>),</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>      trait<span class="ot">=</span>traits[i]</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">make_plot</span>(trait, maf, n_noneuro)</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a><span class="co"># maf = .001----------------------------</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>n_noneuro<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0k&quot;</span>,<span class="st">&quot;1k&quot;</span>, <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span>)</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>maf_threshold<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;.1&quot;</span>,<span class="st">&quot;.01&quot;</span>,<span class="st">&quot;.001&quot;</span>)</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>maf<span class="ot">=</span>maf_threshold[<span class="dv">3</span>]</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/mix-pop-gwas-chisq-by-aver2-bin-maf.001.png&quot;</span>),</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>      trait<span class="ot">=</span>traits[i]</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>      <span class="fu">make_plot</span>(trait, maf, n_noneuro)</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate slope: chisq ~ aver2_j</span></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>n_noneuro<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0k&quot;</span>,<span class="st">&quot;1k&quot;</span>, <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span>)</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>maf_threshold<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;.1&quot;</span>,<span class="st">&quot;.01&quot;</span>,<span class="st">&quot;.001&quot;</span>)</span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(maf_threshold)){</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(n_noneuro)){</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>    maf<span class="ot">=</span>maf_threshold[i]</span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a>    n<span class="ot">=</span>n_noneuro[j]</span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[k]</span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a>    file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-mix-all-out/&quot;</span>,trait,<span class="st">&quot;-mix-pop-gwas-&quot;</span>,n,</span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;-noneuro-maf&quot;</span>,maf,<span class="st">&quot;.out&quot;</span>)</span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a>    mod1<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat)</span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a>    mod2<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a>    slope0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a>                      <span class="at">maf_threshold=</span>maf,</span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a>                      <span class="at">n_noneuro=</span>n,</span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a>                      <span class="at">slope_aver2=</span><span class="fu">coef</span>(mod1)[<span class="dv">2</span>],</span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a>                      <span class="at">p_aver2=</span><span class="fu">summary</span>(mod1)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a>                      <span class="at">slope_ldsc=</span><span class="fu">coef</span>(mod2)[<span class="dv">2</span>],</span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a>                      <span class="at">p_ldsc=</span><span class="fu">summary</span>(mod2)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> k<span class="sc">==</span><span class="dv">1</span>){slope<span class="ot">=</span>slope0} <span class="cf">else</span> {slope<span class="ot">=</span><span class="fu">rbind</span>(slope,slope0)}</span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span>slope[<span class="fu">order</span>(slope<span class="sc">$</span>trait, slope<span class="sc">$</span>maf_threshold, slope<span class="sc">$</span>n_noneuro),]</span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(out,<span class="st">&quot;summary/mix-pop-gwas-slope.txt&quot;</span>, <span class="at">col.names=</span>T, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2_j by maf | n_noneuro</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># function to plot a single trait---------------------------------------------------</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>make_plot<span class="ot">=</span><span class="cf">function</span>(trait, maf_threshold, n){</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define variables</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  n<span class="ot">=</span>n</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>trait</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  maf_threshold<span class="ot">=</span>maf_threshold</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define color</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(RColorBrewer)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  qual_col_pals <span class="ot">=</span> brewer.pal.info[brewer.pal.info<span class="sc">$</span>category <span class="sc">==</span> <span class="st">&#39;qual&#39;</span>,]</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  col_vector <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">mapply</span>(brewer.pal, qual_col_pals<span class="sc">$</span>maxcolors, <span class="fu">rownames</span>(qual_col_pals)))</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  mycol<span class="ot">=</span><span class="fu">sample</span>(col_vector,<span class="fu">length</span>(maf_threshold))</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(maf_threshold)){</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    maf<span class="ot">=</span>maf_threshold[i]</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-mix-all-out/&quot;</span>,trait,<span class="st">&quot;-mix-pop-gwas-&quot;</span>,n,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;-noneuro-maf&quot;</span>,maf,<span class="st">&quot;.out&quot;</span>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bin a variable by quantile</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># average chisq by bin values</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave chisq&quot;</span>,</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span><span class="fu">paste0</span>(trait,<span class="st">&quot; &quot;</span>, n,<span class="st">&quot; non-european&quot;</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">points</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span>mycol[i], <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    } <span class="co"># end of conditional statement</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>  } <span class="co"># end of loop over maf</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>   <span class="co"># add a legend</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(trait<span class="sc">==</span><span class="st">&quot;awake&quot;</span>){</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>     <span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">legend=</span>maf_threshold, <span class="at">col=</span>mycol, <span class="at">cex=</span><span class="fl">1.5</span>, <span class="at">box.lty=</span><span class="dv">0</span>)}</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>} <span class="co"># end of function</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot ------------------------------------------------------------------</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>n_noneuro<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0k&quot;</span>,<span class="st">&quot;1k&quot;</span>, <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span>)</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>maf_threshold<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;.1&quot;</span>,<span class="st">&quot;.01&quot;</span>,<span class="st">&quot;.001&quot;</span>)</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(n_noneuro)){</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>  n<span class="ot">=</span>n_noneuro[j]</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot give an n for non-european</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/mix-pop-gwas-chisq-by-aver2-bin-&quot;</span>,n,<span class="st">&quot;-noneuro.png&quot;</span>),</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>        trait<span class="ot">=</span>traits[i]</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">make_plot</span>(trait, maf_threshold, n)</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can now report average inflation of test statistics (mean(r2j) x n x h2, which is upper bounded by mean(r2j) x n), AND we can report estimated per-SNP inflation of test statistics (r2j x n x j2)</p>
<p>Eg., we can say that if you use UKBB recommended samples, with MAF&gt;.01, the average inflation will be less than 0.5 units, while the maximum inflation will be less than 1 unit.</p>
<p>However, maybe we find that if you analyse rare SNPs (e.g. 0.0001 &lt; MAF &lt; .01), the maximum inflation is much higher (so people must be careful).</p>
<p>What happens if you have a meta-analysis - how does inflation accumulate over cohorts?</p>
<p>Possible way to write up this paper:</p>
<p>Perform a good and bad GWAS of height</p>
<p>Figure 1a - show that GIF performs poorly (because test statistics of good GWAS do not follow a chisq(1) distribution)</p>
<p>Figure 1b - use test statistics of good GWAS to show that LDSC performs badly, because it assumes causal variation is constant [Do you mean the choice of heritability model affects inflation estimates? But we found for good GWASs, ldsc under gcta is OK for most traits.]</p>
<p>Figure 1c - use difference between test statistics to show that LDSC performs badly because it assumes inflation is constant.</p>
<p>(in supplement, can show same results for other traits).</p>
<p>Figure 2 - show that r2j is independent of true signal (test statistics from good gwas), but predicts well inflation (difference)</p>
<!--chapter:end:04_ave_r2_ij.Rmd-->
</div>
</div>
<div id="good" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Good GWAS</h1>
<p>Here we do good GWASs. We will use 1.2M hapmap3 SNPs.
But sill need to do some QC to these SNPs.</p>
<div id="goodid" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> QC of hp3 SNPs</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># select 100k unrelated individuals with no missing covariates &amp; 14 phenotypes--</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># individual with complete covariates</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 100<span class="kw">)</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="ex">library</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;phen/covariates.use&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>dat[complete.cases<span class="kw">(</span><span class="ex">dat</span><span class="kw">)</span><span class="ex">,c</span><span class="er">(</span><span class="ex">1,2</span><span class="kw">)</span><span class="ex">]</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span><span class="st">&quot;covariates-complete-cases.id&quot;</span><span class="ex">,</span> col.names=F, row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># overlaping individuals across 14 traits</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> icd10/unrelated.inds overlap.ind <span class="co"># unrelated white British</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>phen/continuous-traits/</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tt <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> overlap.ind temp</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}($1 in a){print $1, $2}&#39;</span> temp <span class="va">$dir</span>/<span class="va">$tt</span>.raw.pheno <span class="op">&gt;</span> overlap.ind</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> overlap.ind</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$tt</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> temp</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co"># overlapping &amp; complete covariates</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR{a[$1]; next} ($1 in a) {print $1, $1}&#39;</span> overlap.ind covariates-complete-cases.id <span class="op">&gt;</span> overlap-complete-cases.id</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="co">#randomly pick 100k of these</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="ex">shuf</span> overlap-complete-cases.id <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 100000 <span class="op">&gt;</span> rand.100000</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co"># QC SNPs-----------------------------------------------------------------------</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co"># stating number of SNPs= 1,184,423 </span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../unrelated/rand.100000 </span><span class="dt">\</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract ../doug/ukbb.ldsc </span><span class="dt">\</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="st">         --hwe 0.0001 </span><span class="dt">\</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="st">         --hard-call-threshold .05 </span><span class="dt">\</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="st">         --mach-r2-filter 0.8 2 </span><span class="dt">\</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="st">         --make-bed </span><span class="dt">\</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-unrel </span><span class="dt">\</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/qc-unrel</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a><span class="co"># merge files</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> bfile-unrel.list</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span>  <span class="st">&quot;../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-unrel&quot;</span> <span class="op">&gt;&gt;</span>bfile-unrel.list</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 40:0:0</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --make-bed ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a><span class="st">          --mbfile ../gen/bfile-unrel.list </span><span class="dt">\</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a><span class="st">          --exclude-dups YES  </span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/mbfile-unrel.sh</span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the script</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/mbfile-unrel.sh <span class="op">&gt;</span>../job-records/mbfiles-unrel</span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a><span class="co"># MAF &amp; call-rate </span></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> geno-unrel.stats <span class="st">&#39;($5&gt;.01 &amp;&amp; $6&gt;=0.95 &amp;&amp; NR&gt;1){print $1}&#39;</span> <span class="op">&gt;</span> snps-unrel-inds.use</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a><span class="co"># m = 1,103,209 SNPs</span></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a> </span></code></pre></div>
</div>
<div id="extract-covariates" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> extract covariates</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>head<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;phen/ukb45861.header&quot;</span>, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>, <span class="at">header=</span>F, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># function to get the variables</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>get<span class="ot">=</span><span class="cf">function</span>(nm){</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  colnum<span class="ot">=</span><span class="fu">grep</span>(nm,head,<span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">rbind</span>(colnum, head[,colnum])))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(out)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;column&quot;</span>, <span class="st">&quot;field&quot;</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (out)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># get the variables</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">rbind</span>(<span class="fu">get</span>(<span class="st">&#39;21022-0&#39;</span>), <span class="co"># age at recruitment: 21022</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">get</span>(<span class="st">&#39;54-0&#39;</span>), <span class="co"># assessment centre: 54</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">get</span>(<span class="st">&#39;22000-0&#39;</span>), <span class="co"># genotyping batch: 22000</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">get</span>(<span class="st">&#39;22001-0&#39;</span>), <span class="co"># genetic sex: 22001</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">get</span>(<span class="st">&#39;189-0&#39;</span>), <span class="co"># townsend</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">get</span>(<span class="st">&#39;22009-0&#39;</span>), <span class="co"># genotype PC: 22009</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">get</span>(<span class="st">&#39;21000-0&#39;</span>)) <span class="co"># ethnic background </span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(out)<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(out)[<span class="dv">1</span>]</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co"># remove unwanted</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span>out[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">95</span><span class="sc">:</span><span class="dv">100</span>),]</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(out,<span class="st">&quot;phen/covariates.colnum&quot;</span>, <span class="at">col.names=</span>F, <span class="at">row.names=</span>F, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">quote=</span>F)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># extract dat from the full data set</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>awk <span class="sc">-</span>F <span class="st">&#39;&quot;,&quot;&#39;</span> <span class="st">&#39;(NR==FNR){a[$1];next}{printf &quot;%s</span><span class="sc">\&quot;</span><span class="st">&quot;, $1;for(i in a){printf &quot; </span><span class="sc">\&quot;</span><span class="st">%s</span><span class="sc">\&quot;</span><span class="st">&quot;, $i};printf &quot;</span><span class="sc">\n</span><span class="st">&quot;}&#39;</span> phen<span class="sc">/</span>covariates.colnum phen<span class="sc">/</span>ukb45861.csv <span class="sc">&gt;</span> phen<span class="sc">/</span>covariates.dat</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co">#--------</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co"># organize covariates</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co">#--------</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">100</span>)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co"># all covariates</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>var<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;phen/covariates.dat&quot;</span>, <span class="at">header=</span>T, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>nm<span class="ot">=</span><span class="fu">names</span>(var)</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co"># extract covariates</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>var1<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">eid=</span>var<span class="sc">$</span>eid,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">age=</span>var[,<span class="fu">grep</span>(<span class="st">&#39;21022&#39;</span>, nm, <span class="at">fixed=</span>T)], <span class="co"># age at recruitment</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">sex_gen=</span>var[,<span class="fu">grep</span>(<span class="st">&#39;22001&#39;</span>, nm, <span class="at">fixed=</span>T)], <span class="co"># genetic sex: 0 =F; 1 = M</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">centre=</span>var[,<span class="fu">grep</span>(<span class="st">&#39;X54&#39;</span>, nm, <span class="at">fixed=</span>T)], <span class="co"># assessment centre</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">geno_batch=</span>var[,<span class="fu">grep</span>(<span class="st">&#39;22000&#39;</span>, nm, <span class="at">fixed=</span>T)], <span class="co"># genotype batch</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>                <span class="at">townsend=</span>var[,<span class="fu">grep</span>(<span class="st">&#39;189&#39;</span>, nm, <span class="at">fixed=</span>T)], <span class="co"># townsen</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>                var[,<span class="fu">grep</span>(<span class="st">&#39;22009&#39;</span>, nm, <span class="at">fixed=</span>T)], <span class="co"># genotype PC</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>                <span class="at">ethnicity=</span>var[,<span class="fu">grep</span>(<span class="st">&#39;21000&#39;</span>, nm, <span class="at">fixed=</span>T)], <span class="co"># self-reported ethnicity</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>pcnm<span class="ot">=</span><span class="fu">strsplit</span>(nm[<span class="fu">grep</span>(<span class="st">&#39;22009&#39;</span>, nm, <span class="at">fixed=</span>T)], <span class="st">&quot;[.]&quot;</span>)</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>pcnm<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;pc&quot;</span>,<span class="fu">unlist</span>(<span class="fu">lapply</span>(pcnm,<span class="cf">function</span>(X) X[<span class="dv">3</span>])))</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(var1)[<span class="dv">7</span><span class="sc">:</span><span class="dv">46</span>]<span class="ot">=</span>pcnm</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="co"># file that contains all covariates</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(var1,<span class="st">&quot;phen/covariates.phen&quot;</span>, <span class="at">col.names=</span>T, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="co"># create a file to use: no col.names &amp; continuous covariates only</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>use<span class="ot">=</span>var1[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">6</span><span class="sc">:</span><span class="dv">46</span>)]</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(<span class="fu">names</span>(use),<span class="st">&quot;phen/covariates.use-names&quot;</span>, </span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span>F, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(use,<span class="st">&quot;phen/covariates.use&quot;</span>, <span class="at">col.names=</span>F, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span></code></pre></div>
</div>
<div id="gwas" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> GWAS</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># linear regression-------------------------------------------------------------</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> unrelated/gwas-good</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../unrelated/gwas-good/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../unrelated/rand.100000 </span><span class="dt">\</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-unrel-inds.use </span><span class="dt">\</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-good</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/gwas-good</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="co"># resubmit failed/incomplete jobs-----------------------------------------------</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../unrelated/gwas-good/</span><span class="va">$i</span><span class="st">-linear-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../unrelated/rand.100000 </span><span class="dt">\</span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-unrel-inds.use </span><span class="dt">\</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-chr-<span class="va">$j</span>.sh</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-chr-<span class="va">$j</span>.sh</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-good-resubmission</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/gwas-good-resubmission</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a><span class="co"># combine results</span></span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a><span class="co"># only need .summaries &amp; .pvalues</span></span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a><span class="co">#for i in {awake,bmi,chron,ever,fvc,height,imp,neur,pulse,reaction,sbp,snoring,hyper}; do </span></span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a><span class="va">i</span><span class="op">=</span>quals </span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$j</span> <span class="ot">==</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.summaries <span class="op">&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.pvalues <span class="op">&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> </span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.summaries <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.pvalues <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a><span class="co">#done</span></span></code></pre></div>
</div>
<div id="ldsc-intercept" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> ldsc intercept</h2>
<div id="under-gcta" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> under gcta</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># using original ldsc</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># format stats for ldsc--------------------------------------------------------- </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ex">library</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 100<span class="kw">)</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="va">rs</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;doug/ukbb.ldsc&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="va">phen</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span><span class="st">&quot;fvc&quot;</span><span class="ex">,</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;height&quot;</span><span class="ex">,</span><span class="st">&quot;imp&quot;</span><span class="ex">,</span><span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="ex">,</span> <span class="st">&quot;quals&quot;</span><span class="kw">)</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in phen<span class="kw">){</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="va">stat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;unrelated/gwas-good/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="va">p</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;unrelated/gwas-good/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.pvalues&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> stat<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> p<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">SNP</span><span class="op">=</span>rs<span class="va">$X2</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>                 <span class="va">N</span><span class="op">=</span>stat<span class="va">$n</span>[m1],</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>                 <span class="va">Z</span><span class="op">=</span><span class="va">(</span>sqrt<span class="er">(</span>stat<span class="va">$Stat)</span><span class="pp">*</span>stat<span class="va">$Direction</span><span class="kw">)</span><span class="ex">[m1],</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A1</span><span class="op">=</span>stat<span class="va">$A1</span>[m1],</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A2</span><span class="op">=</span>stat<span class="va">$A2</span>[m1], </span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>                 <span class="va">pval</span><span class="op">=</span>p<span class="va">$P</span>[m2], <span class="va">stringsAsFactors</span><span class="op">=</span>F<span class="er">)</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>out[complete.cases<span class="kw">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;unrelated/gwas-good/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear-rs.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co"># perform ldsc------------------------------------------------------------------</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> out-good-gwas</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 24:00:0</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="st">.././munge_sumstats.py </span><span class="dt">\</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="st">--sumstats ../../unrelated/gwas-good/</span><span class="va">$i</span><span class="st">-linear-rs.summaries </span><span class="dt">\</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-good-gwas/</span><span class="va">$i</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="st">--merge-alleles ../w_hm3.snplist</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="st">.././ldsc.py </span><span class="dt">\</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="st">--h2 ../out-good-gwas/</span><span class="va">$i</span><span class="st">.sumstats.gz </span><span class="dt">\</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="st">--ref-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="st">--w-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-good-gwas/</span><span class="va">$i</span><span class="st">-ldsc</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/ldsc-<span class="va">$i</span>-good-gwas.sh</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs-------------------------------------------------------------------</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper</span><span class="op">,</span><span class="dt">quals}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldsc-<span class="va">$i</span>-good-gwas.sh</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../../job-records/ldsc-good-gwas</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a><span class="co"># using sumher</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a><span class="co"># insert genetic distance into bim file-----------------------------------------</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span> geno-unrel.fam <span class="op">&gt;</span> small-unrel</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 3:00:0</span></span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a><span class="st">./plink1.9 --bfile ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a><span class="st">          --cm-map /home/zhoux/snpher/faststorage/genetic_maps/genetic_map_chr@_combined_b37.txt </span><span class="dt">\</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a><span class="st">          --make-bed </span><span class="dt">\</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a><span class="st">          --out new</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../gen/small-unrel</span></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/map<span class="va">$j</span></span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/map<span class="va">$j</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> genetic-distance-hapmap3</span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/zhoux/dsmwpred/xuan/quality-control/qc-10oct/gen</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> new<span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span>.bim <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $2, $3}&#39;</span> <span class="op">&gt;</span> maps-hapmap3.txt</span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> new<span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span>.<span class="dt">{bim</span><span class="op">,</span><span class="dt">bed</span><span class="op">,</span><span class="dt">fam</span><span class="op">,</span><span class="dt">log}</span></span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){arr[$1]=$2;next}{print $1, $2, arr[$2], $4, $5, $6}&#39;</span> <span class="op">&gt;</span> geno-unrel.bim2 maps-hapmap3.txt geno-unrel.bim</span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> geno-unrel.bim geno-unrel.bim0</span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> geno-unrel.bim2 geno-unrel.bim</span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a><span class="co"># compute tagging under gcta----------------------------------------------------</span></span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-tagging ../tagging/gcta-hapmap3-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-cm 1 </span><span class="dt">\</span></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/tagging-gcta-hapmap3-chr<span class="va">$j</span></span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/tagging-gcta-hapmap3-chr<span class="va">$j</span> </span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/tagging-gcta-hapmap3</span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/tagging-gcta-hapmap3</span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb19-128"><a href="#cb19-128" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a><span class="co"># merge tagging files-----------------------------------------------------------</span></span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> list.txt</span>
<span id="cb19-134"><a href="#cb19-134" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb19-135"><a href="#cb19-135" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging/gcta-hapmap3-chr-</span><span class="va">$j</span><span class="st">.tagging&quot;</span> <span class="op">&gt;&gt;</span> list.txt</span>
<span id="cb19-136"><a href="#cb19-136" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb19-137"><a href="#cb19-137" aria-hidden="true" tabindex="-1"></a><span class="ex">./ldak5.1</span> <span class="at">--join-tagging</span> tagging/gcta-hapmap3 <span class="at">--taglist</span> list.txt</span>
<span id="cb19-138"><a href="#cb19-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-139"><a href="#cb19-139" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept----------------------------------------------------------------</span></span>
<span id="cb19-140"><a href="#cb19-140" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> sumher-good</span>
<span id="cb19-141"><a href="#cb19-141" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb19-142"><a href="#cb19-142" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb19-143"><a href="#cb19-143" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb19-144"><a href="#cb19-144" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb19-145"><a href="#cb19-145" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb19-146"><a href="#cb19-146" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb19-147"><a href="#cb19-147" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb19-148"><a href="#cb19-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-149"><a href="#cb19-149" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --sum-hers ../sumher-good/</span><span class="va">$i</span><span class="st">-sumher-gcta </span><span class="dt">\</span></span>
<span id="cb19-150"><a href="#cb19-150" aria-hidden="true" tabindex="-1"></a><span class="st">          --tagfile ../tagging/gcta-hapmap3.tagging </span><span class="dt">\</span></span>
<span id="cb19-151"><a href="#cb19-151" aria-hidden="true" tabindex="-1"></a><span class="st">          --summary ../unrelated/gwas-good/</span><span class="va">$i</span><span class="st">-linear.summaries </span><span class="dt">\</span></span>
<span id="cb19-152"><a href="#cb19-152" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-sums NO </span><span class="dt">\</span></span>
<span id="cb19-153"><a href="#cb19-153" aria-hidden="true" tabindex="-1"></a><span class="st">          --intercept YES</span></span>
<span id="cb19-154"><a href="#cb19-154" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-sumher-gcta-unrelated</span>
<span id="cb19-155"><a href="#cb19-155" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb19-156"><a href="#cb19-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-157"><a href="#cb19-157" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb19-158"><a href="#cb19-158" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-sumher-gcta-unrelated</span>
<span id="cb19-159"><a href="#cb19-159" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/sumher-gcta-unrelated</span></code></pre></div>
</div>
<div id="under-ldak-thin" class="section level3" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> under ldak-thin</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get weights-------------------------------------------------------------------</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> ldak-thin/ldak-thin-hapmap3.in <span class="st">&#39;{print $1, 1}&#39;</span> <span class="op">&gt;</span> ldak-thin/weights.ldak-thin-hapmap3</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate tagging under ldak-thin---------------------------------------------</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 40G</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 5</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-tagging ../tagging/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="st">          --weights ../ldak-thin/weights.ldak-thin-hapmap3 </span><span class="dt">\</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -.25 </span><span class="dt">\</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-cm 1 </span><span class="dt">\</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --save-matrix YES </span><span class="dt">\</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 5</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/tagging-ldak-thin-hapmap3-chr<span class="va">$j</span>.sh</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co"># submit scripts</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/tagging-ldak-thin-hapmap3-chr<span class="va">$j</span>.sh</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/tagging-ldak-thin-hapmap3</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/tagging-ldak-thin-hapmap3</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="co"># merge tagging files-----------------------------------------------------------</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> list.txt</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> matlist.txt</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st">.tagging&quot;</span> <span class="op">&gt;&gt;</span> list.txt</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st">.matrix&quot;</span> <span class="op">&gt;&gt;</span> matlist.txt</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="ex">./ldak5.1</span> <span class="at">--join-tagging</span> tagging/ldak-thin-hapmap3 <span class="at">--taglist</span> list.txt <span class="at">--matlist</span> matlist.txt</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept----------------------------------------------------------------</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --sum-hers ../sumher-good/</span><span class="va">$i</span><span class="st">-sumher-ldak-thin </span><span class="dt">\</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a><span class="st">          --tagfile ../tagging/ldak-thin-hapmap3.tagging </span><span class="dt">\</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a><span class="st">          --summary ../unrelated/gwas-good/</span><span class="va">$i</span><span class="st">-linear.summaries </span><span class="dt">\</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-sums NO </span><span class="dt">\</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a><span class="st">          --intercept YES</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-sumher-ldak-thin-unrelated</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-sumher-ldak-thin-unrelated</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/sumher-ldak-thin-unrelated</span></code></pre></div>
</div>
<div id="summary-1" class="section level3" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> summary</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># original ldsc</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept <span class="pp">*</span>ldsc.log <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[-]/); split($3, b, /[()]/); print a[1], $2, b[2]}&#39;</span> <span class="op">&gt;</span> ../../summary/ldsc-good</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sumher under gcta</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-good-est</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-good-sd</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-gcta-good-est sumher-gcta-good-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumber-gcta-good</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># submer under ldak-thin</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-good-est</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-good-sd</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-ldak-thin-good-est sumher-ldak-thin-good-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-ldak-thin-good</span></code></pre></div>
</div>
</div>
<div id="reml" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> REML</h2>
<div id="making-grms" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> making grms</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># making grm -------------------------------------------------------------------</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># all snps</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/gcta-all-unrel </span><span class="dt">\</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/grm-all-snps-unrel</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/grm-all-snps-unrel <span class="op">&gt;</span> ../job-records/grm-all-snps-unrel</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co"># grm by snp blocks: right vs. left</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&lt;8 {print $2}&#39;</span> geno-unrel.bim <span class="op">&gt;</span> left-hapmap3.snps </span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&gt;=8 {print $2}&#39;</span> geno-unrel.bim <span class="op">&gt;</span> right-hapmap3.snps</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/gcta-</span><span class="va">$i</span><span class="st">-unrel </span><span class="dt">\</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$i</span><span class="st">-hapmap3.snps </span><span class="dt">\</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/grm-gcta-<span class="va">$i</span>-unrel</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/grm-gcta-<span class="va">$i</span>-unrel </span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-gcta-by-snps-unrel </span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. thin snps</span></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 4</span></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 4:0:0</span></span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 4 </span><span class="dt">\</span></span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-prune 0.98 </span><span class="dt">\</span></span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-kb 100 </span><span class="dt">\</span></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-unrel-inds.use </span><span class="dt">\</span></span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a><span class="st">          --thin ../ldak-thin/chr</span><span class="va">$j</span><span class="st">-hapmap3 </span><span class="dt">\</span></span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span></span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin<span class="va">$j</span>-hapmap3</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin<span class="va">$j</span>-hapmap3</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/ldak-thin-hapmap3</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion---</span></span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/ldak-thin-hapmap3</span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a><span class="co"># combine snp list</span></span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> ldak-thin/chr{1..22}-hapmap3.in <span class="op">&gt;</span> ldak-thin/ldak-thin-hapmap3.in</span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------</span></span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. kinship matrix under ldak-thin</span></span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------</span></span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/ldak-thin-all-unrel </span><span class="dt">\</span></span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../ldak-thin/ldak-thin-hapmap3.in </span><span class="dt">\</span></span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -0.25 </span><span class="dt">\</span></span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin-grm-all-snps-unrel</span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin-grm-all-snps-unrel <span class="op">&gt;</span> ../job-records/ldak-thin-grm-all-snps-unrel</span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a><span class="co"># grm by snp blocks: right vs. left</span></span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[:]/); if (a[1]&lt;8) print $1}&#39;</span> <span class="dt">\</span></span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a> ldak-thin/ldak-thin-hapmap3.in <span class="op">&gt;</span> gen/left-ldak-thin-hapmap3.snps </span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[:]/); if (a[1]&gt;=8) print $1}&#39;</span> <span class="dt">\</span></span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a> ldak-thin/ldak-thin-hapmap3.in <span class="op">&gt;</span> gen/right-ldak-thin-hapmap3.snps </span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/ldak-thin-</span><span class="va">$i</span><span class="st">-unrel </span><span class="dt">\</span></span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$i</span><span class="st">-ldak-thin-hapmap3.snps </span><span class="dt">\</span></span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -0.25 </span><span class="dt">\</span></span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin-grm-<span class="va">$i</span>-unrel</span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin-grm-<span class="va">$i</span>-unrel </span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-ldak-thin-by-snps-unrel </span></code></pre></div>
</div>
<div id="fast-reml" class="section level3" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> fast-reml</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># make script files-------------------------------------------------------------</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> reml-good</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --fast-reml ../reml-good/</span><span class="va">$i</span><span class="st">-gcta-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --repetitions 20 </span><span class="dt">\</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../unrelated/rand.100000 </span><span class="dt">\</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/gcta-</span><span class="va">$k</span><span class="st">-unrel </span><span class="dt">\</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-reml-good-gcta-<span class="va">$k</span>-snps</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script files-----------------------------------------------------------</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-reml-good-gcta-<span class="va">$k</span>-snps</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/reml-good-gcta</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/reml-good-gcta</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a><span class="co"># make script files-------------------------------------------------------------</span></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --fast-reml ../reml-good/</span><span class="va">$i</span><span class="st">-ldak-thin-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a><span class="st">          --repetitions 20 </span><span class="dt">\</span></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../unrelated/rand.100000 </span><span class="dt">\</span></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/ldak-thin-</span><span class="va">$k</span><span class="st">-unrel </span><span class="dt">\</span></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-reml-good-ldak-thin-<span class="va">$k</span>-snps</span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script files-----------------------------------------------------------</span></span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-reml-good-ldak-thin-<span class="va">$k</span>-snps</span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span>../job-records/reml-good-ldak-thin</span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/reml-good-ldak-thin</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="inflation-test" class="section level3" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> inflation test</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-good/<span class="va">$i</span>-gcta-right.reml</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-gcta-good.right</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-good/<span class="va">$i</span>-gcta-left.reml</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-gcta-good.left</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-good/<span class="va">$i</span>-gcta-all.reml</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-gcta-good.all</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-gcta-good.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-gcta-good.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-gcta-good.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/reml-gcta-inflation-good-gwas.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-good/<span class="va">$i</span>-ldak-thin-right.reml</span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-ldak-thin-good.right</span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-good/<span class="va">$i</span>-ldak-thin-left.reml</span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-ldak-thin-good.left</span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-good/<span class="va">$i</span>-ldak-thin-all.reml</span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-ldak-thin-good.all</span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-good.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-good.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-good.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb24-165"><a href="#cb24-165" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb24-166"><a href="#cb24-166" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb24-167"><a href="#cb24-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-168"><a href="#cb24-168" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-inflation.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb24-169"><a href="#cb24-169" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span></code></pre></div>
</div>
</div>
<div id="he" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> HE</h2>
<div id="estimation" class="section level3" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> estimation</h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regress grm on covariates-----------------------------------------------------</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grm <span class="kw">in</span> gcta-all-unrel gcta-left-unrel gcta-right-unrel ldak-thin-all-unrel ldak-thin-left-unrel ldak-thin-right-unrel<span class="kw">;</span> <span class="cf">do</span>  </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 50G</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 5</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --adjust-grm ../kinship/</span><span class="va">$grm</span><span class="st">.covar </span><span class="dt">\</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/</span><span class="va">$grm</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 5</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$grm</span>-adjust-unrel.sh</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grm <span class="kw">in</span> gcta-all-unrel gcta-left-unrel gcta-right-unrel ldak-thin-all-unrel ldak-thin-left-unrel ldak-thin-right-unrel<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$grm</span>-adjust-unrel.sh</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-unrel-adjust-for-HE</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/grm-unrel-adjust-for-HE</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="co"># HE under gcta-----------------------------------------------------------------</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --he ../he-good/</span><span class="va">$i</span><span class="st">-he-gcta-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/gcta-</span><span class="va">$k</span><span class="st">-unrel.covar </span><span class="dt">\</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a><span class="st">          --kinship-details NO </span><span class="dt">\</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-root NO </span><span class="dt">\</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 1 </span><span class="dt">\</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a><span class="st">          --memory-save YES</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-he-good-gcta-<span class="va">$k</span>-snps.sh</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-he-good-gcta-<span class="va">$k</span>-snps.sh</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/he-good-gcta</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a><span class="co"># HE under ldak-thin------------------------------------------------------------</span></span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 0:30:0</span></span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --he ../he-good/</span><span class="va">$i</span><span class="st">-he-ldak-thin-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/ldak-thin-</span><span class="va">$k</span><span class="st">-unrel.covar </span><span class="dt">\</span></span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a><span class="st">          --kinship-details NO </span><span class="dt">\</span></span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-root NO </span><span class="dt">\</span></span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 1 </span><span class="dt">\</span></span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a><span class="st">          --memory-save YES</span></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-he-good-ldak-thin-<span class="va">$k</span>-snps.sh</span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-he-good-ldak-thin-<span class="va">$k</span>-snps.sh</span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/he-good-ldak-thin</span></code></pre></div>
</div>
<div id="summary-2" class="section level3" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> summary</h3>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-unrel.right </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-good/<span class="va">$i</span>-he-gcta-right.he</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-unrel.right</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-unrel.left</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-good/<span class="va">$i</span>-he-gcta-left.he</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-unrel.left</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-unrel.all</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-good/<span class="va">$i</span>-he-gcta-all.he</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-unrel.all</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-unrel.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-unrel.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-unrel.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="ex">names</span><span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">left</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;code&quot;</span><span class="ex">,</span><span class="st">&quot;h2&quot;</span><span class="ex">,</span><span class="st">&quot;se&quot;</span><span class="kw">)</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/he-gcta-inflation-unrel-gwas.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-unrel.right </span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-good/<span class="va">$i</span>-he-ldak-thin-right.he</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-unrel.right</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-unrel.left</span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-good/<span class="va">$i</span>-he-ldak-thin-left.he</span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-unrel.left</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-unrel.all</span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-good/<span class="va">$i</span>-he-ldak-thin-all.he</span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-unrel.all</span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-unrel.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-unrel.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-unrel.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a><span class="ex">names</span><span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">left</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;code&quot;</span><span class="ex">,</span><span class="st">&quot;h2&quot;</span><span class="ex">,</span><span class="st">&quot;se&quot;</span><span class="kw">)</span></span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-inflation-unrel-gwas.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span></code></pre></div>
<!--chapter:end:04.1-good-gwas.Rmd-->
</div>
</div>
</div>
<div id="bad" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Bad GWAS</h1>
<div id="badid" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> ID list</h2>
<div id="initial-selection" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> initial selection</h3>
<p>Randomly select participants with complete data and use the SNP list as for unrelated.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># extract white, asian &amp; black from ukbb----------------------------------------</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;phen/covariates.phen&quot;</span><span class="ex">,</span> header=T, stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># White: British(1001)  </span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Asian or Asian British: Indian(3001)+Pakistani(3002)+Bangladeshi(3003)+other Asian backgroud(3004)</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Black: Caribbean(4001)+African(4002)+other Black Background(4003)</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>dat[complete.cases<span class="kw">(</span><span class="ex">dat</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="va">white</span><span class="op">=</span>1001</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="va">asian</span><span class="op">=</span>3001:3004</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="va">black</span><span class="op">=</span>4001:4003</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="va">out1</span><span class="op">=</span>dat[dat<span class="va">$ethnicity</span>%in%white,]</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="va">out2</span><span class="op">=</span>dat[dat<span class="va">$ethnicity</span>%in%asian,]</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="va">out3</span><span class="op">=</span>dat[dat<span class="va">$ethnicity</span>%in%black,]</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="va">out1</span><span class="op">[</span>,<span class="st">&quot;eid&quot;</span><span class="op">]</span><span class="ex">,</span> <span class="st">&quot;white-complete-cov.id&quot;</span>, col.names=F, row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="va">out2</span><span class="op">[</span>,<span class="st">&quot;eid&quot;</span><span class="op">]</span><span class="ex">,</span> <span class="st">&quot;asian-complete-cov.id&quot;</span>, col.names=F, row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="va">out3</span><span class="op">[</span>,<span class="st">&quot;eid&quot;</span><span class="op">]</span><span class="ex">,</span> <span class="st">&quot;black-complete-cov.id&quot;</span>, col.names=F, row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co"># overlapping UNRELATED WHITE across 14 traits----------------------------------</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co"># overlapping = no missing data for the 14 traits</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> icd10/unrelated.inds overlap.ind <span class="co"># unrelated white British</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>phen/continuous-traits/</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tt <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> overlap.ind temp</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}($1 in a){print $1, $2}&#39;</span> temp <span class="va">$dir</span>/<span class="va">$tt</span>.raw.pheno <span class="op">&gt;</span> overlap.ind</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> overlap.ind</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$tt</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> temp</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="co"># overlapping + complete data for covariates + unrelated</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR{a[$1]; next} ($1 in a) {print $1, $1}&#39;</span> unrelated/overlap.ind white-complete-cov.id <span class="op">&gt;</span> overlap-white-complete-cov.id <span class="co"># N = 147,008</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="co"># overlapping UNRELATED ASIAN across 14 traits----------------------------------</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> asian-complete-cov.id overlap-asian-complete-cov.id</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>phen/continuous-traits/</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tt <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> overlap-asian-complete-cov.id temp</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}($1 in a){print $1, $2}&#39;</span> temp <span class="va">$dir</span>/<span class="va">$tt</span>.raw.pheno <span class="op">&gt;</span> overlap-asian-complete-cov.id</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> overlap-asian-complete-cov.id <span class="co"># N = 4,052</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$tt</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> temp</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a><span class="co"># relatedness filtering</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a><span class="co"># see below</span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a><span class="co"># overlapping UNRELATED BLACK across 14 traits----------------------------------</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> black-complete-cov.id overlap-black-complete-cov.id</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>phen/continuous-traits/</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tt <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> overlap-black-complete-cov.id temp</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}($1 in a){print $1, $2}&#39;</span> temp <span class="va">$dir</span>/<span class="va">$tt</span>.raw.pheno <span class="op">&gt;</span> overlap-black-complete-cov.id</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> overlap-black-complete-cov.id <span class="co"># N = 3,583</span></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$tt</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> temp</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a><span class="co"># relatedness filtering</span></span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a><span class="co"># see below</span></span></code></pre></div>
</div>
<div id="relatedness-filtering" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> relatedness filtering</h3>
<p>For black and Asian people only.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 0. make bfiles</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># id lists</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="ex">overlap-white-complete-cov.id</span> <span class="co"># N=147,008</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="ex">overlap-black-complete-cov.id</span> <span class="co"># N=3,583</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="ex">overlap-asian-complete-cov.id</span> <span class="co"># N=4,052</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> overlap-white-complete-cov.id overlap-black-complete-cov.id overlap-asian-complete-cov.id <span class="op">&gt;</span> overlap-mixed-complete-cov.id <span class="co"># 154,643    </span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># bfiles by chr</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../overlap-mixed-complete-cov.id </span><span class="dt">\</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract ../gen/snps-unrel-inds.use </span><span class="dt">\</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="st">         --make-bed </span><span class="dt">\</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-mix </span><span class="dt">\</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3 </span><span class="dt">\</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/chr<span class="va">$j</span>-mix.sh</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/chr<span class="va">$i</span>-mix.sh</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/mkbfile-mix-pop</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="co"># merge bfiles</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> bfile-mix.list</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span>  <span class="st">&quot;../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-mix&quot;</span> <span class="op">&gt;&gt;</span>bfile-mix.list</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --make-bed ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="st">          --mbfile ../gen/bfile-mix.list </span><span class="dt">\</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="st">          --exclude-dups YES  </span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/merge-mbfiles-mix-pop.sh</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the script</span></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/merge-mbfiles-mix-pop.sh <span class="op">&gt;</span>../job-records/merge-mbfiles-mix</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a><span class="co">#-------</span></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. prune SNPs</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a><span class="co">#-------</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 4</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 4 </span><span class="dt">\</span></span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-prune 0.05 </span><span class="dt">\</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-kb 1000 </span><span class="dt">\</span></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a><span class="st">          --thin ../thin/thin-chr</span><span class="va">$j</span></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>  <span class="op">&gt;</span> sh_script/thin<span class="va">$j</span></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/thin<span class="va">$j</span></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/thin-snps</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------</span></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. kinship matrix under GCTA</span></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------</span></span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{black</span><span class="op">,</span><span class="dt">asian}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/</span><span class="va">$pop</span><span class="st">-gcta-thin</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../overlap-</span><span class="va">$pop</span><span class="st">-complete-cov.id</span><span class="dt">\</span></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../thin/thin-chr</span><span class="va">$j</span><span class="st">.in </span><span class="dt">\</span></span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/<span class="va">$pop</span>-grm<span class="va">$j</span></span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files</span></span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{black</span><span class="op">,</span><span class="dt">asian}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$pop</span>-grm<span class="va">$j</span></span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-pops</span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a><span class="co"># merge grms</span></span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{black</span><span class="op">,</span><span class="dt">asian}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">$pop</span>-grm.list</span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span> </span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span> </span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;../kinship/</span><span class="va">$pop</span><span class="st">-gcta-thin</span><span class="va">$j</span><span class="st">&quot;</span> <span class="op">&gt;&gt;</span> <span class="va">$pop</span>-grm.list</span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{black</span><span class="op">,</span><span class="dt">asian}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb28-123"><a href="#cb28-123" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb28-124"><a href="#cb28-124" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb28-125"><a href="#cb28-125" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 80G</span></span>
<span id="cb28-126"><a href="#cb28-126" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb28-127"><a href="#cb28-127" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 12:0:0</span></span>
<span id="cb28-128"><a href="#cb28-128" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --add-grm ../kinship/</span><span class="va">$pop</span><span class="st">-gcta-thin --mgrm ../</span><span class="va">$pop</span><span class="st">-grm.list</span></span>
<span id="cb28-129"><a href="#cb28-129" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$pop</span>-grm.sh</span>
<span id="cb28-130"><a href="#cb28-130" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb28-131"><a href="#cb28-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-132"><a href="#cb28-132" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{black</span><span class="op">,</span><span class="dt">asian}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-133"><a href="#cb28-133" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$pop</span>-grm.sh </span>
<span id="cb28-134"><a href="#cb28-134" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-merge</span>
<span id="cb28-135"><a href="#cb28-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-136"><a href="#cb28-136" aria-hidden="true" tabindex="-1"></a><span class="co">#can now delete per-chr files</span></span>
<span id="cb28-137"><a href="#cb28-137" aria-hidden="true" tabindex="-1"></a><span class="co">#rm *gcta-thin{1..22}.*</span></span>
<span id="cb28-138"><a href="#cb28-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-139"><a href="#cb28-139" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------</span></span>
<span id="cb28-140"><a href="#cb28-140" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Relatedness filtering </span></span>
<span id="cb28-141"><a href="#cb28-141" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------</span></span>
<span id="cb28-142"><a href="#cb28-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-143"><a href="#cb28-143" aria-hidden="true" tabindex="-1"></a><span class="co"># relatedness filtering</span></span>
<span id="cb28-144"><a href="#cb28-144" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{asian</span><span class="op">,</span><span class="dt">black}</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb28-145"><a href="#cb28-145" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb28-146"><a href="#cb28-146" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb28-147"><a href="#cb28-147" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb28-148"><a href="#cb28-148" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb28-149"><a href="#cb28-149" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb28-150"><a href="#cb28-150" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 2:0:0</span></span>
<span id="cb28-151"><a href="#cb28-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-152"><a href="#cb28-152" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --filter ../relatedness/</span><span class="va">$pop</span><span class="st">-cut.05 </span><span class="dt">\</span></span>
<span id="cb28-153"><a href="#cb28-153" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/</span><span class="va">$pop</span><span class="st">-gcta-thin </span><span class="dt">\</span></span>
<span id="cb28-154"><a href="#cb28-154" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-rel 0.05 </span><span class="dt">\</span></span>
<span id="cb28-155"><a href="#cb28-155" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3</span></span>
<span id="cb28-156"><a href="#cb28-156" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$pop</span>-rel-cut.05.sh</span>
<span id="cb28-157"><a href="#cb28-157" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb28-158"><a href="#cb28-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-159"><a href="#cb28-159" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb28-160"><a href="#cb28-160" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{asian</span><span class="op">,</span><span class="dt">black}</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb28-161"><a href="#cb28-161" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$pop</span>-rel-cut.05.sh</span>
<span id="cb28-162"><a href="#cb28-162" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/relatedness-filtering</span>
<span id="cb28-163"><a href="#cb28-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-164"><a href="#cb28-164" aria-hidden="true" tabindex="-1"></a><span class="co"># remaining individuals</span></span>
<span id="cb28-165"><a href="#cb28-165" aria-hidden="true" tabindex="-1"></a><span class="co"># asian-cut.05.keep N = 3,448</span></span>
<span id="cb28-166"><a href="#cb28-166" aria-hidden="true" tabindex="-1"></a><span class="co"># black-cut.05.keep N = 3,024</span></span>
<span id="cb28-167"><a href="#cb28-167" aria-hidden="true" tabindex="-1"></a><span class="co"># sum = 6,472</span></span></code></pre></div>
</div>
<div id="final-list" class="section level3" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> final list</h3>
<p>To match the good GWAS, we will have N = 100k in total and replace 6,472 whites with Asians and Blacks.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select  </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">shuf</span> rand.100000 <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 93528 <span class="op">&gt;</span> white.rand.93528</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> white.rand.93528 relatedness/asian-cut.05.keep relatedness/black-cut.05.keep <span class="op">&gt;</span> mix-pop-gwas.id </span></code></pre></div>
</div>
</div>
<div id="gwas-lm" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> GWAS-lm</h2>
<div id="basic-cov" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> basic cov</h3>
<p>We use basic covariates only: age, sex and townsend.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># covariates--------------------------------------------------------------------</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $3, $4, $5}&#39;</span> covariates.use <span class="op">&gt;</span> basic-covariates.use</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&lt;=5{print $0}&#39;</span> covariates.use-names <span class="op">&gt;</span> basic-covariates.use</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># gwas</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../gwas-mix/</span><span class="va">$i</span><span class="st">-linear-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-unrel-inds.use </span><span class="dt">\</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-chr-<span class="va">$j</span>.sh</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="co"># --covar ../phen/covariates.use</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-chr-<span class="va">$j</span>.sh</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-mix-pop</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/gwas-mix-pop</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a><span class="co"># combine results</span></span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a><span class="co"># only need .summaries &amp; .pvalues</span></span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$j</span> <span class="ot">==</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.summaries <span class="op">&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.pvalues <span class="op">&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> </span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.summaries <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.pvalues <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="basic-cov-pc" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> basic cov + PC</h3>
<p>Here we add PC one at a time until the tenth as covariates and conduct GWAS</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># covariates--------------------------------------------------------------------</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 999<span class="kw">)</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;phen/covariates.phen&quot;</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;eid&quot;</span><span class="ex">,</span><span class="st">&quot;age&quot;</span><span class="ex">,</span><span class="st">&quot;sex_gen&quot;</span><span class="ex">,</span> <span class="st">&quot;townsend&quot;</span>, paste0<span class="er">(</span><span class="st">&quot;pc&quot;</span><span class="ex">,1:40</span><span class="kw">))</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>cov[,nm]</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:10<span class="kw">){</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">sel</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;eid&quot;</span><span class="ex">,</span><span class="st">&quot;eid&quot;</span><span class="ex">,</span><span class="st">&quot;age&quot;</span><span class="ex">,</span><span class="st">&quot;sex_gen&quot;</span><span class="ex">,</span> <span class="st">&quot;townsend&quot;</span>, paste0<span class="er">(</span><span class="st">&quot;pc&quot;</span><span class="ex">,</span> 1:i<span class="kw">))</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>cov[,sel]</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">file1</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;phen/covariates-basic-&quot;</span><span class="ex">,i,</span><span class="st">&quot;PC.use&quot;</span><span class="kw">)</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="va">file2</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;phen/covariates-basic-&quot;</span><span class="ex">,i,</span><span class="st">&quot;PC.use-names&quot;</span><span class="kw">)</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,file1,</span> col.names=F, row.names=F,quote=F<span class="kw">)</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">names</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">,file2,</span> col.names=F, row.names=F,quote=F<span class="kw">)</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co"># gwas--------------------------------------------------------------------------</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">10</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-mix-<span class="va">$j</span><span class="st">&#39;PC&#39;</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../gwas-mix-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>/<span class="va">$i</span>-linear</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>../phen/covariates-basic-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>.use</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 6G</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 6:0:0</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar </span><span class="va">$cov</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-unrel-inds.use </span><span class="dt">\</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>.sh</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">10</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>.sh</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-mix-pc</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/gwas-mix-pc</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
</div>
<div id="gwas-bolt-lmm" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> GWAS-bolt-lmm</h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># make filter files-------------------------------------------------------------</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="va">fam</span><span class="op">=</span>gen/geno-mix.fam</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="va">bim</span><span class="op">=</span>gen/geno-mix.bim</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>mix-pop-gwas.id</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>gen/snps-unrel-inds.use</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="va">id_remove</span><span class="op">=</span>BOLT-LMM_v2.3.5/mix-pop-gwas-id.exclude</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="va">snp_exclude</span><span class="op">=</span>BOLT-LMM_v2.3.5/snps-unrel-inds.remove</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1];next} </span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="st">     !($2 in a) {print $2}&#39;</span> <span class="va">$snp</span> <span class="va">$bim</span> <span class="op">&gt;</span> <span class="va">$snp_exclude</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># note the list is empty because $snp &amp; $bim contain the same list</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1];next} </span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="st">     !($1 in a) {print $0}&#39;</span> <span class="va">$id</span> <span class="va">$fam</span> <span class="op">&gt;</span> <span class="va">$id_remove</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co"># organize phenotype files------------------------------------------------------</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 999<span class="kw">)</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co"># covariate file</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;phen/covariates.phen&quot;</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;age&quot;</span><span class="ex">,</span><span class="st">&quot;sex_gen&quot;</span><span class="ex">,</span> <span class="st">&quot;townsend&quot;</span> ,paste0<span class="er">(</span><span class="st">&quot;pc&quot;</span><span class="ex">,1:40</span><span class="kw">))</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    <span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;phen/continuous-traits/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;.raw.pheno&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>    <span class="va">m</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">dat</span><span class="va">$X1</span><span class="ex">,cov</span><span class="va">$eid</span><span class="kw">)</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>    <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">FID</span><span class="op">=</span>dat<span class="va">$X1</span>,</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>                   <span class="va">IID</span><span class="op">=</span>dat<span class="va">$X2</span>,</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>                   <span class="va">PHENO</span><span class="op">=</span>dat<span class="va">$X3</span>,</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>                   <span class="va">cov</span><span class="op">[</span>m,nm<span class="op">]</span><span class="kw">)</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>    <span class="va">old</span><span class="op">=</span>names<span class="kw">(</span><span class="ex">out</span><span class="kw">)</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>    <span class="va">new</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">names</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">[1:3],</span> paste0<span class="er">(</span><span class="st">&quot;COV&quot;</span><span class="ex">,1:43</span><span class="kw">))</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    <span class="ex">names</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">=new</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;BOLT-LMM_v2.3.5/dat/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;.dat&quot;</span><span class="kw">)</span><span class="ex">,</span> col.names=T,</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>                <span class="ex">row.names=F,</span> quote=F<span class="kw">)</span></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">){</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>            <span class="ex">out.nm=data.frame</span><span class="er">(</span><span class="va">name</span><span class="op">=</span>new,true_name=old, <span class="va">stringsAsFactors</span><span class="op">=</span>F<span class="kw">)</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>            <span class="ex">write.table</span><span class="er">(</span><span class="ex">out.nm,</span><span class="st">&quot;BOLT-LMM_v2.3.5/dat/cov-names&quot;</span><span class="ex">,</span> </span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a><span class="co"># model SNPs--------------------------------------------------------------------</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a><span class="co"># subset snps used in GRM for BOLT-LMM</span></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a><span class="co"># we previously thinned SNPs: see &#39;relatedness filtering&#39; section of bad GWAS</span></span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we just merge them across chromsomes</span></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>thin/geno-mix-thin-snps</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">$out</span> </span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> thin/thin-chr<span class="va">$i</span>.in <span class="op">&gt;&gt;</span> <span class="va">$out</span></span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a><span class="co"># run BOLT-LMM------------------------------------------------------------------</span></span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>../gwas-bad</span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a><span class="st">../bolt --bfile=../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a><span class="st">         --phenoFile=../dat/</span><span class="va">$i</span><span class="st">.dat </span><span class="dt">\</span></span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a><span class="st">         --phenoCol=PHENO </span><span class="dt">\</span></span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a><span class="st">         --remove=../mix-pop-gwas-id.exclude</span><span class="dt">\</span></span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a><span class="st">         --lmm </span><span class="dt">\</span></span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a><span class="st">         --LDscoresFile=../tables/LDSCORE.1000G_EUR.tab.gz </span><span class="dt">\</span></span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a><span class="st">         --LDscoresMatchBp </span><span class="dt">\</span></span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a><span class="st">         --covarFile=../dat/</span><span class="va">$i</span><span class="st">.dat </span><span class="dt">\</span></span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a><span class="st">         --qCovarCol=COV{1:3}</span><span class="dt">\</span></span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a><span class="st">         --modelSnps=../geno-mix-thin-snps </span><span class="dt">\</span></span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a><span class="st">         --maxMissingPerSnp=1 </span><span class="dt">\</span></span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a><span class="st">         --maxMissingPerIndiv=1 </span><span class="dt">\</span></span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a><span class="st">         --statsFile=</span><span class="va">$dir</span><span class="st">/</span><span class="va">$i</span><span class="st">.out </span><span class="dt">\</span></span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a><span class="st">         --numThreads=10 </span><span class="dt">\</span></span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a><span class="st">       2&gt;&amp;1 | tee </span><span class="va">$dir</span><span class="st">/</span><span class="va">$i</span><span class="st">.log</span></span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-bolt-lmm.sh</span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a><span class="co"># submit scripts</span></span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-bolt-lmm.sh</span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/bolt-lmm-bad</span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/bolt-lmm-bad</span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb32-103"><a href="#cb32-103" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb32-104"><a href="#cb32-104" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb32-107"><a href="#cb32-107" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb32-108"><a href="#cb32-108" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb32-109"><a href="#cb32-109" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb32-110"><a href="#cb32-110" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb32-111"><a href="#cb32-111" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb32-112"><a href="#cb32-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-113"><a href="#cb32-113" aria-hidden="true" tabindex="-1"></a><span class="co"># organize results -------------------------------------------------------------</span></span>
<span id="cb32-114"><a href="#cb32-114" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-norm-337k-out</span>
<span id="cb32-115"><a href="#cb32-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-116"><a href="#cb32-116" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb32-117"><a href="#cb32-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-118"><a href="#cb32-118" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-norm-337k/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb32-119"><a href="#cb32-119" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-ukbb-norm</span>
<span id="cb32-120"><a href="#cb32-120" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-norm-337k-out/<span class="va">$trait</span>.out</span>
<span id="cb32-121"><a href="#cb32-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-122"><a href="#cb32-122" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp    </span>
<span id="cb32-123"><a href="#cb32-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-124"><a href="#cb32-124" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb32-125"><a href="#cb32-125" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb32-126"><a href="#cb32-126" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb32-127"><a href="#cb32-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-128"><a href="#cb32-128" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb32-129"><a href="#cb32-129" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb32-130"><a href="#cb32-130" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb32-131"><a href="#cb32-131" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb32-132"><a href="#cb32-132" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2&quot;}</span></span>
<span id="cb32-133"><a href="#cb32-133" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb32-134"><a href="#cb32-134" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="aver2_j" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> aver2_j</h2>
<div id="calc-aver2_j" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> calc aver2_j</h3>
<p>Note we previously computed aver2_j based using <code>geno-mix</code> data. see @ref(calc_aver2_j).</p>
</div>
<div id="bolt-lmm" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> bolt-lmm</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-norm-337k-out</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-norm-337k/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-ukbb-norm</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-norm-337k-out/<span class="va">$trait</span>.out</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp    </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2&quot;}</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="basic-cov-pc-1" class="section level3" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> basic cov + PC</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-norm-337k-out</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-norm-337k/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-ukbb-norm</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-norm-337k-out/<span class="va">$trait</span>.out</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp    </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2&quot;}</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
</div>
<div id="ldsc-intercept-1" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> ldsc intercept</h2>
<div id="under-gcta-1" class="section level3" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> under gcta</h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># using original ldsc</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># format stats for ldsc--------------------------------------------------------- </span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="ex">library</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 100<span class="kw">)</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="va">rs</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;doug/ukbb.ldsc&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="va">phen</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span><span class="st">&quot;fvc&quot;</span><span class="ex">,</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;height&quot;</span><span class="ex">,</span><span class="st">&quot;imp&quot;</span><span class="ex">,</span><span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="ex">,</span> <span class="st">&quot;quals&quot;</span><span class="kw">)</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in phen<span class="kw">){</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="va">stat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;gwas-mix/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="va">p</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;gwas-mix/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.pvalues&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> stat<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> p<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">SNP</span><span class="op">=</span>rs<span class="va">$X2</span>,</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>                 <span class="va">N</span><span class="op">=</span>stat<span class="va">$n</span>[m1],</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>                 <span class="va">Z</span><span class="op">=</span><span class="va">(</span>sqrt<span class="er">(</span>stat<span class="va">$Stat)</span><span class="pp">*</span>stat<span class="va">$Direction</span><span class="kw">)</span><span class="ex">[m1],</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A1</span><span class="op">=</span>stat<span class="va">$A1</span>[m1],</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A2</span><span class="op">=</span>stat<span class="va">$A2</span>[m1], </span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>                 <span class="va">pval</span><span class="op">=</span>p<span class="va">$P</span>[m2], <span class="va">stringsAsFactors</span><span class="op">=</span>F<span class="er">)</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>out[complete.cases<span class="kw">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;gwas-mix/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear-rs.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="co"># perform ldsc------------------------------------------------------------------</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> out-mix-pop</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 08:00:0</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="st">.././munge_sumstats.py </span><span class="dt">\</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="st">--sumstats ../../gwas-mix/</span><span class="va">$i</span><span class="st">-linear-rs.summaries </span><span class="dt">\</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-mix-pop/</span><span class="va">$i</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="st">--merge-alleles ../w_hm3.snplist</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="st">.././ldsc.py </span><span class="dt">\</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a><span class="st">--h2 ../out-mix-pop/</span><span class="va">$i</span><span class="st">.sumstats.gz </span><span class="dt">\</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a><span class="st">--ref-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a><span class="st">--w-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-mix-pop/</span><span class="va">$i</span><span class="st">-ldsc</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/ldsc-<span class="va">$i</span>-mix-pop.sh</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs-------------------------------------------------------------------</span></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper</span><span class="op">,</span><span class="dt">quals}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldsc-<span class="va">$i</span>-mix-pop.sh</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../../job-records/ldsc-mix-pop</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/ldsc-mix-pop</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a><span class="co"># using sumher</span></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a><span class="co"># insert genetic distance into bim file-----------------------------------------</span></span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a><span class="co"># here we want to use the same genetic distance as for unrelated individuals, i.e., good GWAS</span></span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;gen/geno-mix.bim&quot;</span><span class="ex">,</span> header=F, stringsAsFactors=F<span class="kw">)</span></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a><span class="va">ref</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;gen/geno-unrel.bim&quot;</span><span class="ex">,</span> header=F, stringsAsFactors=F<span class="kw">)</span></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">dat</span><span class="va">$V2</span><span class="ex">,ref</span><span class="va">$V2</span><span class="kw">)</span></span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="ex">dat</span><span class="va">$V1</span><span class="ex">,</span> dat<span class="va">$V2</span>, ref<span class="va">$V3</span>[m], dat<span class="va">$V4</span>, dat<span class="va">$V5</span>, dat<span class="va">$V6</span>, stringsAsFactors=F<span class="kw">)</span></span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span><span class="st">&quot;gen/geno-mix.bim2&quot;</span><span class="ex">,</span> col.names=F, row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> geno-mix.bim geno-mix.bim0</span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> geno-mix.bim2 geno-mix.bim</span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a><span class="co"># compute tagging under gcta----------------------------------------------------</span></span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-tagging ../tagging-mix-pop/gcta-hapmap3-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-cm 1 </span><span class="dt">\</span></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span></span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/tagging-gcta-hapmap3-chr<span class="va">$j</span></span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/tagging-gcta-hapmap3-chr<span class="va">$j</span> </span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/tagging-gcta-hadmap3-mix-pop</span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/tagging-gcta-hadmap3-mix-pop</span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a><span class="co"># merge tagging files-----------------------------------------------------------</span></span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> list.txt</span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-mix-pop/gcta-hapmap3-chr-</span><span class="va">$j</span><span class="st">.tagging&quot;</span> <span class="op">&gt;&gt;</span> list.txt</span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a><span class="ex">./ldak5.1</span> <span class="at">--join-tagging</span> tagging-mix-pop/gcta-hapmap3 <span class="at">--taglist</span> list.txt</span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept----------------------------------------------------------------</span></span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> sumher-mix</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --sum-hers ../sumher-mix/</span><span class="va">$i</span><span class="st">-sumher-gcta </span><span class="dt">\</span></span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a><span class="st">          --tagfile ../tagging-mix-pop/gcta-hapmap3.tagging </span><span class="dt">\</span></span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a><span class="st">          --summary ../gwas-mix/</span><span class="va">$i</span><span class="st">-linear.summaries </span><span class="dt">\</span></span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-sums NO </span><span class="dt">\</span></span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a><span class="st">          --intercept YES</span></span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-sumher-gcta-mix-pop</span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-sumher-gcta-mix-pop</span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/sumher-gcta-mix-pop</span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/sumher-gcta-mix-pop</span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="under-ldak-thin-1" class="section level3" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> under ldak-thin</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get weights-------------------------------------------------------------------</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> ldak-thin/ldak-thin-hapmap3.in <span class="st">&#39;{print $1, 1}&#39;</span> <span class="op">&gt;</span> ldak-thin/weights.ldak-thin-hapmap3</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate tagging under ldak-thin---------------------------------------------</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 40G</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 5</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-tagging ../tagging-mix-pop/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="st">          --weights ../ldak-thin/weights.ldak-thin-hapmap3 </span><span class="dt">\</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -.25 </span><span class="dt">\</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-cm 1 </span><span class="dt">\</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --save-matrix YES </span><span class="dt">\</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 5</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/tagging-ldak-thin-hapmap3-chr<span class="va">$j</span>.sh</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co"># submit scripts</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/tagging-ldak-thin-hapmap3-chr<span class="va">$j</span>.sh</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/tagging-ldak-thin-hapmap3</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/tagging-ldak-thin-hapmap3</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a><span class="co"># merge tagging files-----------------------------------------------------------</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> list.txt</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> matlist.txt</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-mix-pop/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st">.tagging&quot;</span> <span class="op">&gt;&gt;</span> list.txt</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-mix-pop/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st">.matrix&quot;</span> <span class="op">&gt;&gt;</span> matlist.txt</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a><span class="ex">./ldak5.1</span> <span class="at">--join-tagging</span> tagging-mix-pop/ldak-thin-hapmap3 <span class="at">--taglist</span> list.txt <span class="at">--matlist</span> matlist.txt</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept----------------------------------------------------------------</span></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --sum-hers ../sumher-mix/</span><span class="va">$i</span><span class="st">-sumher-ldak-thin </span><span class="dt">\</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a><span class="st">          --tagfile ../tagging-mix-pop/ldak-thin-hapmap3.tagging </span><span class="dt">\</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a><span class="st">          --summary ../gwas-mix/</span><span class="va">$i</span><span class="st">-linear.summaries </span><span class="dt">\</span></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-sums NO </span><span class="dt">\</span></span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a><span class="st">          --intercept YES</span></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-sumher-ldak-thin-mix</span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-sumher-ldak-thin-mix</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/sumher-ldak-thin-mix</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a><span class="co"># check job-completion</span></span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/sumher-ldak-thin-mix</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="summary-3" class="section level3" number="7.5.3">
<h3><span class="header-section-number">7.5.3</span> summary</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># without 40 PCs----------------------------------------------------------------------</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># original ldsc</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept <span class="pp">*</span>ldsc.log <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[-]/); split($3, b, /[()]/); print a[1], $2, b[2]}&#39;</span> <span class="op">&gt;</span> ../../summary/ldsc-mix</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># sumher under gcta</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-mix-est</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-mix-sd</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-gcta-mix-est sumher-gcta-mix-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-gcta-mix</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> sumher-gcta-mix-sd sumher-gcta-mix-est</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># suhmer under ldak-thin</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-mix-est</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-mix-sd</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-ldak-thin-mix-est sumher-ldak-thin-mix-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-ldak-thin-mix</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> sumher-ldak-thin-mix-sd sumher-ldak-thin-mix-est</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co"># with covariates (i.e., including all 40 PCs)-------------------------------------------</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co"># original ldsc</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept <span class="pp">*</span>ldsc.log <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[-]/); split($3, b, /[()]/); print a[1], $2, b[2]}&#39;</span> <span class="op">&gt;</span> ../../summary/ldsc-mix-with-cov</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co"># sumher under gcta</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-mix-est</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-mix-sd</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-gcta-mix-est sumher-gcta-mix-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-gcta-mix-with-cov</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> sumher-gcta-mix-sd sumher-gcta-mix-est</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="co"># suhmer under ldak-thin</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-mix-est</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-mix-sd</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-ldak-thin-mix-est sumher-ldak-thin-mix-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-ldak-thin-mix-with-cov</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> sumher-ldak-thin-mix-sd sumher-ldak-thin-mix-est</span></code></pre></div>
</div>
</div>
<div id="reml-1" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> REML</h2>
<div id="making-grms-1" class="section level3" number="7.6.1">
<h3><span class="header-section-number">7.6.1</span> making grms</h3>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># making grm -------------------------------------------------------------------</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># all snps</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 120G</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/gcta-all-mix </span><span class="dt">\</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/grm-all-snps-mix</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/grm-all-snps-mix <span class="op">&gt;</span> ../job-records/grm-all-snps-mix</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co"># grm by snp blocks: right vs. left</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&lt;8 {print $2}&#39;</span> geno-mix.bim <span class="op">&gt;</span> left-mix-pop.snps </span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&gt;=8 {print $2}&#39;</span> geno-mix.bim <span class="op">&gt;</span> right-mix-pop.snps</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/gcta-</span><span class="va">$i</span><span class="st">-mix </span><span class="dt">\</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$i</span><span class="st">-mix-pop.snps </span><span class="dt">\</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/grm-gcta-<span class="va">$i</span>-mix</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/grm-gcta-<span class="va">$i</span>-mix </span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-gcta-by-snps-mix</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/grm-gcta-by-snps-mix</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------</span></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. thin snps</span></span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------</span></span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a><span class="co"># we omit this step and use ldak-thin/ldak-thin-hapmap3.in, which was created previously</span></span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a><span class="co"># using geno-unrel bfiles. See above.</span></span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------</span></span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. kinship matrix under ldak-thin</span></span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------</span></span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/ldak-thin-all-mix </span><span class="dt">\</span></span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../ldak-thin/ldak-thin-hapmap3.in </span><span class="dt">\</span></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -0.25 </span><span class="dt">\</span></span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin-grm-all-snps-mix</span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin-grm-all-snps-mix<span class="op">&gt;</span> ../job-records/ldak-thin-grm-all-snps-mix</span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a><span class="co"># grm by snp blocks: right vs. left</span></span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[:]/); if (a[1]&lt;8) print $1}&#39;</span> <span class="dt">\</span></span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a> ldak-thin/ldak-thin-hapmap3.in <span class="op">&gt;</span> gen/left-ldak-thin-hapmap3.snps </span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[:]/); if (a[1]&gt;=8) print $1}&#39;</span> <span class="dt">\</span></span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a> ldak-thin/ldak-thin-hapmap3.in <span class="op">&gt;</span> gen/right-ldak-thin-hapmap3.snps </span>
<span id="cb38-111"><a href="#cb38-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-112"><a href="#cb38-112" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb38-113"><a href="#cb38-113" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb38-114"><a href="#cb38-114" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb38-115"><a href="#cb38-115" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb38-116"><a href="#cb38-116" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb38-117"><a href="#cb38-117" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb38-118"><a href="#cb38-118" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb38-119"><a href="#cb38-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-120"><a href="#cb38-120" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb38-121"><a href="#cb38-121" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/ldak-thin-</span><span class="va">$i</span><span class="st">-mix </span><span class="dt">\</span></span>
<span id="cb38-122"><a href="#cb38-122" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb38-123"><a href="#cb38-123" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb38-124"><a href="#cb38-124" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$i</span><span class="st">-ldak-thin-hapmap3.snps </span><span class="dt">\</span></span>
<span id="cb38-125"><a href="#cb38-125" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -0.25 </span><span class="dt">\</span></span>
<span id="cb38-126"><a href="#cb38-126" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb38-127"><a href="#cb38-127" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb38-128"><a href="#cb38-128" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin-grm-<span class="va">$i</span>-mix</span>
<span id="cb38-129"><a href="#cb38-129" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb38-130"><a href="#cb38-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-131"><a href="#cb38-131" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb38-132"><a href="#cb38-132" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin-grm-<span class="va">$i</span>-mix </span>
<span id="cb38-133"><a href="#cb38-133" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-ldak-thin-by-snps-mix</span>
<span id="cb38-134"><a href="#cb38-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-135"><a href="#cb38-135" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb38-136"><a href="#cb38-136" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/grm-ldak-thin-by-snps-mix</span>
<span id="cb38-137"><a href="#cb38-137" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb38-138"><a href="#cb38-138" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb38-139"><a href="#cb38-139" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb38-140"><a href="#cb38-140" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb38-141"><a href="#cb38-141" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb38-142"><a href="#cb38-142" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb38-143"><a href="#cb38-143" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb38-144"><a href="#cb38-144" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb38-145"><a href="#cb38-145" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb38-146"><a href="#cb38-146" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb38-147"><a href="#cb38-147" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb38-148"><a href="#cb38-148" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb38-149"><a href="#cb38-149" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb38-150"><a href="#cb38-150" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb38-151"><a href="#cb38-151" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb38-152"><a href="#cb38-152" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="fast-reml-1" class="section level3" number="7.6.2">
<h3><span class="header-section-number">7.6.2</span> fast-reml</h3>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># make script files-------------------------------------------------------------</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> reml-mix</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --fast-reml ../reml-mix/</span><span class="va">$i</span><span class="st">-gcta-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --repetitions 20 </span><span class="dt">\</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/gcta-</span><span class="va">$k</span><span class="st">-mix </span><span class="dt">\</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-reml-mix-gcta-<span class="va">$k</span>-snps</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script files-----------------------------------------------------------</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-reml-mix-gcta-<span class="va">$k</span>-snps</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/reml-mix-gcta</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/reml-mix-gcta</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a><span class="co"># cancel jobs </span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">14</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a><span class="va">job</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;NR==i{print $0}&#39;</span> kill-jobs<span class="kw">`</span></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a><span class="ex">scancel</span> <span class="va">$job</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a><span class="co"># make script files-------------------------------------------------------------</span></span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --fast-reml ../reml-mix/</span><span class="va">$i</span><span class="st">-ldak-thin-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a><span class="st">          --repetitions 20 </span><span class="dt">\</span></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/ldak-thin-</span><span class="va">$k</span><span class="st">-mix </span><span class="dt">\</span></span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-reml-mix-ldak-thin-<span class="va">$k</span>-snps</span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script files-----------------------------------------------------------</span></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-reml-mix-ldak-thin-<span class="va">$k</span>-snps</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span>../job-records/reml-mix-ldak-thin</span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/reml-mix-ldak-thin</span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="inflation-test-1" class="section level3" number="7.6.3">
<h3><span class="header-section-number">7.6.3</span> inflation test</h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-gcta-right.reml</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-gcta-mix.right</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-gcta-left.reml</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-gcta-mix.left</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-gcta-all.reml</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-gcta-mix.all</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-gcta-mix.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-gcta-mix.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-gcta-mix.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/reml-gcta-inflation-mix-gwas.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-ldak-thin-right.reml</span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb40-95"><a href="#cb40-95" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb40-96"><a href="#cb40-96" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-ldak-thin-mix.right</span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-ldak-thin-left.reml</span>
<span id="cb40-106"><a href="#cb40-106" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb40-107"><a href="#cb40-107" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb40-108"><a href="#cb40-108" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb40-109"><a href="#cb40-109" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb40-110"><a href="#cb40-110" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb40-111"><a href="#cb40-111" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb40-112"><a href="#cb40-112" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-ldak-thin-mix.left</span>
<span id="cb40-113"><a href="#cb40-113" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb40-114"><a href="#cb40-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-115"><a href="#cb40-115" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb40-116"><a href="#cb40-116" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb40-117"><a href="#cb40-117" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-ldak-thin-all.reml</span>
<span id="cb40-118"><a href="#cb40-118" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb40-119"><a href="#cb40-119" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb40-120"><a href="#cb40-120" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb40-121"><a href="#cb40-121" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb40-122"><a href="#cb40-122" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb40-123"><a href="#cb40-123" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb40-124"><a href="#cb40-124" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-ldak-thin-mix.all</span>
<span id="cb40-125"><a href="#cb40-125" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb40-126"><a href="#cb40-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-127"><a href="#cb40-127" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb40-128"><a href="#cb40-128" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb40-129"><a href="#cb40-129" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-mix.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb40-130"><a href="#cb40-130" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-mix.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb40-131"><a href="#cb40-131" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-mix.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb40-132"><a href="#cb40-132" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb40-133"><a href="#cb40-133" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb40-134"><a href="#cb40-134" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb40-135"><a href="#cb40-135" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb40-136"><a href="#cb40-136" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb40-137"><a href="#cb40-137" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb40-138"><a href="#cb40-138" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb40-139"><a href="#cb40-139" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb40-140"><a href="#cb40-140" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb40-141"><a href="#cb40-141" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb40-142"><a href="#cb40-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-143"><a href="#cb40-143" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb40-144"><a href="#cb40-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-145"><a href="#cb40-145" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb40-146"><a href="#cb40-146" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb40-147"><a href="#cb40-147" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb40-148"><a href="#cb40-148" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb40-149"><a href="#cb40-149" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb40-150"><a href="#cb40-150" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb40-151"><a href="#cb40-151" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb40-152"><a href="#cb40-152" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb40-153"><a href="#cb40-153" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb40-154"><a href="#cb40-154" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb40-155"><a href="#cb40-155" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb40-156"><a href="#cb40-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-157"><a href="#cb40-157" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb40-158"><a href="#cb40-158" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb40-159"><a href="#cb40-159" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb40-160"><a href="#cb40-160" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb40-161"><a href="#cb40-161" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb40-162"><a href="#cb40-162" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb40-163"><a href="#cb40-163" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb40-164"><a href="#cb40-164" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb40-165"><a href="#cb40-165" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb40-166"><a href="#cb40-166" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb40-167"><a href="#cb40-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-168"><a href="#cb40-168" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-inflation-mix-gwas.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb40-169"><a href="#cb40-169" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span></code></pre></div>
</div>
</div>
<div id="he-1" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> HE</h2>
<div id="estimation-1" class="section level3" number="7.7.1">
<h3><span class="header-section-number">7.7.1</span> estimation</h3>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regress grm on covariates-----------------------------------------------------</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grm <span class="kw">in</span> gcta-all-mix gcta-left-mix gcta-right-mix ldak-thin-all-mix ldak-thin-left-mix ldak-thin-right-mix<span class="kw">;</span> <span class="cf">do</span>  </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 50G</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 5</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --adjust-grm ../kinship/</span><span class="va">$grm</span><span class="st">.covar </span><span class="dt">\</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/</span><span class="va">$grm</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 5</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$grm</span>-adjust.sh</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grm <span class="kw">in</span> gcta-all-mix gcta-left-mix gcta-right-mix ldak-thin-all-mix ldak-thin-left-mix ldak-thin-right-mix<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$grm</span>-adjust.sh</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-adjust-for-HE</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/grm-adjust-for-HE</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="co"># HE under gcta-----------------------------------------------------------------</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --he ../he-mix/</span><span class="va">$i</span><span class="st">-he-gcta-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/gcta-</span><span class="va">$k</span><span class="st">-mix.covar </span><span class="dt">\</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="st">          --kinship-details NO </span><span class="dt">\</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-root NO </span><span class="dt">\</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 1 </span><span class="dt">\</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="st">          --memory-save YES</span></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-he-gcta-<span class="va">$k</span>-snps.sh</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-he-gcta-<span class="va">$k</span>-snps.sh</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/he-gcta</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="co"># HE under ldak-thin------------------------------------------------------------</span></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 0:30:0</span></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --he ../he-mix/</span><span class="va">$i</span><span class="st">-he-ldak-thin-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/ldak-thin-</span><span class="va">$k</span><span class="st">-mix.covar </span><span class="dt">\</span></span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a><span class="st">          --kinship-details NO </span><span class="dt">\</span></span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-root NO </span><span class="dt">\</span></span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 1 </span><span class="dt">\</span></span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a><span class="st">          --memory-save YES</span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-he-ldak-thin-<span class="va">$k</span>-snps.sh</span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-he-ldak-thin-<span class="va">$k</span>-snps.sh</span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/he-ldak-thin</span></code></pre></div>
</div>
<div id="summary-4" class="section level3" number="7.7.2">
<h3><span class="header-section-number">7.7.2</span> summary</h3>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-mix.right </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-gcta-right.he</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-mix.right</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-mix.left</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-gcta-left.he</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-mix.left</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-mix.all</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-gcta-all.he</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-mix.all</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-mix.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-mix.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-mix.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="ex">names</span><span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">left</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;code&quot;</span><span class="ex">,</span><span class="st">&quot;h2&quot;</span><span class="ex">,</span><span class="st">&quot;se&quot;</span><span class="kw">)</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/he-gcta-inflation-mix-gwas.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-mix.right </span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-ldak-thin-right.he</span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-mix.right</span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-mix.left</span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-ldak-thin-left.he</span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-mix.left</span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-mix.all</span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-gcta-all.he</span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-mix.all</span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-mix.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-mix.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-mix.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a><span class="ex">names</span><span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">left</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;code&quot;</span><span class="ex">,</span><span class="st">&quot;h2&quot;</span><span class="ex">,</span><span class="st">&quot;se&quot;</span><span class="kw">)</span></span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb42-108"><a href="#cb42-108" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-inflation-mix-gwas.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb42-143"><a href="#cb42-143" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span></code></pre></div>
<!--chapter:end:04.2-bad-gwas.Rmd-->
</div>
</div>
</div>
<div id="ukbb" class="section level1" number="8">
<h1><span class="header-section-number">8</span> UKBB recommended</h1>
<div id="total-n-337k" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> total N = 337k</h2>
<p>Here we want to identify the unrelated white individuals recommended by the UKBB.</p>
<p>Email from Florian:
“We restrict individuals to the ones used for computing the principal components (PCs) in the UK Biobank (Field 22020). These individuals are unrelated and have passed some quality control including removing samples with a missing rate on autosomes larger than 0.02, having a mismatch between inferred sex and self-reported sex, and outliers based on heterozygosity (more details can be found in section S3 of Bycroft et al. (2018)).”
And the White British are from this: <a href="https://biobank.ctsu.ox.ac.uk/crystal/field.cgi?id=22006" class="uri">https://biobank.ctsu.ox.ac.uk/crystal/field.cgi?id=22006</a></p>
<p>So required data fields:
PC: 22020
White british: 22006</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 100<span class="kw">)</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract data</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="va">head</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;phen/ukb45861.header&quot;</span><span class="ex">,</span> sep=<span class="st">&quot;,&quot;</span>, header=F, stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># function to get the variables</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="va">get</span><span class="op">=</span>function<span class="kw">(</span><span class="fu">nm</span><span class="kw">){</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">colnum</span><span class="op">=</span>grep<span class="kw">(</span><span class="fu">nm</span>,head,fixed=TRUE<span class="kw">)</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="ex">t</span><span class="er">(</span><span class="ex">rbind</span><span class="er">(</span><span class="ex">colnum,</span> head[,colnum]<span class="kw">)))</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">names</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;column&quot;</span><span class="ex">,</span> <span class="st">&quot;field&quot;</span><span class="kw">)</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">(</span><span class="ex">out</span><span class="kw">)</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co"># get the variables</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>rbind<span class="kw">(</span><span class="ex">get</span><span class="er">(</span><span class="st">&#39;22020-0&#39;</span><span class="kw">)</span><span class="ex">,</span> <span class="co"># PC</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>      <span class="ex">get</span><span class="er">(</span><span class="st">&#39;22006-0&#39;</span><span class="kw">))</span> <span class="co"># white british</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span><span class="st">&quot;phen/vars.colnum&quot;</span><span class="ex">,</span> col.names=F, row.names=F, sep=<span class="st">&quot;\t&quot;</span>, quote=F<span class="kw">)</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co"># extract dat</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-F</span> <span class="st">&#39;&quot;,&quot;&#39;</span> <span class="st">&#39;(NR==FNR){a[$1];next}{printf &quot;%s\&quot;&quot;, $1;for(i in a){printf &quot; \&quot;%s\&quot;&quot;, $i};printf &quot;\n&quot;}&#39;</span> phen/vars.colnum phen/ukb45861.csv <span class="op">&gt;</span> phen/ukbb-recommended.dat</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="co"># get the id list of the intersect of the two data fields</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;phen/ukbb-recommended.dat&quot;</span><span class="ex">,</span> header=T, stringsAsFactors=F<span class="kw">)</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="va">id1</span><span class="op">=</span>dat<span class="va">$eid</span>[dat<span class="va">$X22020</span>.0.0==1 <span class="kw">&amp;</span> <span class="ex">!is.na</span><span class="er">(</span><span class="ex">dat</span><span class="va">$X22020</span><span class="ex">.0.0</span><span class="kw">)</span><span class="ex">]</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="va">id2</span><span class="op">=</span>dat<span class="va">$eid</span>[dat<span class="va">$X22006</span>.0.0==1 <span class="kw">&amp;</span> <span class="ex">!is.na</span><span class="er">(</span><span class="ex">dat</span><span class="va">$X22006</span><span class="ex">.0.0</span><span class="kw">)</span><span class="ex">]</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">id1,id2</span><span class="kw">)</span> <span class="co"># N = 337,462</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> <span class="st">&quot;ukbb-recommend.id&quot;</span>, col.names=F, row.names=F, quote=F<span class="kw">)</span></span></code></pre></div>
</div>
<div id="qc-of-hp3-snps" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> QC of hp3 SNPs</h2>
<p>Here we do QC to 1.2M hapmap3 SNPs for the UKBB recommended individuals.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># QC SNPs-----------------------------------------------------------------------</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># stating number of SNPs= 1,184,423</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># note: at this stage, we use all UKBB recommended IDs </span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># we will do a random selection of IDs later.</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../ukbb-recommend.id </span><span class="dt">\</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract ../doug/ukbb.ldsc </span><span class="dt">\</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="st">         --hwe 0.0001 </span><span class="dt">\</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="st">         --hard-call-threshold .05 </span><span class="dt">\</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="st">         --mach-r2-filter 0.8 2 </span><span class="dt">\</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="st">         --make-bed </span><span class="dt">\</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-norm </span><span class="dt">\</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/qc-norm</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="co"># merge files</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> bfile-norm.list</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span>  <span class="st">&quot;../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-norm&quot;</span> <span class="op">&gt;&gt;</span>bfile-norm.list</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --make-bed ../gen/geno-norm </span><span class="dt">\</span></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a><span class="st">          --mbfile ../gen/bfile-norm.list </span><span class="dt">\</span></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a><span class="st">          --exclude-dups YES  </span></span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/mbfile-norm.sh</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the script</span></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/mbfile-norm.sh <span class="op">&gt;</span>../job-records/mbfiles-norm</span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly select 100k individuals </span></span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a><span class="ex">shuf</span> ukbb-recommend.id <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 100000 <span class="op">&gt;</span> ukbb-recommned-rand.100000</span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a><span class="co"># make bfile for these individuals</span></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --make-bed ../gen/geno-norm-100k </span><span class="dt">\</span></span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm </span><span class="dt">\</span></span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../ukbb-recommned-rand.100000 </span><span class="dt">\</span></span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a><span class="st">          --exclude-dups YES  </span></span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/mbfile-norm-100k.sh</span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the script</span></span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/mbfile-norm-100k.sh <span class="op">&gt;</span>../job-records/mbfiles-norm-100k</span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a><span class="co"># MAF &amp; call-rate </span></span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> geno-norm-100k.stats <span class="st">&#39;($5&gt;.01 &amp;&amp; $6&gt;=0.95 &amp;&amp; NR&gt;1){print $1}&#39;</span> <span class="op">&gt;</span> snps-norm-100k.use</span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a><span class="co"># m = 1,100,799 SNPs</span></span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a> </span></code></pre></div>
</div>
<div id="gwas-100k" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> GWAS-100k</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># linear regression-------------------------------------------------------------</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-norm</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../gwas-norm/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm-100k </span><span class="dt">\</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../ukbb-recommned-rand.100000 </span><span class="dt">\</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-norm-100k.use </span><span class="dt">\</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-norm</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/gwas-norm</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="gwas-337k" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> GWAS-337k</h2>
<p>Here we do gwas for all recommended individuals. Previously we made a bfile for all these individuals.</p>
<ul>
<li><strong>bfile</strong> (after QC) gen/geno-norm</li>
<li><strong>id list</strong> ukbb-recommend.id</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># snp list----------------------------------------------------------------------</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># MAF &amp; call rate filtering</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> gen/geno-norm.stats <span class="st">&#39;($5&gt;.01 &amp;&amp; $6&gt;=0.95 &amp;&amp; NR&gt;1){print $1}&#39;</span> <span class="op">&gt;</span> gen/snps-norm.use <span class="co">#1,100,715 snps</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># GWAS -------------------------------------------------------------------------</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-norm-337k</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../gwas-norm-337k/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm </span><span class="dt">\</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../ukbb-recommend.id </span><span class="dt">\</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-norm.use </span><span class="dt">\</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-norm-337k</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/gwas-norm-337k</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="ldsc-100k" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> ldsc-100k</h2>
<div id="under-gcta-2" class="section level3" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> under gcta</h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># using original ldsc</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># format stats for ldsc--------------------------------------------------------- </span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="ex">library</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 100<span class="kw">)</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="va">rs</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;doug/ukbb.ldsc&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="va">phen</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span><span class="st">&quot;fvc&quot;</span><span class="ex">,</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;height&quot;</span><span class="ex">,</span><span class="st">&quot;imp&quot;</span><span class="ex">,</span><span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="ex">,</span> <span class="st">&quot;quals&quot;</span><span class="kw">)</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in phen<span class="kw">){</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="va">stat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;gwas-norm/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  <span class="va">p</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;gwas-norm/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.pvalues&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> stat<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> p<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">SNP</span><span class="op">=</span>rs<span class="va">$X2</span>,</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>                 <span class="va">N</span><span class="op">=</span>stat<span class="va">$n</span>[m1],</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>                 <span class="va">Z</span><span class="op">=</span><span class="va">(</span>sqrt<span class="er">(</span>stat<span class="va">$Stat)</span><span class="pp">*</span>stat<span class="va">$Direction</span><span class="kw">)</span><span class="ex">[m1],</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A1</span><span class="op">=</span>stat<span class="va">$A1</span>[m1],</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A2</span><span class="op">=</span>stat<span class="va">$A2</span>[m1], </span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>                 <span class="va">pval</span><span class="op">=</span>p<span class="va">$P</span>[m2], <span class="va">stringsAsFactors</span><span class="op">=</span>F<span class="er">)</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>out[complete.cases<span class="kw">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;gwas-norm/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear-rs.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>  <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a><span class="co"># perform ldsc------------------------------------------------------------------</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> out-norm-100k</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 24:00:0</span></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a><span class="st">.././munge_sumstats.py </span><span class="dt">\</span></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a><span class="st">--sumstats ../../gwas-norm/</span><span class="va">$i</span><span class="st">-linear-rs.summaries </span><span class="dt">\</span></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-norm-100k/</span><span class="va">$i</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a><span class="st">--merge-alleles ../w_hm3.snplist</span></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a><span class="st">.././ldsc.py </span><span class="dt">\</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a><span class="st">--h2 ../out-norm-100k/</span><span class="va">$i</span><span class="st">.sumstats.gz </span><span class="dt">\</span></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a><span class="st">--ref-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a><span class="st">--w-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-norm-100k/</span><span class="va">$i</span><span class="st">-ldsc</span></span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/ldsc-<span class="va">$i</span>-norm-100k.sh</span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs-------------------------------------------------------------------</span></span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper</span><span class="op">,</span><span class="dt">quals}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldsc-<span class="va">$i</span>-norm-100k.sh</span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../../job-records/ldsc-norm-100k</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a><span class="co"># using sumher</span></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a><span class="co"># insert genetic distance into bim file-----------------------------------------</span></span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span> geno-norm-100k.fam <span class="op">&gt;</span> small-norm</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 3:00:0</span></span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a><span class="st">./plink1.9 --bfile ../gen/geno-norm-100k </span><span class="dt">\</span></span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a><span class="st">          --cm-map /home/zhoux/snpher/faststorage/genetic_maps/genetic_map_chr@_combined_b37.txt </span><span class="dt">\</span></span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a><span class="st">          --make-bed </span><span class="dt">\</span></span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a><span class="st">          --out new</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../gen/small-norm</span></span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/map<span class="va">$j</span></span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/map<span class="va">$j</span></span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> genetic-distance-hapmap3</span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/zhoux/dsmwpred/xuan/quality-control/qc-10oct/gen</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> new<span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span>.bim <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $2, $3}&#39;</span> <span class="op">&gt;</span> maps-hapmap3-norm-100k.txt</span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> new<span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span>.<span class="dt">{bim</span><span class="op">,</span><span class="dt">bed</span><span class="op">,</span><span class="dt">fam</span><span class="op">,</span><span class="dt">log}</span></span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){arr[$1]=$2;next}{print $1, $2, arr[$2], $4, $5, $6}&#39;</span> <span class="op">&gt;</span> geno-norm-100k.bim2 maps-hapmap3-norm-100k.txt geno-norm-100k.bim</span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> geno-norm-100k.bim geno-norm-100k.bim0</span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> geno-norm-100k.bim2 geno-norm-100k.bim</span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a><span class="co"># compute tagging under gcta----------------------------------------------------</span></span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> tagging-norm-100k</span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-tagging ../tagging-norm-100k/gcta-hapmap3-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm-100k </span><span class="dt">\</span></span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-cm 1 </span><span class="dt">\</span></span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span></span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/tagging-gcta-hapmap3-chr<span class="va">$j</span></span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/tagging-gcta-hapmap3-chr<span class="va">$j</span> </span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/tagging-gcta-hapmap3-norm-100k</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/tagging-gcta-hapmap3-norm-100k</span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a><span class="co"># merge tagging files-----------------------------------------------------------</span></span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> list.txt</span>
<span id="cb47-136"><a href="#cb47-136" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-norm-100k/gcta-hapmap3-chr-</span><span class="va">$j</span><span class="st">.tagging&quot;</span> <span class="op">&gt;&gt;</span> list.txt</span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true" tabindex="-1"></a><span class="ex">./ldak5.1</span> <span class="at">--join-tagging</span> tagging-norm-100k/gcta-hapmap3 <span class="at">--taglist</span> list.txt</span>
<span id="cb47-140"><a href="#cb47-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-141"><a href="#cb47-141" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept----------------------------------------------------------------</span></span>
<span id="cb47-142"><a href="#cb47-142" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> sumher-norm-100k</span>
<span id="cb47-143"><a href="#cb47-143" aria-hidden="true" tabindex="-1"></a><span class="va">dirin1</span><span class="op">=</span>tagging-norm-100k</span>
<span id="cb47-144"><a href="#cb47-144" aria-hidden="true" tabindex="-1"></a><span class="va">dirin2</span><span class="op">=</span>gwas-norm</span>
<span id="cb47-145"><a href="#cb47-145" aria-hidden="true" tabindex="-1"></a><span class="va">dirout</span><span class="op">=</span>sumher-norm-100k</span>
<span id="cb47-146"><a href="#cb47-146" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb47-147"><a href="#cb47-147" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb47-148"><a href="#cb47-148" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb47-149"><a href="#cb47-149" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb47-150"><a href="#cb47-150" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb47-151"><a href="#cb47-151" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb47-152"><a href="#cb47-152" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb47-153"><a href="#cb47-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-154"><a href="#cb47-154" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --sum-hers ../</span><span class="va">$dirout</span><span class="st">/</span><span class="va">$i</span><span class="st">-sumher-gcta </span><span class="dt">\</span></span>
<span id="cb47-155"><a href="#cb47-155" aria-hidden="true" tabindex="-1"></a><span class="st">          --tagfile ../</span><span class="va">$dirin1</span><span class="st">/gcta-hapmap3.tagging </span><span class="dt">\</span></span>
<span id="cb47-156"><a href="#cb47-156" aria-hidden="true" tabindex="-1"></a><span class="st">          --summary ../</span><span class="va">$dirin2</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear.summaries </span><span class="dt">\</span></span>
<span id="cb47-157"><a href="#cb47-157" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-sums NO </span><span class="dt">\</span></span>
<span id="cb47-158"><a href="#cb47-158" aria-hidden="true" tabindex="-1"></a><span class="st">          --intercept YES</span></span>
<span id="cb47-159"><a href="#cb47-159" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-sumher-gcta</span>
<span id="cb47-160"><a href="#cb47-160" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb47-161"><a href="#cb47-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-162"><a href="#cb47-162" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb47-163"><a href="#cb47-163" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-sumher-gcta</span>
<span id="cb47-164"><a href="#cb47-164" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/sumher-gcta-norm-100k</span></code></pre></div>
</div>
<div id="under-ldak-thin-2" class="section level3" number="8.5.2">
<h3><span class="header-section-number">8.5.2</span> under ldak-thin</h3>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get weights-------------------------------------------------------------------</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> ldak-thin/ldak-thin-norm.in <span class="st">&#39;{print $1, 1}&#39;</span> <span class="op">&gt;</span> ldak-thin/weights.ldak-thin-norm</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate tagging under ldak-thin---------------------------------------------</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="va">dirout</span><span class="op">=</span>tagging-norm-100k</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="va">filein1</span><span class="op">=</span>geno-norm-100k</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="va">filein2</span><span class="op">=</span>weights.ldak-thin-norm</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 40G</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 5</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-tagging ../</span><span class="va">$dirout</span><span class="st">/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/</span><span class="va">$filein1</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --weights ../ldak-thin/</span><span class="va">$filein2</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -.25 </span><span class="dt">\</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-cm 1 </span><span class="dt">\</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --save-matrix YES </span><span class="dt">\</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 5</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/tagging-ldak-thin-hapmap3-chr<span class="va">$j</span>.sh</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a><span class="co"># submit scripts</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/tagging-ldak-thin-hapmap3-chr<span class="va">$j</span>.sh</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/tagging-ldak-thin-norm-100k</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/tagging-ldak-thin-norm-100k</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a><span class="co"># merge tagging files-----------------------------------------------------------</span></span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> list.txt</span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> matlist.txt</span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-norm-100k/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st">.tagging&quot;</span> <span class="op">&gt;&gt;</span> list.txt</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-norm-100k/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st">.matrix&quot;</span> <span class="op">&gt;&gt;</span> matlist.txt</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a><span class="va">dirout</span><span class="op">=</span>tagging-norm-100k</span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a><span class="ex">./ldak5.1</span> <span class="at">--join-tagging</span> <span class="va">$dirout</span>/ldak-thin-hapmap3 <span class="at">--taglist</span> list.txt <span class="at">--matlist</span> matlist.txt</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept----------------------------------------------------------------</span></span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a><span class="va">dirin1</span><span class="op">=</span>tagging-norm-100k</span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a><span class="va">dirin2</span><span class="op">=</span>gwas-norm</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a><span class="va">dirout</span><span class="op">=</span>sumher-norm-100k</span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --sum-hers ../</span><span class="va">$dirout</span><span class="st">/</span><span class="va">$i</span><span class="st">-sumher-ldak-thin </span><span class="dt">\</span></span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a><span class="st">          --tagfile ../</span><span class="va">$dirin1</span><span class="st">/ldak-thin-hapmap3.tagging </span><span class="dt">\</span></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a><span class="st">          --summary ../</span><span class="va">$dirin2</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear.summaries </span><span class="dt">\</span></span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-sums NO </span><span class="dt">\</span></span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a><span class="st">          --intercept YES</span></span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-sumher-ldak-thin</span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-sumher-ldak-thin</span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/sumher-ldak-thin-norm-100k</span></code></pre></div>
</div>
<div id="summary-5" class="section level3" number="8.5.3">
<h3><span class="header-section-number">8.5.3</span> summary</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># original ldsc</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept <span class="pp">*</span>ldsc.log <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[-]/); split($3, b, /[()]/); print a[1], $2, b[2]}&#39;</span> <span class="op">&gt;</span> ../../summary/ldsc-norm-100k</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sumher under gcta</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-norm-100k-est</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-norm-100k-sd</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-gcta-norm-100k-est sumher-gcta-norm-100k-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-gcta-norm-100k</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># suhmer under ldak-thin</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-norm-100k-est</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-norm-100k-sd</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-ldak-thin-norm-100k-est sumher-ldak-thin-norm-100k-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-ldak-thin-norm-100k</span></code></pre></div>
</div>
</div>
<div id="ldsc-337k" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> ldsc-337k</h2>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#:::::::::::::</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># using original ldsc</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># format stats for ldsc--------------------------------------------------------- </span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="ex">library</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 100<span class="kw">)</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="va">rs</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;doug/ukbb.ldsc&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="va">phen</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span><span class="st">&quot;fvc&quot;</span><span class="ex">,</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;height&quot;</span><span class="ex">,</span><span class="st">&quot;imp&quot;</span><span class="ex">,</span><span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="ex">,</span> <span class="st">&quot;quals&quot;</span><span class="kw">)</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in phen<span class="kw">){</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="va">stat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;gwas-norm-337k/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="va">p</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;gwas-norm-337k/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.pvalues&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> stat<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> p<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">SNP</span><span class="op">=</span>rs<span class="va">$X2</span>,</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>                 <span class="va">N</span><span class="op">=</span>stat<span class="va">$n</span>[m1],</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>                 <span class="va">Z</span><span class="op">=</span><span class="va">(</span>sqrt<span class="er">(</span>stat<span class="va">$Stat)</span><span class="pp">*</span>stat<span class="va">$Direction</span><span class="kw">)</span><span class="ex">[m1],</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A1</span><span class="op">=</span>stat<span class="va">$A1</span>[m1],</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A2</span><span class="op">=</span>stat<span class="va">$A2</span>[m1], </span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>                 <span class="va">pval</span><span class="op">=</span>p<span class="va">$P</span>[m2], <span class="va">stringsAsFactors</span><span class="op">=</span>F<span class="er">)</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>out[complete.cases<span class="kw">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;gwas-norm-337k/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear-rs.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>  <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="co"># perform ldsc------------------------------------------------------------------</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> out-norm-337k</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 24:00:0</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a><span class="st">.././munge_sumstats.py </span><span class="dt">\</span></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a><span class="st">--sumstats ../../gwas-norm-337k/</span><span class="va">$i</span><span class="st">-linear-rs.summaries </span><span class="dt">\</span></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-norm-337k/</span><span class="va">$i</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a><span class="st">--merge-alleles ../w_hm3.snplist</span></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a><span class="st">.././ldsc.py </span><span class="dt">\</span></span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a><span class="st">--h2 ../out-norm-337k/</span><span class="va">$i</span><span class="st">.sumstats.gz </span><span class="dt">\</span></span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a><span class="st">--ref-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a><span class="st">--w-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-norm-337k/</span><span class="va">$i</span><span class="st">-ldsc</span></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/ldsc-<span class="va">$i</span>-norm-337k.sh</span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs-------------------------------------------------------------------</span></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper</span><span class="op">,</span><span class="dt">quals}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldsc-<span class="va">$i</span>-norm-337k.sh</span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../../job-records/ldsc-norm-337k</span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a><span class="co"># summary ----------------------------------------------------------------------</span></span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept <span class="pp">*</span>ldsc.log <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[-]/); split($3, b, /[()]/); print a[1], $2, b[2]}&#39;</span> <span class="op">&gt;</span> ../../summary/ldsc-norm-337k</span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;summary/ldsc-norm-337k&quot;</span><span class="ex">,</span> header=F, stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a><span class="co"># get p-values for Wald tests</span></span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a><span class="co"># H0: intercept = 1</span></span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a><span class="va">alpha</span><span class="op">=</span>0.05/14 <span class="co"># Bonferroni corrected alpha</span></span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">trait</span><span class="op">=</span>ldsc<span class="va">$V1</span>, <span class="va">est</span><span class="op">=</span>ldsc<span class="va">$V2</span>, <span class="va">se</span><span class="op">=</span>ldsc<span class="va">$V3</span>,</span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a>                <span class="va">wald_p</span><span class="op">=</span>pchisq<span class="kw">((</span>(<span class="va">ldsc$V2</span><span class="op">-</span><span class="dv">1</span>)<span class="op">/</span><span class="va">ldsc$V3</span>)<span class="op">^</span><span class="dv">2</span><span class="kw">,</span> <span class="va">df</span><span class="op">=</span><span class="dv">1</span><span class="kw">,</span> <span class="va">lower</span>.<span class="va">tail</span><span class="op">=</span><span class="va">F</span>)<span class="kw">,</span></span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a>                <span class="va">sig</span><span class="op">=</span><span class="va">pchisq</span>(((<span class="va">ldsc$V2</span><span class="op">-</span><span class="dv">1</span>)<span class="op">/</span><span class="va">ldsc$V3</span>)<span class="op">^</span><span class="dv">2</span><span class="kw">,</span> <span class="va">df</span><span class="op">=</span><span class="dv">1</span><span class="kw">,</span> <span class="va">lower</span>.<span class="va">tail</span><span class="op">=</span><span class="va">F</span>) <span class="op">&lt;</span> <span class="va">alpha</span><span class="kw">,</span></span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a>                <span class="va">stringsAsFactors</span> <span class="op">=</span> <span class="va">F</span>)</span></code></pre></div>
</div>
<div id="aver2_j-337k" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> aver2_j-337k</h2>
<div id="calc" class="section level3" number="8.7.1">
<h3><span class="header-section-number">8.7.1</span> calc</h3>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  snp lists</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># new directory</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> inflation/norm</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> inflation/norm/out</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co"># lista &amp; listb</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>10000</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gen/snps-norm.use</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>inflation/norm/left-snps</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>inflation/norm/right-snps</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;);</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&lt;8) print $1 }&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$left</span>  </span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;);</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&gt;=8) print $1 }&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$right</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r^2_j</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/norm/right-snps</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/norm/left-snps</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-norm</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/norm/out/10k-snps</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:10:0</span></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-r-10k-snps</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-r-10k-snps <span class="op">&gt;</span>../job-records/calc-r-norm</span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r_j^2 for each i-------------------------------------------------</span></span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span><span class="st">&quot;10k-snps&quot;</span></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/norm/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.pairwise&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/norm/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsa&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>                <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/norm/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsb&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a>                <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>dat[,-c<span class="kw">(</span><span class="ex">10001</span><span class="kw">)</span><span class="ex">]^2</span></span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a><span class="va">outb</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>listb<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,2,</span> mean<span class="kw">))</span></span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a><span class="va">outa</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>lista<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,1,</span> mean<span class="kw">))</span></span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>rbind<span class="kw">(</span><span class="ex">outa,outb</span><span class="kw">)</span></span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;summary/ave-r2-&quot;</span><span class="ex">,nm,</span> <span class="st">&quot;-ukbb-norm&quot;</span><span class="kw">)</span><span class="ex">,</span> col.names=F, row.names=F, quote=F<span class="kw">)</span>  </span></code></pre></div>
</div>
<div id="organize-data" class="section level3" number="8.7.2">
<h3><span class="header-section-number">8.7.2</span> organize data</h3>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-norm-337k-out</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-norm-337k/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-ukbb-norm</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-norm-337k-out/<span class="va">$trait</span>.out</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp    </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2&quot;}</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="chisq-aver2_j" class="section level3" number="8.7.3">
<h3><span class="header-section-number">8.7.3</span> chisq ~ aver2_j</h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate slope: chisq ~ aver2_j</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-norm-337k-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>slope0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope_aver2=</span><span class="fu">coef</span>(mod)[<span class="dv">2</span>],</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">p_aver2=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){slope<span class="ot">=</span>slope0} <span class="cf">else</span> {slope<span class="ot">=</span><span class="fu">rbind</span>(slope,slope0)}</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2_j  </span></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot ------------------------------------------------------------------</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-by-aver2-bin-ukbb-recommend-337k.png&quot;</span>),</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[i]</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>    file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-norm-337k-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>)</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bin a variable by quantile</span></span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>    cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># average chisq by bin values</span></span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>    out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>    out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave chisq&quot;</span>,</span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
</div>
<div id="he-2" class="section level2" number="8.8">
<h2><span class="header-section-number">8.8</span> HE</h2>
<div id="making-grms-2" class="section level3" number="8.8.1">
<h3><span class="header-section-number">8.8.1</span> making grms</h3>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># making grm -------------------------------------------------------------------</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># all snps</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 08:0:0</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/gcta-all-norm </span><span class="dt">\</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm-100k </span><span class="dt">\</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-norm-100k.use </span><span class="dt">\</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/grm-all-snps-norm</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/grm-all-snps-norm <span class="op">&gt;</span> ../job-records/grm-all-snps-norm</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a><span class="co"># grm by snp blocks: right vs. left</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&lt;8 {print $2}&#39;</span> geno-norm-100k.bim <span class="op">&gt;</span> left-snps-norm-100k.use </span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&gt;=8 {print $2}&#39;</span> geno-norm-100k.bim <span class="op">&gt;</span> right-snps-norm-100k.use</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/gcta-</span><span class="va">$i</span><span class="st">-norm </span><span class="dt">\</span></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm-100k </span><span class="dt">\</span></span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$i</span><span class="st">-snps-norm-100k.use </span><span class="dt">\</span></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/grm-gcta-<span class="va">$i</span>-norm</span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/grm-gcta-<span class="va">$i</span>-norm </span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-gcta-by-snps-norm </span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------</span></span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. thin snps</span></span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------</span></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 4</span></span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 4:0:0</span></span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 4 </span><span class="dt">\</span></span>
<span id="cb54-69"><a href="#cb54-69" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-prune 0.98 </span><span class="dt">\</span></span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-kb 100 </span><span class="dt">\</span></span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-norm-100k.use </span><span class="dt">\</span></span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm-100k </span><span class="dt">\</span></span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a><span class="st">          --thin ../ldak-thin/chr</span><span class="va">$j</span><span class="st">-norm </span><span class="dt">\</span></span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span></span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin<span class="va">$j</span>-norm</span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-78"><a href="#cb54-78" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb54-79"><a href="#cb54-79" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb54-80"><a href="#cb54-80" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin<span class="va">$j</span>-norm</span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/ldak-thin-norm</span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion---</span></span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/ldak-thin-norm</span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb54-86"><a href="#cb54-86" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb54-87"><a href="#cb54-87" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb54-88"><a href="#cb54-88" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb54-89"><a href="#cb54-89" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb54-90"><a href="#cb54-90" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb54-91"><a href="#cb54-91" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb54-92"><a href="#cb54-92" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb54-93"><a href="#cb54-93" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb54-94"><a href="#cb54-94" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb54-95"><a href="#cb54-95" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb54-96"><a href="#cb54-96" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb54-97"><a href="#cb54-97" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb54-98"><a href="#cb54-98" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb54-99"><a href="#cb54-99" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb54-100"><a href="#cb54-100" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb54-101"><a href="#cb54-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-102"><a href="#cb54-102" aria-hidden="true" tabindex="-1"></a><span class="co"># combine snp list</span></span>
<span id="cb54-103"><a href="#cb54-103" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> ldak-thin/chr{1..22}-norm.in <span class="op">&gt;</span> ldak-thin/ldak-thin-norm.in</span>
<span id="cb54-104"><a href="#cb54-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-105"><a href="#cb54-105" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------</span></span>
<span id="cb54-106"><a href="#cb54-106" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. kinship matrix under ldak-thin</span></span>
<span id="cb54-107"><a href="#cb54-107" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------</span></span>
<span id="cb54-108"><a href="#cb54-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-109"><a href="#cb54-109" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb54-110"><a href="#cb54-110" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb54-111"><a href="#cb54-111" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb54-112"><a href="#cb54-112" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb54-113"><a href="#cb54-113" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 08:0:0</span></span>
<span id="cb54-114"><a href="#cb54-114" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb54-115"><a href="#cb54-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-116"><a href="#cb54-116" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb54-117"><a href="#cb54-117" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/ldak-thin-all-norm </span><span class="dt">\</span></span>
<span id="cb54-118"><a href="#cb54-118" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm-100k </span><span class="dt">\</span></span>
<span id="cb54-119"><a href="#cb54-119" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../ldak-thin/ldak-thin-norm.in </span><span class="dt">\</span></span>
<span id="cb54-120"><a href="#cb54-120" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -0.25 </span><span class="dt">\</span></span>
<span id="cb54-121"><a href="#cb54-121" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb54-122"><a href="#cb54-122" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb54-123"><a href="#cb54-123" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin-grm-all-snps-norm</span>
<span id="cb54-124"><a href="#cb54-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-125"><a href="#cb54-125" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin-grm-all-snps-norm <span class="op">&gt;</span> ../job-records/ldak-thin-grm-all-snps-norm</span>
<span id="cb54-126"><a href="#cb54-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-127"><a href="#cb54-127" aria-hidden="true" tabindex="-1"></a><span class="co"># grm by snp blocks: right vs. left</span></span>
<span id="cb54-128"><a href="#cb54-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-129"><a href="#cb54-129" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[:]/); if (a[1]&lt;8) print $1}&#39;</span> <span class="dt">\</span></span>
<span id="cb54-130"><a href="#cb54-130" aria-hidden="true" tabindex="-1"></a> ldak-thin/ldak-thin-norm.in <span class="op">&gt;</span> gen/left-ldak-thin-norm.snps </span>
<span id="cb54-131"><a href="#cb54-131" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[:]/); if (a[1]&gt;=8) print $1}&#39;</span> <span class="dt">\</span></span>
<span id="cb54-132"><a href="#cb54-132" aria-hidden="true" tabindex="-1"></a> ldak-thin/ldak-thin-norm.in <span class="op">&gt;</span> gen/right-ldak-thin-norm.snps </span>
<span id="cb54-133"><a href="#cb54-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-134"><a href="#cb54-134" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb54-135"><a href="#cb54-135" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb54-136"><a href="#cb54-136" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb54-137"><a href="#cb54-137" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb54-138"><a href="#cb54-138" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb54-139"><a href="#cb54-139" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 08:0:0</span></span>
<span id="cb54-140"><a href="#cb54-140" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb54-141"><a href="#cb54-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-142"><a href="#cb54-142" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb54-143"><a href="#cb54-143" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/ldak-thin-</span><span class="va">$i</span><span class="st">-norm </span><span class="dt">\</span></span>
<span id="cb54-144"><a href="#cb54-144" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm-100k </span><span class="dt">\</span></span>
<span id="cb54-145"><a href="#cb54-145" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$i</span><span class="st">-ldak-thin-norm.snps </span><span class="dt">\</span></span>
<span id="cb54-146"><a href="#cb54-146" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -0.25 </span><span class="dt">\</span></span>
<span id="cb54-147"><a href="#cb54-147" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb54-148"><a href="#cb54-148" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb54-149"><a href="#cb54-149" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin-grm-<span class="va">$i</span>-norm</span>
<span id="cb54-150"><a href="#cb54-150" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb54-151"><a href="#cb54-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-152"><a href="#cb54-152" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb54-153"><a href="#cb54-153" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin-grm-<span class="va">$i</span>-norm </span>
<span id="cb54-154"><a href="#cb54-154" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-ldak-thin-by-snps-norm </span></code></pre></div>
</div>
<div id="estimation-2" class="section level3" number="8.8.2">
<h3><span class="header-section-number">8.8.2</span> estimation</h3>
<p>NEED To check what covariates to adjust for HE
basic.covariates.use or covariates.use?</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regress grm on covariates-----------------------------------------------------</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grm <span class="kw">in</span> gcta-all-norm gcta-left-norm gcta-right-norm ldak-thin-all-norm ldak-thin-left-norm ldak-thin-right-norm<span class="kw">;</span> <span class="cf">do</span>  </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 50G</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 5</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --adjust-grm ../kinship/</span><span class="va">$grm</span><span class="st">.covar </span><span class="dt">\</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/</span><span class="va">$grm</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 5</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$grm</span>-adjust.sh</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grm <span class="kw">in</span> gcta-all-norm gcta-left-norm gcta-right-norm ldak-thin-all-norm ldak-thin-left-norm ldak-thin-right-norm<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$grm</span>-adjust.sh</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-adjust-for-HE</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/grm-adjust-for-HE</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a><span class="co"># HE under gcta-----------------------------------------------------------------</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --he ../he-norm/</span><span class="va">$i</span><span class="st">-he-gcta-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/gcta-</span><span class="va">$k</span><span class="st">-norm.covar </span><span class="dt">\</span></span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a><span class="st">          --kinship-details NO </span><span class="dt">\</span></span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-root NO </span><span class="dt">\</span></span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 1 </span><span class="dt">\</span></span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a><span class="st">          --memory-save YES</span></span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-he-gcta-<span class="va">$k</span>-snps-norm.sh</span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-he-gcta-<span class="va">$k</span>-snps-norm.sh</span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/he-gcta</span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a><span class="co"># HE under ldak-thin------------------------------------------------------------</span></span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 0:30:0</span></span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --he ../he-norm/</span><span class="va">$i</span><span class="st">-he-ldak-thin-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/ldak-thin-</span><span class="va">$k</span><span class="st">-norm.covar </span><span class="dt">\</span></span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a><span class="st">          --kinship-details NO </span><span class="dt">\</span></span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-root NO </span><span class="dt">\</span></span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 1 </span><span class="dt">\</span></span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a><span class="st">          --memory-save YES</span></span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-he-ldak-thin-<span class="va">$k</span>-norm.sh</span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-he-ldak-thin-<span class="va">$k</span>-norm.sh</span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/he-ldak-thin</span></code></pre></div>
</div>
<div id="summary-6" class="section level3" number="8.8.3">
<h3><span class="header-section-number">8.8.3</span> summary</h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-norm.right </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-norm/<span class="va">$i</span>-he-gcta-right.he</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-norm.right</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-norm.left</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-norm/<span class="va">$i</span>-he-gcta-left.he</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-norm.left</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-norm.all</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-norm/<span class="va">$i</span>-he-gcta-all.he</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-norm.all</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-norm.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-norm.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-norm.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a><span class="ex">names</span><span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">left</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;code&quot;</span><span class="ex">,</span><span class="st">&quot;h2&quot;</span><span class="ex">,</span><span class="st">&quot;se&quot;</span><span class="kw">)</span></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/he-gcta-inflation-norm.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb56-80"><a href="#cb56-80" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-norm.right </span>
<span id="cb56-81"><a href="#cb56-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb56-82"><a href="#cb56-82" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-norm/<span class="va">$i</span>-he-ldak-thin-right.he</span>
<span id="cb56-83"><a href="#cb56-83" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-norm.right</span>
<span id="cb56-84"><a href="#cb56-84" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb56-85"><a href="#cb56-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-86"><a href="#cb56-86" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb56-87"><a href="#cb56-87" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-norm.left</span>
<span id="cb56-88"><a href="#cb56-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb56-89"><a href="#cb56-89" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-norm/<span class="va">$i</span>-he-ldak-thin-left.he</span>
<span id="cb56-90"><a href="#cb56-90" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-norm.left</span>
<span id="cb56-91"><a href="#cb56-91" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb56-92"><a href="#cb56-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-93"><a href="#cb56-93" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb56-94"><a href="#cb56-94" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-norm.all</span>
<span id="cb56-95"><a href="#cb56-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb56-96"><a href="#cb56-96" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-norm/<span class="va">$i</span>-he-gcta-all.he</span>
<span id="cb56-97"><a href="#cb56-97" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-norm.all</span>
<span id="cb56-98"><a href="#cb56-98" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb56-99"><a href="#cb56-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-100"><a href="#cb56-100" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb56-101"><a href="#cb56-101" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb56-102"><a href="#cb56-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-103"><a href="#cb56-103" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-norm.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb56-104"><a href="#cb56-104" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-norm.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb56-105"><a href="#cb56-105" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-norm.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb56-106"><a href="#cb56-106" aria-hidden="true" tabindex="-1"></a><span class="ex">names</span><span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">left</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;code&quot;</span><span class="ex">,</span><span class="st">&quot;h2&quot;</span><span class="ex">,</span><span class="st">&quot;se&quot;</span><span class="kw">)</span></span>
<span id="cb56-107"><a href="#cb56-107" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb56-108"><a href="#cb56-108" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb56-109"><a href="#cb56-109" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb56-110"><a href="#cb56-110" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb56-111"><a href="#cb56-111" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb56-112"><a href="#cb56-112" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb56-113"><a href="#cb56-113" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb56-114"><a href="#cb56-114" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb56-115"><a href="#cb56-115" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb56-116"><a href="#cb56-116" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb56-117"><a href="#cb56-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-118"><a href="#cb56-118" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb56-119"><a href="#cb56-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-120"><a href="#cb56-120" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb56-121"><a href="#cb56-121" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb56-122"><a href="#cb56-122" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb56-123"><a href="#cb56-123" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb56-124"><a href="#cb56-124" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb56-125"><a href="#cb56-125" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb56-126"><a href="#cb56-126" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb56-127"><a href="#cb56-127" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb56-128"><a href="#cb56-128" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb56-129"><a href="#cb56-129" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb56-130"><a href="#cb56-130" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb56-131"><a href="#cb56-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-132"><a href="#cb56-132" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb56-133"><a href="#cb56-133" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb56-134"><a href="#cb56-134" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb56-135"><a href="#cb56-135" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb56-136"><a href="#cb56-136" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb56-137"><a href="#cb56-137" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb56-138"><a href="#cb56-138" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb56-139"><a href="#cb56-139" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb56-140"><a href="#cb56-140" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb56-141"><a href="#cb56-141" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb56-142"><a href="#cb56-142" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-inflation-norm.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb56-143"><a href="#cb56-143" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span></code></pre></div>
<!--chapter:end:04.3-ukbb-recommended.Rmd-->
</div>
</div>
</div>
<div id="control" class="section level1" number="9">
<h1><span class="header-section-number">9</span> control GWAS</h1>
<p>Here we perform GWASs that serve as the control group for the good versus bad GWASs comparison. For the bad GWASs (section @ref(bad)), we have a total of 100k individuals, which consist of 93,528 unrelated white British (from the good GWASs) and 6,472 blacks and Asians. We observed inflation of the test statistics. Although unlikely, it is still possible that some of the inflation is due to random errors. To rule out this possibility [or to ascertain that the observed inflation is due to population stratification not random errors], we used the same 93,528 unrelated white British but replaced the 6,472 blacks and Asians with unrelated white British that were not included in the good GWASs.</p>
<div id="id-list" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> ID list</h2>
<p>We used previously obtained id lists (see section @ref(goodid) for the good GWAS id list and section @ref(badid) for the bad GWAS id list ) to derive the id list for the control GWASs. These are:</p>
<ul>
<li><code>overlap-complete-cases.id</code>: N = 147,008. Unrelated white British who have no missing data for all 14 traits and covariates.</li>
<li><code>rand.100000</code>: ID list for the good gwas. Randomly selected from <code>overlap-complete-cases.id</code><br />
</li>
<li><code>white.rand.93528</code>: unrelated whites as a part of the bad gwas ID list. Randomly selected from <code>rand.100000</code></li>
</ul>
<p>Here are the steps:</p>
<ol style="list-style-type: decimal">
<li>identify IDs from <code>overlap-complete-cases.id</code> not included in <code>rand.100000</code>.</li>
<li>randomly select 6,472 from the identified IDs.</li>
<li>combine <code>white.rand.93528</code> with the randomly selected 6,472 IDs.</li>
</ol>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">100</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>id1<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;unrelated/overlap-complete-cases.id&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>id2<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;unrelated/rand.100000&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>id3<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;white.rand.93528&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pool for selection</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>common<span class="ot">=</span><span class="fu">intersect</span>(id1<span class="sc">$</span>V1, id2<span class="sc">$</span>V1)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>pool<span class="ot">=</span>id1[<span class="sc">!</span>id1<span class="sc">$</span>V1<span class="sc">%in%</span>common,]</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly select 6,472 from the pool</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>pool[<span class="fu">sample</span>(<span class="fu">dim</span>(pool)[<span class="dv">1</span>], <span class="dv">6472</span>, <span class="at">replace=</span>F),]</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  combine with &#39;white.rand.93528&#39;</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(<span class="fu">rbind</span>(sel,id3), <span class="st">&#39;control-gwas.id&#39;</span>, <span class="at">quote=</span>F, <span class="at">row.names=</span>F, <span class="at">col.names=</span>F)</span></code></pre></div>
</div>
<div id="qc-of-hp3-snps-1" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> QC of hp3 SNPs</h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># QC SNPs-----------------------------------------------------------------------</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># stating number of SNPs= 1,184,423 </span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../control-gwas.id </span><span class="dt">\</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract ../doug/ukbb.ldsc </span><span class="dt">\</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="st">         --hwe 0.0001 </span><span class="dt">\</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="st">         --hard-call-threshold .05 </span><span class="dt">\</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="st">         --mach-r2-filter 0.8 2 </span><span class="dt">\</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="st">         --make-bed </span><span class="dt">\</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/tmp/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/qc-control-gwas</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/qc-control-gwas</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a><span class="co"># merge files</span></span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> bfile-control-gwas.list</span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span>  <span class="st">&quot;../gen/tmp/bhr</span><span class="va">$j</span><span class="st">&quot;</span> <span class="op">&gt;&gt;</span>bfile-control-gwas.list</span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 40:0:0</span></span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --make-bed ../gen/geno-control </span><span class="dt">\</span></span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a><span class="st">          --mbfile ../gen/bfile-control-gwas.list </span><span class="dt">\</span></span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a><span class="st">          --exclude-dups YES  </span></span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/mbfile-control.sh</span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the script</span></span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/mbfile-control.sh <span class="op">&gt;</span>../job-records/mbfiles-control-gwas</span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-69"><a href="#cb58-69" aria-hidden="true" tabindex="-1"></a><span class="co"># MAF &amp; call-rate </span></span>
<span id="cb58-70"><a href="#cb58-70" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> geno-control.stats <span class="st">&#39;($5&gt;.01 &amp;&amp; $6&gt;=0.95 &amp;&amp; NR&gt;1){print $1}&#39;</span> <span class="op">&gt;</span> snps-control-gwas.use</span>
<span id="cb58-71"><a href="#cb58-71" aria-hidden="true" tabindex="-1"></a><span class="co"># m = 1,103,182 SNPs</span></span></code></pre></div>
</div>
<div id="gwas-1" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> GWAS</h2>
<div class="sourceCode" id="cb59"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># linear regression-------------------------------------------------------------</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-control</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="va">dirout</span><span class="op">=</span>gwas-control</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="va">filein</span><span class="op">=</span>geno-control</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>control-gwas.id</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>snps-control-gwas.use</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../</span><span class="va">$dirout</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/</span><span class="va">$filein</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../</span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$snp</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-control</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/gwas-control</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="ldsc-intercept-2" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> ldsc intercept</h2>
<div id="under-gcta-3" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> under gcta</h3>
<div class="sourceCode" id="cb60"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># UP TO HERE</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># using original ldsc</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># format stats for ldsc--------------------------------------------------------- </span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="ex">library</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 100<span class="kw">)</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="va">rs</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;doug/ukbb.ldsc&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="va">phen</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span><span class="st">&quot;fvc&quot;</span><span class="ex">,</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;height&quot;</span><span class="ex">,</span><span class="st">&quot;imp&quot;</span><span class="ex">,</span><span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="ex">,</span> <span class="st">&quot;quals&quot;</span><span class="kw">)</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in phen<span class="kw">){</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="va">stat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;gwas-control/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  <span class="va">p</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;gwas-control/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.pvalues&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> stat<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> p<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">SNP</span><span class="op">=</span>rs<span class="va">$X2</span>,</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>                 <span class="va">N</span><span class="op">=</span>stat<span class="va">$n</span>[m1],</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>                 <span class="va">Z</span><span class="op">=</span><span class="va">(</span>sqrt<span class="er">(</span>stat<span class="va">$Stat)</span><span class="pp">*</span>stat<span class="va">$Direction</span><span class="kw">)</span><span class="ex">[m1],</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A1</span><span class="op">=</span>stat<span class="va">$A1</span>[m1],</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A2</span><span class="op">=</span>stat<span class="va">$A2</span>[m1], </span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>                 <span class="va">pval</span><span class="op">=</span>p<span class="va">$P</span>[m2], <span class="va">stringsAsFactors</span><span class="op">=</span>F<span class="er">)</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>out[complete.cases<span class="kw">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;gwas-control/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear-rs.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>  <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a><span class="co"># perform ldsc------------------------------------------------------------------</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> out-control</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 24:00:0</span></span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a><span class="st">.././munge_sumstats.py </span><span class="dt">\</span></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a><span class="st">--sumstats ../../gwas-control/</span><span class="va">$i</span><span class="st">-linear-rs.summaries </span><span class="dt">\</span></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-control/</span><span class="va">$i</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a><span class="st">--merge-alleles ../w_hm3.snplist</span></span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a><span class="st">.././ldsc.py </span><span class="dt">\</span></span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a><span class="st">--h2 ../out-control/</span><span class="va">$i</span><span class="st">.sumstats.gz </span><span class="dt">\</span></span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a><span class="st">--ref-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a><span class="st">--w-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-control/</span><span class="va">$i</span><span class="st">-ldsc</span></span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/ldsc-<span class="va">$i</span>-control.sh</span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs-------------------------------------------------------------------</span></span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper</span><span class="op">,</span><span class="dt">quals}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldsc-<span class="va">$i</span>-control.sh</span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../../job-records/ldsc-control</span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a><span class="co"># using sumher</span></span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a><span class="co"># insert genetic distance into bim file-----------------------------------------</span></span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span> geno-control.fam <span class="op">&gt;</span> small-control</span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 3:00:0</span></span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true" tabindex="-1"></a><span class="st">./plink1.9 --bfile ../gen/geno-control </span><span class="dt">\</span></span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true" tabindex="-1"></a><span class="st">          --cm-map /home/zhoux/snpher/faststorage/genetic_maps/genetic_map_chr@_combined_b37.txt </span><span class="dt">\</span></span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true" tabindex="-1"></a><span class="st">          --make-bed </span><span class="dt">\</span></span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true" tabindex="-1"></a><span class="st">          --out new</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../gen/small-control</span></span>
<span id="cb60-78"><a href="#cb60-78" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/map<span class="va">$j</span></span>
<span id="cb60-79"><a href="#cb60-79" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-80"><a href="#cb60-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-81"><a href="#cb60-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/map<span class="va">$j</span></span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> genetic-distance-hapmap3</span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/zhoux/dsmwpred/xuan/quality-control/qc-10oct/gen</span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> new<span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span>.bim <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $2, $3}&#39;</span> <span class="op">&gt;</span> maps-hapmap3-control.txt</span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> new<span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span>.<span class="dt">{bim</span><span class="op">,</span><span class="dt">bed</span><span class="op">,</span><span class="dt">fam</span><span class="op">,</span><span class="dt">log}</span></span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){arr[$1]=$2;next}{print $1, $2, arr[$2], $4, $5, $6}&#39;</span> <span class="op">&gt;</span> geno-control.bim2 maps-hapmap3-control.txt geno-control.bim</span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> geno-control.bim geno-control.bim0</span>
<span id="cb60-91"><a href="#cb60-91" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> geno-control.bim2 geno-control.bim</span>
<span id="cb60-92"><a href="#cb60-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-93"><a href="#cb60-93" aria-hidden="true" tabindex="-1"></a><span class="co"># compute tagging under gcta----------------------------------------------------</span></span>
<span id="cb60-94"><a href="#cb60-94" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> tagging-control</span>
<span id="cb60-95"><a href="#cb60-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-96"><a href="#cb60-96" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb60-97"><a href="#cb60-97" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb60-98"><a href="#cb60-98" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb60-99"><a href="#cb60-99" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb60-100"><a href="#cb60-100" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb60-101"><a href="#cb60-101" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb60-102"><a href="#cb60-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-103"><a href="#cb60-103" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-tagging ../tagging-control/gcta-hapmap3-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb60-104"><a href="#cb60-104" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-control </span><span class="dt">\</span></span>
<span id="cb60-105"><a href="#cb60-105" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb60-106"><a href="#cb60-106" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb60-107"><a href="#cb60-107" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-cm 1 </span><span class="dt">\</span></span>
<span id="cb60-108"><a href="#cb60-108" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span></span>
<span id="cb60-109"><a href="#cb60-109" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/tagging-gcta-hapmap3-chr<span class="va">$j</span></span>
<span id="cb60-110"><a href="#cb60-110" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-111"><a href="#cb60-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-112"><a href="#cb60-112" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-113"><a href="#cb60-113" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/tagging-gcta-hapmap3-chr<span class="va">$j</span> </span>
<span id="cb60-114"><a href="#cb60-114" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/tagging-gcta-hapmap3-control</span>
<span id="cb60-115"><a href="#cb60-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-116"><a href="#cb60-116" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb60-117"><a href="#cb60-117" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/tagging-gcta-hapmap3-control</span>
<span id="cb60-118"><a href="#cb60-118" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb60-119"><a href="#cb60-119" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb60-120"><a href="#cb60-120" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-121"><a href="#cb60-121" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb60-122"><a href="#cb60-122" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb60-123"><a href="#cb60-123" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb60-124"><a href="#cb60-124" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb60-125"><a href="#cb60-125" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb60-126"><a href="#cb60-126" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-127"><a href="#cb60-127" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb60-128"><a href="#cb60-128" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb60-129"><a href="#cb60-129" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb60-130"><a href="#cb60-130" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb60-131"><a href="#cb60-131" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb60-132"><a href="#cb60-132" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb60-133"><a href="#cb60-133" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb60-134"><a href="#cb60-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-135"><a href="#cb60-135" aria-hidden="true" tabindex="-1"></a><span class="co"># merge tagging files-----------------------------------------------------------</span></span>
<span id="cb60-136"><a href="#cb60-136" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> list.txt</span>
<span id="cb60-137"><a href="#cb60-137" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb60-138"><a href="#cb60-138" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-control/gcta-hapmap3-chr-</span><span class="va">$j</span><span class="st">.tagging&quot;</span> <span class="op">&gt;&gt;</span> list.txt</span>
<span id="cb60-139"><a href="#cb60-139" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-140"><a href="#cb60-140" aria-hidden="true" tabindex="-1"></a><span class="ex">./ldak5.1</span> <span class="at">--join-tagging</span> tagging-control/gcta-hapmap3 <span class="at">--taglist</span> list.txt</span>
<span id="cb60-141"><a href="#cb60-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-142"><a href="#cb60-142" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept----------------------------------------------------------------</span></span>
<span id="cb60-143"><a href="#cb60-143" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> sumher-control</span>
<span id="cb60-144"><a href="#cb60-144" aria-hidden="true" tabindex="-1"></a><span class="va">dirin1</span><span class="op">=</span>tagging-control</span>
<span id="cb60-145"><a href="#cb60-145" aria-hidden="true" tabindex="-1"></a><span class="va">dirin2</span><span class="op">=</span>gwas-control</span>
<span id="cb60-146"><a href="#cb60-146" aria-hidden="true" tabindex="-1"></a><span class="va">dirout</span><span class="op">=</span>sumher-control</span>
<span id="cb60-147"><a href="#cb60-147" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-148"><a href="#cb60-148" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb60-149"><a href="#cb60-149" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb60-150"><a href="#cb60-150" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb60-151"><a href="#cb60-151" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb60-152"><a href="#cb60-152" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb60-153"><a href="#cb60-153" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb60-154"><a href="#cb60-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-155"><a href="#cb60-155" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --sum-hers ../</span><span class="va">$dirout</span><span class="st">/</span><span class="va">$i</span><span class="st">-sumher-gcta </span><span class="dt">\</span></span>
<span id="cb60-156"><a href="#cb60-156" aria-hidden="true" tabindex="-1"></a><span class="st">          --tagfile ../</span><span class="va">$dirin1</span><span class="st">/gcta-hapmap3.tagging </span><span class="dt">\</span></span>
<span id="cb60-157"><a href="#cb60-157" aria-hidden="true" tabindex="-1"></a><span class="st">          --summary ../</span><span class="va">$dirin2</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear.summaries </span><span class="dt">\</span></span>
<span id="cb60-158"><a href="#cb60-158" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-sums NO </span><span class="dt">\</span></span>
<span id="cb60-159"><a href="#cb60-159" aria-hidden="true" tabindex="-1"></a><span class="st">          --intercept YES</span></span>
<span id="cb60-160"><a href="#cb60-160" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-sumher-gcta</span>
<span id="cb60-161"><a href="#cb60-161" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-162"><a href="#cb60-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-163"><a href="#cb60-163" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-164"><a href="#cb60-164" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-sumher-gcta</span>
<span id="cb60-165"><a href="#cb60-165" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/sumher-gcta-control</span></code></pre></div>
</div>
<div id="under-ldak-thin-3" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> under ldak-thin</h3>
<div class="sourceCode" id="cb61"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get weights-------------------------------------------------------------------</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> ldak-thin/ldak-thin-control.in <span class="st">&#39;{print $1, 1}&#39;</span> <span class="op">&gt;</span> ldak-thin/weights.ldak-thin-control</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate tagging under ldak-thin---------------------------------------------</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="va">dirout</span><span class="op">=</span>tagging-control</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="va">filein1</span><span class="op">=</span>geno-control</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="va">filein2</span><span class="op">=</span>weights.ldak-thin-control</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 40G</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 5</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-tagging ../</span><span class="va">$dirout</span><span class="st">/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/</span><span class="va">$filein1</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --weights ../ldak-thin/</span><span class="va">$filein2</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -.25 </span><span class="dt">\</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-cm 1 </span><span class="dt">\</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --save-matrix YES </span><span class="dt">\</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 5</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/tagging-ldak-thin-hapmap3-chr<span class="va">$j</span>.sh</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="co"># submit scripts</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/tagging-ldak-thin-hapmap3-chr<span class="va">$j</span>.sh</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/tagging-ldak-thin-control</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/tagging-ldak-thin-control</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a><span class="co"># merge tagging files-----------------------------------------------------------</span></span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> list.txt</span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> matlist.txt</span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-control/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st">.tagging&quot;</span> <span class="op">&gt;&gt;</span> list.txt</span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-control/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st">.matrix&quot;</span> <span class="op">&gt;&gt;</span> matlist.txt</span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a><span class="va">dirout</span><span class="op">=</span>tagging-control</span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a><span class="ex">./ldak5.1</span> <span class="at">--join-tagging</span> <span class="va">$dirout</span>/ldak-thin-hapmap3 <span class="at">--taglist</span> list.txt <span class="at">--matlist</span> matlist.txt</span>
<span id="cb61-60"><a href="#cb61-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-61"><a href="#cb61-61" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept----------------------------------------------------------------</span></span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a><span class="va">dirin1</span><span class="op">=</span>tagging-control</span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a><span class="va">dirin2</span><span class="op">=</span>gwas-control</span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a><span class="va">dirout</span><span class="op">=</span>sumher-control</span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb61-67"><a href="#cb61-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb61-68"><a href="#cb61-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb61-69"><a href="#cb61-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb61-70"><a href="#cb61-70" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb61-71"><a href="#cb61-71" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb61-72"><a href="#cb61-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-73"><a href="#cb61-73" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --sum-hers ../</span><span class="va">$dirout</span><span class="st">/</span><span class="va">$i</span><span class="st">-sumher-ldak-thin </span><span class="dt">\</span></span>
<span id="cb61-74"><a href="#cb61-74" aria-hidden="true" tabindex="-1"></a><span class="st">          --tagfile ../</span><span class="va">$dirin1</span><span class="st">/ldak-thin-hapmap3.tagging </span><span class="dt">\</span></span>
<span id="cb61-75"><a href="#cb61-75" aria-hidden="true" tabindex="-1"></a><span class="st">          --summary ../</span><span class="va">$dirin2</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear.summaries </span><span class="dt">\</span></span>
<span id="cb61-76"><a href="#cb61-76" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-sums NO </span><span class="dt">\</span></span>
<span id="cb61-77"><a href="#cb61-77" aria-hidden="true" tabindex="-1"></a><span class="st">          --intercept YES</span></span>
<span id="cb61-78"><a href="#cb61-78" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-sumher-ldak-thin</span>
<span id="cb61-79"><a href="#cb61-79" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb61-80"><a href="#cb61-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-81"><a href="#cb61-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-82"><a href="#cb61-82" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-sumher-ldak-thin</span>
<span id="cb61-83"><a href="#cb61-83" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/sumher-ldak-thin-control</span></code></pre></div>
</div>
<div id="summary-7" class="section level3" number="9.4.3">
<h3><span class="header-section-number">9.4.3</span> summary</h3>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>control</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># original ldsc</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ldsc/out-control</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept <span class="pp">*</span>ldsc.log <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[-]/); split($3, b, /[()]/); print a[1], $2, b[2]}&#39;</span> <span class="op">&gt;</span> ../../summary/ldsc-<span class="va">$nm</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co"># sumher under gcta</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> sumher-control</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-<span class="va">$nm</span>-est</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-<span class="va">$nm</span>-sd</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-gcta-<span class="va">$nm</span>-est sumher-gcta-<span class="va">$nm</span>-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-gcta-<span class="va">$nm</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co"># suhmer under ldak-thin</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-<span class="va">$nm</span>-est</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-<span class="va">$nm</span>-sd</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-ldak-thin-<span class="va">$nm</span>-est sumher-ldak-thin-<span class="va">$nm</span>-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-ldak-thin-<span class="va">$nm</span></span></code></pre></div>
</div>
</div>
<div id="he-3" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> HE</h2>
<div id="making-grms-3" class="section level3" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> making grms</h3>
<div class="sourceCode" id="cb63"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># making grm -------------------------------------------------------------------</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="va">fileout</span><span class="op">=</span>gcta-all-control</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="va">filein</span><span class="op">=</span>geno-control</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>snps-control-gwas.use</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co"># all snps</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 08:0:0</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/</span><span class="va">$fileout</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/</span><span class="va">$filein</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$snp</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/grm-all-snps</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/grm-all-snps <span class="op">&gt;</span> ../job-records/grm-all-snps-control</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a><span class="co"># grm by snp blocks: right vs. left</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&lt;8 {print $2}&#39;</span> geno-control.bim <span class="op">&gt;</span> left-snps-control.use </span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&gt;=8 {print $2}&#39;</span> geno-control.bim <span class="op">&gt;</span> right-snps-control.use</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a><span class="va">filein</span><span class="op">=</span>geno-control</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/gcta-</span><span class="va">$i</span><span class="st">-control </span><span class="dt">\</span></span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/</span><span class="va">$filein</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$i</span><span class="st">-snps-control.use </span><span class="dt">\</span></span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/grm-gcta-<span class="va">$i</span></span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/grm-gcta-<span class="va">$i</span> </span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-gcta-by-snps-control</span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------</span></span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. thin snps</span></span>
<span id="cb63-63"><a href="#cb63-63" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------</span></span>
<span id="cb63-64"><a href="#cb63-64" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>snps-control-gwas.use</span>
<span id="cb63-65"><a href="#cb63-65" aria-hidden="true" tabindex="-1"></a><span class="va">filein</span><span class="op">=</span>geno-control</span>
<span id="cb63-66"><a href="#cb63-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-67"><a href="#cb63-67" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb63-68"><a href="#cb63-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb63-69"><a href="#cb63-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb63-70"><a href="#cb63-70" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 4</span></span>
<span id="cb63-71"><a href="#cb63-71" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 4:0:0</span></span>
<span id="cb63-72"><a href="#cb63-72" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb63-73"><a href="#cb63-73" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 4 </span><span class="dt">\</span></span>
<span id="cb63-74"><a href="#cb63-74" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-prune 0.98 </span><span class="dt">\</span></span>
<span id="cb63-75"><a href="#cb63-75" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-kb 100 </span><span class="dt">\</span></span>
<span id="cb63-76"><a href="#cb63-76" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$snp</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb63-77"><a href="#cb63-77" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/</span><span class="va">$filein</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb63-78"><a href="#cb63-78" aria-hidden="true" tabindex="-1"></a><span class="st">          --thin ../ldak-thin/chr</span><span class="va">$j</span><span class="st">-control </span><span class="dt">\</span></span>
<span id="cb63-79"><a href="#cb63-79" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span></span>
<span id="cb63-80"><a href="#cb63-80" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin<span class="va">$j</span></span>
<span id="cb63-81"><a href="#cb63-81" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb63-82"><a href="#cb63-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-83"><a href="#cb63-83" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb63-84"><a href="#cb63-84" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-85"><a href="#cb63-85" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin<span class="va">$j</span></span>
<span id="cb63-86"><a href="#cb63-86" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/ldak-thin-control</span>
<span id="cb63-87"><a href="#cb63-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-88"><a href="#cb63-88" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion---</span></span>
<span id="cb63-89"><a href="#cb63-89" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/ldak-thin-control</span>
<span id="cb63-90"><a href="#cb63-90" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb63-91"><a href="#cb63-91" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb63-92"><a href="#cb63-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-93"><a href="#cb63-93" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb63-94"><a href="#cb63-94" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb63-95"><a href="#cb63-95" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb63-96"><a href="#cb63-96" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb63-97"><a href="#cb63-97" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb63-98"><a href="#cb63-98" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb63-99"><a href="#cb63-99" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb63-100"><a href="#cb63-100" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb63-101"><a href="#cb63-101" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb63-102"><a href="#cb63-102" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb63-103"><a href="#cb63-103" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb63-104"><a href="#cb63-104" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb63-105"><a href="#cb63-105" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb63-106"><a href="#cb63-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-107"><a href="#cb63-107" aria-hidden="true" tabindex="-1"></a><span class="co"># combine snp list</span></span>
<span id="cb63-108"><a href="#cb63-108" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> ldak-thin/chr{1..22}-control.in <span class="op">&gt;</span> ldak-thin/ldak-thin-control.in</span>
<span id="cb63-109"><a href="#cb63-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-110"><a href="#cb63-110" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------</span></span>
<span id="cb63-111"><a href="#cb63-111" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. kinship matrix under ldak-thin</span></span>
<span id="cb63-112"><a href="#cb63-112" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------</span></span>
<span id="cb63-113"><a href="#cb63-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-114"><a href="#cb63-114" aria-hidden="true" tabindex="-1"></a><span class="va">fileout</span><span class="op">=</span>ldak-thin-all-control</span>
<span id="cb63-115"><a href="#cb63-115" aria-hidden="true" tabindex="-1"></a><span class="va">filein</span><span class="op">=</span>geno-control</span>
<span id="cb63-116"><a href="#cb63-116" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>ldak-thin-control.in</span>
<span id="cb63-117"><a href="#cb63-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-118"><a href="#cb63-118" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb63-119"><a href="#cb63-119" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb63-120"><a href="#cb63-120" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb63-121"><a href="#cb63-121" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb63-122"><a href="#cb63-122" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 08:0:0</span></span>
<span id="cb63-123"><a href="#cb63-123" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb63-124"><a href="#cb63-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-125"><a href="#cb63-125" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb63-126"><a href="#cb63-126" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/</span><span class="va">$fileout</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb63-127"><a href="#cb63-127" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/</span><span class="va">$filein</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb63-128"><a href="#cb63-128" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../ldak-thin/</span><span class="va">$snp</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb63-129"><a href="#cb63-129" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -0.25 </span><span class="dt">\</span></span>
<span id="cb63-130"><a href="#cb63-130" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb63-131"><a href="#cb63-131" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb63-132"><a href="#cb63-132" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin-grm-all-snps</span>
<span id="cb63-133"><a href="#cb63-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-134"><a href="#cb63-134" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin-grm-all-snps <span class="op">&gt;</span> ../job-records/ldak-thin-grm-all-snps-control</span>
<span id="cb63-135"><a href="#cb63-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-136"><a href="#cb63-136" aria-hidden="true" tabindex="-1"></a><span class="co"># grm by snp blocks: right vs. left</span></span>
<span id="cb63-137"><a href="#cb63-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-138"><a href="#cb63-138" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[:]/); if (a[1]&lt;8) print $1}&#39;</span> <span class="dt">\</span></span>
<span id="cb63-139"><a href="#cb63-139" aria-hidden="true" tabindex="-1"></a> ldak-thin/ldak-thin-control.in <span class="op">&gt;</span> gen/left-ldak-thin-control.snps </span>
<span id="cb63-140"><a href="#cb63-140" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[:]/); if (a[1]&gt;=8) print $1}&#39;</span> <span class="dt">\</span></span>
<span id="cb63-141"><a href="#cb63-141" aria-hidden="true" tabindex="-1"></a> ldak-thin/ldak-thin-control.in <span class="op">&gt;</span> gen/right-ldak-thin-control.snps </span>
<span id="cb63-142"><a href="#cb63-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-143"><a href="#cb63-143" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-144"><a href="#cb63-144" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb63-145"><a href="#cb63-145" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb63-146"><a href="#cb63-146" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 60G</span></span>
<span id="cb63-147"><a href="#cb63-147" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb63-148"><a href="#cb63-148" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 08:0:0</span></span>
<span id="cb63-149"><a href="#cb63-149" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb63-150"><a href="#cb63-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-151"><a href="#cb63-151" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb63-152"><a href="#cb63-152" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/ldak-thin-</span><span class="va">$i</span><span class="st">-control </span><span class="dt">\</span></span>
<span id="cb63-153"><a href="#cb63-153" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-control </span><span class="dt">\</span></span>
<span id="cb63-154"><a href="#cb63-154" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$i</span><span class="st">-ldak-thin-control.snps </span><span class="dt">\</span></span>
<span id="cb63-155"><a href="#cb63-155" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -0.25 </span><span class="dt">\</span></span>
<span id="cb63-156"><a href="#cb63-156" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb63-157"><a href="#cb63-157" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb63-158"><a href="#cb63-158" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin-grm-<span class="va">$i</span></span>
<span id="cb63-159"><a href="#cb63-159" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb63-160"><a href="#cb63-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-161"><a href="#cb63-161" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-162"><a href="#cb63-162" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin-grm-<span class="va">$i</span> </span>
<span id="cb63-163"><a href="#cb63-163" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-ldak-thin-by-snps-control</span></code></pre></div>
</div>
<div id="estimation-3" class="section level3" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> estimation</h3>
<p>NEED To check what covariates to adjust for HE
basic.covariates.use or covariates.use?</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regress grm on covariates-----------------------------------------------------</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grm <span class="kw">in</span> gcta-all-control gcta-left-control gcta-right-control ldak-thin-all-control ldak-thin-left-control ldak-thin-right-control<span class="kw">;</span> <span class="cf">do</span>  </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 50G</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 5</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --adjust-grm ../kinship/</span><span class="va">$grm</span><span class="st">.covar </span><span class="dt">\</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/</span><span class="va">$grm</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 5</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$grm</span>-adjust.sh</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grm <span class="kw">in</span> gcta-all-control gcta-left-control gcta-right-control ldak-thin-all-control ldak-thin-left-control ldak-thin-right-control<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$grm</span>-adjust.sh</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-adjust-for-HE-control</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/grm-adjust-for-HE-control</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a><span class="co"># HE under gcta-----------------------------------------------------------------</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> he-control</span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a><span class="va">dirout</span><span class="op">=</span>he-control</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --he ../</span><span class="va">$dirout</span><span class="st">/</span><span class="va">$i</span><span class="st">-he-gcta-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/gcta-</span><span class="va">$k</span><span class="st">-control.covar </span><span class="dt">\</span></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a><span class="st">          --kinship-details NO </span><span class="dt">\</span></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-root NO </span><span class="dt">\</span></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 1 </span><span class="dt">\</span></span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a><span class="st">          --memory-save YES</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-he-gcta-<span class="va">$k</span>-snps-control.sh</span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-he-gcta-<span class="va">$k</span>-snps-control.sh</span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/he-gcta-control</span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a><span class="co"># HE under ldak-thin------------------------------------------------------------</span></span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a><span class="va">dirout</span><span class="op">=</span>he-control</span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 0:30:0</span></span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --he ../</span><span class="va">$dirout</span><span class="st">/</span><span class="va">$i</span><span class="st">-he-ldak-thin-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/ldak-thin-</span><span class="va">$k</span><span class="st">-control.covar </span><span class="dt">\</span></span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a><span class="st">          --kinship-details NO </span><span class="dt">\</span></span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-root NO </span><span class="dt">\</span></span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 1 </span><span class="dt">\</span></span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a><span class="st">          --memory-save YES</span></span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-he-ldak-thin-<span class="va">$k</span>-control.sh</span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb64-97"><a href="#cb64-97" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-98"><a href="#cb64-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-99"><a href="#cb64-99" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-he-ldak-thin-<span class="va">$k</span>-control.sh</span>
<span id="cb64-100"><a href="#cb64-100" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-101"><a href="#cb64-101" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/he-ldak-thin-control</span></code></pre></div>
</div>
<div id="summary-8" class="section level3" number="9.5.3">
<h3><span class="header-section-number">9.5.3</span> summary</h3>
<div class="sourceCode" id="cb65"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>control</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-<span class="va">$nm</span>.right </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-<span class="va">$nm</span>/<span class="va">$i</span>-he-gcta-right.he</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-<span class="va">$nm</span>.right</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-<span class="va">$nm</span>.left</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-<span class="va">$nm</span>/<span class="va">$i</span>-he-gcta-left.he</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-<span class="va">$nm</span>.left</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-<span class="va">$nm</span>.all</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-<span class="va">$nm</span>/<span class="va">$i</span>-he-gcta-all.he</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-<span class="va">$nm</span>.all</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-control.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-control.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-control.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a><span class="ex">names</span><span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">left</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;code&quot;</span><span class="ex">,</span><span class="st">&quot;h2&quot;</span><span class="ex">,</span><span class="st">&quot;se&quot;</span><span class="kw">)</span></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb65-64"><a href="#cb65-64" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb65-65"><a href="#cb65-65" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb65-66"><a href="#cb65-66" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb65-67"><a href="#cb65-67" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb65-68"><a href="#cb65-68" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb65-69"><a href="#cb65-69" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb65-70"><a href="#cb65-70" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb65-71"><a href="#cb65-71" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/he-gcta-inflation-control.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-72"><a href="#cb65-72" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb65-73"><a href="#cb65-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-74"><a href="#cb65-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-75"><a href="#cb65-75" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb65-76"><a href="#cb65-76" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb65-77"><a href="#cb65-77" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb65-78"><a href="#cb65-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-79"><a href="#cb65-79" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>control</span>
<span id="cb65-80"><a href="#cb65-80" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb65-81"><a href="#cb65-81" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb65-82"><a href="#cb65-82" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-<span class="va">$nm</span>.right </span>
<span id="cb65-83"><a href="#cb65-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-84"><a href="#cb65-84" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-<span class="va">$nm</span>/<span class="va">$i</span>-he-ldak-thin-right.he</span>
<span id="cb65-85"><a href="#cb65-85" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-<span class="va">$nm</span>.right</span>
<span id="cb65-86"><a href="#cb65-86" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-87"><a href="#cb65-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-88"><a href="#cb65-88" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb65-89"><a href="#cb65-89" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-<span class="va">$nm</span>.left</span>
<span id="cb65-90"><a href="#cb65-90" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-91"><a href="#cb65-91" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-<span class="va">$nm</span>/<span class="va">$i</span>-he-ldak-thin-left.he</span>
<span id="cb65-92"><a href="#cb65-92" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-<span class="va">$nm</span>.left</span>
<span id="cb65-93"><a href="#cb65-93" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-94"><a href="#cb65-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-95"><a href="#cb65-95" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb65-96"><a href="#cb65-96" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-<span class="va">$nm</span>.all</span>
<span id="cb65-97"><a href="#cb65-97" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-98"><a href="#cb65-98" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-<span class="va">$nm</span>/<span class="va">$i</span>-he-gcta-all.he</span>
<span id="cb65-99"><a href="#cb65-99" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-<span class="va">$nm</span>.all</span>
<span id="cb65-100"><a href="#cb65-100" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-101"><a href="#cb65-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-102"><a href="#cb65-102" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb65-103"><a href="#cb65-103" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb65-104"><a href="#cb65-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-105"><a href="#cb65-105" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-control.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb65-106"><a href="#cb65-106" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-control.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb65-107"><a href="#cb65-107" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-control.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb65-108"><a href="#cb65-108" aria-hidden="true" tabindex="-1"></a><span class="ex">names</span><span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">left</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;code&quot;</span><span class="ex">,</span><span class="st">&quot;h2&quot;</span><span class="ex">,</span><span class="st">&quot;se&quot;</span><span class="kw">)</span></span>
<span id="cb65-109"><a href="#cb65-109" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb65-110"><a href="#cb65-110" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb65-111"><a href="#cb65-111" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-112"><a href="#cb65-112" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-113"><a href="#cb65-113" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-114"><a href="#cb65-114" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-115"><a href="#cb65-115" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-116"><a href="#cb65-116" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb65-117"><a href="#cb65-117" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb65-118"><a href="#cb65-118" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb65-119"><a href="#cb65-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-120"><a href="#cb65-120" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb65-121"><a href="#cb65-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-122"><a href="#cb65-122" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb65-123"><a href="#cb65-123" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb65-124"><a href="#cb65-124" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb65-125"><a href="#cb65-125" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb65-126"><a href="#cb65-126" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb65-127"><a href="#cb65-127" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb65-128"><a href="#cb65-128" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb65-129"><a href="#cb65-129" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb65-130"><a href="#cb65-130" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb65-131"><a href="#cb65-131" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb65-132"><a href="#cb65-132" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb65-133"><a href="#cb65-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-134"><a href="#cb65-134" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb65-135"><a href="#cb65-135" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb65-136"><a href="#cb65-136" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb65-137"><a href="#cb65-137" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb65-138"><a href="#cb65-138" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb65-139"><a href="#cb65-139" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb65-140"><a href="#cb65-140" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb65-141"><a href="#cb65-141" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb65-142"><a href="#cb65-142" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb65-143"><a href="#cb65-143" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb65-144"><a href="#cb65-144" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-inflation-control.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-145"><a href="#cb65-145" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span></code></pre></div>
<!--chapter:end:04.4-control-gwas.Rmd-->
</div>
</div>
</div>
<div id="inclusive-gwas" class="section level1" number="10">
<h1><span class="header-section-number">10</span> inclusive GWAS</h1>
<p>Here we conduct a GWAS that mimic the QC steps taken by some of the most inclusive GWAS studies. For example, the GWAS conducted by Codd et al. (2021) on telomere length has the following QC step, which resulted in n = 472,174 and m = 19.4 million SNPs</p>
<blockquote>
<p>We used imputed genotypes available in the UKB2 for the GWAS. To ensure quality, we restricted the analysis to variants with a MAF of ≥0.1% (where imputation accuracy is greatest) and an INFO score of ≥0.3. We tested 19.4 million variants using the BOLT-LMM package, adjusting for age, sex, array and the first ten principal components (PCs). The analysis was run separately for chromosome 23, where males were coded as 0/2.</p>
</blockquote>
<p>Here we want to test if the test statistics from GWAS conducted in such a way are inflated using the proposed method. We do not have access to telomere length, but we can use the 14 traits as examples instead.</p>
<div id="qc" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> QC</h2>
<div class="sourceCode" id="cb66"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract covariates</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This has been done under &#39;Good GWAS&#39; section. Here we just want to extract from the file</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="va">scipen</span><span class="op">=</span>999<span class="kw">)</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;phen/covariates.phen&quot;</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="va">pc</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;pc&quot;</span><span class="ex">,1:10</span><span class="kw">)</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;eid&quot;</span><span class="ex">,</span><span class="st">&quot;eid&quot;</span><span class="ex">,</span><span class="st">&quot;age&quot;</span><span class="ex">,</span><span class="st">&quot;geno_batch&quot;</span><span class="ex">,pc</span><span class="kw">)</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>dat[,cov]</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span><span class="st">&quot;phen/covariates-inclusive-gwas.use&quot;</span><span class="ex">,</span> col.names=F,</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>            <span class="ex">row.names=F,</span> quote=F<span class="kw">)</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">cov,</span><span class="st">&quot;phen/covariates-inclusive-gwas.use-names&quot;</span><span class="ex">,</span> col.names=F,</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>            <span class="ex">row.names=F,</span> quote=F<span class="kw">)</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>out[complete.cases<span class="kw">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">,]</span> <span class="co"># n = 488,244</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="va">sel</span><span class="op">[</span>,1:2<span class="op">]</span><span class="ex">,</span> <span class="st">&quot;complete-cases-covariates-inclusive-gwas.id&quot;</span>, col.names=F,</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>            <span class="ex">row.names=F,</span> quote=F<span class="kw">)</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="co"># id list of complete cases: covariates &amp; phenotypes</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a><span class="co"># note: to remain as much people as possible, we did not select all 14 traits. but 9.</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a><span class="co"># for these traits, n = 467, 104 have complete data</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> complete-cases-covariates-inclusive-gwas.id inclusive-gwas.id</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>phen/continuous-traits/</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="co"># {awake,bmi,chron,ever,fvc,height,imp,neur,pulse,quals,reaction,sbp,snoring,hyper}</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tt <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> inclusive-gwas.id temp</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}($1 in a){print $1, $2}&#39;</span> temp <span class="va">$dir</span>/<span class="va">$tt</span>.raw.pheno <span class="op">&gt;</span> inclusive-gwas.id</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> inclusive-gwas.id</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$tt</span></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> temp</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a><span class="co"># extract genotypes</span></span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a><span class="co"># QC SNPs-----------------------------------------------------------------------</span></span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a><span class="co"># stating number of SNPs=</span></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../inclusive-gwas.id </span><span class="dt">\</span></span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a><span class="st">         --hwe 0.0001 </span><span class="dt">\</span></span>
<span id="cb66-57"><a href="#cb66-57" aria-hidden="true" tabindex="-1"></a><span class="st">         --maf 0.001 </span><span class="dt">\</span></span>
<span id="cb66-58"><a href="#cb66-58" aria-hidden="true" tabindex="-1"></a><span class="st">         --hard-call-threshold .05 </span><span class="dt">\</span></span>
<span id="cb66-59"><a href="#cb66-59" aria-hidden="true" tabindex="-1"></a><span class="st">         --mach-r2-filter 0.3 2 </span><span class="dt">\</span></span>
<span id="cb66-60"><a href="#cb66-60" aria-hidden="true" tabindex="-1"></a><span class="st">         --make-bed </span><span class="dt">\</span></span>
<span id="cb66-61"><a href="#cb66-61" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb66-62"><a href="#cb66-62" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/tmp/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb66-63"><a href="#cb66-63" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3</span></span>
<span id="cb66-64"><a href="#cb66-64" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb66-65"><a href="#cb66-65" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-66"><a href="#cb66-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-67"><a href="#cb66-67" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs-------------------------------------------------------------------</span></span>
<span id="cb66-68"><a href="#cb66-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-69"><a href="#cb66-69" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb66-70"><a href="#cb66-70" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/qc-inclusive-gwas</span>
<span id="cb66-71"><a href="#cb66-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-72"><a href="#cb66-72" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb66-73"><a href="#cb66-73" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/qc-inclusive-gwas</span>
<span id="cb66-74"><a href="#cb66-74" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb66-75"><a href="#cb66-75" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb66-76"><a href="#cb66-76" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-77"><a href="#cb66-77" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp</span>
<span id="cb66-78"><a href="#cb66-78" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb66-79"><a href="#cb66-79" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb66-80"><a href="#cb66-80" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb66-81"><a href="#cb66-81" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb66-82"><a href="#cb66-82" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-83"><a href="#cb66-83" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb66-84"><a href="#cb66-84" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb66-85"><a href="#cb66-85" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb66-86"><a href="#cb66-86" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb66-87"><a href="#cb66-87" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb66-88"><a href="#cb66-88" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb66-89"><a href="#cb66-89" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb66-90"><a href="#cb66-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-91"><a href="#cb66-91" aria-hidden="true" tabindex="-1"></a><span class="co"># merge files-------------------------------------------------------------------</span></span>
<span id="cb66-92"><a href="#cb66-92" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> gen/bfile-inclusive-gwas.list</span>
<span id="cb66-93"><a href="#cb66-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-94"><a href="#cb66-94" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span>  <span class="st">&quot;../gen/tmp/bhr</span><span class="va">$j</span><span class="st">&quot;</span> <span class="op">&gt;&gt;</span> gen/bfile-inclusive-gwas.list</span>
<span id="cb66-95"><a href="#cb66-95" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-96"><a href="#cb66-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-97"><a href="#cb66-97" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb66-98"><a href="#cb66-98" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb66-99"><a href="#cb66-99" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb66-100"><a href="#cb66-100" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 80G</span></span>
<span id="cb66-101"><a href="#cb66-101" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb66-102"><a href="#cb66-102" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb66-103"><a href="#cb66-103" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --make-bed ../gen/geno-inclusive-gwas </span><span class="dt">\</span></span>
<span id="cb66-104"><a href="#cb66-104" aria-hidden="true" tabindex="-1"></a><span class="st">          --mbfile ../gen/bfile-inclusive-gwas.list </span><span class="dt">\</span></span>
<span id="cb66-105"><a href="#cb66-105" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb66-106"><a href="#cb66-106" aria-hidden="true" tabindex="-1"></a><span class="st">          --exclude-dups YES</span></span>
<span id="cb66-107"><a href="#cb66-107" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/mbfile-inclusive-gwas.sh</span>
<span id="cb66-108"><a href="#cb66-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-109"><a href="#cb66-109" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the script-------------------------------------------------------------</span></span>
<span id="cb66-110"><a href="#cb66-110" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/mbfile-inclusive-gwas.sh <span class="op">&gt;</span>../job-records/mbfile-inclusive-gwas</span>
<span id="cb66-111"><a href="#cb66-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-112"><a href="#cb66-112" aria-hidden="true" tabindex="-1"></a><span class="co"># compute info score------------------------------------------------------------</span></span>
<span id="cb66-113"><a href="#cb66-113" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-114"><a href="#cb66-114" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb66-115"><a href="#cb66-115" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb66-116"><a href="#cb66-116" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb66-117"><a href="#cb66-117" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb66-118"><a href="#cb66-118" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb66-119"><a href="#cb66-119" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb66-120"><a href="#cb66-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-121"><a href="#cb66-121" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb66-122"><a href="#cb66-122" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3 </span><span class="dt">\</span></span>
<span id="cb66-123"><a href="#cb66-123" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../inclusive-gwas.id </span><span class="dt">\</span></span>
<span id="cb66-124"><a href="#cb66-124" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb66-125"><a href="#cb66-125" aria-hidden="true" tabindex="-1"></a><span class="st">         --freq cols=chrom,ref,alt,altfreq,machr2 </span><span class="dt">\</span></span>
<span id="cb66-126"><a href="#cb66-126" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/info/chr</span><span class="va">$j</span></span>
<span id="cb66-127"><a href="#cb66-127" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/info-chr<span class="va">$j</span>.sh</span>
<span id="cb66-128"><a href="#cb66-128" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-129"><a href="#cb66-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-130"><a href="#cb66-130" aria-hidden="true" tabindex="-1"></a><span class="co"># submit file-------------------------------------------------------------------</span></span>
<span id="cb66-131"><a href="#cb66-131" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-132"><a href="#cb66-132" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/info-chr<span class="va">$j</span>.sh</span>
<span id="cb66-133"><a href="#cb66-133" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/compute-info-score-inclusive-gwas</span>
<span id="cb66-134"><a href="#cb66-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-135"><a href="#cb66-135" aria-hidden="true" tabindex="-1"></a><span class="co"># combine files ----------------------------------------------------------------</span></span>
<span id="cb66-136"><a href="#cb66-136" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>gen/info</span>
<span id="cb66-137"><a href="#cb66-137" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">$dir</span>/inclusive-gwas-afreq</span>
<span id="cb66-138"><a href="#cb66-138" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-139"><a href="#cb66-139" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$i</span> <span class="ot">==</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb66-140"><a href="#cb66-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$dir</span>/chr<span class="va">$i</span>.afreq <span class="op">&gt;</span> <span class="va">$dir</span>/inclusive-gwas-afreq</span>
<span id="cb66-141"><a href="#cb66-141" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb66-142"><a href="#cb66-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$dir</span>/chr<span class="va">$i</span>.afreq <span class="op">&gt;&gt;</span> <span class="va">$dir</span>/inclusive-gwas-afreq</span>
<span id="cb66-143"><a href="#cb66-143" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb66-144"><a href="#cb66-144" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-145"><a href="#cb66-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-146"><a href="#cb66-146" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::</span></span>
<span id="cb66-147"><a href="#cb66-147" aria-hidden="true" tabindex="-1"></a><span class="co"># SNP list</span></span>
<span id="cb66-148"><a href="#cb66-148" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::</span></span>
<span id="cb66-149"><a href="#cb66-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-150"><a href="#cb66-150" aria-hidden="true" tabindex="-1"></a><span class="co"># MAF &amp; call-rate</span></span>
<span id="cb66-151"><a href="#cb66-151" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> gen/bfile-inclusive-gwas.stat <span class="st">&#39;($5&gt;.001 &amp;&amp; $6&gt;=0.95 &amp;&amp; NR&gt;1){print $1}&#39;</span> <span class="op">&gt;</span> snps-inclusive-gwas.use</span>
<span id="cb66-152"><a href="#cb66-152" aria-hidden="true" tabindex="-1"></a><span class="co"># m = SNPs</span></span></code></pre></div>
</div>
<div id="gwas-telomere-length" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> gwas-telomere length</h2>
<div id="aver2_j-1" class="section level3" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> aver2_j</h3>
<p>Here we want to check if there is evidence of inflation in GWAS statistics due to confouding.
Here are the steps:</p>
<ol style="list-style-type: decimal">
<li>download the GWAS stats (<a href="https://figshare.com/s/caa99dc0f76d62990195" class="uri">https://figshare.com/s/caa99dc0f76d62990195</a>)</li>
<li>randomly chose 10k SNPs from each side of the genome</li>
<li>compute aver2_j</li>
<li>check if chi square test stats vary with respect to aver2_j</li>
</ol>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># select SNPs &amp; organize data</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># download gwas stats-----------------------------------------------------------</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-telomere</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://figshare.com/ndownloader/files/28414941<span class="pp">?</span>private_link=caa99dc0f76d62990195</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co"># m = 20,134,422 SNPs</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co"># organize data: snp name &amp; chisq ----------------------------------------------</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gwas-telomere/UKB_telomere_gwas_summarystats.tsv.gz</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>gwas-telomere/telemere-gwas-organized</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="fu">zcat</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&#39;\t&#39;</span> <span class="st">&#39;BEGIN {print &quot;chr base_pair_location chr_base rs chisq&quot;} </span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="st">                            NR &gt;1 {print $3, $4,$3&quot;:&quot;$4, $1, ($8/$9)^2}&#39;</span> <span class="op">&gt;</span> <span class="va">$outfile</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="co"># hapmap3 SNPs------------------------------------------------------------------</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="va">infile1</span><span class="op">=</span>doug/ukbb.ldsc</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="va">infile2</span><span class="op">=</span>gwas-telomere/telemere-gwas-organized</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>gwas-telomere/telemere-gwas-organized-hm3</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR{a[$3];next} </span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="st">     ($3 in a || FNR==1 ){print $0}&#39;</span> <span class="va">$infile1</span> <span class="va">$infile2</span> <span class="op">&gt;</span> <span class="va">$outfile</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a><span class="co"># choose snp lists--------------------------------------------------------------</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a><span class="co"># choose 40k for each side as the pool for selection</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>40000</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gwas-telomere/telemere-gwas-organized-hm3</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>inflation/gwas-telomere/left-snps-pool</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>inflation/gwas-telomere/right-snps-pool</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&lt;8 &amp;&amp; NR &gt; 1 {print $1, $2, $3}&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$left</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&gt;=8 &amp;&amp; NR &gt; 1 {print $1, $2, $3}&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$right</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a><span class="co"># entire snp list of ukbb</span></span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>inflation/gwas-telomere/ukbb-bhr-all-snps</span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">$out</span></span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a><span class="va">gen</span><span class="op">=</span>gen/geno_plink/bhr<span class="va">$i</span>.pvar</span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $1&quot;:&quot;$2, $3}&#39;</span> <span class="va">$gen</span> <span class="op">&gt;&gt;</span> <span class="va">$out</span></span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a><span class="co"># wc -l gen/geno_plink/bhr{1..22}.pvar</span></span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a><span class="co"># put the chosen 40k snps in the right format</span></span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>inflation/gwas-telomere/ukbb-bhr-all-snps</span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a><span class="va">leftin</span><span class="op">=</span>inflation/gwas-telomere/left-snps-pool</span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a><span class="va">rightin</span><span class="op">=</span>inflation/gwas-telomere/right-snps-pool</span>
<span id="cb67-45"><a href="#cb67-45" aria-hidden="true" tabindex="-1"></a><span class="va">leftout</span><span class="op">=</span>inflation/gwas-telomere/left-snps-tmp</span>
<span id="cb67-46"><a href="#cb67-46" aria-hidden="true" tabindex="-1"></a><span class="va">rightout</span><span class="op">=</span>inflation/gwas-telomere/right-snps-tmp</span>
<span id="cb67-47"><a href="#cb67-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-48"><a href="#cb67-48" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$3];next}</span></span>
<span id="cb67-49"><a href="#cb67-49" aria-hidden="true" tabindex="-1"></a><span class="st">     ($3 in a){print $4}&#39;</span> <span class="va">$leftin</span> <span class="va">$snp</span> <span class="op">&gt;</span> <span class="va">$leftout</span></span>
<span id="cb67-50"><a href="#cb67-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-51"><a href="#cb67-51" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$3];next}</span></span>
<span id="cb67-52"><a href="#cb67-52" aria-hidden="true" tabindex="-1"></a><span class="st">     ($3 in a){print $4}&#39;</span> <span class="va">$rightin</span> <span class="va">$snp</span> <span class="op">&gt;</span> <span class="va">$rightout</span></span>
<span id="cb67-53"><a href="#cb67-53" aria-hidden="true" tabindex="-1"></a><span class="co"># note:  &gt; 40k are in the list of each side because some snps have the same basepair...    </span></span>
<span id="cb67-54"><a href="#cb67-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-55"><a href="#cb67-55" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb67-56"><a href="#cb67-56" aria-hidden="true" tabindex="-1"></a><span class="co">#  extract genotypes of the bfiles</span></span>
<span id="cb67-57"><a href="#cb67-57" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb67-58"><a href="#cb67-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-59"><a href="#cb67-59" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>inflation/gwas-telomere/left-snps-tmp</span>
<span id="cb67-60"><a href="#cb67-60" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>inflation/gwas-telomere/right-snps-tmp</span>
<span id="cb67-61"><a href="#cb67-61" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>inflation/gwas-telomere/snp-all</span>
<span id="cb67-62"><a href="#cb67-62" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$left</span> <span class="va">$right</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb67-63"><a href="#cb67-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-64"><a href="#cb67-64" aria-hidden="true" tabindex="-1"></a><span class="co"># extract data -----------------------------------------------------------------</span></span>
<span id="cb67-65"><a href="#cb67-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-66"><a href="#cb67-66" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb67-67"><a href="#cb67-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb67-68"><a href="#cb67-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb67-69"><a href="#cb67-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 4G</span></span>
<span id="cb67-70"><a href="#cb67-70" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb67-71"><a href="#cb67-71" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb67-72"><a href="#cb67-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-73"><a href="#cb67-73" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb67-74"><a href="#cb67-74" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract ../inflation/gwas-telomere/snp-all </span><span class="dt">\</span></span>
<span id="cb67-75"><a href="#cb67-75" aria-hidden="true" tabindex="-1"></a><span class="st">         --make-bed </span><span class="dt">\</span></span>
<span id="cb67-76"><a href="#cb67-76" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/tmp/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb67-77"><a href="#cb67-77" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb67-78"><a href="#cb67-78" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3</span></span>
<span id="cb67-79"><a href="#cb67-79" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb67-80"><a href="#cb67-80" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-81"><a href="#cb67-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-82"><a href="#cb67-82" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs-------------------------------------------------------------------</span></span>
<span id="cb67-83"><a href="#cb67-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-84"><a href="#cb67-84" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb67-85"><a href="#cb67-85" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/bfile-telomere</span>
<span id="cb67-86"><a href="#cb67-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-87"><a href="#cb67-87" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb67-88"><a href="#cb67-88" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/bfile-telomere</span>
<span id="cb67-89"><a href="#cb67-89" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb67-90"><a href="#cb67-90" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb67-91"><a href="#cb67-91" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-92"><a href="#cb67-92" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb67-93"><a href="#cb67-93" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb67-94"><a href="#cb67-94" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb67-95"><a href="#cb67-95" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb67-96"><a href="#cb67-96" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb67-97"><a href="#cb67-97" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-98"><a href="#cb67-98" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb67-99"><a href="#cb67-99" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb67-100"><a href="#cb67-100" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb67-101"><a href="#cb67-101" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb67-102"><a href="#cb67-102" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb67-103"><a href="#cb67-103" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb67-104"><a href="#cb67-104" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb67-105"><a href="#cb67-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-106"><a href="#cb67-106" aria-hidden="true" tabindex="-1"></a><span class="co"># merge files-------------------------------------------------------------------</span></span>
<span id="cb67-107"><a href="#cb67-107" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> gen/bfile.list</span>
<span id="cb67-108"><a href="#cb67-108" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-109"><a href="#cb67-109" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span>  <span class="st">&quot;../gen/tmp/bhr</span><span class="va">$j</span><span class="st">&quot;</span> <span class="op">&gt;&gt;</span> gen/bfile.list</span>
<span id="cb67-110"><a href="#cb67-110" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-111"><a href="#cb67-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-112"><a href="#cb67-112" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb67-113"><a href="#cb67-113" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb67-114"><a href="#cb67-114" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb67-115"><a href="#cb67-115" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb67-116"><a href="#cb67-116" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb67-117"><a href="#cb67-117" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 01:00:0</span></span>
<span id="cb67-118"><a href="#cb67-118" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --make-bed ../gen/geno-telomere </span><span class="dt">\</span></span>
<span id="cb67-119"><a href="#cb67-119" aria-hidden="true" tabindex="-1"></a><span class="st">          --mbfile ../gen/bfile.list </span><span class="dt">\</span></span>
<span id="cb67-120"><a href="#cb67-120" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb67-121"><a href="#cb67-121" aria-hidden="true" tabindex="-1"></a><span class="st">          --exclude-dups YES</span></span>
<span id="cb67-122"><a href="#cb67-122" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/mbfile-telomere.sh</span>
<span id="cb67-123"><a href="#cb67-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-124"><a href="#cb67-124" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the script-------------------------------------------------------------</span></span>
<span id="cb67-125"><a href="#cb67-125" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/mbfile-telomere.sh <span class="op">&gt;</span>../job-records/mbfile-telomere</span>
<span id="cb67-126"><a href="#cb67-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-127"><a href="#cb67-127" aria-hidden="true" tabindex="-1"></a><span class="co"># compute info score------------------------------------------------------------</span></span>
<span id="cb67-128"><a href="#cb67-128" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-129"><a href="#cb67-129" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>../inflation/gwas-telomere/snp-all</span>
<span id="cb67-130"><a href="#cb67-130" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../gen/info/chr<span class="va">$j</span>-telomere</span>
<span id="cb67-131"><a href="#cb67-131" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb67-132"><a href="#cb67-132" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb67-133"><a href="#cb67-133" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb67-134"><a href="#cb67-134" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb67-135"><a href="#cb67-135" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb67-136"><a href="#cb67-136" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:20:0</span></span>
<span id="cb67-137"><a href="#cb67-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-138"><a href="#cb67-138" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb67-139"><a href="#cb67-139" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3 </span><span class="dt">\</span></span>
<span id="cb67-140"><a href="#cb67-140" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract </span><span class="va">$snp</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb67-141"><a href="#cb67-141" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb67-142"><a href="#cb67-142" aria-hidden="true" tabindex="-1"></a><span class="st">         --freq cols=chrom,ref,alt,altfreq,machr2 </span><span class="dt">\</span></span>
<span id="cb67-143"><a href="#cb67-143" aria-hidden="true" tabindex="-1"></a><span class="st">         --out </span><span class="va">$out</span></span>
<span id="cb67-144"><a href="#cb67-144" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/info-chr<span class="va">$j</span>.sh</span>
<span id="cb67-145"><a href="#cb67-145" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-146"><a href="#cb67-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-147"><a href="#cb67-147" aria-hidden="true" tabindex="-1"></a><span class="co"># submit file-------------------------------------------------------------------</span></span>
<span id="cb67-148"><a href="#cb67-148" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-149"><a href="#cb67-149" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/info-chr<span class="va">$j</span>.sh</span>
<span id="cb67-150"><a href="#cb67-150" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/compute-info-telomere</span>
<span id="cb67-151"><a href="#cb67-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-152"><a href="#cb67-152" aria-hidden="true" tabindex="-1"></a><span class="co"># combine files ----------------------------------------------------------------</span></span>
<span id="cb67-153"><a href="#cb67-153" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>gen/info</span>
<span id="cb67-154"><a href="#cb67-154" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">$dir</span>/telomere-afreq</span>
<span id="cb67-155"><a href="#cb67-155" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-156"><a href="#cb67-156" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$i</span> <span class="ot">==</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb67-157"><a href="#cb67-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$dir</span>/chr<span class="va">$i</span>-telomere.afreq <span class="op">&gt;</span> <span class="va">$dir</span>/telomere-afreq</span>
<span id="cb67-158"><a href="#cb67-158" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb67-159"><a href="#cb67-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$dir</span>/chr<span class="va">$i</span>-telomere.afreq <span class="op">&gt;&gt;</span> <span class="va">$dir</span>/telomere-afreq</span>
<span id="cb67-160"><a href="#cb67-160" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb67-161"><a href="#cb67-161" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-162"><a href="#cb67-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-163"><a href="#cb67-163" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb67-164"><a href="#cb67-164" aria-hidden="true" tabindex="-1"></a><span class="co">#  Finalize the 10k SNP list of each side</span></span>
<span id="cb67-165"><a href="#cb67-165" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb67-166"><a href="#cb67-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-167"><a href="#cb67-167" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>10000</span>
<span id="cb67-168"><a href="#cb67-168" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>gen/geno-telomere.bim</span>
<span id="cb67-169"><a href="#cb67-169" aria-hidden="true" tabindex="-1"></a><span class="va">leftin</span><span class="op">=</span>inflation/gwas-telomere/left-snps-tmp</span>
<span id="cb67-170"><a href="#cb67-170" aria-hidden="true" tabindex="-1"></a><span class="va">rightin</span><span class="op">=</span>inflation/gwas-telomere/right-snps-tmp</span>
<span id="cb67-171"><a href="#cb67-171" aria-hidden="true" tabindex="-1"></a><span class="va">leftout</span><span class="op">=</span>inflation/gwas-telomere/left-snps</span>
<span id="cb67-172"><a href="#cb67-172" aria-hidden="true" tabindex="-1"></a><span class="va">rightout</span><span class="op">=</span>inflation/gwas-telomere/right-snps</span>
<span id="cb67-173"><a href="#cb67-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-174"><a href="#cb67-174" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}</span></span>
<span id="cb67-175"><a href="#cb67-175" aria-hidden="true" tabindex="-1"></a><span class="st">     ($2 in a){print $2}&#39;</span> <span class="va">$leftin</span> <span class="va">$snp</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-</span><span class="va">$m</span>  <span class="op">&gt;</span> <span class="va">$leftout</span></span>
<span id="cb67-176"><a href="#cb67-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-177"><a href="#cb67-177" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}</span></span>
<span id="cb67-178"><a href="#cb67-178" aria-hidden="true" tabindex="-1"></a><span class="st">     ($2 in a){print $2}&#39;</span> <span class="va">$rightin</span> <span class="va">$snp</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-</span><span class="va">$m</span>  <span class="op">&gt;</span> <span class="va">$rightout</span></span>
<span id="cb67-179"><a href="#cb67-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-180"><a href="#cb67-180" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb67-181"><a href="#cb67-181" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r^2_j</span></span>
<span id="cb67-182"><a href="#cb67-182" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb67-183"><a href="#cb67-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-184"><a href="#cb67-184" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/gwas-telomere/right-snps</span>
<span id="cb67-185"><a href="#cb67-185" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/gwas-telomere/left-snps</span>
<span id="cb67-186"><a href="#cb67-186" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-telomere</span>
<span id="cb67-187"><a href="#cb67-187" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/gwas-telomere/out/10k-snps</span>
<span id="cb67-188"><a href="#cb67-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-189"><a href="#cb67-189" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb67-190"><a href="#cb67-190" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb67-191"><a href="#cb67-191" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb67-192"><a href="#cb67-192" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 80G</span></span>
<span id="cb67-193"><a href="#cb67-193" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb67-194"><a href="#cb67-194" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb67-195"><a href="#cb67-195" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb67-196"><a href="#cb67-196" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb67-197"><a href="#cb67-197" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb67-198"><a href="#cb67-198" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb67-199"><a href="#cb67-199" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb67-200"><a href="#cb67-200" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-r-10k-snps</span>
<span id="cb67-201"><a href="#cb67-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-202"><a href="#cb67-202" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb67-203"><a href="#cb67-203" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-r-10k-snps <span class="op">&gt;</span>../job-records/calc-r-telomere</span>
<span id="cb67-204"><a href="#cb67-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-205"><a href="#cb67-205" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r_j^2 for each i-------------------------------------------------</span></span>
<span id="cb67-206"><a href="#cb67-206" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb67-207"><a href="#cb67-207" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb67-208"><a href="#cb67-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-209"><a href="#cb67-209" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span><span class="st">&quot;10k-snps&quot;</span></span>
<span id="cb67-210"><a href="#cb67-210" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/gwas-telomere/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.pairwise&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb67-211"><a href="#cb67-211" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/gwas-telomere/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsa&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb67-212"><a href="#cb67-212" aria-hidden="true" tabindex="-1"></a>                <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb67-213"><a href="#cb67-213" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/gwas-telomere/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsb&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb67-214"><a href="#cb67-214" aria-hidden="true" tabindex="-1"></a>                <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb67-215"><a href="#cb67-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-216"><a href="#cb67-216" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>dat[,-c<span class="kw">(</span><span class="ex">10001</span><span class="kw">)</span><span class="ex">]^2</span></span>
<span id="cb67-217"><a href="#cb67-217" aria-hidden="true" tabindex="-1"></a><span class="va">outb</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>listb<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,2,</span> mean<span class="kw">))</span></span>
<span id="cb67-218"><a href="#cb67-218" aria-hidden="true" tabindex="-1"></a><span class="va">outa</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>lista<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,1,</span> mean<span class="kw">))</span></span>
<span id="cb67-219"><a href="#cb67-219" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>rbind<span class="kw">(</span><span class="ex">outa,outb</span><span class="kw">)</span></span>
<span id="cb67-220"><a href="#cb67-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-221"><a href="#cb67-221" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;summary/ave-r2-&quot;</span><span class="ex">,nm,</span> <span class="st">&quot;-ukbb-telomere&quot;</span><span class="kw">)</span><span class="ex">,</span> col.names=F, row.names=F, quote=F<span class="kw">)</span>  </span></code></pre></div>
</div>
<div id="organize-data-1" class="section level3" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> organize data</h3>
<div class="sourceCode" id="cb68"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO CHECK THE FOLLOWING CODE</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-ukbb-telomere</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="va">rs</span><span class="op">=</span>doug/ukbb.ldsc</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-telomere/telomere-gwas-organized-hm3</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-telomere/telomere.out</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next}</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="st">      ($1 in a) {print $1, b[$1], $2}&#39;</span> <span class="va">$rs</span> <span class="va">$aver2</span> <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;snp rs chisq aver2&quot;} </span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR {a[$2]; b[$2]=$1; c[$2]=$3; next}</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="st">     ($4 in a) {print b[$4], $4, $5, c[$4] }&#39;</span> tmp/aver2.tmp <span class="va">$gwas</span>  <span class="op">&gt;</span> <span class="va">$out</span>  </span></code></pre></div>
</div>
<div id="chisq-aver2_j-1" class="section level3" number="10.2.3">
<h3><span class="header-section-number">10.2.3</span> chisq ~ aver2_j</h3>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="st">&quot;gwas-telomere/telomere.out&quot;</span>, <span class="at">col_names=</span>T)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate slope: chisq ~ aver2_j-----------------------------------------------</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="co"># make the plot---------------------------------------------------------------</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co"># bin a variable by quantile</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="co"># average chisq by bin values</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-by-aver2-bin-telomere.png&quot;</span>,</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>end<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave chisq&quot;</span>,</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylim=</span><span class="fu">c</span>(start,end),</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span><span class="st">&quot;&quot;</span>, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot ------------------------------------------------------------------</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a><span class="co">#cuts=c(&quot;cut.125&quot;,&quot;cut.25&quot;,&quot;cut.5&quot;)</span></span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>cuts<span class="ot">=</span><span class="st">&quot;cut.125&quot;</span></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>related<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;rel&quot;</span>,<span class="st">&quot;unrel&quot;</span>)</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cuts)){</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>  cut<span class="ot">=</span>cuts[j]</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot chisq ~ aver2 by rel for a given cutoff for relatedness</span></span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-by-aver2-bin-related-gwas-&quot;</span>,cut,<span class="st">&quot;.png&quot;</span>),</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>        trait<span class="ot">=</span>traits[i]</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">make_plot</span>(trait, cut)</span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="notesconcerns" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> notes/concerns</h2>
<ul>
<li>Telomere length GWAS:
<ul>
<li>The QC seems too rough so that some SNPs have multiple alleles.</li>
</ul></li>
</ul>
<!--chapter:end:04.5-inclusive-gwas.Rmd-->
</div>
</div>
<div id="related-individuals" class="section level1" number="11">
<h1><span class="header-section-number">11</span> related individuals</h1>
<div id="genotyped-snps" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> genotyped SNPs</h2>
<div id="aver2_j-2" class="section level3" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> aver2_j</h3>
<p>Previously we performed analyses on icd10 traits using related individuals. Here are relevant files:</p>
<ul>
<li><strong>bfile</strong>: gen/geno-rel: created using icd10/related.inds</li>
<li><strong>id lists</strong>:
<ul>
<li>56757 icd10/related.inds</li>
<li>56754 relatedness/cut.05.related: relatedness &gt;= 0.05.</li>
<li>56753 relatedness/cut.125.related</li>
<li>48197 relatedness/cut.25.related</li>
<li>18294 relatedness/cut.5.related</li>
</ul></li>
<li><strong>snp list</strong> after QC: gen/snps-rel-inds.use : 627,320 SNPs</li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create id lists &amp; snp lists</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># unrelated ids----------------------------------------------------------------</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># serve as control groups</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="va">n</span><span class="op">=</span><span class="va">(</span>56753 48197 18294<span class="va">)</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span><span class="va">(</span>cut.125 cut.25 cut.5<span class="va">)</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">0</span><span class="dt">..</span><span class="dv">2</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="ex">shuf</span> rand.100000 <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">${n</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> <span class="op">&gt;</span> white-unrel-rand-control-for-<span class="va">${nm</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># snp list----------------------------------------------------------------------</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="co"># common snps of related &amp; unrelated</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="va">unrel</span><span class="op">=</span>gen/snps-unrel-inds.use <span class="co"># 1,103,209</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="va">rel</span><span class="op">=</span>gen/snps-rel-inds.use <span class="co"># 627,320 SNPs</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR{a[$1];next} </span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="st">    ($1 in a) {print $1}&#39;</span> <span class="va">$unrel</span> <span class="va">$rel</span> <span class="op">&gt;</span> gen/common-unrel-rel-snps <span class="co"># 153,313</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="co"># lista &amp; listb</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="co"># this will be common for all id lists</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>10000</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gen/common-unrel-rel-snps</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>inflation/related/left-snps</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>inflation/related/right-snps</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;);</span></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&lt;8) print $1 }&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$left</span>  </span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;);</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&gt;=8) print $1 }&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$right</span></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r^2_j</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> nm <span class="kw">in</span> <span class="dt">{cut.125</span><span class="op">,</span><span class="dt">cut.25</span><span class="op">,</span><span class="dt">cut.5}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a><span class="co"># common snp lists</span></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/related/right-snps</span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/related/left-snps</span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a><span class="co"># related individuals</span></span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../relatedness/<span class="va">$nm</span>.related</span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-rel</span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/related/out/10k-snps-<span class="va">$nm</span>-rel</span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:10:0</span></span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-r-10k-snps-<span class="va">$nm</span>-rel</span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-63"><a href="#cb70-63" aria-hidden="true" tabindex="-1"></a><span class="co"># unrelated controls</span></span>
<span id="cb70-64"><a href="#cb70-64" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../white-unrel-rand-control-for-<span class="va">$nm</span></span>
<span id="cb70-65"><a href="#cb70-65" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-unrel</span>
<span id="cb70-66"><a href="#cb70-66" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/related/out/10k-snps-<span class="va">$nm</span>-unrel</span>
<span id="cb70-67"><a href="#cb70-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-68"><a href="#cb70-68" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb70-69"><a href="#cb70-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb70-70"><a href="#cb70-70" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb70-71"><a href="#cb70-71" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb70-72"><a href="#cb70-72" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb70-73"><a href="#cb70-73" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:10:0</span></span>
<span id="cb70-74"><a href="#cb70-74" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb70-75"><a href="#cb70-75" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb70-76"><a href="#cb70-76" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb70-77"><a href="#cb70-77" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb70-78"><a href="#cb70-78" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb70-79"><a href="#cb70-79" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb70-80"><a href="#cb70-80" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-r-10k-snps-<span class="va">$nm</span>-unrel</span>
<span id="cb70-81"><a href="#cb70-81" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb70-82"><a href="#cb70-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-83"><a href="#cb70-83" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb70-84"><a href="#cb70-84" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> nm <span class="kw">in</span> <span class="dt">{cut.125</span><span class="op">,</span><span class="dt">cut.25</span><span class="op">,</span><span class="dt">cut.5}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb70-85"><a href="#cb70-85" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-r-10k-snps-<span class="va">$nm</span>-rel</span>
<span id="cb70-86"><a href="#cb70-86" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-r-10k-snps-<span class="va">$nm</span>-unrel</span>
<span id="cb70-87"><a href="#cb70-87" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/calc-r-related</span>
<span id="cb70-88"><a href="#cb70-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-89"><a href="#cb70-89" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r_j^2 for each i-------------------------------------------------</span></span>
<span id="cb70-90"><a href="#cb70-90" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb70-91"><a href="#cb70-91" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb70-92"><a href="#cb70-92" aria-hidden="true" tabindex="-1"></a><span class="va">cut</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;cut.125&quot;</span><span class="ex">,</span><span class="st">&quot;cut.25&quot;</span><span class="ex">,</span><span class="st">&quot;cut.5&quot;</span><span class="kw">)</span></span>
<span id="cb70-93"><a href="#cb70-93" aria-hidden="true" tabindex="-1"></a><span class="va">rel</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;rel&quot;</span><span class="ex">,</span><span class="st">&quot;unrel&quot;</span><span class="kw">)</span></span>
<span id="cb70-94"><a href="#cb70-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-95"><a href="#cb70-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">j</span> in 1:length<span class="er">(</span><span class="ex">rel</span><span class="kw">)){</span></span>
<span id="cb70-96"><a href="#cb70-96" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="fu">cut</span><span class="kw">)){</span></span>
<span id="cb70-97"><a href="#cb70-97" aria-hidden="true" tabindex="-1"></a>    <span class="va">nm</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;10k-snps-&quot;</span><span class="ex">,cut[i],</span><span class="st">&quot;-&quot;</span><span class="ex">,rel[j]</span><span class="kw">)</span></span>
<span id="cb70-98"><a href="#cb70-98" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/related/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.pairwise&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb70-99"><a href="#cb70-99" aria-hidden="true" tabindex="-1"></a>    <span class="va">lista</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/related/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsa&quot;</span><span class="kw">)</span><span class="ex">,</span> stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb70-100"><a href="#cb70-100" aria-hidden="true" tabindex="-1"></a>    <span class="va">listb</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/related/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsb&quot;</span><span class="kw">)</span><span class="ex">,</span> stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb70-101"><a href="#cb70-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-102"><a href="#cb70-102" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>dat[,-c<span class="kw">(</span><span class="ex">10001</span><span class="kw">)</span><span class="ex">]^2</span></span>
<span id="cb70-103"><a href="#cb70-103" aria-hidden="true" tabindex="-1"></a>    <span class="va">outb</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>listb<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,2,</span> mean<span class="kw">))</span></span>
<span id="cb70-104"><a href="#cb70-104" aria-hidden="true" tabindex="-1"></a>    <span class="va">outa</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>lista<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,1,</span> mean<span class="kw">))</span></span>
<span id="cb70-105"><a href="#cb70-105" aria-hidden="true" tabindex="-1"></a>    <span class="va">out</span><span class="op">=</span>rbind<span class="kw">(</span><span class="ex">outa,outb</span><span class="kw">)</span></span>
<span id="cb70-106"><a href="#cb70-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-107"><a href="#cb70-107" aria-hidden="true" tabindex="-1"></a>    <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;summary/ave-r2-&quot;</span><span class="ex">,nm</span><span class="kw">)</span><span class="ex">,</span> col.names=F, row.names=F, quote=F<span class="kw">)</span>  </span>
<span id="cb70-108"><a href="#cb70-108" aria-hidden="true" tabindex="-1"></a>  <span class="kw">}</span></span>
<span id="cb70-109"><a href="#cb70-109" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb70-110"><a href="#cb70-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-111"><a href="#cb70-111" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb70-112"><a href="#cb70-112" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb70-113"><a href="#cb70-113" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb70-114"><a href="#cb70-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-115"><a href="#cb70-115" aria-hidden="true" tabindex="-1"></a><span class="co"># check if mean r^2_j differs for rel vs. unrel</span></span>
<span id="cb70-116"><a href="#cb70-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-117"><a href="#cb70-117" aria-hidden="true" tabindex="-1"></a><span class="va">cut</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;cut.125&quot;</span><span class="ex">,</span><span class="st">&quot;cut.25&quot;</span><span class="ex">,</span><span class="st">&quot;cut.5&quot;</span><span class="kw">)</span></span>
<span id="cb70-118"><a href="#cb70-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-119"><a href="#cb70-119" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="fu">cut</span><span class="kw">)){</span></span>
<span id="cb70-120"><a href="#cb70-120" aria-hidden="true" tabindex="-1"></a>    <span class="va">nm_rel</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;ave-r2-10k-snps-&quot;</span><span class="ex">,cut[i],</span><span class="st">&quot;-rel&quot;</span><span class="kw">)</span></span>
<span id="cb70-121"><a href="#cb70-121" aria-hidden="true" tabindex="-1"></a>    <span class="va">nm_unrel</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;ave-r2-10k-snps-&quot;</span><span class="ex">,cut[i],</span><span class="st">&quot;-unrel&quot;</span><span class="kw">)</span></span>
<span id="cb70-122"><a href="#cb70-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-123"><a href="#cb70-123" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat_rel</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/&quot;</span><span class="ex">,nm_rel</span><span class="kw">)</span><span class="ex">,stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb70-124"><a href="#cb70-124" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat_unrel</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/&quot;</span><span class="ex">,nm_unrel</span><span class="kw">)</span><span class="ex">,stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb70-125"><a href="#cb70-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-126"><a href="#cb70-126" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">rel</span><span class="op">=</span>cut[i],</span>
<span id="cb70-127"><a href="#cb70-127" aria-hidden="true" tabindex="-1"></a>                    <span class="va">rel_ave</span><span class="op">=</span>mean<span class="kw">(</span><span class="ex">dat_rel</span><span class="va">$V2</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb70-128"><a href="#cb70-128" aria-hidden="true" tabindex="-1"></a>                    <span class="va">rel_sd</span><span class="op">=</span>sd<span class="kw">(</span><span class="ex">dat_rel</span><span class="va">$V2</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb70-129"><a href="#cb70-129" aria-hidden="true" tabindex="-1"></a>                    <span class="va">unrel_ave</span><span class="op">=</span>mean<span class="kw">(</span><span class="ex">dat_unrel</span><span class="va">$V2</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb70-130"><a href="#cb70-130" aria-hidden="true" tabindex="-1"></a>                    <span class="va">unrel_sd</span><span class="op">=</span>sd<span class="kw">(</span><span class="ex">dat_unrel</span><span class="va">$V2</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb70-131"><a href="#cb70-131" aria-hidden="true" tabindex="-1"></a>                    <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb70-132"><a href="#cb70-132" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out1=out0}else</span><span class="dt">{out1=rbind(out1</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb70-133"><a href="#cb70-133" aria-hidden="true" tabindex="-1"></a>  <span class="kw">}</span></span></code></pre></div>
</div>
<div id="gwas-2" class="section level3" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> gwas</h3>
<div class="sourceCode" id="cb71"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create directories------------------------------------------------------------</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{cut.125</span><span class="op">,</span><span class="dt">cut.25</span><span class="op">,</span><span class="dt">cut.5}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{rel</span><span class="op">,</span><span class="dt">unrel}</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-<span class="va">$j</span>-<span class="va">$i</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co"># gwas -------------------------------------------------------------------------</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{cut.125</span><span class="op">,</span><span class="dt">cut.25</span><span class="op">,</span><span class="dt">cut.5}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="co"># related individuals----------------------</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../gwas-<span class="va">$j</span>-rel/<span class="va">$i</span>-linear</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../relatedness/<span class="va">$j</span>.related</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>../gen/snps-rel-inds.use</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-rel</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 8:0:0</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract </span><span class="va">$snp</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-<span class="va">$j</span>-rel.sh</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a><span class="co"># unrelated individuals----------------------</span></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../gwas-<span class="va">$j</span>-unrel/<span class="va">$i</span>-linear</span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../white-unrel-rand-control-for-<span class="va">$j</span></span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>../gen/snps-unrel-inds.use</span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-unrel</span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb71-44"><a href="#cb71-44" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 8:0:0</span></span>
<span id="cb71-45"><a href="#cb71-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-46"><a href="#cb71-46" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb71-47"><a href="#cb71-47" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb71-48"><a href="#cb71-48" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb71-49"><a href="#cb71-49" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb71-50"><a href="#cb71-50" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract </span><span class="va">$snp</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb71-51"><a href="#cb71-51" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb71-52"><a href="#cb71-52" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb71-53"><a href="#cb71-53" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-<span class="va">$j</span>-unrel.sh</span>
<span id="cb71-54"><a href="#cb71-54" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb71-55"><a href="#cb71-55" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb71-56"><a href="#cb71-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-57"><a href="#cb71-57" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb71-58"><a href="#cb71-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{cut.125</span><span class="op">,</span><span class="dt">cut.25</span><span class="op">,</span><span class="dt">cut.5}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb71-59"><a href="#cb71-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb71-60"><a href="#cb71-60" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-<span class="va">$j</span>-rel.sh</span>
<span id="cb71-61"><a href="#cb71-61" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-<span class="va">$j</span>-unrel.sh</span>
<span id="cb71-62"><a href="#cb71-62" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb71-63"><a href="#cb71-63" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-related</span>
<span id="cb71-64"><a href="#cb71-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-65"><a href="#cb71-65" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion</span></span>
<span id="cb71-66"><a href="#cb71-66" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/gwas-related</span>
<span id="cb71-67"><a href="#cb71-67" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb71-68"><a href="#cb71-68" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb71-69"><a href="#cb71-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb71-70"><a href="#cb71-70" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb71-71"><a href="#cb71-71" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb71-72"><a href="#cb71-72" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb71-73"><a href="#cb71-73" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb71-74"><a href="#cb71-74" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb71-75"><a href="#cb71-75" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb71-76"><a href="#cb71-76" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb71-77"><a href="#cb71-77" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb71-78"><a href="#cb71-78" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb71-79"><a href="#cb71-79" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb71-80"><a href="#cb71-80" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb71-81"><a href="#cb71-81" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb71-82"><a href="#cb71-82" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="organize-data-2" class="section level3" number="11.1.3">
<h3><span class="header-section-number">11.1.3</span> organize data</h3>
<div class="sourceCode" id="cb72"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># compute MAF</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{cut.125</span><span class="op">,</span><span class="dt">cut.25</span><span class="op">,</span><span class="dt">cut.5}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{rel</span><span class="op">,</span><span class="dt">unrel}</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../gen/maf/geno-<span class="va">$j</span>-<span class="va">$i</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$i</span> <span class="ot">==</span> rel <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">bfile</span><span class="op">=</span>../gen/geno-rel</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../relatedness/<span class="va">$j</span>.related</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="va">bfile</span><span class="op">=</span>../gen/geno-unrel</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../white-unrel-rand-control-for-<span class="va">$j</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-stats </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/calc-maf-<span class="va">$j</span>-<span class="va">$i</span>.sh</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{cut.125</span><span class="op">,</span><span class="dt">cut.25</span><span class="op">,</span><span class="dt">cut.5}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{rel</span><span class="op">,</span><span class="dt">unrel}</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-maf-<span class="va">$j</span>-<span class="va">$i</span>.sh</span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/calc-maf-rel</span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a><span class="co"># extract LD scores</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a><span class="co"># we do this for related individuals.</span></span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a><span class="co"># ld scores of snp list for unrelated id: snps-unrel-maf.001.ldscore </span></span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a><span class="co"># convert snp list to rs system ------------------------------------------------</span></span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gen/snps-rel-inds.use</span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>gen/snps-rel-rs</span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1]; b[$1]=$2; next}</span></span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a><span class="st">     ($1 in a){print b[$1], $2}&#39;</span> doug/ukbb.ldsc <span class="va">$infile</span> <span class="op">&gt;</span> <span class="va">$outfile</span></span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a><span class="co">#  extract ld scores -----------------------------------------------------------</span></span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>ldsc/eur_w_ld_chr</span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chrom <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a><span class="fu">zcat</span> <span class="va">$dir</span>/<span class="va">$chrom</span>.l2.ldscore.gz <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $2, $6}&#39;</span> <span class="op">&gt;</span> ldscore</span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}($1 in a){print $0}&#39;</span> gen/snps-rel-rs ldscore <span class="op">&gt;</span> temp</span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$chrom</span> <span class="ot">-eq</span> 1 <span class="bu">]</span></span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a><span class="cf">then</span> </span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a> <span class="fu">mv</span> temp snps-rel.ldscore</span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a> <span class="fu">cat</span> snps-rel.ldscore temp <span class="op">&gt;</span> temp2</span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a> <span class="fu">mv</span> temp2 snps-rel.ldscore</span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$chrom</span></span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a><span class="co">#  put info together</span></span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a><span class="co"># maf: gen/maf/geno-[cut.125]-[rel]</span></span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a><span class="co"># chi square : gwas-[cut.125]-[rel]/[trait]-linear.summaries</span></span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a><span class="co"># ave r^2_j: summary/ave-r2-10k-snps-[cut.25]-[unrel]</span></span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a><span class="co"># ld score from ldsc ref panel: snps-unrel-maf.001.ldscore; snps-rel.ldscore</span></span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed file</span></span>
<span id="cb72-78"><a href="#cb72-78" aria-hidden="true" tabindex="-1"></a><span class="va">rs</span><span class="op">=</span>doug/ukbb.ldsc</span>
<span id="cb72-79"><a href="#cb72-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-80"><a href="#cb72-80" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{cut.125</span><span class="op">,</span><span class="dt">cut.25</span><span class="op">,</span><span class="dt">cut.5}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb72-81"><a href="#cb72-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{rel</span><span class="op">,</span><span class="dt">unrel}</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb72-82"><a href="#cb72-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-83"><a href="#cb72-83" aria-hidden="true" tabindex="-1"></a><span class="co"># files vary depending on j &amp;/or  i</span></span>
<span id="cb72-84"><a href="#cb72-84" aria-hidden="true" tabindex="-1"></a><span class="va">maf</span><span class="op">=</span>gen/maf/geno-<span class="va">$j</span>-<span class="va">$i</span>.stats <span class="co"># use as the snp list to integrate all info</span></span>
<span id="cb72-85"><a href="#cb72-85" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-<span class="va">$j</span>-<span class="va">$i</span></span>
<span id="cb72-86"><a href="#cb72-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-87"><a href="#cb72-87" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$i</span> <span class="ot">==</span> rel <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb72-88"><a href="#cb72-88" aria-hidden="true" tabindex="-1"></a>  <span class="va">ldsc</span><span class="op">=</span>snps-rel.ldscore</span>
<span id="cb72-89"><a href="#cb72-89" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb72-90"><a href="#cb72-90" aria-hidden="true" tabindex="-1"></a>  <span class="va">ldsc</span><span class="op">=</span>snps-unrel-maf.001.ldscore</span>
<span id="cb72-91"><a href="#cb72-91" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb72-92"><a href="#cb72-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-93"><a href="#cb72-93" aria-hidden="true" tabindex="-1"></a><span class="co"># create temporary files</span></span>
<span id="cb72-94"><a href="#cb72-94" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR &gt; 1 {print $1, $5 }&#39;</span> <span class="va">$maf</span> <span class="op">&gt;</span> tmp/maf.tmp</span>
<span id="cb72-95"><a href="#cb72-95" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$2]; b[$2]=$1; next} ($1 in a) {print b[$1], $0}&#39;</span> <span class="va">$rs</span> <span class="va">$ldsc</span> <span class="op">&gt;</span> tmp/ldsc.tmp1</span>
<span id="cb72-96"><a href="#cb72-96" aria-hidden="true" tabindex="-1"></a><span class="co"># here we make sure the order of the rows are the same as maf.tmp</span></span>
<span id="cb72-97"><a href="#cb72-97" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; c[$1]=$3 ; next} </span></span>
<span id="cb72-98"><a href="#cb72-98" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1], c[$1];</span></span>
<span id="cb72-99"><a href="#cb72-99" aria-hidden="true" tabindex="-1"></a><span class="st">      else print &quot;NA&quot;}&#39;</span> tmp/ldsc.tmp1 tmp/maf.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb72-100"><a href="#cb72-100" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb72-101"><a href="#cb72-101" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb72-102"><a href="#cb72-102" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/maf.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb72-103"><a href="#cb72-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-104"><a href="#cb72-104" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb72-105"><a href="#cb72-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-106"><a href="#cb72-106" aria-hidden="true" tabindex="-1"></a><span class="co"># files vary with j, i and trait</span></span>
<span id="cb72-107"><a href="#cb72-107" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-<span class="va">$j</span>-<span class="va">$i</span>/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb72-108"><a href="#cb72-108" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-related-all-out/<span class="va">$trait</span>-<span class="va">$j</span>-<span class="va">$i</span>.out</span>
<span id="cb72-109"><a href="#cb72-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-110"><a href="#cb72-110" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$5; next} </span></span>
<span id="cb72-111"><a href="#cb72-111" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb72-112"><a href="#cb72-112" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$gwas</span> tmp/maf.tmp <span class="op">&gt;</span> tmp/gwas.tmp     </span>
<span id="cb72-113"><a href="#cb72-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-114"><a href="#cb72-114" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb72-115"><a href="#cb72-115" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/maf.tmp <span class="dt">\</span></span>
<span id="cb72-116"><a href="#cb72-116" aria-hidden="true" tabindex="-1"></a>      tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb72-117"><a href="#cb72-117" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb72-118"><a href="#cb72-118" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb72-119"><a href="#cb72-119" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb72-120"><a href="#cb72-120" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;maf;chisq;aver2;rs;ldsc&quot;}</span></span>
<span id="cb72-121"><a href="#cb72-121" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb72-122"><a href="#cb72-122" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb72-123"><a href="#cb72-123" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb72-124"><a href="#cb72-124" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="summary-9" class="section level3" number="11.1.4">
<h3><span class="header-section-number">11.1.4</span> summary</h3>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate slope: chisq ~ aver2_j</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co">#cuts=c(&quot;cut.125&quot;,&quot;cut.25&quot;,&quot;cut.5&quot;)</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>cuts<span class="ot">=</span><span class="st">&quot;cut.125&quot;</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>related<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;rel&quot;</span>,<span class="st">&quot;unrel&quot;</span>)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(related)){</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cuts)){</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>    rel<span class="ot">=</span>related[i]</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>    cut<span class="ot">=</span>cuts[j]</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[k]</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>    file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-related-all-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,cut,</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;-&quot;</span>,rel,<span class="st">&quot;.out&quot;</span>)</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat)</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>    slope0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cutoff=</span>cut,</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel=</span>rel,</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">slope_aver2=</span><span class="fu">coef</span>(mod)[<span class="dv">2</span>],</span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">p_aver2=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> k<span class="sc">==</span><span class="dv">1</span>){slope<span class="ot">=</span>slope0} <span class="cf">else</span> {slope<span class="ot">=</span><span class="fu">rbind</span>(slope,slope0)}</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span>slope[<span class="fu">order</span>(slope<span class="sc">$</span>trait, slope<span class="sc">$</span>cutoff, slope<span class="sc">$</span>rel),]</span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a><span class="co">#write.table(out,&quot;summary/chisq-aver2-slope-gwas-related.txt&quot;, </span></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a><span class="co">#            col.names=T, row.names=F, quote=F)</span></span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2_j  by rel | cut</span></span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a><span class="co"># function to plot a single trait---------------------------------------------------</span></span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a>make_plot<span class="ot">=</span><span class="cf">function</span>(trait, cut){</span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define variables</span></span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a>  cut<span class="ot">=</span>cut</span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>trait</span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define color</span></span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(RColorBrewer)</span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a>  qual_col_pals <span class="ot">=</span> brewer.pal.info[brewer.pal.info<span class="sc">$</span>category <span class="sc">==</span> <span class="st">&#39;qual&#39;</span>,]</span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a>  col_vector <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">mapply</span>(brewer.pal, qual_col_pals<span class="sc">$</span>maxcolors, <span class="fu">rownames</span>(qual_col_pals)))</span>
<span id="cb73-63"><a href="#cb73-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb73-64"><a href="#cb73-64" aria-hidden="true" tabindex="-1"></a>  mycol<span class="ot">=</span><span class="fu">sample</span>(col_vector,<span class="dv">2</span>)</span>
<span id="cb73-65"><a href="#cb73-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-66"><a href="#cb73-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># related </span></span>
<span id="cb73-67"><a href="#cb73-67" aria-hidden="true" tabindex="-1"></a>    file1<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-related-all-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,cut,<span class="st">&quot;-rel.out&quot;</span>)</span>
<span id="cb73-68"><a href="#cb73-68" aria-hidden="true" tabindex="-1"></a>    dat1<span class="ot">=</span><span class="fu">vroom</span>(file1, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb73-69"><a href="#cb73-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bin a variable by quantile</span></span>
<span id="cb73-70"><a href="#cb73-70" aria-hidden="true" tabindex="-1"></a>    cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat1<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb73-71"><a href="#cb73-71" aria-hidden="true" tabindex="-1"></a>    dat1<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat1<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb73-72"><a href="#cb73-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># average chisq by bin values</span></span>
<span id="cb73-73"><a href="#cb73-73" aria-hidden="true" tabindex="-1"></a>    out1<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat1<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat1<span class="sc">$</span>bin, mean))</span>
<span id="cb73-74"><a href="#cb73-74" aria-hidden="true" tabindex="-1"></a>    out1<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat1<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat1<span class="sc">$</span>bin, mean)</span>
<span id="cb73-75"><a href="#cb73-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-76"><a href="#cb73-76" aria-hidden="true" tabindex="-1"></a>   <span class="co"># unrelated </span></span>
<span id="cb73-77"><a href="#cb73-77" aria-hidden="true" tabindex="-1"></a>    file2<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-related-all-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,cut,<span class="st">&quot;-unrel.out&quot;</span>)</span>
<span id="cb73-78"><a href="#cb73-78" aria-hidden="true" tabindex="-1"></a>    dat2<span class="ot">=</span><span class="fu">vroom</span>(file2, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb73-79"><a href="#cb73-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bin a variable by quantile</span></span>
<span id="cb73-80"><a href="#cb73-80" aria-hidden="true" tabindex="-1"></a>    cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat2<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb73-81"><a href="#cb73-81" aria-hidden="true" tabindex="-1"></a>    dat2<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat2<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb73-82"><a href="#cb73-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># average chisq by bin values</span></span>
<span id="cb73-83"><a href="#cb73-83" aria-hidden="true" tabindex="-1"></a>    out2<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat2<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat2<span class="sc">$</span>bin, mean))</span>
<span id="cb73-84"><a href="#cb73-84" aria-hidden="true" tabindex="-1"></a>    out2<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat2<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat2<span class="sc">$</span>bin, mean)  </span>
<span id="cb73-85"><a href="#cb73-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-86"><a href="#cb73-86" aria-hidden="true" tabindex="-1"></a>    xstart<span class="ot">=</span><span class="fu">min</span>(out1<span class="sc">$</span>bin_val,out2<span class="sc">$</span>bin_val)</span>
<span id="cb73-87"><a href="#cb73-87" aria-hidden="true" tabindex="-1"></a>    xend<span class="ot">=</span><span class="fu">max</span>(out1<span class="sc">$</span>bin_val,out2<span class="sc">$</span>bin_val)</span>
<span id="cb73-88"><a href="#cb73-88" aria-hidden="true" tabindex="-1"></a>    ystart<span class="ot">=</span><span class="fu">min</span>(out1<span class="sc">$</span>chisq_ave,out2<span class="sc">$</span>chisq_ave)</span>
<span id="cb73-89"><a href="#cb73-89" aria-hidden="true" tabindex="-1"></a>    yend<span class="ot">=</span><span class="fu">max</span>(out1<span class="sc">$</span>chisq_ave,out2<span class="sc">$</span>chisq_ave)</span>
<span id="cb73-90"><a href="#cb73-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-91"><a href="#cb73-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(out1<span class="sc">$</span>bin_val, out1<span class="sc">$</span>chisq_ave,</span>
<span id="cb73-92"><a href="#cb73-92" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave chisq&quot;</span>,</span>
<span id="cb73-93"><a href="#cb73-93" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlim=</span><span class="fu">c</span>(xstart,xend), <span class="at">ylim=</span><span class="fu">c</span>(ystart,yend),</span>
<span id="cb73-94"><a href="#cb73-94" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span><span class="fu">paste0</span>(trait,<span class="st">&quot; &quot;</span>, cut), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb73-95"><a href="#cb73-95" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span>mycol[<span class="dv">1</span>], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb73-96"><a href="#cb73-96" aria-hidden="true" tabindex="-1"></a>      <span class="fu">points</span>(out2<span class="sc">$</span>bin_val, out2<span class="sc">$</span>chisq_ave,</span>
<span id="cb73-97"><a href="#cb73-97" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span>mycol[<span class="dv">2</span>], <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb73-98"><a href="#cb73-98" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(trait<span class="sc">==</span><span class="st">&quot;awake&quot;</span>){</span>
<span id="cb73-99"><a href="#cb73-99" aria-hidden="true" tabindex="-1"></a>     <span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;rel&quot;</span>,<span class="st">&quot;unrel&quot;</span>), </span>
<span id="cb73-100"><a href="#cb73-100" aria-hidden="true" tabindex="-1"></a>            <span class="at">col=</span>mycol, <span class="at">cex=</span><span class="fl">1.5</span>, <span class="at">box.lty=</span><span class="dv">0</span>)}</span>
<span id="cb73-101"><a href="#cb73-101" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb73-102"><a href="#cb73-102" aria-hidden="true" tabindex="-1"></a>} <span class="co"># end of function</span></span>
<span id="cb73-103"><a href="#cb73-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-104"><a href="#cb73-104" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot ------------------------------------------------------------------</span></span>
<span id="cb73-105"><a href="#cb73-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-106"><a href="#cb73-106" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb73-107"><a href="#cb73-107" aria-hidden="true" tabindex="-1"></a>cuts<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;cut.125&quot;</span>,<span class="st">&quot;cut.25&quot;</span>,<span class="st">&quot;cut.5&quot;</span>)</span>
<span id="cb73-108"><a href="#cb73-108" aria-hidden="true" tabindex="-1"></a>related<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;rel&quot;</span>,<span class="st">&quot;unrel&quot;</span>)</span>
<span id="cb73-109"><a href="#cb73-109" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb73-110"><a href="#cb73-110" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb73-111"><a href="#cb73-111" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb73-112"><a href="#cb73-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-113"><a href="#cb73-113" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cuts)){</span>
<span id="cb73-114"><a href="#cb73-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-115"><a href="#cb73-115" aria-hidden="true" tabindex="-1"></a>  cut<span class="ot">=</span>cuts[j]</span>
<span id="cb73-116"><a href="#cb73-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot chisq ~ aver2 by rel for a given cutoff for relatedness</span></span>
<span id="cb73-117"><a href="#cb73-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-by-aver2-bin-related-gwas-&quot;</span>,cut,<span class="st">&quot;.png&quot;</span>),</span>
<span id="cb73-118"><a href="#cb73-118" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb73-119"><a href="#cb73-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb73-120"><a href="#cb73-120" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb73-121"><a href="#cb73-121" aria-hidden="true" tabindex="-1"></a>        trait<span class="ot">=</span>traits[i]</span>
<span id="cb73-122"><a href="#cb73-122" aria-hidden="true" tabindex="-1"></a>        <span class="fu">make_plot</span>(trait, cut)</span>
<span id="cb73-123"><a href="#cb73-123" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb73-124"><a href="#cb73-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb73-125"><a href="#cb73-125" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="hapmap3-snps" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> hapmap3 SNPs</h2>
<div id="genotype-data" class="section level3" number="11.2.1">
<h3><span class="header-section-number">11.2.1</span> genotype data</h3>
<div class="sourceCode" id="cb74"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make bfiles by chromosome</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::::</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../icd10/related.inds </span><span class="dt">\</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract ../doug/ukbb.ldsc </span><span class="dt">\</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="st">         --hwe 0.0001 </span><span class="dt">\</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="st">         --hard-call-threshold .05 </span><span class="dt">\</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="st">         --mach-r2-filter 0.8 2 </span><span class="dt">\</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="st">         --make-bed </span><span class="dt">\</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/tmp/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3 </span><span class="dt">\</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/chr<span class="va">$i</span>.sh</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/mkbfile-related</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion</span></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/mkbfile-related</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb74-49"><a href="#cb74-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-50"><a href="#cb74-50" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::</span></span>
<span id="cb74-51"><a href="#cb74-51" aria-hidden="true" tabindex="-1"></a><span class="co"># merge bfiles </span></span>
<span id="cb74-52"><a href="#cb74-52" aria-hidden="true" tabindex="-1"></a><span class="co">#::::</span></span>
<span id="cb74-53"><a href="#cb74-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-54"><a href="#cb74-54" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> bfile.list</span>
<span id="cb74-55"><a href="#cb74-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb74-56"><a href="#cb74-56" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span>  <span class="st">&quot;../gen/tmp/bhr</span><span class="va">$j</span><span class="st">&quot;</span> <span class="op">&gt;&gt;</span>bfile.list</span>
<span id="cb74-57"><a href="#cb74-57" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb74-58"><a href="#cb74-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-59"><a href="#cb74-59" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb74-60"><a href="#cb74-60" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb74-61"><a href="#cb74-61" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb74-62"><a href="#cb74-62" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb74-63"><a href="#cb74-63" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb74-64"><a href="#cb74-64" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 40:0:0</span></span>
<span id="cb74-65"><a href="#cb74-65" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --make-bed ../gen/geno-rel-hmp3 </span><span class="dt">\</span></span>
<span id="cb74-66"><a href="#cb74-66" aria-hidden="true" tabindex="-1"></a><span class="st">          --mbfile ../gen/bfile.list </span><span class="dt">\</span></span>
<span id="cb74-67"><a href="#cb74-67" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb74-68"><a href="#cb74-68" aria-hidden="true" tabindex="-1"></a><span class="st">          --exclude-dups YES  </span></span>
<span id="cb74-69"><a href="#cb74-69" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/mbfile.sh</span>
<span id="cb74-70"><a href="#cb74-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-71"><a href="#cb74-71" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the script</span></span>
<span id="cb74-72"><a href="#cb74-72" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/mbfile.sh <span class="op">&gt;</span>../job-records/mbfiles-related</span>
<span id="cb74-73"><a href="#cb74-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-74"><a href="#cb74-74" aria-hidden="true" tabindex="-1"></a><span class="co"># snp list --------------------------------------------------------------------</span></span>
<span id="cb74-75"><a href="#cb74-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-76"><a href="#cb74-76" aria-hidden="true" tabindex="-1"></a><span class="co"># MAF &amp; call-rate </span></span>
<span id="cb74-77"><a href="#cb74-77" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> gen/geno-rel-hmp3.stats <span class="st">&#39;($5&gt;.01 &amp;&amp; $6&gt;=0.95 &amp;&amp; NR&gt;1){print $1}&#39;</span> <span class="op">&gt;</span> gen/snps-rel-hmp3.use</span>
<span id="cb74-78"><a href="#cb74-78" aria-hidden="true" tabindex="-1"></a><span class="co"># m = 1,105,446 SNPs</span></span></code></pre></div>
</div>
<div id="gwas-3" class="section level3" number="11.2.2">
<h3><span class="header-section-number">11.2.2</span> gwas</h3>
<div class="sourceCode" id="cb75"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># script ----------------------------------------------------------------------</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co">#for j in {cut.125,cut.25,cut.5}; do</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="va">j</span><span class="op">=</span>cut.125</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chr <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../relatedness/<span class="va">$j</span>.related</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>../gen/snps-rel-hmp3.use</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-rel-hmp3</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../gwas-<span class="va">$j</span>-rel/<span class="va">$i</span>-linear-<span class="va">$chr</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 8:0:0</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract </span><span class="va">$snp</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$chr</span></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-<span class="va">$j</span>-rel-chr-<span class="va">$chr</span>.sh</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a><span class="co">#done</span></span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs-------------------------------------------------------------------</span></span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a><span class="va">j</span><span class="op">=</span>cut.125</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chr <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a><span class="co">#for j in {cut.125,cut.25,cut.5}; do</span></span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-<span class="va">$j</span>-rel-chr-<span class="va">$chr</span>.sh</span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a><span class="co">#sbatch -A snpher ../sh_script/$i-linear-$j-unrel.sh</span></span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-related</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/gwas-related</span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb75-52"><a href="#cb75-52" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb75-53"><a href="#cb75-53" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb75-56"><a href="#cb75-56" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb75-57"><a href="#cb75-57" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb75-58"><a href="#cb75-58" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb75-59"><a href="#cb75-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-60"><a href="#cb75-60" aria-hidden="true" tabindex="-1"></a><span class="co"># merge files-------------------------------------------------------------------</span></span>
<span id="cb75-61"><a href="#cb75-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-62"><a href="#cb75-62" aria-hidden="true" tabindex="-1"></a><span class="co"># only do .summaries &amp; .pvalues</span></span>
<span id="cb75-63"><a href="#cb75-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb75-64"><a href="#cb75-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb75-65"><a href="#cb75-65" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$j</span> <span class="ot">==</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb75-66"><a href="#cb75-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-<span class="va">$j</span>.summaries <span class="op">&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb75-67"><a href="#cb75-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-<span class="va">$j</span>.pvalues <span class="op">&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb75-68"><a href="#cb75-68" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> </span>
<span id="cb75-69"><a href="#cb75-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-<span class="va">$j</span>.summaries <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb75-70"><a href="#cb75-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-<span class="va">$j</span>.pvalues <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb75-71"><a href="#cb75-71" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb75-72"><a href="#cb75-72" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb75-73"><a href="#cb75-73" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="aver2_j-3" class="section level3" number="11.2.3">
<h3><span class="header-section-number">11.2.3</span> aver2_j</h3>
<div class="sourceCode" id="cb76"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  snp lists</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># snp list----------------------------------------------------------------------</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co"># common snps of related &amp; unrelated</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="va">unrel</span><span class="op">=</span>gen/snps-unrel-inds.use <span class="co"># 1,103,209</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="va">rel</span><span class="op">=</span>gen/snps-rel-hmp3.use <span class="co"># 1,105,446 SNPs</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR{a[$1];next} </span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="st">    ($1 in a) {print $1}&#39;</span> <span class="va">$unrel</span> <span class="va">$rel</span> <span class="op">&gt;</span> gen/common-unrel-rel-snps <span class="co"># 1,101,844</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="co"># lista &amp; listb</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co"># this will be common for all id lists</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>10000</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gen/common-unrel-rel-snps</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>inflation/related/left-snps</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>inflation/related/right-snps</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;);</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&lt;8) print $1 }&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$left</span>  </span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;);</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&gt;=8) print $1 }&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$right</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r^2_j</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a><span class="co">#for nm in {cut.125,cut.25,cut.5}; do</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>cut.125</span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a><span class="co"># common snp lists</span></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/related/right-snps</span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/related/left-snps</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a><span class="co"># related individuals</span></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../relatedness/<span class="va">$nm</span>.related</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-rel-hmp3</span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/related/out/10k-snps-<span class="va">$nm</span>-rel</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:10:0</span></span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-r-10k-snps-<span class="va">$nm</span>-rel</span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true" tabindex="-1"></a><span class="co"># unrelated controls</span></span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../white-unrel-rand-control-for-<span class="va">$nm</span></span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-unrel</span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/related/out/10k-snps-<span class="va">$nm</span>-unrel</span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-59"><a href="#cb76-59" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb76-60"><a href="#cb76-60" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb76-61"><a href="#cb76-61" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb76-62"><a href="#cb76-62" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb76-63"><a href="#cb76-63" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb76-64"><a href="#cb76-64" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:10:0</span></span>
<span id="cb76-65"><a href="#cb76-65" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb76-66"><a href="#cb76-66" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb76-67"><a href="#cb76-67" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb76-68"><a href="#cb76-68" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb76-69"><a href="#cb76-69" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb76-70"><a href="#cb76-70" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb76-71"><a href="#cb76-71" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-r-10k-snps-<span class="va">$nm</span>-unrel</span>
<span id="cb76-72"><a href="#cb76-72" aria-hidden="true" tabindex="-1"></a><span class="co">#done</span></span>
<span id="cb76-73"><a href="#cb76-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-74"><a href="#cb76-74" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb76-75"><a href="#cb76-75" aria-hidden="true" tabindex="-1"></a><span class="co">#for nm in {cut.125,cut.25,cut.5}; do</span></span>
<span id="cb76-76"><a href="#cb76-76" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> nm <span class="kw">in</span> cut.125<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb76-77"><a href="#cb76-77" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-r-10k-snps-<span class="va">$nm</span>-rel</span>
<span id="cb76-78"><a href="#cb76-78" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-r-10k-snps-<span class="va">$nm</span>-unrel</span>
<span id="cb76-79"><a href="#cb76-79" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/calc-r-related</span>
<span id="cb76-80"><a href="#cb76-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-81"><a href="#cb76-81" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r_j^2 for each i-------------------------------------------------</span></span>
<span id="cb76-82"><a href="#cb76-82" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb76-83"><a href="#cb76-83" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb76-84"><a href="#cb76-84" aria-hidden="true" tabindex="-1"></a><span class="co">#cut=c(&quot;cut.125&quot;,&quot;cut.25&quot;,&quot;cut.5&quot;)</span></span>
<span id="cb76-85"><a href="#cb76-85" aria-hidden="true" tabindex="-1"></a><span class="va">cut</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;cut.125&quot;</span><span class="kw">)</span></span>
<span id="cb76-86"><a href="#cb76-86" aria-hidden="true" tabindex="-1"></a><span class="va">rel</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;rel&quot;</span><span class="ex">,</span><span class="st">&quot;unrel&quot;</span><span class="kw">)</span></span>
<span id="cb76-87"><a href="#cb76-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-88"><a href="#cb76-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">j</span> in 1:length<span class="er">(</span><span class="ex">rel</span><span class="kw">)){</span></span>
<span id="cb76-89"><a href="#cb76-89" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="fu">cut</span><span class="kw">)){</span></span>
<span id="cb76-90"><a href="#cb76-90" aria-hidden="true" tabindex="-1"></a>    <span class="va">nm</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;10k-snps-&quot;</span><span class="ex">,cut[i],</span><span class="st">&quot;-&quot;</span><span class="ex">,rel[j]</span><span class="kw">)</span></span>
<span id="cb76-91"><a href="#cb76-91" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/related/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.pairwise&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb76-92"><a href="#cb76-92" aria-hidden="true" tabindex="-1"></a>    <span class="va">lista</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/related/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsa&quot;</span><span class="kw">)</span><span class="ex">,</span> stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb76-93"><a href="#cb76-93" aria-hidden="true" tabindex="-1"></a>    <span class="va">listb</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/related/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsb&quot;</span><span class="kw">)</span><span class="ex">,</span> stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb76-94"><a href="#cb76-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-95"><a href="#cb76-95" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>dat[,-c<span class="kw">(</span><span class="ex">10001</span><span class="kw">)</span><span class="ex">]^2</span></span>
<span id="cb76-96"><a href="#cb76-96" aria-hidden="true" tabindex="-1"></a>    <span class="va">outb</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>listb<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,2,</span> mean<span class="kw">))</span></span>
<span id="cb76-97"><a href="#cb76-97" aria-hidden="true" tabindex="-1"></a>    <span class="va">outa</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>lista<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,1,</span> mean<span class="kw">))</span></span>
<span id="cb76-98"><a href="#cb76-98" aria-hidden="true" tabindex="-1"></a>    <span class="va">out</span><span class="op">=</span>rbind<span class="kw">(</span><span class="ex">outa,outb</span><span class="kw">)</span></span>
<span id="cb76-99"><a href="#cb76-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-100"><a href="#cb76-100" aria-hidden="true" tabindex="-1"></a>    <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;summary/ave-r2-&quot;</span><span class="ex">,nm</span><span class="kw">)</span><span class="ex">,</span> col.names=F, row.names=F, quote=F<span class="kw">)</span>  </span>
<span id="cb76-101"><a href="#cb76-101" aria-hidden="true" tabindex="-1"></a>  <span class="kw">}</span></span>
<span id="cb76-102"><a href="#cb76-102" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb76-103"><a href="#cb76-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-104"><a href="#cb76-104" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb76-105"><a href="#cb76-105" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb76-106"><a href="#cb76-106" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb76-107"><a href="#cb76-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-108"><a href="#cb76-108" aria-hidden="true" tabindex="-1"></a><span class="co"># check if mean r^2_j differs for rel vs. unrel</span></span>
<span id="cb76-109"><a href="#cb76-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-110"><a href="#cb76-110" aria-hidden="true" tabindex="-1"></a><span class="co">#cut=c(&quot;cut.125&quot;,&quot;cut.25&quot;,&quot;cut.5&quot;)</span></span>
<span id="cb76-111"><a href="#cb76-111" aria-hidden="true" tabindex="-1"></a><span class="va">cut</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;cut.125&quot;</span><span class="kw">)</span></span>
<span id="cb76-112"><a href="#cb76-112" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="fu">cut</span><span class="kw">)){</span></span>
<span id="cb76-113"><a href="#cb76-113" aria-hidden="true" tabindex="-1"></a>    <span class="va">nm_rel</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;ave-r2-10k-snps-&quot;</span><span class="ex">,cut[i],</span><span class="st">&quot;-rel&quot;</span><span class="kw">)</span></span>
<span id="cb76-114"><a href="#cb76-114" aria-hidden="true" tabindex="-1"></a>    <span class="va">nm_unrel</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;ave-r2-10k-snps-&quot;</span><span class="ex">,cut[i],</span><span class="st">&quot;-unrel&quot;</span><span class="kw">)</span></span>
<span id="cb76-115"><a href="#cb76-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-116"><a href="#cb76-116" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat_rel</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/&quot;</span><span class="ex">,nm_rel</span><span class="kw">)</span><span class="ex">,stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb76-117"><a href="#cb76-117" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat_unrel</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/&quot;</span><span class="ex">,nm_unrel</span><span class="kw">)</span><span class="ex">,stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb76-118"><a href="#cb76-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-119"><a href="#cb76-119" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">rel</span><span class="op">=</span>cut[i],</span>
<span id="cb76-120"><a href="#cb76-120" aria-hidden="true" tabindex="-1"></a>                    <span class="va">rel_ave</span><span class="op">=</span>mean<span class="kw">(</span><span class="ex">dat_rel</span><span class="va">$V2</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb76-121"><a href="#cb76-121" aria-hidden="true" tabindex="-1"></a>                    <span class="va">rel_sd</span><span class="op">=</span>sd<span class="kw">(</span><span class="ex">dat_rel</span><span class="va">$V2</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb76-122"><a href="#cb76-122" aria-hidden="true" tabindex="-1"></a>                    <span class="va">unrel_ave</span><span class="op">=</span>mean<span class="kw">(</span><span class="ex">dat_unrel</span><span class="va">$V2</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb76-123"><a href="#cb76-123" aria-hidden="true" tabindex="-1"></a>                    <span class="va">unrel_sd</span><span class="op">=</span>sd<span class="kw">(</span><span class="ex">dat_unrel</span><span class="va">$V2</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb76-124"><a href="#cb76-124" aria-hidden="true" tabindex="-1"></a>                    <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb76-125"><a href="#cb76-125" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out1=out0}else</span><span class="dt">{out1=rbind(out1</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb76-126"><a href="#cb76-126" aria-hidden="true" tabindex="-1"></a>  <span class="kw">}</span></span></code></pre></div>
</div>
<div id="organize-data-3" class="section level3" number="11.2.4">
<h3><span class="header-section-number">11.2.4</span> organize data</h3>
<div class="sourceCode" id="cb77"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co">#for j in {cut.125,cut.25,cut.5}; do</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> cut.125<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{rel</span><span class="op">,</span><span class="dt">unrel}</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-<span class="va">$j</span>-<span class="va">$i</span>/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-<span class="va">$j</span>-<span class="va">$i</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-related-all-out/<span class="va">$trait</span>-<span class="va">$j</span>-<span class="va">$i</span>.out</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2&quot;}</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="chisq-aver2_j-2" class="section level3" number="11.2.5">
<h3><span class="header-section-number">11.2.5</span> chisq ~ aver2_j</h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate slope: chisq ~ aver2_j</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co">#cuts=c(&quot;cut.125&quot;,&quot;cut.25&quot;,&quot;cut.5&quot;)</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>cuts<span class="ot">=</span><span class="st">&quot;cut.125&quot;</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>related<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;rel&quot;</span>,<span class="st">&quot;unrel&quot;</span>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(related)){</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cuts)){</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>    rel<span class="ot">=</span>related[i]</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>    cut<span class="ot">=</span>cuts[j]</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[k]</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>    file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-related-all-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,cut,</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;-&quot;</span>,rel,<span class="st">&quot;.out&quot;</span>)</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat)</span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>    slope0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cutoff=</span>cut,</span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel=</span>rel,</span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">slope_aver2=</span><span class="fu">coef</span>(mod)[<span class="dv">2</span>],</span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">p_aver2=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> k<span class="sc">==</span><span class="dv">1</span>){slope<span class="ot">=</span>slope0} <span class="cf">else</span> {slope<span class="ot">=</span><span class="fu">rbind</span>(slope,slope0)}</span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span>slope[<span class="fu">order</span>(slope<span class="sc">$</span>trait, slope<span class="sc">$</span>cutoff, slope<span class="sc">$</span>rel),]</span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a><span class="co">#write.table(out,&quot;summary/chisq-aver2-slope-gwas-related.txt&quot;, </span></span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a><span class="co">#            col.names=T, row.names=F, quote=F)</span></span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2_j  by rel | cut</span></span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a><span class="co"># function to plot a single trait---------------------------------------------------</span></span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a>make_plot<span class="ot">=</span><span class="cf">function</span>(trait, cut){</span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define variables</span></span>
<span id="cb78-56"><a href="#cb78-56" aria-hidden="true" tabindex="-1"></a>  cut<span class="ot">=</span>cut</span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>trait</span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define color</span></span>
<span id="cb78-60"><a href="#cb78-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(RColorBrewer)</span>
<span id="cb78-61"><a href="#cb78-61" aria-hidden="true" tabindex="-1"></a>  qual_col_pals <span class="ot">=</span> brewer.pal.info[brewer.pal.info<span class="sc">$</span>category <span class="sc">==</span> <span class="st">&#39;qual&#39;</span>,]</span>
<span id="cb78-62"><a href="#cb78-62" aria-hidden="true" tabindex="-1"></a>  col_vector <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">mapply</span>(brewer.pal, qual_col_pals<span class="sc">$</span>maxcolors, <span class="fu">rownames</span>(qual_col_pals)))</span>
<span id="cb78-63"><a href="#cb78-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb78-64"><a href="#cb78-64" aria-hidden="true" tabindex="-1"></a>  mycol<span class="ot">=</span><span class="fu">sample</span>(col_vector,<span class="dv">2</span>)</span>
<span id="cb78-65"><a href="#cb78-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-66"><a href="#cb78-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># related </span></span>
<span id="cb78-67"><a href="#cb78-67" aria-hidden="true" tabindex="-1"></a>    file1<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-related-all-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,cut,<span class="st">&quot;-rel.out&quot;</span>)</span>
<span id="cb78-68"><a href="#cb78-68" aria-hidden="true" tabindex="-1"></a>    dat1<span class="ot">=</span><span class="fu">vroom</span>(file1, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb78-69"><a href="#cb78-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bin a variable by quantile</span></span>
<span id="cb78-70"><a href="#cb78-70" aria-hidden="true" tabindex="-1"></a>    cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat1<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb78-71"><a href="#cb78-71" aria-hidden="true" tabindex="-1"></a>    dat1<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat1<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb78-72"><a href="#cb78-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># average chisq by bin values</span></span>
<span id="cb78-73"><a href="#cb78-73" aria-hidden="true" tabindex="-1"></a>    out1<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat1<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat1<span class="sc">$</span>bin, mean))</span>
<span id="cb78-74"><a href="#cb78-74" aria-hidden="true" tabindex="-1"></a>    out1<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat1<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat1<span class="sc">$</span>bin, mean)</span>
<span id="cb78-75"><a href="#cb78-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-76"><a href="#cb78-76" aria-hidden="true" tabindex="-1"></a>   <span class="co"># unrelated </span></span>
<span id="cb78-77"><a href="#cb78-77" aria-hidden="true" tabindex="-1"></a>    file2<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-related-all-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,cut,<span class="st">&quot;-unrel.out&quot;</span>)</span>
<span id="cb78-78"><a href="#cb78-78" aria-hidden="true" tabindex="-1"></a>    dat2<span class="ot">=</span><span class="fu">vroom</span>(file2, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb78-79"><a href="#cb78-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bin a variable by quantile</span></span>
<span id="cb78-80"><a href="#cb78-80" aria-hidden="true" tabindex="-1"></a>    cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat2<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb78-81"><a href="#cb78-81" aria-hidden="true" tabindex="-1"></a>    dat2<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat2<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb78-82"><a href="#cb78-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># average chisq by bin values</span></span>
<span id="cb78-83"><a href="#cb78-83" aria-hidden="true" tabindex="-1"></a>    out2<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat2<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat2<span class="sc">$</span>bin, mean))</span>
<span id="cb78-84"><a href="#cb78-84" aria-hidden="true" tabindex="-1"></a>    out2<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat2<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat2<span class="sc">$</span>bin, mean)  </span>
<span id="cb78-85"><a href="#cb78-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-86"><a href="#cb78-86" aria-hidden="true" tabindex="-1"></a>    xstart<span class="ot">=</span><span class="fu">min</span>(out1<span class="sc">$</span>bin_val,out2<span class="sc">$</span>bin_val)</span>
<span id="cb78-87"><a href="#cb78-87" aria-hidden="true" tabindex="-1"></a>    xend<span class="ot">=</span><span class="fu">max</span>(out1<span class="sc">$</span>bin_val,out2<span class="sc">$</span>bin_val)</span>
<span id="cb78-88"><a href="#cb78-88" aria-hidden="true" tabindex="-1"></a>    ystart<span class="ot">=</span><span class="fu">min</span>(out1<span class="sc">$</span>chisq_ave,out2<span class="sc">$</span>chisq_ave)</span>
<span id="cb78-89"><a href="#cb78-89" aria-hidden="true" tabindex="-1"></a>    yend<span class="ot">=</span><span class="fu">max</span>(out1<span class="sc">$</span>chisq_ave,out2<span class="sc">$</span>chisq_ave)</span>
<span id="cb78-90"><a href="#cb78-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-91"><a href="#cb78-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(out1<span class="sc">$</span>bin_val, out1<span class="sc">$</span>chisq_ave,</span>
<span id="cb78-92"><a href="#cb78-92" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave chisq&quot;</span>,</span>
<span id="cb78-93"><a href="#cb78-93" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlim=</span><span class="fu">c</span>(xstart,xend), <span class="at">ylim=</span><span class="fu">c</span>(ystart,yend),</span>
<span id="cb78-94"><a href="#cb78-94" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span><span class="fu">paste0</span>(trait,<span class="st">&quot; &quot;</span>, cut), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb78-95"><a href="#cb78-95" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span>mycol[<span class="dv">1</span>], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb78-96"><a href="#cb78-96" aria-hidden="true" tabindex="-1"></a>      <span class="fu">points</span>(out2<span class="sc">$</span>bin_val, out2<span class="sc">$</span>chisq_ave,</span>
<span id="cb78-97"><a href="#cb78-97" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span>mycol[<span class="dv">2</span>], <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb78-98"><a href="#cb78-98" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(trait<span class="sc">==</span><span class="st">&quot;awake&quot;</span>){</span>
<span id="cb78-99"><a href="#cb78-99" aria-hidden="true" tabindex="-1"></a>     <span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;rel&quot;</span>,<span class="st">&quot;unrel&quot;</span>), </span>
<span id="cb78-100"><a href="#cb78-100" aria-hidden="true" tabindex="-1"></a>            <span class="at">col=</span>mycol, <span class="at">cex=</span><span class="fl">1.5</span>, <span class="at">box.lty=</span><span class="dv">0</span>)}</span>
<span id="cb78-101"><a href="#cb78-101" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb78-102"><a href="#cb78-102" aria-hidden="true" tabindex="-1"></a>} <span class="co"># end of function</span></span>
<span id="cb78-103"><a href="#cb78-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-104"><a href="#cb78-104" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot ------------------------------------------------------------------</span></span>
<span id="cb78-105"><a href="#cb78-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-106"><a href="#cb78-106" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb78-107"><a href="#cb78-107" aria-hidden="true" tabindex="-1"></a><span class="co">#cuts=c(&quot;cut.125&quot;,&quot;cut.25&quot;,&quot;cut.5&quot;)</span></span>
<span id="cb78-108"><a href="#cb78-108" aria-hidden="true" tabindex="-1"></a>cuts<span class="ot">=</span><span class="st">&quot;cut.125&quot;</span></span>
<span id="cb78-109"><a href="#cb78-109" aria-hidden="true" tabindex="-1"></a>related<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;rel&quot;</span>,<span class="st">&quot;unrel&quot;</span>)</span>
<span id="cb78-110"><a href="#cb78-110" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb78-111"><a href="#cb78-111" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb78-112"><a href="#cb78-112" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb78-113"><a href="#cb78-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-114"><a href="#cb78-114" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cuts)){</span>
<span id="cb78-115"><a href="#cb78-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-116"><a href="#cb78-116" aria-hidden="true" tabindex="-1"></a>  cut<span class="ot">=</span>cuts[j]</span>
<span id="cb78-117"><a href="#cb78-117" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot chisq ~ aver2 by rel for a given cutoff for relatedness</span></span>
<span id="cb78-118"><a href="#cb78-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-by-aver2-bin-related-gwas-&quot;</span>,cut,<span class="st">&quot;.png&quot;</span>),</span>
<span id="cb78-119"><a href="#cb78-119" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb78-120"><a href="#cb78-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb78-121"><a href="#cb78-121" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb78-122"><a href="#cb78-122" aria-hidden="true" tabindex="-1"></a>        trait<span class="ot">=</span>traits[i]</span>
<span id="cb78-123"><a href="#cb78-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">make_plot</span>(trait, cut)</span>
<span id="cb78-124"><a href="#cb78-124" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb78-125"><a href="#cb78-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb78-126"><a href="#cb78-126" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="inflation-aver2_j" class="section level3" number="11.2.6">
<h3><span class="header-section-number">11.2.6</span> inflation ~ aver2_j</h3>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate slope: inflation ~ aver2_j</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>cuts<span class="ot">=</span><span class="st">&quot;cut.125&quot;</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cuts)){</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>    cut<span class="ot">=</span>cuts[j]</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[k]</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>    f1<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-related-all-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,cut,<span class="st">&quot;-rel.out&quot;</span>)</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>    f2<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-related-all-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,cut,<span class="st">&quot;-unrel.out&quot;</span>)</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>    d1<span class="ot">=</span><span class="fu">vroom</span>(f1, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>    d2<span class="ot">=</span><span class="fu">vroom</span>(f2, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>    common<span class="ot">=</span><span class="fu">intersect</span>(d1<span class="sc">$</span>snp, d2<span class="sc">$</span>snp)</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>    m1<span class="ot">=</span><span class="fu">match</span>(common, d1<span class="sc">$</span>snp)</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>    m2<span class="ot">=</span><span class="fu">match</span>(common, d2<span class="sc">$</span>snp)</span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">snp=</span>common,</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">inflation=</span>d1<span class="sc">$</span>chisq[m1]<span class="sc">-</span>d2<span class="sc">$</span>chisq[m2],</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">aver2=</span>d1<span class="sc">$</span>aver2[m1])</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">=</span><span class="fu">lm</span>(inflation <span class="sc">~</span> aver2,<span class="at">data=</span>dat)</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>    slope0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cutoff=</span>cut,</span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>                      <span class="at">slope_aver2=</span><span class="fu">coef</span>(mod)[<span class="dv">2</span>],</span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>                      <span class="at">p_aver2=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(j<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> k<span class="sc">==</span><span class="dv">1</span>){slope<span class="ot">=</span>slope0} <span class="cf">else</span> {slope<span class="ot">=</span><span class="fu">rbind</span>(slope,slope0)}</span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span>slope[<span class="fu">order</span>(slope<span class="sc">$</span>trait, slope<span class="sc">$</span>cutoff),]</span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a><span class="co">#write.table(out,&quot;summary/chisq-aver2-slope-gwas-related.txt&quot;, </span></span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a><span class="co">#            col.names=T, row.names=F, quote=F)</span></span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a><span class="co"># plot inflation ~ aver2_j  </span></span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb79-52"><a href="#cb79-52" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot ------------------------------------------------------------------</span></span>
<span id="cb79-53"><a href="#cb79-53" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb79-54"><a href="#cb79-54" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb79-55"><a href="#cb79-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb79-56"><a href="#cb79-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb79-57"><a href="#cb79-57" aria-hidden="true" tabindex="-1"></a>cut<span class="ot">=</span><span class="st">&quot;cut.125&quot;</span>       </span>
<span id="cb79-58"><a href="#cb79-58" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-by-aver2-bin-related-gwas.png&quot;</span>),</span>
<span id="cb79-59"><a href="#cb79-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb79-60"><a href="#cb79-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb79-61"><a href="#cb79-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb79-62"><a href="#cb79-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-63"><a href="#cb79-63" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[i]</span>
<span id="cb79-64"><a href="#cb79-64" aria-hidden="true" tabindex="-1"></a>    f1<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-related-all-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,cut,<span class="st">&quot;-rel.out&quot;</span>)</span>
<span id="cb79-65"><a href="#cb79-65" aria-hidden="true" tabindex="-1"></a>    f2<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-related-all-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,cut,<span class="st">&quot;-unrel.out&quot;</span>)</span>
<span id="cb79-66"><a href="#cb79-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-67"><a href="#cb79-67" aria-hidden="true" tabindex="-1"></a>    d1<span class="ot">=</span><span class="fu">vroom</span>(f1, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb79-68"><a href="#cb79-68" aria-hidden="true" tabindex="-1"></a>    d2<span class="ot">=</span><span class="fu">vroom</span>(f2, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb79-69"><a href="#cb79-69" aria-hidden="true" tabindex="-1"></a>    common<span class="ot">=</span><span class="fu">intersect</span>(d1<span class="sc">$</span>snp, d2<span class="sc">$</span>snp)</span>
<span id="cb79-70"><a href="#cb79-70" aria-hidden="true" tabindex="-1"></a>    m1<span class="ot">=</span><span class="fu">match</span>(common, d1<span class="sc">$</span>snp)</span>
<span id="cb79-71"><a href="#cb79-71" aria-hidden="true" tabindex="-1"></a>    m2<span class="ot">=</span><span class="fu">match</span>(common, d2<span class="sc">$</span>snp)</span>
<span id="cb79-72"><a href="#cb79-72" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">snp=</span>common,</span>
<span id="cb79-73"><a href="#cb79-73" aria-hidden="true" tabindex="-1"></a>                   <span class="at">inflation=</span>d1<span class="sc">$</span>chisq[m1]<span class="sc">-</span>d2<span class="sc">$</span>chisq[m2],</span>
<span id="cb79-74"><a href="#cb79-74" aria-hidden="true" tabindex="-1"></a>                   <span class="at">aver2=</span>d1<span class="sc">$</span>aver2[m1])    </span>
<span id="cb79-75"><a href="#cb79-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-76"><a href="#cb79-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bin a variable by quantile</span></span>
<span id="cb79-77"><a href="#cb79-77" aria-hidden="true" tabindex="-1"></a>    cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb79-78"><a href="#cb79-78" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb79-79"><a href="#cb79-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># average inflation by bin values</span></span>
<span id="cb79-80"><a href="#cb79-80" aria-hidden="true" tabindex="-1"></a>    out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb79-81"><a href="#cb79-81" aria-hidden="true" tabindex="-1"></a>    out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb79-82"><a href="#cb79-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-83"><a href="#cb79-83" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>inflation_ave,</span>
<span id="cb79-84"><a href="#cb79-84" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave inflation&quot;</span>,</span>
<span id="cb79-85"><a href="#cb79-85" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb79-86"><a href="#cb79-86" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb79-87"><a href="#cb79-87" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb79-88"><a href="#cb79-88" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
</div>
<div id="mix-unrel-rel" class="section level2" number="11.3">
<h2><span class="header-section-number">11.3</span> mix unrel &amp; rel</h2>
<div id="genotype" class="section level3" number="11.3.1">
<h3><span class="header-section-number">11.3.1</span> genotype</h3>
<div class="sourceCode" id="cb80"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># id list</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{print $1, $2}&#39;</span> rand.100000 icd10/related.inds <span class="op">&gt;</span> rel-unrel-combo.id </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># note: there are some overlap between the two id lists.</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co"># make bfiles by chromosome</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co">#::::</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../rel-unrel-combo.id </span><span class="dt">\</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract ../doug/ukbb.ldsc </span><span class="dt">\</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="st">         --hwe 0.0001 </span><span class="dt">\</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="st">         --hard-call-threshold .05 </span><span class="dt">\</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="st">         --mach-r2-filter 0.8 2 </span><span class="dt">\</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="st">         --make-bed </span><span class="dt">\</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-combo </span><span class="dt">\</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3 </span><span class="dt">\</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/chr<span class="va">$j</span>.sh</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/chr<span class="va">$i</span>.sh</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/mkbfile-related-unrel-combo</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/mkbfile-related-unrel-combo</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::</span></span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a><span class="co"># merge bfiles </span></span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a><span class="co">#::::</span></span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> bfile.list</span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span>  <span class="st">&quot;../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-combo&quot;</span> <span class="op">&gt;&gt;</span>bfile.list</span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb80-65"><a href="#cb80-65" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb80-66"><a href="#cb80-66" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb80-67"><a href="#cb80-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb80-68"><a href="#cb80-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 40:0:0</span></span>
<span id="cb80-69"><a href="#cb80-69" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --make-bed ../gen/geno-rel-unrel-combo </span><span class="dt">\</span></span>
<span id="cb80-70"><a href="#cb80-70" aria-hidden="true" tabindex="-1"></a><span class="st">          --mbfile ../gen/bfile.list </span><span class="dt">\</span></span>
<span id="cb80-71"><a href="#cb80-71" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb80-72"><a href="#cb80-72" aria-hidden="true" tabindex="-1"></a><span class="st">          --exclude-dups YES  </span></span>
<span id="cb80-73"><a href="#cb80-73" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/mbfile.sh</span>
<span id="cb80-74"><a href="#cb80-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-75"><a href="#cb80-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-76"><a href="#cb80-76" aria-hidden="true" tabindex="-1"></a><span class="co"># snp list --------------------------------------------------------------------</span></span>
<span id="cb80-77"><a href="#cb80-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-78"><a href="#cb80-78" aria-hidden="true" tabindex="-1"></a><span class="co"># MAF &amp; call-rate </span></span>
<span id="cb80-79"><a href="#cb80-79" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> gen/geno-rel-unrel-combo.stats <span class="st">&#39;($5&gt;.01 &amp;&amp; $6&gt;=0.95 &amp;&amp; NR&gt;1){print $1}&#39;</span> <span class="op">&gt;</span> gen/snps-rel-unrel-combo.use</span>
<span id="cb80-80"><a href="#cb80-80" aria-hidden="true" tabindex="-1"></a><span class="co"># m = 1,102,906 SNPs</span></span></code></pre></div>
</div>
<div id="gwas-4" class="section level3" number="11.3.2">
<h3><span class="header-section-number">11.3.2</span> gwas</h3>
<div class="sourceCode" id="cb81"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-rel-unrel-combo</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co"># script ----------------------------------------------------------------------</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chr <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>../gen/snps-rel-unrel-combo.use</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-rel-unrel-combo</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../gwas-rel-unrel-combo/<span class="va">$i</span>-linear-<span class="va">$chr</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 8:0:0</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract </span><span class="va">$snp</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$chr</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-chr-<span class="va">$chr</span>.sh</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a><span class="co">#done</span></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs-------------------------------------------------------------------</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chr <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-chr-<span class="va">$chr</span>.sh</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-combo</span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a><span class="co"># merge files-------------------------------------------------------------------</span></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a><span class="co"># only do .summaries &amp; .pvalues</span></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$j</span> <span class="ot">==</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-<span class="va">$j</span>.summaries <span class="op">&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-<span class="va">$j</span>.pvalues <span class="op">&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> </span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-<span class="va">$j</span>.summaries <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-<span class="va">$j</span>.pvalues <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="aver2_j-4" class="section level3" number="11.3.3">
<h3><span class="header-section-number">11.3.3</span> aver2_j</h3>
<div class="sourceCode" id="cb82"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  snp lists</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co"># common snps of related &amp; unrelated</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="va">unrel</span><span class="op">=</span>gen/snps-unrel-inds.use</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="va">rel</span><span class="op">=</span>gen/snps-rel-unrel-combo.use</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR{a[$1];next} </span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="st">    ($1 in a) {print $1}&#39;</span> <span class="va">$unrel</span> <span class="va">$rel</span> <span class="op">&gt;</span> gen/common-unrel-rel-combo-snps <span class="co"># 1,101,883</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="co"># lista &amp; listb</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>10000</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gen/common-unrel-rel-combo-snps</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>inflation/combo/left-snps</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>inflation/combo/right-snps</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;);</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&lt;8) print $1 }&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$left</span>  </span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, &quot;:&quot;);</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a><span class="st">    if (a[1]&gt;=8) print $1 }&#39;</span> <span class="va">$infile</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> <span class="va">$m</span> <span class="op">&gt;</span><span class="va">$right</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r^2_j</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a><span class="co"># related</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/combo/right-snps</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/combo/left-snps</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-rel-unrel-combo</span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/combo/out/10k-snps</span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-r-10k-snps</span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-r-10k-snps <span class="op">&gt;</span>../job-records/calc-r-combo</span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a><span class="co"># unrelated</span></span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/combo/right-snps</span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/combo/left-snps</span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-unrel</span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../unrelated/rand.100000</span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/combo/out/10k-snps-unrel</span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:10:0</span></span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-r-10k-snps-unrel</span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-70"><a href="#cb82-70" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb82-71"><a href="#cb82-71" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-r-10k-snps-unrel <span class="op">&gt;</span>../job-records/calc-r-combo-unrel</span>
<span id="cb82-72"><a href="#cb82-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-73"><a href="#cb82-73" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute ave r_j^2 for each i-------------------------------------------------</span></span>
<span id="cb82-74"><a href="#cb82-74" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb82-75"><a href="#cb82-75" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb82-76"><a href="#cb82-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-77"><a href="#cb82-77" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span><span class="st">&quot;10k-snps&quot;</span></span>
<span id="cb82-78"><a href="#cb82-78" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/combo/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.pairwise&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb82-79"><a href="#cb82-79" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/combo/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsa&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb82-80"><a href="#cb82-80" aria-hidden="true" tabindex="-1"></a>                <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb82-81"><a href="#cb82-81" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/combo/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsb&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb82-82"><a href="#cb82-82" aria-hidden="true" tabindex="-1"></a>                <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb82-83"><a href="#cb82-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-84"><a href="#cb82-84" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>dat[,-c<span class="kw">(</span><span class="ex">10001</span><span class="kw">)</span><span class="ex">]^2</span></span>
<span id="cb82-85"><a href="#cb82-85" aria-hidden="true" tabindex="-1"></a><span class="va">outb</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>listb<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,2,</span> mean<span class="kw">))</span></span>
<span id="cb82-86"><a href="#cb82-86" aria-hidden="true" tabindex="-1"></a><span class="va">outa</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>lista<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,1,</span> mean<span class="kw">))</span></span>
<span id="cb82-87"><a href="#cb82-87" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>rbind<span class="kw">(</span><span class="ex">outa,outb</span><span class="kw">)</span></span>
<span id="cb82-88"><a href="#cb82-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-89"><a href="#cb82-89" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;summary/ave-r2-&quot;</span><span class="ex">,nm,</span> <span class="st">&quot;-rel-unrel-combo&quot;</span><span class="kw">)</span><span class="ex">,</span> col.names=F, row.names=F, quote=F<span class="kw">)</span> </span>
<span id="cb82-90"><a href="#cb82-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-91"><a href="#cb82-91" aria-hidden="true" tabindex="-1"></a><span class="co"># for unrelated control rand.100000</span></span>
<span id="cb82-92"><a href="#cb82-92" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb82-93"><a href="#cb82-93" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb82-94"><a href="#cb82-94" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span><span class="st">&quot;10k-snps-unrel&quot;</span></span>
<span id="cb82-95"><a href="#cb82-95" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/combo/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.pairwise&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb82-96"><a href="#cb82-96" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/combo/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsa&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb82-97"><a href="#cb82-97" aria-hidden="true" tabindex="-1"></a>                <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb82-98"><a href="#cb82-98" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/combo/out/&quot;</span><span class="ex">,nm,</span><span class="st">&quot;.predictorsb&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb82-99"><a href="#cb82-99" aria-hidden="true" tabindex="-1"></a>                <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb82-100"><a href="#cb82-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-101"><a href="#cb82-101" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>dat[,-c<span class="kw">(</span><span class="ex">10001</span><span class="kw">)</span><span class="ex">]^2</span></span>
<span id="cb82-102"><a href="#cb82-102" aria-hidden="true" tabindex="-1"></a><span class="va">outb</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>listb<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,2,</span> mean<span class="kw">))</span></span>
<span id="cb82-103"><a href="#cb82-103" aria-hidden="true" tabindex="-1"></a><span class="va">outa</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">predictor</span><span class="op">=</span>lista<span class="va">$V1</span>, <span class="va">ave_r2</span><span class="op">=</span>apply<span class="kw">(</span><span class="ex">dat,1,</span> mean<span class="kw">))</span></span>
<span id="cb82-104"><a href="#cb82-104" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>rbind<span class="kw">(</span><span class="ex">outa,outb</span><span class="kw">)</span></span>
<span id="cb82-105"><a href="#cb82-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-106"><a href="#cb82-106" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span><span class="st">&quot;summary/ave-r2-10k-snps-rel-unrel-combo-ref&quot;</span><span class="ex">,</span> </span>
<span id="cb82-107"><a href="#cb82-107" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=F,</span> row.names=F, quote=F<span class="kw">)</span> </span></code></pre></div>
</div>
<div id="organize-data-4" class="section level3" number="11.3.4">
<h3><span class="header-section-number">11.3.4</span> organize data</h3>
<div class="sourceCode" id="cb83"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># related------------------------------------------------------------------------</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-rel-unrel-combo/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-rel-unrel-combo</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-rel-unrel-combo-out/<span class="va">$trait</span>.out</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp    </span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2&quot;}</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a><span class="co"># unrelated control-------------------------------------------------------------</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>unrelated/gwas-good/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-rel-unrel-combo-ref</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-rel-unrel-combo-out/<span class="va">$trait</span>-ref.out</span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp    </span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2&quot;}</span></span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="chisq-aver2_j-3" class="section level3" number="11.3.5">
<h3><span class="header-section-number">11.3.5</span> chisq ~ aver2_j</h3>
<div class="sourceCode" id="cb84"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate slope: chisq ~ aver2_j</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;gwas-rel-unrel-combo-out/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;.out&quot;</span><span class="kw">)</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="fu">file</span>, col_names=T, delim=<span class="st">&quot;;&quot;</span><span class="kw">)</span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>dat[complete.cases<span class="kw">(</span><span class="ex">dat</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a><span class="va">mod</span><span class="op">=</span>lm<span class="kw">(</span><span class="ex">chisq</span> ~ aver2,data=dat<span class="kw">)</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="va">slope0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">trait</span><span class="op">=</span>trait,</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>                  <span class="va">slope_aver2</span><span class="op">=</span>coef<span class="kw">(</span><span class="ex">mod</span><span class="kw">)</span><span class="ex">[2],</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>                  <span class="va">p_aver2</span><span class="op">=</span>summary<span class="kw">(</span><span class="ex">mod</span><span class="kw">)</span><span class="va">$coefficients</span><span class="ex">[,4][2],</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>                  <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{slope=slope0}</span> else <span class="dt">{slope=rbind(slope</span><span class="op">,</span><span class="dt">slope0)}</span></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2_j  </span></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot ------------------------------------------------------------------</span></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a><span class="ex">png</span><span class="er">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;fig/chisq-by-aver2-bin-unrel-rel-combo-gwas.png&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>      <span class="ex">width</span> = 50, height = 30, units = <span class="st">&quot;cm&quot;</span>, res=600<span class="kw">)</span></span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>  <span class="ex">par</span><span class="er">(</span><span class="va">mfrow</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">3,5</span><span class="kw">))</span></span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>    <span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>    <span class="va">file</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;gwas-rel-unrel-combo-out/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;.out&quot;</span><span class="kw">)</span></span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="fu">file</span>, col_names=T, delim=<span class="st">&quot;;&quot;</span><span class="kw">)</span></span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bin a variable by quantile</span></span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>    <span class="va">cutoff</span><span class="op">=</span>quantile<span class="kw">(</span><span class="ex">dat</span><span class="va">$aver2</span><span class="ex">,</span> probs = seq<span class="er">(</span><span class="ex">0,</span> 1, 0.005<span class="kw">)</span><span class="ex">,</span> na.rm=T<span class="kw">)</span></span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a>    <span class="ex">dat</span><span class="va">$bin</span><span class="ex">=cut</span><span class="er">(</span><span class="ex">dat</span><span class="va">$aver2</span><span class="ex">,</span> breaks=cutoff, labels=1:<span class="er">(</span><span class="ex">length</span><span class="er">(</span><span class="ex">cutoff</span><span class="kw">)</span><span class="ex">-1</span><span class="kw">))</span></span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># average chisq by bin values</span></span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>    <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">chisq_ave</span><span class="op">=</span>tapply<span class="kw">(</span><span class="ex">dat</span><span class="va">$chisq</span><span class="ex">,INDEX=dat</span><span class="va">$bin</span><span class="ex">,</span> mean<span class="kw">))</span></span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a>    <span class="ex">out</span><span class="va">$bin_val</span><span class="ex">=tapply</span><span class="er">(</span><span class="ex">dat</span><span class="va">$aver2</span><span class="ex">,INDEX=dat</span><span class="va">$bin</span><span class="ex">,</span> mean<span class="kw">)</span></span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a><span class="ex">plot</span><span class="er">(</span><span class="ex">out</span><span class="va">$bin_val</span><span class="ex">,</span> out<span class="va">$chisq_ave</span>,</span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a>         <span class="va">xlab</span><span class="op">=</span><span class="st">&quot;ave r2&quot;</span>, <span class="va">ylab</span><span class="op">=</span><span class="st">&quot;ave chisq&quot;</span>,</span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a>         <span class="va">main</span><span class="op">=</span>trait, <span class="va">las</span><span class="op">=</span>1,</span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a>         <span class="ex">cex</span> = 1.5, pch=21,  bg=<span class="st">&quot;orange&quot;</span>, col=<span class="st">&quot;white&quot;</span>, lwd=0.5<span class="kw">)</span></span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a> <span class="kw">}</span></span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off()</span></span></code></pre></div>
</div>
<div id="inflation-aver2_j-1" class="section level3" number="11.3.6">
<h3><span class="header-section-number">11.3.6</span> inflation ~ aver2_j</h3>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate slope: inflation ~ aver2_j</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[i]</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    f1<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-rel-unrel-combo-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>)</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>    f2<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-rel-unrel-combo-out/&quot;</span>,trait,<span class="st">&quot;-ref.out&quot;</span>)</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    d1<span class="ot">=</span><span class="fu">vroom</span>(f1, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>    d2<span class="ot">=</span><span class="fu">vroom</span>(f2, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>    common<span class="ot">=</span><span class="fu">intersect</span>(d1<span class="sc">$</span>snp, d2<span class="sc">$</span>snp)</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>    m1<span class="ot">=</span><span class="fu">match</span>(common, d1<span class="sc">$</span>snp)</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>    m2<span class="ot">=</span><span class="fu">match</span>(common, d2<span class="sc">$</span>snp)</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">snp=</span>common,</span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">inflation=</span>d1<span class="sc">$</span>chisq[m1]<span class="sc">-</span>d2<span class="sc">$</span>chisq[m2],</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">aver2=</span>d1<span class="sc">$</span>aver2[m1])</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">=</span><span class="fu">lm</span>(inflation <span class="sc">~</span> aver2,<span class="at">data=</span>dat)</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>    slope0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">slope_aver2=</span><span class="fu">coef</span>(mod)[<span class="dv">2</span>],</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">p_aver2=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){slope<span class="ot">=</span>slope0} <span class="cf">else</span> {slope<span class="ot">=</span><span class="fu">rbind</span>(slope,slope0)}</span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span>slope[<span class="fu">order</span>(slope<span class="sc">$</span>trait),]</span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a><span class="co"># plot inflation ~ aver2_j  </span></span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot ------------------------------------------------------------------</span></span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb85-47"><a href="#cb85-47" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb85-48"><a href="#cb85-48" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-by-aver2-bin-rel-unrel-combo.png&quot;</span>),</span>
<span id="cb85-49"><a href="#cb85-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb85-50"><a href="#cb85-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb85-51"><a href="#cb85-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb85-52"><a href="#cb85-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-53"><a href="#cb85-53" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[i]</span>
<span id="cb85-54"><a href="#cb85-54" aria-hidden="true" tabindex="-1"></a>    f1<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-rel-unrel-combo-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>)</span>
<span id="cb85-55"><a href="#cb85-55" aria-hidden="true" tabindex="-1"></a>    f2<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-rel-unrel-combo-out/&quot;</span>,trait,<span class="st">&quot;-ref.out&quot;</span>)</span>
<span id="cb85-56"><a href="#cb85-56" aria-hidden="true" tabindex="-1"></a>    d1<span class="ot">=</span><span class="fu">vroom</span>(f1, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb85-57"><a href="#cb85-57" aria-hidden="true" tabindex="-1"></a>    d2<span class="ot">=</span><span class="fu">vroom</span>(f2, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb85-58"><a href="#cb85-58" aria-hidden="true" tabindex="-1"></a>    common<span class="ot">=</span><span class="fu">intersect</span>(d1<span class="sc">$</span>snp, d2<span class="sc">$</span>snp)</span>
<span id="cb85-59"><a href="#cb85-59" aria-hidden="true" tabindex="-1"></a>    m1<span class="ot">=</span><span class="fu">match</span>(common, d1<span class="sc">$</span>snp)</span>
<span id="cb85-60"><a href="#cb85-60" aria-hidden="true" tabindex="-1"></a>    m2<span class="ot">=</span><span class="fu">match</span>(common, d2<span class="sc">$</span>snp)</span>
<span id="cb85-61"><a href="#cb85-61" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">snp=</span>common,</span>
<span id="cb85-62"><a href="#cb85-62" aria-hidden="true" tabindex="-1"></a>                   <span class="at">inflation=</span>d1<span class="sc">$</span>chisq[m1]<span class="sc">-</span>d2<span class="sc">$</span>chisq[m2],</span>
<span id="cb85-63"><a href="#cb85-63" aria-hidden="true" tabindex="-1"></a>                   <span class="at">aver2=</span>d1<span class="sc">$</span>aver2[m1])    </span>
<span id="cb85-64"><a href="#cb85-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-65"><a href="#cb85-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bin a variable by quantile</span></span>
<span id="cb85-66"><a href="#cb85-66" aria-hidden="true" tabindex="-1"></a>    cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb85-67"><a href="#cb85-67" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb85-68"><a href="#cb85-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># average inflation by bin values</span></span>
<span id="cb85-69"><a href="#cb85-69" aria-hidden="true" tabindex="-1"></a>    out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb85-70"><a href="#cb85-70" aria-hidden="true" tabindex="-1"></a>    out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb85-71"><a href="#cb85-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-72"><a href="#cb85-72" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>inflation_ave,</span>
<span id="cb85-73"><a href="#cb85-73" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave inflation&quot;</span>,</span>
<span id="cb85-74"><a href="#cb85-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb85-75"><a href="#cb85-75" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb85-76"><a href="#cb85-76" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb85-77"><a href="#cb85-77" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<!--chapter:end:05.1-related-individuals.rmd-->
</div>
</div>
</div>
<div id="calc_aver2_j" class="section level1" number="12">
<h1><span class="header-section-number">12</span> compute <span class="math inline">\(\sum_{i,j}^{m_1, m_2}r^2_{i,j}\)</span></h1>
<div id="good-gwas-all-qced-snps" class="section level2" number="12.1">
<h2><span class="header-section-number">12.1</span> good GWAS-all qced snps</h2>
<div class="sourceCode" id="cb86"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co">#::::</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># here we define a R function to compute sum(r^2)</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;# here we define a R function to compute sum(r^2)</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="st">options(stringsAsFactors=FALSE)</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="st">ip&lt;-commandArgs(trailingOnly=TRUE)</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="st">options(warn=1)</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="st">require(vroom)</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="st">compute_sumr2=function(filein, fileout){</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="st">  dir=</span><span class="dt">\&quot;</span><span class="st">/home/zhoux/dsmwpred/xuan/quality-control/qc-10oct/inflation/</span><span class="dt">\&quot;</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="st">  dat=vroom(paste0(dir,</span><span class="dt">\&quot;</span><span class="st">out/</span><span class="dt">\&quot;</span><span class="st">, filein), col_names=F)</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="st">  r=dat[lower.tri(dat, diag = T)]</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a><span class="st">  sumr2=sum(r^2)</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a><span class="st">  write.table(cbind(sumr2, length(r)), paste0(dir,</span><span class="dt">\&quot;</span><span class="st">summary/</span><span class="dt">\&quot;</span><span class="st">, fileout),</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a><span class="st">  col.names=F, row.names=F, quote=F, append=T)</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a><span class="st">compute_sumr2(ip[1],ip[2])</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>inflation/calc-sum-r2.r</span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># script</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 4:00:0</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="st"># 0. define vars &amp; create snp lists</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="st">  m=1000</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="st">  nm=1k</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="st">  lista=left-snps-goodgwas-</span><span class="va">$nm</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a><span class="st">  listb=right-snps-goodgwas-</span><span class="va">$nm</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a><span class="st">  out=</span><span class="va">$nm</span><span class="st">-snps-goodgwas</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a><span class="st">  filein=</span><span class="va">$nm</span><span class="st">-snps-goodgwas.pairwise</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a><span class="st">  fileout=sum-r2-</span><span class="va">$nm</span><span class="st">-snps-goodgwas</span></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a><span class="st"># loop and recycle files to avoid storage problems</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a><span class="st">for i in {1..500}; do</span></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a><span class="st">    # 1. create snp lists &amp; use ldak to compute r_i,j</span></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a><span class="st">      shuf ../gen/left-hapmap3.snps | head -n </span><span class="va">$m</span><span class="st"> &gt; ../inflation/</span><span class="va">$lista</span><span class="st"> </span></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a><span class="st">      shuf ../gen/right-hapmap3.snps | head -n </span><span class="va">$m</span><span class="st"> &gt; ../inflation/</span><span class="va">$listb</span></span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a><span class="st">      ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a><span class="st">                --calc-inflation ../inflation/out/</span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a><span class="st">                --bfile ../gen/geno-unrel </span><span class="dt">\</span></span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a><span class="st">                --lista ../inflation/</span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a><span class="st">                --listb ../inflation/</span><span class="va">$listb</span><span class="st"> </span></span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a><span class="st">    # 2. compute sum(r^2): see for details</span></span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a><span class="st">      Rscript --vanilla ../inflation/calc-sum-r2.r </span><span class="va">$filein</span><span class="st"> </span><span class="va">$fileout</span></span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a><span class="st">done</span></span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-sum-r2</span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>1000</span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>1k</span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-sum-r2 <span class="op">&gt;</span>../job-records/calc-sum-r2-<span class="va">$nm</span>-snps-goodgwas</span></code></pre></div>
</div>
<div id="good-gwass--ldak-thin-snps" class="section level2" number="12.2">
<h2><span class="header-section-number">12.2</span> good GWASs- ldak-thin snps</h2>
<div class="sourceCode" id="cb88"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co"># script</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 4:00:0</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="st"># 0. define vars &amp; create snp lists</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="st"># to be changed</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="st">  m=1000</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="st">  nm=1k</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="st">  snpa=../gen/left-mix-pop.snps</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a><span class="st">  snpb=../gen/right-mix-pop.snps</span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="st">  id=../mix-pop-gwas.id</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a><span class="st">  bfile=../gen/geno-mix</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a><span class="st">  lista=left-snps-badgwas-</span><span class="va">$nm</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a><span class="st">  listb=right-snps-badgwas-</span><span class="va">$nm</span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a><span class="st">  out=</span><span class="va">$nm</span><span class="st">-snps-badgwas</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a><span class="st">  filein=</span><span class="va">$nm</span><span class="st">-snps-badgwas.pairwise</span></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a><span class="st">  fileout=sum-r2-</span><span class="va">$nm</span><span class="st">-snps-badgwas</span></span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a><span class="st"># loop and recycle files to avoid storage problems</span></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a><span class="st">for i in {1..500}; do</span></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a><span class="st">    # 1. create snp lists &amp; use ldak to compute r_i,j</span></span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a><span class="st">      shuf </span><span class="va">$snpa</span><span class="st"> | head -n </span><span class="va">$m</span><span class="st"> &gt; ../inflation/</span><span class="va">$lista</span><span class="st"> </span></span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a><span class="st">      shuf </span><span class="va">$snpb</span><span class="st"> | head -n </span><span class="va">$m</span><span class="st"> &gt; ../inflation/</span><span class="va">$listb</span></span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a><span class="st">      ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a><span class="st">                --calc-inflation ../inflation/out/</span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a><span class="st">                --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a><span class="st">                --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a><span class="st">                --lista ../inflation/</span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a><span class="st">                --listb ../inflation/</span><span class="va">$listb</span><span class="st"> </span></span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a><span class="st">    # 2. compute sum(r^2): see for details</span></span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a><span class="st">      Rscript --vanilla ../inflation/calc-sum-r2.r </span><span class="va">$filein</span><span class="st"> </span><span class="va">$fileout</span></span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a><span class="st">done</span></span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-sum-r2</span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>1000</span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>1k</span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-sum-r2 <span class="op">&gt;</span>../job-records/calc-sum-r2-<span class="va">$nm</span>-snps-badgwas</span></code></pre></div>
</div>
<div id="bad-gwass-all-qced-snps" class="section level2" number="12.3">
<h2><span class="header-section-number">12.3</span> bad GWASs-all qced snps</h2>
<div class="sourceCode" id="cb89"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># script</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 4:00:0</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="st"># 0. define vars &amp; create snp lists</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a><span class="st"># to be changed</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="st">  m=1000</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a><span class="st">  nm=1k</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a><span class="st">  snpa=../gen/left-mix-pop.snps</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a><span class="st">  snpb=../gen/right-mix-pop.snps</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a><span class="st">  id=../mix-pop-gwas.id</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a><span class="st">  bfile=../gen/geno-mix</span></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a><span class="st">  lista=left-snps-badgwas-</span><span class="va">$nm</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a><span class="st">  listb=right-snps-badgwas-</span><span class="va">$nm</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a><span class="st">  out=</span><span class="va">$nm</span><span class="st">-snps-badgwas</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a><span class="st">  filein=</span><span class="va">$nm</span><span class="st">-snps-badgwas.pairwise</span></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a><span class="st">  fileout=sum-r2-</span><span class="va">$nm</span><span class="st">-snps-badgwas</span></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a><span class="st"># loop and recycle files to avoid storage problems</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a><span class="st">for i in {1..500}; do</span></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a><span class="st">    # 1. create snp lists &amp; use ldak to compute r_i,j</span></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a><span class="st">      shuf </span><span class="va">$snpa</span><span class="st"> | head -n </span><span class="va">$m</span><span class="st"> &gt; ../inflation/</span><span class="va">$lista</span><span class="st"> </span></span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a><span class="st">      shuf </span><span class="va">$snpb</span><span class="st"> | head -n </span><span class="va">$m</span><span class="st"> &gt; ../inflation/</span><span class="va">$listb</span></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a><span class="st">      ./ldak5.2 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a><span class="st">                --calc-inflation ../inflation/out/</span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a><span class="st">                --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a><span class="st">                --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a><span class="st">                --lista ../inflation/</span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a><span class="st">                --listb ../inflation/</span><span class="va">$listb</span><span class="st"> </span></span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a><span class="st">    # 2. compute sum(r^2): see for details</span></span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a><span class="st">    #::</span></span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a><span class="st">      Rscript --vanilla ../inflation/calc-sum-r2.r </span><span class="va">$filein</span><span class="st"> </span><span class="va">$fileout</span></span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-52"><a href="#cb89-52" aria-hidden="true" tabindex="-1"></a><span class="st">done</span></span>
<span id="cb89-53"><a href="#cb89-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-54"><a href="#cb89-54" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-sum-r2</span>
<span id="cb89-55"><a href="#cb89-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-56"><a href="#cb89-56" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb89-57"><a href="#cb89-57" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>1000</span>
<span id="cb89-58"><a href="#cb89-58" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>1k</span>
<span id="cb89-59"><a href="#cb89-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-60"><a href="#cb89-60" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-sum-r2 <span class="op">&gt;</span>../job-records/calc-sum-r2-<span class="va">$nm</span>-snps-badgwas</span></code></pre></div>
</div>
<div id="summary-10" class="section level2" number="12.4">
<h2><span class="header-section-number">12.4</span> summary</h2>
<div class="sourceCode" id="cb90"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co">#::</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ave r_ij^2</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># good gwas</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="st">&#39;Average squared correlation&#39;</span> sh_out/calc-sum-r2-60083794.out <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{split($0, a, &quot;;&quot;) split(a[1], b, &quot; &quot;); print b[5]}&#39;</span> <span class="op">&gt;</span> inflation/summary/ave-r2-1k-snps-goodgwas</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co"># bad gwas</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="st">&#39;Average squared correlation&#39;</span> sh_out/calc-sum-r2-60086056.out <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{split($0, a, &quot;;&quot;) split(a[1], b, &quot; &quot;); print b[5]}&#39;</span> <span class="op">&gt;</span> inflation/summary/ave-r2-1k-snps-badgwas</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="va">good</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;inflation/summary/ave-r2-1k-snps-goodgwas&quot;</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="va">bad</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;inflation/summary/ave-r2-1k-snps-badgwas&quot;</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a><span class="ex">png</span><span class="er">(</span><span class="st">&quot;fig/ave-r2-his-1k-snps.png&quot;</span><span class="ex">,</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">width</span> =40, height = 20, units = <span class="st">&quot;cm&quot;</span>, res=600<span class="kw">)</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a><span class="ex">par</span><span class="er">(</span><span class="va">mfrow</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">1,2</span><span class="kw">))</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a><span class="ex">hist</span><span class="er">(</span><span class="ex">good</span><span class="va">$V1</span><span class="ex">,</span> main=<span class="st">&quot;ave r2 good GWAS&quot;</span>, breaks=50, freq=F, </span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>    <span class="va">col</span><span class="op">=</span><span class="st">&quot;lightgray&quot;</span>, <span class="va">border</span><span class="op">=</span><span class="st">&quot;lightgray&quot;</span><span class="kw">)</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a><span class="ex">hist</span><span class="er">(</span><span class="ex">bad</span><span class="va">$V1</span><span class="ex">,</span> main=<span class="st">&quot;ave r2 bad GWAS&quot;</span>, breaks=50, freq=F, </span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>    <span class="va">col</span><span class="op">=</span><span class="st">&quot;lightgray&quot;</span>, <span class="va">border</span><span class="op">=</span><span class="st">&quot;lightgray&quot;</span><span class="kw">)</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off()</span></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a><span class="co"># mean var</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a><span class="co"># good 1.004277e-05 2.172758e-16</span></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a><span class="co"># bad 0.0003566028 9.250966e-10</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a><span class="co">#::</span></span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a><span class="co"># r_ij^2</span></span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a><span class="co">#::</span></span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a><span class="va">good</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;inflation/out/1k-snps-goodgwas.pairwise&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a><span class="va">bad</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;inflation/out/1k-snps-badgwas.pairwise&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a><span class="va">r2_good</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">as.matrix</span><span class="er">(</span><span class="ex">good</span><span class="kw">)</span><span class="ex">^2</span><span class="kw">)</span></span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a><span class="va">r2_bad</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">as.matrix</span><span class="er">(</span><span class="ex">bad</span><span class="kw">)</span><span class="ex">^2</span><span class="kw">)</span></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a><span class="ex">png</span><span class="er">(</span><span class="st">&quot;fig/r2-his-1k-snps.png&quot;</span><span class="ex">,</span></span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>    <span class="ex">width</span> =40, height = 20, units = <span class="st">&quot;cm&quot;</span>, res=600<span class="kw">)</span></span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a><span class="ex">par</span><span class="er">(</span><span class="va">mfrow</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">1,2</span><span class="kw">))</span></span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a><span class="ex">hist</span><span class="er">(</span><span class="ex">r2_good,</span> main=<span class="st">&quot;r2 good GWAS&quot;</span>, breaks=100, freq=F, </span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>    <span class="va">col</span><span class="op">=</span><span class="st">&quot;lightgray&quot;</span>, <span class="va">border</span><span class="op">=</span><span class="st">&quot;lightgray&quot;</span><span class="kw">)</span></span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a><span class="ex">hist</span><span class="er">(</span><span class="ex">r2_bad,</span> main=<span class="st">&quot;r2 bad GWAS&quot;</span>, breaks=100, freq=F, </span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>    <span class="va">col</span><span class="op">=</span><span class="st">&quot;lightgray&quot;</span>, <span class="va">border</span><span class="op">=</span><span class="st">&quot;lightgray&quot;</span><span class="kw">)</span></span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off()</span></span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a><span class="co"># mean var</span></span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a><span class="co"># good 1.002858e-05 2.020087e-10</span></span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a><span class="co"># bad 0.0003632657 2.666479e-06</span></span></code></pre></div>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># good gwas</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;inflation/summary/sum-r2-1k-snps-goodgwas&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/sumr2-good-gwas-1k-snps.png&quot;</span>),</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">20</span>, <span class="at">height =</span> <span class="dv">20</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>V1, <span class="at">main=</span><span class="st">&quot;good GWAS&quot;</span>)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="co"># bad gwas</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;inflation/summary/sum-r2-1k-snps-badgwas&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/sumr2-bad-gwas-1k-snps.png&quot;</span>),</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">20</span>, <span class="at">height =</span> <span class="dv">20</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>V1, <span class="at">main=</span><span class="st">&quot;bad GWAS&quot;</span>)</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="compute-overliner2_j" class="section level2" number="12.5">
<h2><span class="header-section-number">12.5</span> compute <span class="math inline">\(\overline{r^2_j}\)</span></h2>
<ol style="list-style-type: decimal">
<li>compute average r2 for each i.</li>
</ol>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. compute r^2</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>echo <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="sc">\&quot;</span><span class="st">s04|s05</span><span class="sc">\&quot;</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 4:00:0</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="st"># 0. define vars &amp; create snp lists</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a><span class="st">#:::</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="st"># to be changed</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="st">m=10000</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="st">nm=10k</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a><span class="st">lista=left-snps-unrel-inds-\$nm</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a><span class="st">listb=right-snps-unrel-inds-\$nm</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a><span class="st"># NOTE: both good and bad gwas share the same snp list: snps-unrel-inds.use</span></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a><span class="st">awk &#39;{split(\$1, a, </span><span class="sc">\&quot;</span><span class="st">:</span><span class="sc">\&quot;</span><span class="st">); if (a[1]&lt;8) print \$1 }&#39; ../gen/snps-unrel-inds.use | shuf | head -n \$m &gt;../inflation/\$lista  </span></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a><span class="st">awk &#39;{split(\$1, a, </span><span class="sc">\&quot;</span><span class="st">:</span><span class="sc">\&quot;</span><span class="st">); if (a[1]&gt;=8) print \$1 }&#39; ../gen/snps-unrel-inds.use | shuf | head -n \$m &gt;../inflation/\$listb</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a><span class="st">#::</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a><span class="st"># 1. good gwas</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a><span class="st">#::</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a><span class="st">id=../unrelated/rand.100000</span></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a><span class="st">bfile=../gen/geno-unrel</span></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a><span class="st">out=\$nm-snps-goodgwas</span></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 10 \</span></span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation ../inflation/out/\$out \</span></span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile \$bfile \</span></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep \$id \</span></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista ../inflation/\$lista \</span></span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb ../inflation/\$listb </span></span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a><span class="st">#::</span></span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a><span class="st"># 2. bad gwas</span></span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a><span class="st">#::</span></span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a><span class="st">id=../mix-pop-gwas.id</span></span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a><span class="st">bfile=../gen/geno-mix</span></span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a><span class="st">out=\$nm-snps-badgwas</span></span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 10 \</span></span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation ../inflation/out/\$out \</span></span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile \$bfile \</span></span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep \$id \</span></span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista ../inflation/\$lista \</span></span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb ../inflation/\$listb </span></span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="sc">&gt;</span>sh_script<span class="sc">/</span>calc<span class="sc">-</span>sum<span class="sc">-</span>r2</span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span><span class="dv">10000</span></span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a>nm<span class="ot">=</span>10k</span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a>sbatch <span class="sc">-</span>A snpher ..<span class="sc">/</span>sh_script<span class="sc">/</span>calc<span class="sc">-</span>sum<span class="sc">-</span>r2 <span class="sc">&gt;</span>..<span class="sc">/</span>job<span class="sc">-</span>records<span class="sc">/</span>calc<span class="sc">-</span>sum<span class="sc">-</span>r2<span class="sc">-</span><span class="er">$</span>nm<span class="sc">-</span>snps</span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. compute ave r_j^2 for each i</span></span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a>R</span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a>names<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;goodgwas&quot;</span>, <span class="st">&quot;badgwas&quot;</span>)</span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(names)){</span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a>nm<span class="ot">=</span>names[i]</span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/out/10k-snps-&quot;</span>,nm,<span class="st">&quot;.pairwise&quot;</span>), <span class="at">col_names=</span>F)</span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a>lista<span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/out/10k-snps-&quot;</span>,nm,<span class="st">&quot;.predictorsa&quot;</span>), <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a>listb<span class="ot">=</span><span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/out/10k-snps-&quot;</span>,nm,<span class="st">&quot;.predictorsb&quot;</span>), <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span>dat[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">10001</span>)]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a>outb<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">predictor=</span>listb<span class="sc">$</span>V1, <span class="at">ave_r2=</span><span class="fu">apply</span>(dat,<span class="dv">2</span>, mean))</span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a>outa<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">predictor=</span>lista<span class="sc">$</span>V1, <span class="at">ave_r2=</span><span class="fu">apply</span>(dat,<span class="dv">1</span>, mean))</span>
<span id="cb92-81"><a href="#cb92-81" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">rbind</span>(outa,outb)</span>
<span id="cb92-82"><a href="#cb92-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-83"><a href="#cb92-83" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(out,<span class="fu">paste0</span>(<span class="st">&quot;summary/ave-r2-by-snp-&quot;</span>,nm), <span class="at">col.names=</span>F, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)  </span>
<span id="cb92-84"><a href="#cb92-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-85"><a href="#cb92-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-86"><a href="#cb92-86" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb92-87"><a href="#cb92-87" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. convert to rs system</span></span>
<span id="cb92-88"><a href="#cb92-88" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb92-89"><a href="#cb92-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-90"><a href="#cb92-90" aria-hidden="true" tabindex="-1"></a>awk <span class="st">&#39;(NR==FNR){a[$1]; b[$1]=$2; next}($1 in a){print b[$1], $2}&#39;</span> doug<span class="sc">/</span>ukbb.ldsc summary<span class="sc">/</span>ave<span class="sc">-</span>r2<span class="sc">-</span>by<span class="sc">-</span>snp<span class="sc">-</span>goodgwas <span class="sc">&gt;</span> summary<span class="sc">/</span>ave<span class="sc">-</span>r2<span class="sc">-</span>by<span class="sc">-</span>snp<span class="sc">-</span>goodgwas<span class="sc">-</span>rs</span>
<span id="cb92-91"><a href="#cb92-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-92"><a href="#cb92-92" aria-hidden="true" tabindex="-1"></a>awk <span class="st">&#39;(NR==FNR){a[$1]; b[$1]=$2; next}($1 in a){print b[$1], $2}&#39;</span> doug<span class="sc">/</span>ukbb.ldsc summary<span class="sc">/</span>ave<span class="sc">-</span>r2<span class="sc">-</span>by<span class="sc">-</span>snp<span class="sc">-</span>badgwas <span class="sc">&gt;</span> summary<span class="sc">/</span>ave<span class="sc">-</span>r2<span class="sc">-</span>by<span class="sc">-</span>snp<span class="sc">-</span>badgwas<span class="sc">-</span>rs</span></code></pre></div>
</div>
<div id="mixed-pop-gwas-with-pc-as-covariates" class="section level2" number="12.6">
<h2><span class="header-section-number">12.6</span> mixed pop GWAS with PC as covariates</h2>
<p>Previously we conducted mixed pop GWAS with the first 40 PC as covariates. Since we used the same genotype data (i.e., the same individuals) as for the bad GWASs, <span class="math inline">\(\overline{r^2_j}\)</span> is the same. The difference is the chi-square test statistics. Here we want to check if the relationship between <span class="math inline">\(\overline{r^2_j}\)</span> and chi square still exists for the bad gwas.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># align GWAS test statistics with ld score-------------------------------------- </span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>dir1<span class="ot">=</span><span class="st">&quot;gwas-mix-with-cov/&quot;</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>dir2<span class="ot">=</span><span class="st">&quot;unrelated/gwas-good/&quot;</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>dir3<span class="ot">=</span><span class="st">&quot;gwas-mix/&quot;</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;vroom&quot;</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>snps<span class="ot">=</span><span class="fu">vroom</span>(<span class="st">&quot;overlap-control-good-bad.ldscore&quot;</span>, <span class="at">col_names=</span>F)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(snps)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;ldsc_ref&quot;</span>)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>  dat1<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(dir1,trait,<span class="st">&quot;-linear-rs.summaries&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>  dat2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(dir2,trait,<span class="st">&quot;-linear-rs.summaries&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>  dat3<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(dir3,trait,<span class="st">&quot;-linear-rs.summaries&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>  m1<span class="ot">=</span><span class="fu">match</span>(snps<span class="sc">$</span>snp, dat1<span class="sc">$</span>SNP)</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>  m2<span class="ot">=</span><span class="fu">match</span>(snps<span class="sc">$</span>snp, dat2<span class="sc">$</span>SNP)</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>  m3<span class="ot">=</span><span class="fu">match</span>(snps<span class="sc">$</span>snp, dat3<span class="sc">$</span>SNP)</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">SNP=</span>snps<span class="sc">$</span>snp,</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ldsc_ref=</span>snps<span class="sc">$</span>ldsc_ref,</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bad_cov_chisq=</span>dat1<span class="sc">$</span>Z[m1]<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">good_chisq=</span>dat2<span class="sc">$</span>Z[m2]<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bad_chisq=</span>dat3<span class="sc">$</span>Z[m3]<span class="sc">^</span><span class="dv">2</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span>out[<span class="fu">complete.cases</span>(out),]</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin LD scores according to quantiles</span></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>  cutoff1<span class="ot">=</span><span class="fu">quantile</span>(out<span class="sc">$</span>ldsc_ref, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>))</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>ldsc_ref_bin<span class="ot">=</span><span class="fu">cut</span>(out<span class="sc">$</span>ldsc_ref, <span class="at">breaks=</span>cutoff1, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff1)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(out,<span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>,trait,<span class="st">&quot;-gwas-test-stats-compare3.txt&quot;</span>), </span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">col.names=</span>T, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a><span class="co"># align chisq with ave r^2_j----------------------------------------------------</span></span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>stat<span class="ot">=</span><span class="fu">vroom</span>(<span class="st">&quot;gen/geno-unrel-rs.maf&quot;</span>, <span class="at">col_names=</span>F)</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>r2_good<span class="ot">=</span><span class="fu">vroom</span>(<span class="st">&quot;summary/ave-r2-by-snp-goodgwas-rs&quot;</span>, <span class="at">col_names=</span>F)</span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>r2_bad<span class="ot">=</span><span class="fu">vroom</span>(<span class="st">&quot;summary/ave-r2-by-snp-badgwas-rs&quot;</span>, <span class="at">col_names=</span>F)</span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>,trait,<span class="st">&quot;-gwas-test-stats-compare3.txt&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a>inflation<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">snp=</span>dat<span class="sc">$</span>SNP,</span>
<span id="cb93-52"><a href="#cb93-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inflation=</span>dat<span class="sc">$</span>bad_chisq<span class="sc">-</span>dat<span class="sc">$</span>good_chisq,</span>
<span id="cb93-53"><a href="#cb93-53" aria-hidden="true" tabindex="-1"></a>                     <span class="at">bad_chisq=</span>dat<span class="sc">$</span>bad_chisq,</span>
<span id="cb93-54"><a href="#cb93-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">bad_cov_chisq=</span>dat<span class="sc">$</span>bad_cov_chisq,</span>
<span id="cb93-55"><a href="#cb93-55" aria-hidden="true" tabindex="-1"></a>                     <span class="at">good_chisq=</span>dat<span class="sc">$</span>good_chisq,</span>
<span id="cb93-56"><a href="#cb93-56" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb93-57"><a href="#cb93-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-58"><a href="#cb93-58" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">=</span><span class="fu">match</span>(inflation<span class="sc">$</span>snp, stat<span class="sc">$</span>X1)</span>
<span id="cb93-59"><a href="#cb93-59" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">=</span><span class="fu">match</span>(inflation<span class="sc">$</span>snp,r2_good<span class="sc">$</span>X1)</span>
<span id="cb93-60"><a href="#cb93-60" aria-hidden="true" tabindex="-1"></a>m3<span class="ot">=</span><span class="fu">match</span>(inflation<span class="sc">$</span>snp,r2_bad<span class="sc">$</span>X1)</span>
<span id="cb93-61"><a href="#cb93-61" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(inflation,</span>
<span id="cb93-62"><a href="#cb93-62" aria-hidden="true" tabindex="-1"></a>               <span class="at">maf=</span>stat<span class="sc">$</span>X4[m1], </span>
<span id="cb93-63"><a href="#cb93-63" aria-hidden="true" tabindex="-1"></a>               <span class="at">r2_good=</span>r2_good<span class="sc">$</span>X2[m2],</span>
<span id="cb93-64"><a href="#cb93-64" aria-hidden="true" tabindex="-1"></a>               <span class="at">r2_bad=</span>r2_bad<span class="sc">$</span>X2[m2], <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb93-65"><a href="#cb93-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-66"><a href="#cb93-66" aria-hidden="true" tabindex="-1"></a><span class="co"># bin maf &amp; r2_bad according to quantiles</span></span>
<span id="cb93-67"><a href="#cb93-67" aria-hidden="true" tabindex="-1"></a>cutoff1<span class="ot">=</span><span class="fu">quantile</span>(out<span class="sc">$</span>maf, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb93-68"><a href="#cb93-68" aria-hidden="true" tabindex="-1"></a>cutoff2<span class="ot">=</span><span class="fu">quantile</span>(out<span class="sc">$</span>r2_bad, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb93-69"><a href="#cb93-69" aria-hidden="true" tabindex="-1"></a>cutoff3<span class="ot">=</span><span class="fu">quantile</span>(out<span class="sc">$</span>r2_good, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb93-70"><a href="#cb93-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-71"><a href="#cb93-71" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>maf_bin<span class="ot">=</span><span class="fu">cut</span>(out<span class="sc">$</span>maf, <span class="at">breaks=</span>cutoff1, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff1)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb93-72"><a href="#cb93-72" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_bad_bin<span class="ot">=</span><span class="fu">cut</span>(out<span class="sc">$</span>r2_bad, <span class="at">breaks=</span>cutoff2, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff2)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb93-73"><a href="#cb93-73" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_good_bin<span class="ot">=</span><span class="fu">cut</span>(out<span class="sc">$</span>r2_good, <span class="at">breaks=</span>cutoff3, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff3)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb93-74"><a href="#cb93-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-75"><a href="#cb93-75" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(out,<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), </span>
<span id="cb93-76"><a href="#cb93-76" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span>T, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span>
<span id="cb93-77"><a href="#cb93-77" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-78"><a href="#cb93-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-79"><a href="#cb93-79" aria-hidden="true" tabindex="-1"></a><span class="co"># plot bad chisq by binned ave r2 --------------------------------------------------</span></span>
<span id="cb93-80"><a href="#cb93-80" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb93-81"><a href="#cb93-81" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb93-82"><a href="#cb93-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb93-83"><a href="#cb93-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb93-84"><a href="#cb93-84" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/badgwas-with-cov-chisq-by-aver2-bin.png&quot;</span>),</span>
<span id="cb93-85"><a href="#cb93-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb93-86"><a href="#cb93-86" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb93-87"><a href="#cb93-87" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb93-88"><a href="#cb93-88" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb93-89"><a href="#cb93-89" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb93-90"><a href="#cb93-90" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;bad_cov_chisq&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>,<span class="st">&quot;r2_bad_bin&quot;</span>)]</span>
<span id="cb93-91"><a href="#cb93-91" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb93-92"><a href="#cb93-92" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">bad_cov_chisq=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>bad_cov_chisq,<span class="at">INDEX=</span>sel<span class="sc">$</span>r2_bad_bin, mean))</span>
<span id="cb93-93"><a href="#cb93-93" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_bad_bin<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(out)[<span class="dv">1</span>]</span>
<span id="cb93-94"><a href="#cb93-94" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_bad_bin_val<span class="ot">=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>r2_bad,<span class="at">INDEX=</span>sel<span class="sc">$</span>r2_bad_bin, mean)</span>
<span id="cb93-95"><a href="#cb93-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-96"><a href="#cb93-96" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>r2_bad_bin_val, out<span class="sc">$</span>bad_cov_chisq,</span>
<span id="cb93-97"><a href="#cb93-97" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq test stat&quot;</span>,</span>
<span id="cb93-98"><a href="#cb93-98" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb93-99"><a href="#cb93-99" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb93-100"><a href="#cb93-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-101"><a href="#cb93-101" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb93-102"><a href="#cb93-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-103"><a href="#cb93-103" aria-hidden="true" tabindex="-1"></a><span class="co"># plot good chisq by binned ave r2 --------------------------------------------------</span></span>
<span id="cb93-104"><a href="#cb93-104" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb93-105"><a href="#cb93-105" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb93-106"><a href="#cb93-106" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb93-107"><a href="#cb93-107" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb93-108"><a href="#cb93-108" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/goodgwas-chisq-by-aver2-bin.png&quot;</span>),</span>
<span id="cb93-109"><a href="#cb93-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb93-110"><a href="#cb93-110" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb93-111"><a href="#cb93-111" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb93-112"><a href="#cb93-112" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb93-113"><a href="#cb93-113" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb93-114"><a href="#cb93-114" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;good_chisq&quot;</span>,<span class="st">&quot;r2_good&quot;</span>,<span class="st">&quot;r2_good_bin&quot;</span>)]</span>
<span id="cb93-115"><a href="#cb93-115" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb93-116"><a href="#cb93-116" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">good_chisq=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>good_chisq,<span class="at">INDEX=</span>sel<span class="sc">$</span>r2_good_bin, mean))</span>
<span id="cb93-117"><a href="#cb93-117" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_good_bin<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(out)[<span class="dv">1</span>]</span>
<span id="cb93-118"><a href="#cb93-118" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_good_bin_val<span class="ot">=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>r2_good,<span class="at">INDEX=</span>sel<span class="sc">$</span>r2_good_bin, mean)</span>
<span id="cb93-119"><a href="#cb93-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-120"><a href="#cb93-120" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>r2_good_bin_val, out<span class="sc">$</span>good_chisq,</span>
<span id="cb93-121"><a href="#cb93-121" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq test stat&quot;</span>,</span>
<span id="cb93-122"><a href="#cb93-122" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb93-123"><a href="#cb93-123" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb93-124"><a href="#cb93-124" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-125"><a href="#cb93-125" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb93-126"><a href="#cb93-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-127"><a href="#cb93-127" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq by ldsc----------------------------------------------------------- </span></span>
<span id="cb93-128"><a href="#cb93-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-129"><a href="#cb93-129" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;vroom&quot;</span>)</span>
<span id="cb93-130"><a href="#cb93-130" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb93-131"><a href="#cb93-131" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb93-132"><a href="#cb93-132" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb93-133"><a href="#cb93-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-134"><a href="#cb93-134" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/badgwas-with-cov-by-ldscbin.png&quot;</span>),</span>
<span id="cb93-135"><a href="#cb93-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb93-136"><a href="#cb93-136" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb93-137"><a href="#cb93-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-138"><a href="#cb93-138" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb93-139"><a href="#cb93-139" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb93-140"><a href="#cb93-140" aria-hidden="true" tabindex="-1"></a>trait</span>
<span id="cb93-141"><a href="#cb93-141" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>,trait,<span class="st">&quot;-gwas-test-stats-compare3.txt&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb93-142"><a href="#cb93-142" aria-hidden="true" tabindex="-1"></a>out1<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">ave_ldscore=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>ldsc_ref,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb93-143"><a href="#cb93-143" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_good_chisq=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>good_chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb93-144"><a href="#cb93-144" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_bad_cov_chisq=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>bad_cov_chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean))</span>
<span id="cb93-145"><a href="#cb93-145" aria-hidden="true" tabindex="-1"></a>               </span>
<span id="cb93-146"><a href="#cb93-146" aria-hidden="true" tabindex="-1"></a><span class="co">#out2=data.frame(ave_ldscore=tapply(dat$ldsc_mix,INDEX=dat$ldsc_mix_bin, mean),</span></span>
<span id="cb93-147"><a href="#cb93-147" aria-hidden="true" tabindex="-1"></a><span class="co">#               ave_control_chisq=tapply(dat$control_chisq,INDEX=dat$ldsc_mix_bin, mean),</span></span>
<span id="cb93-148"><a href="#cb93-148" aria-hidden="true" tabindex="-1"></a><span class="co">#               ave_good_chisq=tapply(dat$good_chisq,INDEX=dat$ldsc_mix_bin, mean),</span></span>
<span id="cb93-149"><a href="#cb93-149" aria-hidden="true" tabindex="-1"></a><span class="co">#              ave_bad_chisq=tapply(dat$bad_chisq,INDEX=dat$ldsc_mix_bin, mean))</span></span>
<span id="cb93-150"><a href="#cb93-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-151"><a href="#cb93-151" aria-hidden="true" tabindex="-1"></a>end<span class="ot">=</span><span class="fu">round</span>(<span class="fu">max</span>(<span class="fu">c</span>(out1[,<span class="dv">2</span>], out1[,<span class="dv">3</span>])),<span class="dv">0</span>)</span>
<span id="cb93-152"><a href="#cb93-152" aria-hidden="true" tabindex="-1"></a><span class="co">#end2=round(max(c(out2[,2], out2[,3], out2[,4])),0)</span></span>
<span id="cb93-153"><a href="#cb93-153" aria-hidden="true" tabindex="-1"></a><span class="co">#end=max(end1,end2)</span></span>
<span id="cb93-154"><a href="#cb93-154" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb93-155"><a href="#cb93-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-156"><a href="#cb93-156" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out1<span class="sc">$</span>ave_ldscore, out1<span class="sc">$</span>ave_good_chisq,</span>
<span id="cb93-157"><a href="#cb93-157" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ldscore&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisquare&quot;</span>, </span>
<span id="cb93-158"><a href="#cb93-158" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb93-159"><a href="#cb93-159" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb93-160"><a href="#cb93-160" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;gray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb93-161"><a href="#cb93-161" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out1<span class="sc">$</span>ave_ldscore, out1<span class="sc">$</span>ave_bad_cov_chisq,</span>
<span id="cb93-162"><a href="#cb93-162" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>)</span>
<span id="cb93-163"><a href="#cb93-163" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-164"><a href="#cb93-164" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb93-165"><a href="#cb93-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-166"><a href="#cb93-166" aria-hidden="true" tabindex="-1"></a><span class="co"># regress chi square from bad gwas with cov on ldsc</span></span>
<span id="cb93-167"><a href="#cb93-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-168"><a href="#cb93-168" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb93-169"><a href="#cb93-169" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb93-170"><a href="#cb93-170" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb93-171"><a href="#cb93-171" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb93-172"><a href="#cb93-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-173"><a href="#cb93-173" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb93-174"><a href="#cb93-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-175"><a href="#cb93-175" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb93-176"><a href="#cb93-176" aria-hidden="true" tabindex="-1"></a>trait</span>
<span id="cb93-177"><a href="#cb93-177" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>,trait,<span class="st">&quot;-gwas-test-stats-compare3.txt&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb93-178"><a href="#cb93-178" aria-hidden="true" tabindex="-1"></a>dat2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb93-179"><a href="#cb93-179" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span><span class="fu">match</span>(dat<span class="sc">$</span>SNP,dat2<span class="sc">$</span>snp)</span>
<span id="cb93-180"><a href="#cb93-180" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(dat2[m,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">9</span><span class="sc">:</span><span class="dv">11</span>)],dat[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)])</span>
<span id="cb93-181"><a href="#cb93-181" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span>out[<span class="fu">complete.cases</span>(out),]</span>
<span id="cb93-182"><a href="#cb93-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-183"><a href="#cb93-183" aria-hidden="true" tabindex="-1"></a><span class="co">#ldsc_ref2=(out$ldsc_ref)^2</span></span>
<span id="cb93-184"><a href="#cb93-184" aria-hidden="true" tabindex="-1"></a><span class="co">#r2_bad2=(out$r2_bad)^2</span></span>
<span id="cb93-185"><a href="#cb93-185" aria-hidden="true" tabindex="-1"></a>mod0<span class="ot">=</span><span class="fu">lm</span>(bad_cov_chisq <span class="sc">~</span> <span class="dv">1</span>,<span class="at">data=</span>out)</span>
<span id="cb93-186"><a href="#cb93-186" aria-hidden="true" tabindex="-1"></a>mod1<span class="ot">=</span><span class="fu">lm</span>(bad_cov_chisq <span class="sc">~</span> ldsc_ref,<span class="at">data=</span>out)</span>
<span id="cb93-187"><a href="#cb93-187" aria-hidden="true" tabindex="-1"></a>mod1<span class="fl">.1</span><span class="ot">=</span><span class="fu">lm</span>(bad_chisq <span class="sc">~</span> ldsc_ref <span class="sc">+</span> ldsc_ref2 ,<span class="at">data=</span>out)</span>
<span id="cb93-188"><a href="#cb93-188" aria-hidden="true" tabindex="-1"></a>mod2<span class="ot">=</span><span class="fu">lm</span>(bad_chisq <span class="sc">~</span> r2_bad, <span class="at">data=</span>out)</span>
<span id="cb93-189"><a href="#cb93-189" aria-hidden="true" tabindex="-1"></a>mod2<span class="fl">.1</span><span class="ot">=</span><span class="fu">lm</span>(bad_chisq <span class="sc">~</span> r2_bad <span class="sc">+</span> r2_bad2, <span class="at">data=</span>out)</span>
<span id="cb93-190"><a href="#cb93-190" aria-hidden="true" tabindex="-1"></a>mod3<span class="ot">=</span><span class="fu">lm</span>(bad_chisq <span class="sc">~</span> r2_bad <span class="sc">+</span> ldsc_ref ,<span class="at">data=</span>out)</span>
<span id="cb93-191"><a href="#cb93-191" aria-hidden="true" tabindex="-1"></a>mod3<span class="fl">.1</span><span class="ot">=</span><span class="fu">lm</span>(bad_chisq <span class="sc">~</span> r2_bad <span class="sc">+</span> ldsc_ref <span class="sc">+</span> ldsc_ref2 ,<span class="at">data=</span>out)</span>
<span id="cb93-192"><a href="#cb93-192" aria-hidden="true" tabindex="-1"></a>mod3<span class="fl">.2</span><span class="ot">=</span><span class="fu">lm</span>(bad_chisq <span class="sc">~</span> r2_bad <span class="sc">+</span> ldsc_ref <span class="sc">+</span> ldsc_ref2 <span class="sc">+</span> r2_bad<span class="sc">*</span>ldsc_ref ,<span class="at">data=</span>out)</span>
<span id="cb93-193"><a href="#cb93-193" aria-hidden="true" tabindex="-1"></a>mod4<span class="ot">=</span><span class="fu">lm</span>(bad_chisq <span class="sc">~</span> r2_bad <span class="sc">+</span> ldsc_ref <span class="sc">+</span> r2_bad<span class="sc">*</span>ldsc_ref ,<span class="at">data=</span>out)</span>
<span id="cb93-194"><a href="#cb93-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-195"><a href="#cb93-195" aria-hidden="true" tabindex="-1"></a>p0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb93-196"><a href="#cb93-196" aria-hidden="true" tabindex="-1"></a>              <span class="at">p_r2=</span><span class="fu">anova</span>(mod2, mod0)<span class="sc">$</span>P[<span class="dv">2</span>],</span>
<span id="cb93-197"><a href="#cb93-197" aria-hidden="true" tabindex="-1"></a>              <span class="at">p_r2_2=</span><span class="fu">anova</span>(mod2<span class="fl">.1</span>, mod2)<span class="sc">$</span>P[<span class="dv">2</span>],</span>
<span id="cb93-198"><a href="#cb93-198" aria-hidden="true" tabindex="-1"></a>              <span class="at">p_ldsc=</span><span class="fu">anova</span>(mod3,mod2)<span class="sc">$</span>P[<span class="dv">2</span>],</span>
<span id="cb93-199"><a href="#cb93-199" aria-hidden="true" tabindex="-1"></a>              <span class="at">p_ldsc2=</span><span class="fu">anova</span>(mod3<span class="fl">.1</span>,mod3)<span class="sc">$</span>P[<span class="dv">2</span>],</span>
<span id="cb93-200"><a href="#cb93-200" aria-hidden="true" tabindex="-1"></a>              <span class="at">p_ldsc_r2=</span><span class="fu">anova</span>(mod4,mod3)<span class="sc">$</span>P[<span class="dv">2</span>],</span>
<span id="cb93-201"><a href="#cb93-201" aria-hidden="true" tabindex="-1"></a>              <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb93-202"><a href="#cb93-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-203"><a href="#cb93-203" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){p<span class="ot">=</span>p0} <span class="cf">else</span>{p<span class="ot">=</span><span class="fu">rbind</span>(p,p0)}</span>
<span id="cb93-204"><a href="#cb93-204" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-205"><a href="#cb93-205" aria-hidden="true" tabindex="-1"></a>p_bad<span class="ot">=</span>p</span></code></pre></div>
<!--chapter:end:06_working_space.Rmd-->
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-bulik2015ld" class="csl-entry">
Bulik-Sullivan, B. K., Loh, P.-R., Finucane, H. K., Ripke, S., Yang, J., Patterson, N., Daly, M. J., Price, A. L., &amp; Neale, B. M. (2015). LD score regression distinguishes confounding from polygenicity in genome-wide association studies. <em>Nature Genetics</em>, <em>47</em>(3), 291–295.
</div>
<div id="ref-holmes" class="csl-entry">
Holmes, J. B., Speed, D., &amp; Balding, D. J. (2019). Summary statistic analyses can mistake confounding bias for heritability. <em>Genetic Epidemiology</em>, <em>43</em>(8), 930–940. https://doi.org/<a href="https://doi.org/10.1002/gepi.22259">https://doi.org/10.1002/gepi.22259</a>
</div>
</div>
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
