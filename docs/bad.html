<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Bad GWAS | GWAS Quality Control</title>
  <meta name="description" content="9 Bad GWAS | GWAS Quality Control" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Bad GWAS | GWAS Quality Control" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Bad GWAS | GWAS Quality Control" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="good.html"/>
<link rel="next" href="ukbb.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Quality Control Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> General Info</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#topic"><i class="fa fa-check"></i><b>1.1</b> Topic</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#frequently-used-commands"><i class="fa fa-check"></i><b>1.2</b> Frequently used commands</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>2</b> summary</a></li>
<li class="chapter" data-level="3" data-path="summaries.html"><a href="summaries.html"><i class="fa fa-check"></i><b>3</b> Summaries</a>
<ul>
<li class="chapter" data-level="3.1" data-path="summaries.html"><a href="summaries.html#good-gwas"><i class="fa fa-check"></i><b>3.1</b> Good GWAS</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher"><i class="fa fa-check"></i><b>3.1.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.1.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression"><i class="fa fa-check"></i><b>3.1.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="summaries.html"><a href="summaries.html#bad-gwas"><i class="fa fa-check"></i><b>3.2</b> Bad GWAS</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-1"><i class="fa fa-check"></i><b>3.2.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.2.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-1"><i class="fa fa-check"></i><b>3.2.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="summaries.html"><a href="summaries.html#ukbb-recommended"><i class="fa fa-check"></i><b>3.3</b> UKBB recommended</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-2"><i class="fa fa-check"></i><b>3.3.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.3.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-2"><i class="fa fa-check"></i><b>3.3.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="summaries.html"><a href="summaries.html#control-gwas"><i class="fa fa-check"></i><b>3.4</b> Control GWAS</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-3"><i class="fa fa-check"></i><b>3.4.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.4.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-3"><i class="fa fa-check"></i><b>3.4.2</b> Haseman Elston Regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="summary-1.html"><a href="summary-1.html"><i class="fa fa-check"></i><b>4</b> summary</a></li>
<li class="chapter" data-level="5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html"><i class="fa fa-check"></i><b>5</b> Good VS Bad GWAS</a>
<ul>
<li class="chapter" data-level="5.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#test-statistics-ld-score"><i class="fa fa-check"></i><b>5.1</b> test statistics ~ LD score</a></li>
<li class="chapter" data-level="5.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#new-models"><i class="fa fa-check"></i><b>5.2</b> New models?</a></li>
<li class="chapter" data-level="5.3" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#ld-scores-based-on-individual-level-data"><i class="fa fa-check"></i><b>5.3</b> LD scores based on individual level data</a></li>
<li class="chapter" data-level="5.4" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#test-the-new-model"><i class="fa fa-check"></i><b>5.4</b> Test the new model</a></li>
<li class="chapter" data-level="5.5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#predictors-of-inflation"><i class="fa fa-check"></i><b>5.5</b> predictors of inflation?</a></li>
<li class="chapter" data-level="5.6" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#regress-chisq-mean-r2_j"><i class="fa fa-check"></i><b>5.6</b> regress chisq ~ mean r^2_j</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#plots"><i class="fa fa-check"></i><b>5.6.1</b> plots</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#predict-inflation-aver2_j"><i class="fa fa-check"></i><b>5.7</b> predict inflation | aver2_j ?</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good_chisq-vs.-adj_chisq"><i class="fa fa-check"></i><b>5.7.1</b> good_chisq vs. adj_chisq</a></li>
<li class="chapter" data-level="5.7.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-vs.-inf._hat-raw"><i class="fa fa-check"></i><b>5.7.2</b> bad gwas: inf. vs. inf._hat: raw</a></li>
<li class="chapter" data-level="5.7.3" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-vs.-inf._hat-ave"><i class="fa fa-check"></i><b>5.7.3</b> bad gwas: inf. vs. inf._hat: ave</a></li>
<li class="chapter" data-level="5.7.4" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-from-full-model"><i class="fa fa-check"></i><b>5.7.4</b> bad gwas: inf. from full model</a></li>
<li class="chapter" data-level="5.7.5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#to-explore-change"><i class="fa fa-check"></i><b>5.7.5</b> To Explore: change??</a></li>
<li class="chapter" data-level="5.7.6" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good-gwas-inf.-vs.-inf._hat-raw"><i class="fa fa-check"></i><b>5.7.6</b> good gwas: inf. vs. inf._hat: raw</a></li>
<li class="chapter" data-level="5.7.7" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good-gwas-inf.-vs.-inf._hat-ave"><i class="fa fa-check"></i><b>5.7.7</b> good gwas: inf. vs. inf._hat: ave</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#ukbb_337k_inflation"><i class="fa fa-check"></i><b>5.8</b> UKBB N = 337k</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#organize-data"><i class="fa fa-check"></i><b>5.8.1</b> organize data</a></li>
<li class="chapter" data-level="5.8.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#plot"><i class="fa fa-check"></i><b>5.8.2</b> plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mathematical-details.html"><a href="mathematical-details.html"><i class="fa fa-check"></i><b>6</b> Mathematical Details</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mathematical-details.html"><a href="mathematical-details.html#trk_rightk_left"><i class="fa fa-check"></i><b>6.1</b> <span class="math inline">\(tr(K_{right}K_{left})\)</span></a></li>
<li class="chapter" data-level="6.2" data-path="mathematical-details.html"><a href="mathematical-details.html#verification"><i class="fa fa-check"></i><b>6.2</b> verification</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html"><i class="fa fa-check"></i><b>7</b> chi square ~ <span class="math inline">\(\overline{r^2_j}\)</span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#overliner2_j-choice-of-snps"><i class="fa fa-check"></i><b>7.1</b> <span class="math inline">\(\overline{r^2_j}\)</span> &amp; choice of SNPs</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#number-of-snps"><i class="fa fa-check"></i><b>7.1.1</b> number of SNPs</a></li>
<li class="chapter" data-level="7.1.2" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#maf"><i class="fa fa-check"></i><b>7.1.2</b> maf</a></li>
<li class="chapter" data-level="7.1.3" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#summary-2"><i class="fa fa-check"></i><b>7.1.3</b> summary</a></li>
<li class="chapter" data-level="7.1.4" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#final-plots"><i class="fa fa-check"></i><b>7.1.4</b> Final plots</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#varying-levels-of-confouding"><i class="fa fa-check"></i><b>7.2</b> varying levels of confouding</a></li>
<li class="chapter" data-level="7.3" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#results-summary"><i class="fa fa-check"></i><b>7.3</b> results summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="good.html"><a href="good.html"><i class="fa fa-check"></i><b>8</b> Good GWAS</a>
<ul>
<li class="chapter" data-level="8.1" data-path="good.html"><a href="good.html#goodid"><i class="fa fa-check"></i><b>8.1</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="8.2" data-path="good.html"><a href="good.html#extract-covariates"><i class="fa fa-check"></i><b>8.2</b> extract covariates</a></li>
<li class="chapter" data-level="8.3" data-path="good.html"><a href="good.html#gwas"><i class="fa fa-check"></i><b>8.3</b> GWAS</a></li>
<li class="chapter" data-level="8.4" data-path="good.html"><a href="good.html#chisq-aver2_j"><i class="fa fa-check"></i><b>8.4</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="8.5" data-path="good.html"><a href="good.html#ldsc-interce"><i class="fa fa-check"></i><b>8.5</b> ldsc interce</a></li>
<li class="chapter" data-level="8.6" data-path="good.html"><a href="good.html#ldsc-intercept"><i class="fa fa-check"></i><b>8.6</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="good.html"><a href="good.html#under-gcta"><i class="fa fa-check"></i><b>8.6.1</b> under gcta</a></li>
<li class="chapter" data-level="8.6.2" data-path="good.html"><a href="good.html#under-ldak-thin"><i class="fa fa-check"></i><b>8.6.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="8.6.3" data-path="good.html"><a href="good.html#summary-3"><i class="fa fa-check"></i><b>8.6.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="good.html"><a href="good.html#reml"><i class="fa fa-check"></i><b>8.7</b> REML</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="good.html"><a href="good.html#making-grms"><i class="fa fa-check"></i><b>8.7.1</b> making grms</a></li>
<li class="chapter" data-level="8.7.2" data-path="good.html"><a href="good.html#fast-reml"><i class="fa fa-check"></i><b>8.7.2</b> fast-reml</a></li>
<li class="chapter" data-level="8.7.3" data-path="good.html"><a href="good.html#inflation-test"><i class="fa fa-check"></i><b>8.7.3</b> inflation test</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="good.html"><a href="good.html#he"><i class="fa fa-check"></i><b>8.8</b> HE</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="good.html"><a href="good.html#estimation"><i class="fa fa-check"></i><b>8.8.1</b> estimation</a></li>
<li class="chapter" data-level="8.8.2" data-path="good.html"><a href="good.html#summary-4"><i class="fa fa-check"></i><b>8.8.2</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bad.html"><a href="bad.html"><i class="fa fa-check"></i><b>9</b> Bad GWAS</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bad.html"><a href="bad.html#badid"><i class="fa fa-check"></i><b>9.1</b> ID list</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="bad.html"><a href="bad.html#initial-selection"><i class="fa fa-check"></i><b>9.1.1</b> initial selection</a></li>
<li class="chapter" data-level="9.1.2" data-path="bad.html"><a href="bad.html#relatedness-filtering"><i class="fa fa-check"></i><b>9.1.2</b> relatedness filtering</a></li>
<li class="chapter" data-level="9.1.3" data-path="bad.html"><a href="bad.html#final-list"><i class="fa fa-check"></i><b>9.1.3</b> final list</a></li>
<li class="chapter" data-level="9.1.4" data-path="bad.html"><a href="bad.html#pc-plot"><i class="fa fa-check"></i><b>9.1.4</b> PC plot</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="bad.html"><a href="bad.html#gwas-lm"><i class="fa fa-check"></i><b>9.2</b> GWAS-lm</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="bad.html"><a href="bad.html#basic-cov"><i class="fa fa-check"></i><b>9.2.1</b> basic cov</a></li>
<li class="chapter" data-level="9.2.2" data-path="bad.html"><a href="bad.html#basic-cov-pc"><i class="fa fa-check"></i><b>9.2.2</b> basic cov + PC</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="bad.html"><a href="bad.html#gwas-bolt-lmm"><i class="fa fa-check"></i><b>9.3</b> GWAS-bolt-lmm</a></li>
<li class="chapter" data-level="9.4" data-path="bad.html"><a href="bad.html#correct-genotypes"><i class="fa fa-check"></i><b>9.4</b> correct genotypes</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="bad.html"><a href="bad.html#cal-aver2"><i class="fa fa-check"></i><b>9.4.1</b> cal-aver2</a></li>
<li class="chapter" data-level="9.4.2" data-path="bad.html"><a href="bad.html#compare-changes-in-aver2"><i class="fa fa-check"></i><b>9.4.2</b> compare changes in aver2</a></li>
<li class="chapter" data-level="9.4.3" data-path="bad.html"><a href="bad.html#chisq-aver2"><i class="fa fa-check"></i><b>9.4.3</b> chisq ~ aver2</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="bad.html"><a href="bad.html#chisq-aver2_j-1"><i class="fa fa-check"></i><b>9.5</b> chisq ~ aver2_j</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="bad.html"><a href="bad.html#calc-aver2_j"><i class="fa fa-check"></i><b>9.5.1</b> calc aver2_j</a></li>
<li class="chapter" data-level="9.5.2" data-path="bad.html"><a href="bad.html#bolt-lmm"><i class="fa fa-check"></i><b>9.5.2</b> bolt-lmm</a></li>
<li class="chapter" data-level="9.5.3" data-path="bad.html"><a href="bad.html#basic-cov-pc-1"><i class="fa fa-check"></i><b>9.5.3</b> basic cov + PC</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="bad.html"><a href="bad.html#ldsc-intercept-1"><i class="fa fa-check"></i><b>9.6</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="bad.html"><a href="bad.html#under-gcta-1"><i class="fa fa-check"></i><b>9.6.1</b> under gcta</a></li>
<li class="chapter" data-level="9.6.2" data-path="bad.html"><a href="bad.html#under-ldak-thin-1"><i class="fa fa-check"></i><b>9.6.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="9.6.3" data-path="bad.html"><a href="bad.html#summary-5"><i class="fa fa-check"></i><b>9.6.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="bad.html"><a href="bad.html#reml-1"><i class="fa fa-check"></i><b>9.7</b> REML</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="bad.html"><a href="bad.html#making-grms-1"><i class="fa fa-check"></i><b>9.7.1</b> making grms</a></li>
<li class="chapter" data-level="9.7.2" data-path="bad.html"><a href="bad.html#fast-reml-1"><i class="fa fa-check"></i><b>9.7.2</b> fast-reml</a></li>
<li class="chapter" data-level="9.7.3" data-path="bad.html"><a href="bad.html#inflation-test-1"><i class="fa fa-check"></i><b>9.7.3</b> inflation test</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="bad.html"><a href="bad.html#he-1"><i class="fa fa-check"></i><b>9.8</b> HE</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="bad.html"><a href="bad.html#estimation-1"><i class="fa fa-check"></i><b>9.8.1</b> estimation</a></li>
<li class="chapter" data-level="9.8.2" data-path="bad.html"><a href="bad.html#summary-6"><i class="fa fa-check"></i><b>9.8.2</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ukbb.html"><a href="ukbb.html"><i class="fa fa-check"></i><b>10</b> UKBB recommended</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ukbb.html"><a href="ukbb.html#total-n-337k"><i class="fa fa-check"></i><b>10.1</b> total N = 337k</a></li>
<li class="chapter" data-level="10.2" data-path="ukbb.html"><a href="ukbb.html#qc-of-hp3-snps"><i class="fa fa-check"></i><b>10.2</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="10.3" data-path="ukbb.html"><a href="ukbb.html#gwas-100k"><i class="fa fa-check"></i><b>10.3</b> GWAS-100k</a></li>
<li class="chapter" data-level="10.4" data-path="ukbb.html"><a href="ukbb.html#gwas-337k"><i class="fa fa-check"></i><b>10.4</b> GWAS-337k</a></li>
<li class="chapter" data-level="10.5" data-path="ukbb.html"><a href="ukbb.html#ldsc-100k"><i class="fa fa-check"></i><b>10.5</b> ldsc-100k</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="ukbb.html"><a href="ukbb.html#under-gcta-2"><i class="fa fa-check"></i><b>10.5.1</b> under gcta</a></li>
<li class="chapter" data-level="10.5.2" data-path="ukbb.html"><a href="ukbb.html#under-ldak-thin-2"><i class="fa fa-check"></i><b>10.5.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="10.5.3" data-path="ukbb.html"><a href="ukbb.html#summary-7"><i class="fa fa-check"></i><b>10.5.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="ukbb.html"><a href="ukbb.html#ldsc-337k"><i class="fa fa-check"></i><b>10.6</b> ldsc-337k</a></li>
<li class="chapter" data-level="10.7" data-path="ukbb.html"><a href="ukbb.html#aver2_j-337k"><i class="fa fa-check"></i><b>10.7</b> aver2_j-337k</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="ukbb.html"><a href="ukbb.html#calc"><i class="fa fa-check"></i><b>10.7.1</b> calc</a></li>
<li class="chapter" data-level="10.7.2" data-path="ukbb.html"><a href="ukbb.html#organize-data-1"><i class="fa fa-check"></i><b>10.7.2</b> organize data</a></li>
<li class="chapter" data-level="10.7.3" data-path="ukbb.html"><a href="ukbb.html#chisq-aver2_j-2"><i class="fa fa-check"></i><b>10.7.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="ukbb.html"><a href="ukbb.html#he-2"><i class="fa fa-check"></i><b>10.8</b> HE</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="ukbb.html"><a href="ukbb.html#making-grms-2"><i class="fa fa-check"></i><b>10.8.1</b> making grms</a></li>
<li class="chapter" data-level="10.8.2" data-path="ukbb.html"><a href="ukbb.html#estimation-2"><i class="fa fa-check"></i><b>10.8.2</b> estimation</a></li>
<li class="chapter" data-level="10.8.3" data-path="ukbb.html"><a href="ukbb.html#summary-8"><i class="fa fa-check"></i><b>10.8.3</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="control.html"><a href="control.html"><i class="fa fa-check"></i><b>11</b> control GWAS</a>
<ul>
<li class="chapter" data-level="11.1" data-path="control.html"><a href="control.html#id-list"><i class="fa fa-check"></i><b>11.1</b> ID list</a></li>
<li class="chapter" data-level="11.2" data-path="control.html"><a href="control.html#qc-of-hp3-snps-1"><i class="fa fa-check"></i><b>11.2</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="11.3" data-path="control.html"><a href="control.html#gwas-1"><i class="fa fa-check"></i><b>11.3</b> GWAS</a></li>
<li class="chapter" data-level="11.4" data-path="control.html"><a href="control.html#ldsc-intercept-2"><i class="fa fa-check"></i><b>11.4</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="control.html"><a href="control.html#under-gcta-3"><i class="fa fa-check"></i><b>11.4.1</b> under gcta</a></li>
<li class="chapter" data-level="11.4.2" data-path="control.html"><a href="control.html#under-ldak-thin-3"><i class="fa fa-check"></i><b>11.4.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="11.4.3" data-path="control.html"><a href="control.html#summary-9"><i class="fa fa-check"></i><b>11.4.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="control.html"><a href="control.html#he-3"><i class="fa fa-check"></i><b>11.5</b> HE</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="control.html"><a href="control.html#making-grms-3"><i class="fa fa-check"></i><b>11.5.1</b> making grms</a></li>
<li class="chapter" data-level="11.5.2" data-path="control.html"><a href="control.html#estimation-3"><i class="fa fa-check"></i><b>11.5.2</b> estimation</a></li>
<li class="chapter" data-level="11.5.3" data-path="control.html"><a href="control.html#summary-10"><i class="fa fa-check"></i><b>11.5.3</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="previous-gwas.html"><a href="previous-gwas.html"><i class="fa fa-check"></i><b>12</b> previous GWAS</a>
<ul>
<li class="chapter" data-level="12.1" data-path="previous-gwas.html"><a href="previous-gwas.html#qc"><i class="fa fa-check"></i><b>12.1</b> QC</a></li>
<li class="chapter" data-level="12.2" data-path="previous-gwas.html"><a href="previous-gwas.html#gwas-telomere-length"><i class="fa fa-check"></i><b>12.2</b> gwas-telomere length</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="previous-gwas.html"><a href="previous-gwas.html#aver2_j"><i class="fa fa-check"></i><b>12.2.1</b> aver2_j</a></li>
<li class="chapter" data-level="12.2.2" data-path="previous-gwas.html"><a href="previous-gwas.html#organize-data-2"><i class="fa fa-check"></i><b>12.2.2</b> organize data</a></li>
<li class="chapter" data-level="12.2.3" data-path="previous-gwas.html"><a href="previous-gwas.html#chisq-aver2_j-3"><i class="fa fa-check"></i><b>12.2.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="previous-gwas.html"><a href="previous-gwas.html#pr-interval-gwas"><i class="fa fa-check"></i><b>12.3</b> PR interval GWAS</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="previous-gwas.html"><a href="previous-gwas.html#aver2_j-1"><i class="fa fa-check"></i><b>12.3.1</b> aver2_j</a></li>
<li class="chapter" data-level="12.3.2" data-path="previous-gwas.html"><a href="previous-gwas.html#organize-data-3"><i class="fa fa-check"></i><b>12.3.2</b> organize data</a></li>
<li class="chapter" data-level="12.3.3" data-path="previous-gwas.html"><a href="previous-gwas.html#chisq-aver2_j-4"><i class="fa fa-check"></i><b>12.3.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="previous-gwas.html"><a href="previous-gwas.html#ben-neale-pan-ukbb"><i class="fa fa-check"></i><b>12.4</b> Ben Neale Pan-UKBB</a></li>
<li class="chapter" data-level="12.5" data-path="previous-gwas.html"><a href="previous-gwas.html#notesconcerns"><i class="fa fa-check"></i><b>12.5</b> notes/concerns</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html"><i class="fa fa-check"></i><b>13</b> GWAS: White British + Irish</a>
<ul>
<li class="chapter" data-level="13.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#id-list-1"><i class="fa fa-check"></i><b>13.1</b> ID list</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#ids-who-have-no-missing-data"><i class="fa fa-check"></i><b>13.1.1</b> Ids who have no missing data</a></li>
<li class="chapter" data-level="13.1.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#relatedness-filtering-1"><i class="fa fa-check"></i><b>13.1.2</b> relatedness filtering</a></li>
<li class="chapter" data-level="13.1.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#pc-plot-1"><i class="fa fa-check"></i><b>13.1.3</b> PC plot</a></li>
<li class="chapter" data-level="13.1.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#phenotypic-differences"><i class="fa fa-check"></i><b>13.1.4</b> phenotypic differences</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#gwas-lm-1"><i class="fa fa-check"></i><b>13.2</b> GWAS-lm</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#basic-covariates"><i class="fa fa-check"></i><b>13.2.1</b> basic covariates</a></li>
<li class="chapter" data-level="13.2.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#basic-covariates-pcs"><i class="fa fa-check"></i><b>13.2.2</b> basic covariates + PCs</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#chisq-aver2_j-5"><i class="fa fa-check"></i><b>13.3</b> chisq ~ aver2_j</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#calc-aver2_j-1"><i class="fa fa-check"></i><b>13.3.1</b> calc aver2_j</a></li>
<li class="chapter" data-level="13.3.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#organize-data-4"><i class="fa fa-check"></i><b>13.3.2</b> organize data</a></li>
<li class="chapter" data-level="13.3.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#detect-confounding-wt-pcs"><i class="fa fa-check"></i><b>13.3.3</b> detect confounding: w/t PCs</a></li>
<li class="chapter" data-level="13.3.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#detect-confounding-with-pcs"><i class="fa fa-check"></i><b>13.3.4</b> detect confounding: with PCs</a></li>
<li class="chapter" data-level="13.3.5" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#inflation-good-gwas-vs.-control-vs.-british-irish"><i class="fa fa-check"></i><b>13.3.5</b> inflation: good gwas vs. control vs. british-irish</a></li>
<li class="chapter" data-level="13.3.6" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#inflation-aver2"><i class="fa fa-check"></i><b>13.3.6</b> inflation | aver2</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#ideas-to-explore-to-do-list"><i class="fa fa-check"></i><b>13.4</b> Ideas to explore/ to do list:</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="related-individuals.html"><a href="related-individuals.html"><i class="fa fa-check"></i><b>14</b> related individuals</a>
<ul>
<li class="chapter" data-level="14.1" data-path="related-individuals.html"><a href="related-individuals.html#genotyped-snps"><i class="fa fa-check"></i><b>14.1</b> genotyped SNPs</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-2"><i class="fa fa-check"></i><b>14.1.1</b> aver2_j</a></li>
<li class="chapter" data-level="14.1.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-2"><i class="fa fa-check"></i><b>14.1.2</b> gwas</a></li>
<li class="chapter" data-level="14.1.3" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-5"><i class="fa fa-check"></i><b>14.1.3</b> organize data</a></li>
<li class="chapter" data-level="14.1.4" data-path="related-individuals.html"><a href="related-individuals.html#summary-11"><i class="fa fa-check"></i><b>14.1.4</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="related-individuals.html"><a href="related-individuals.html#hapmap3-snps"><i class="fa fa-check"></i><b>14.2</b> hapmap3 SNPs</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="related-individuals.html"><a href="related-individuals.html#genotype-data"><i class="fa fa-check"></i><b>14.2.1</b> genotype data</a></li>
<li class="chapter" data-level="14.2.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-3"><i class="fa fa-check"></i><b>14.2.2</b> gwas</a></li>
<li class="chapter" data-level="14.2.3" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-3"><i class="fa fa-check"></i><b>14.2.3</b> aver2_j</a></li>
<li class="chapter" data-level="14.2.4" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-6"><i class="fa fa-check"></i><b>14.2.4</b> organize data</a></li>
<li class="chapter" data-level="14.2.5" data-path="related-individuals.html"><a href="related-individuals.html#chisq-aver2_j-6"><i class="fa fa-check"></i><b>14.2.5</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="14.2.6" data-path="related-individuals.html"><a href="related-individuals.html#inflation-aver2_j"><i class="fa fa-check"></i><b>14.2.6</b> inflation ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="related-individuals.html"><a href="related-individuals.html#mix-unrel-rel"><i class="fa fa-check"></i><b>14.3</b> mix unrel &amp; rel</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="related-individuals.html"><a href="related-individuals.html#genotype"><i class="fa fa-check"></i><b>14.3.1</b> genotype</a></li>
<li class="chapter" data-level="14.3.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-4"><i class="fa fa-check"></i><b>14.3.2</b> gwas</a></li>
<li class="chapter" data-level="14.3.3" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-4"><i class="fa fa-check"></i><b>14.3.3</b> aver2_j</a></li>
<li class="chapter" data-level="14.3.4" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-7"><i class="fa fa-check"></i><b>14.3.4</b> organize data</a></li>
<li class="chapter" data-level="14.3.5" data-path="related-individuals.html"><a href="related-individuals.html#chisq-aver2_j-7"><i class="fa fa-check"></i><b>14.3.5</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="14.3.6" data-path="related-individuals.html"><a href="related-individuals.html#inflation-aver2_j-1"><i class="fa fa-check"></i><b>14.3.6</b> inflation ~ aver2_j</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html"><i class="fa fa-check"></i><b>15</b> compute <span class="math inline">\(\sum_{i,j}^{m_1, m_2}r^2_{i,j}\)</span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#good-gwas-all-qced-snps"><i class="fa fa-check"></i><b>15.1</b> good GWAS-all qced snps</a></li>
<li class="chapter" data-level="15.2" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#good-gwass--ldak-thin-snps"><i class="fa fa-check"></i><b>15.2</b> good GWASs- ldak-thin snps</a></li>
<li class="chapter" data-level="15.3" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#bad-gwass-all-qced-snps"><i class="fa fa-check"></i><b>15.3</b> bad GWASs-all qced snps</a></li>
<li class="chapter" data-level="15.4" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#summary-12"><i class="fa fa-check"></i><b>15.4</b> summary</a></li>
<li class="chapter" data-level="15.5" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#aver2j"><i class="fa fa-check"></i><b>15.5</b> compute aver2_j</a></li>
<li class="chapter" data-level="15.6" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#mixed-pop-gwas-with-pc-as-covariates"><i class="fa fa-check"></i><b>15.6</b> mixed pop GWAS with PC as covariates</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="assortative-mating.html"><a href="assortative-mating.html"><i class="fa fa-check"></i><b>16</b> Assortative mating</a>
<ul>
<li class="chapter" data-level="16.1" data-path="assortative-mating.html"><a href="assortative-mating.html#test-the-idea"><i class="fa fa-check"></i><b>16.1</b> Test the idea</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="assortative-mating.html"><a href="assortative-mating.html#st-try"><i class="fa fa-check"></i><b>16.1.1</b> 1st try</a></li>
<li class="chapter" data-level="16.1.2" data-path="assortative-mating.html"><a href="assortative-mating.html#nd-try"><i class="fa fa-check"></i><b>16.1.2</b> 2nd try</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html"><i class="fa fa-check"></i><b>17</b> Reference Panel: 1k Genome</a>
<ul>
<li class="chapter" data-level="17.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#common-snplist"><i class="fa fa-check"></i><b>17.1</b> common snplist</a></li>
<li class="chapter" data-level="17.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#compute-aver2"><i class="fa fa-check"></i><b>17.2</b> compute aver2</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#bad-gwas-1"><i class="fa fa-check"></i><b>17.2.1</b> bad gwas</a></li>
<li class="chapter" data-level="17.2.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#varying-levels-of-confounding"><i class="fa fa-check"></i><b>17.2.2</b> varying levels of confounding</a></li>
<li class="chapter" data-level="17.2.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#good-gwas-1"><i class="fa fa-check"></i><b>17.2.3</b> good gwas</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#detect-confounding"><i class="fa fa-check"></i><b>17.3</b> detect confounding</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#bad-gwas-2"><i class="fa fa-check"></i><b>17.3.1</b> bad gwas</a></li>
<li class="chapter" data-level="17.3.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#varying-levels-of-confounding-1"><i class="fa fa-check"></i><b>17.3.2</b> varying levels of confounding</a></li>
<li class="chapter" data-level="17.3.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#good-gwas-2"><i class="fa fa-check"></i><b>17.3.3</b> good gwas</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#estimate-inflation"><i class="fa fa-check"></i><b>17.4</b> estimate inflation</a></li>
<li class="chapter" data-level="17.5" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#stratified-aver2"><i class="fa fa-check"></i><b>17.5</b> stratified aver2</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#calc-aver2"><i class="fa fa-check"></i><b>17.5.1</b> calc aver2</a></li>
<li class="chapter" data-level="17.5.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#organize-data-8"><i class="fa fa-check"></i><b>17.5.2</b> organize data</a></li>
<li class="chapter" data-level="17.5.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#plot-aver2-of-pairwise-mixture-pops"><i class="fa fa-check"></i><b>17.5.3</b> plot aver2 of pairwise mixture pops</a></li>
<li class="chapter" data-level="17.5.4" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#chisq-1-x-aver2"><i class="fa fa-check"></i><b>17.5.4</b> chisq ~ 1 x aver2</a></li>
<li class="chapter" data-level="17.5.5" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#chisq-multi-aver2"><i class="fa fa-check"></i><b>17.5.5</b> chisq ~ multi-aver2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html"><i class="fa fa-check"></i><b>18</b> Fine-scale population stratification</a>
<ul>
<li class="chapter" data-level="18.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#birth-location-data"><i class="fa fa-check"></i><b>18.1</b> birth location data</a></li>
<li class="chapter" data-level="18.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#pca-of-337k"><i class="fa fa-check"></i><b>18.2</b> pca of 337k</a></li>
<li class="chapter" data-level="18.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#birth-place-gwas"><i class="fa fa-check"></i><b>18.3</b> birth place gwas</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-5"><i class="fa fa-check"></i><b>18.3.1</b> gwas</a></li>
<li class="chapter" data-level="18.3.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#chisq-aver2-1"><i class="fa fa-check"></i><b>18.3.2</b> chisq ~ aver2</a></li>
<li class="chapter" data-level="18.3.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#detect-inflation-using-1kg"><i class="fa fa-check"></i><b>18.3.3</b> detect inflation using 1kg</a></li>
<li class="chapter" data-level="18.3.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-results"><i class="fa fa-check"></i><b>18.3.4</b> gwas results</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-based-on-pc-clusters"><i class="fa fa-check"></i><b>18.4</b> GWAS based on PC clusters</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-lists"><i class="fa fa-check"></i><b>18.4.1</b> id lists</a></li>
<li class="chapter" data-level="18.4.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-list-for-bad-gwas2"><i class="fa fa-check"></i><b>18.4.2</b> id list for bad gwas2</a></li>
<li class="chapter" data-level="18.4.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-list-for-bad-gwas3"><i class="fa fa-check"></i><b>18.4.3</b> id list for bad gwas3</a></li>
<li class="chapter" data-level="18.4.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-3"><i class="fa fa-check"></i><b>18.4.4</b> bad gwas</a></li>
<li class="chapter" data-level="18.4.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2"><i class="fa fa-check"></i><b>18.4.5</b> bad gwas#2</a></li>
<li class="chapter" data-level="18.4.6" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3"><i class="fa fa-check"></i><b>18.4.6</b> bad gwas#3</a></li>
<li class="chapter" data-level="18.4.7" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-3"><i class="fa fa-check"></i><b>18.4.7</b> good gwas</a></li>
<li class="chapter" data-level="18.4.8" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-1"><i class="fa fa-check"></i><b>18.4.8</b> control gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#compute-aver2-1"><i class="fa fa-check"></i><b>18.5</b> compute aver2</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-4"><i class="fa fa-check"></i><b>18.5.1</b> bad-gwas</a></li>
<li class="chapter" data-level="18.5.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2-1"><i class="fa fa-check"></i><b>18.5.2</b> bad-gwas#2</a></li>
<li class="chapter" data-level="18.5.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3-1"><i class="fa fa-check"></i><b>18.5.3</b> bad-gwas#3</a></li>
<li class="chapter" data-level="18.5.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-4"><i class="fa fa-check"></i><b>18.5.4</b> good-gwas</a></li>
<li class="chapter" data-level="18.5.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-2"><i class="fa fa-check"></i><b>18.5.5</b> control-gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#chisq-aver2-2"><i class="fa fa-check"></i><b>18.6</b> chisq ~ aver2</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-5"><i class="fa fa-check"></i><b>18.6.1</b> bad gwas</a></li>
<li class="chapter" data-level="18.6.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2-2"><i class="fa fa-check"></i><b>18.6.2</b> bad gwas#2</a></li>
<li class="chapter" data-level="18.6.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3-2"><i class="fa fa-check"></i><b>18.6.3</b> bad gwas#3</a></li>
<li class="chapter" data-level="18.6.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-5"><i class="fa fa-check"></i><b>18.6.4</b> good gwas</a></li>
<li class="chapter" data-level="18.6.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-3"><i class="fa fa-check"></i><b>18.6.5</b> control gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#inflation-aver2-1"><i class="fa fa-check"></i><b>18.7</b> inflation ~ aver2</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GWAS Quality Control</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bad" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Bad GWAS</h1>
<div id="badid" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> ID list</h2>
<div id="initial-selection" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> initial selection</h3>
<p>Randomly select participants with complete data and use the SNP list as for unrelated.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="bad.html#cb45-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2"><a href="bad.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># extract white, asian &amp; black from ukbb----------------------------------------</span></span>
<span id="cb45-3"><a href="bad.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb45-4"><a href="bad.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;phen/covariates.phen&quot;</span><span class="ex">,</span> header=T, stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb45-5"><a href="bad.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># White: British(1001)  </span></span>
<span id="cb45-6"><a href="bad.html#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Asian or Asian British: Indian(3001)+Pakistani(3002)+Bangladeshi(3003)+other Asian backgroud(3004)</span></span>
<span id="cb45-7"><a href="bad.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Black: Caribbean(4001)+African(4002)+other Black Background(4003)</span></span>
<span id="cb45-8"><a href="bad.html#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>dat[complete.cases<span class="kw">(</span><span class="ex">dat</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb45-9"><a href="bad.html#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="va">white</span><span class="op">=</span>1001</span>
<span id="cb45-10"><a href="bad.html#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="va">asian</span><span class="op">=</span>3001:3004</span>
<span id="cb45-11"><a href="bad.html#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="va">black</span><span class="op">=</span>4001:4003</span>
<span id="cb45-12"><a href="bad.html#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="va">out1</span><span class="op">=</span>dat[dat<span class="va">$ethnicity</span>%in%white,]</span>
<span id="cb45-13"><a href="bad.html#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="va">out2</span><span class="op">=</span>dat[dat<span class="va">$ethnicity</span>%in%asian,]</span>
<span id="cb45-14"><a href="bad.html#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="va">out3</span><span class="op">=</span>dat[dat<span class="va">$ethnicity</span>%in%black,]</span>
<span id="cb45-15"><a href="bad.html#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="va">out1</span><span class="op">[</span>,<span class="st">&quot;eid&quot;</span><span class="op">]</span><span class="ex">,</span> <span class="st">&quot;white-complete-cov.id&quot;</span>, col.names=F, row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb45-16"><a href="bad.html#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="va">out2</span><span class="op">[</span>,<span class="st">&quot;eid&quot;</span><span class="op">]</span><span class="ex">,</span> <span class="st">&quot;asian-complete-cov.id&quot;</span>, col.names=F, row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb45-17"><a href="bad.html#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="va">out3</span><span class="op">[</span>,<span class="st">&quot;eid&quot;</span><span class="op">]</span><span class="ex">,</span> <span class="st">&quot;black-complete-cov.id&quot;</span>, col.names=F, row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb45-18"><a href="bad.html#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co"># overlapping UNRELATED WHITE across 14 traits----------------------------------</span></span>
<span id="cb45-19"><a href="bad.html#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># overlapping = no missing data for the 14 traits</span></span>
<span id="cb45-20"><a href="bad.html#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="bad.html#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> icd10/unrelated.inds overlap.ind <span class="co"># unrelated white British</span></span>
<span id="cb45-22"><a href="bad.html#cb45-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-23"><a href="bad.html#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>phen/continuous-traits/</span>
<span id="cb45-24"><a href="bad.html#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tt <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb45-25"><a href="bad.html#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> overlap.ind temp</span>
<span id="cb45-26"><a href="bad.html#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}($1 in a){print $1, $2}&#39;</span> temp <span class="va">$dir</span>/<span class="va">$tt</span>.raw.pheno <span class="op">&gt;</span> overlap.ind</span>
<span id="cb45-27"><a href="bad.html#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> overlap.ind</span>
<span id="cb45-28"><a href="bad.html#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$tt</span></span>
<span id="cb45-29"><a href="bad.html#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb45-30"><a href="bad.html#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> temp</span>
<span id="cb45-31"><a href="bad.html#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="bad.html#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="co"># overlapping + complete data for covariates + unrelated</span></span>
<span id="cb45-33"><a href="bad.html#cb45-33" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR{a[$1]; next} ($1 in a) {print $1, $1}&#39;</span> unrelated/overlap.ind white-complete-cov.id <span class="op">&gt;</span> overlap-white-complete-cov.id <span class="co"># N = 147,008</span></span>
<span id="cb45-34"><a href="bad.html#cb45-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-35"><a href="bad.html#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="co"># overlapping UNRELATED ASIAN across 14 traits----------------------------------</span></span>
<span id="cb45-36"><a href="bad.html#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> asian-complete-cov.id overlap-asian-complete-cov.id</span>
<span id="cb45-37"><a href="bad.html#cb45-37" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>phen/continuous-traits/</span>
<span id="cb45-38"><a href="bad.html#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tt <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb45-39"><a href="bad.html#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> overlap-asian-complete-cov.id temp</span>
<span id="cb45-40"><a href="bad.html#cb45-40" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}($1 in a){print $1, $2}&#39;</span> temp <span class="va">$dir</span>/<span class="va">$tt</span>.raw.pheno <span class="op">&gt;</span> overlap-asian-complete-cov.id</span>
<span id="cb45-41"><a href="bad.html#cb45-41" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> overlap-asian-complete-cov.id <span class="co"># N = 4,052</span></span>
<span id="cb45-42"><a href="bad.html#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$tt</span></span>
<span id="cb45-43"><a href="bad.html#cb45-43" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb45-44"><a href="bad.html#cb45-44" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> temp</span>
<span id="cb45-45"><a href="bad.html#cb45-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-46"><a href="bad.html#cb45-46" aria-hidden="true" tabindex="-1"></a><span class="co"># relatedness filtering</span></span>
<span id="cb45-47"><a href="bad.html#cb45-47" aria-hidden="true" tabindex="-1"></a><span class="co"># see below</span></span>
<span id="cb45-48"><a href="bad.html#cb45-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-49"><a href="bad.html#cb45-49" aria-hidden="true" tabindex="-1"></a><span class="co"># overlapping UNRELATED BLACK across 14 traits----------------------------------</span></span>
<span id="cb45-50"><a href="bad.html#cb45-50" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> black-complete-cov.id overlap-black-complete-cov.id</span>
<span id="cb45-51"><a href="bad.html#cb45-51" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>phen/continuous-traits/</span>
<span id="cb45-52"><a href="bad.html#cb45-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tt <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb45-53"><a href="bad.html#cb45-53" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> overlap-black-complete-cov.id temp</span>
<span id="cb45-54"><a href="bad.html#cb45-54" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1];next}($1 in a){print $1, $2}&#39;</span> temp <span class="va">$dir</span>/<span class="va">$tt</span>.raw.pheno <span class="op">&gt;</span> overlap-black-complete-cov.id</span>
<span id="cb45-55"><a href="bad.html#cb45-55" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> overlap-black-complete-cov.id <span class="co"># N = 3,583</span></span>
<span id="cb45-56"><a href="bad.html#cb45-56" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$tt</span></span>
<span id="cb45-57"><a href="bad.html#cb45-57" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb45-58"><a href="bad.html#cb45-58" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> temp</span>
<span id="cb45-59"><a href="bad.html#cb45-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-60"><a href="bad.html#cb45-60" aria-hidden="true" tabindex="-1"></a><span class="co"># relatedness filtering</span></span>
<span id="cb45-61"><a href="bad.html#cb45-61" aria-hidden="true" tabindex="-1"></a><span class="co"># see below</span></span></code></pre></div>
</div>
<div id="relatedness-filtering" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> relatedness filtering</h3>
<p>For black and Asian people only.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="bad.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------</span></span>
<span id="cb46-2"><a href="bad.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 0. make bfiles</span></span>
<span id="cb46-3"><a href="bad.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------</span></span>
<span id="cb46-4"><a href="bad.html#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="bad.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># id lists</span></span>
<span id="cb46-6"><a href="bad.html#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="ex">overlap-white-complete-cov.id</span> <span class="co"># N=147,008</span></span>
<span id="cb46-7"><a href="bad.html#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="ex">overlap-black-complete-cov.id</span> <span class="co"># N=3,583</span></span>
<span id="cb46-8"><a href="bad.html#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="ex">overlap-asian-complete-cov.id</span> <span class="co"># N=4,052</span></span>
<span id="cb46-9"><a href="bad.html#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> overlap-white-complete-cov.id overlap-black-complete-cov.id overlap-asian-complete-cov.id <span class="op">&gt;</span> overlap-mixed-complete-cov.id <span class="co"># 154,643    </span></span>
<span id="cb46-10"><a href="bad.html#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="bad.html#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># bfiles by chr</span></span>
<span id="cb46-12"><a href="bad.html#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-13"><a href="bad.html#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb46-14"><a href="bad.html#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb46-15"><a href="bad.html#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb46-16"><a href="bad.html#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb46-17"><a href="bad.html#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb46-18"><a href="bad.html#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb46-19"><a href="bad.html#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="bad.html#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --pfile ../gen/geno_plink/bhr</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb46-21"><a href="bad.html#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../overlap-mixed-complete-cov.id </span><span class="dt">\</span></span>
<span id="cb46-22"><a href="bad.html#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract ../gen/snps-unrel-inds.use </span><span class="dt">\</span></span>
<span id="cb46-23"><a href="bad.html#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="st">         --make-bed </span><span class="dt">\</span></span>
<span id="cb46-24"><a href="bad.html#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 20000 </span><span class="dt">\</span></span>
<span id="cb46-25"><a href="bad.html#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-mix </span><span class="dt">\</span></span>
<span id="cb46-26"><a href="bad.html#cb46-26" aria-hidden="true" tabindex="-1"></a><span class="st">         --threads 3 </span><span class="dt">\</span></span>
<span id="cb46-27"><a href="bad.html#cb46-27" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/chr<span class="va">$j</span>-mix.sh</span>
<span id="cb46-28"><a href="bad.html#cb46-28" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-29"><a href="bad.html#cb46-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-30"><a href="bad.html#cb46-30" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb46-31"><a href="bad.html#cb46-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-32"><a href="bad.html#cb46-32" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/chr<span class="va">$i</span>-mix.sh</span>
<span id="cb46-33"><a href="bad.html#cb46-33" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/mkbfile-mix-pop</span>
<span id="cb46-34"><a href="bad.html#cb46-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-35"><a href="bad.html#cb46-35" aria-hidden="true" tabindex="-1"></a><span class="co"># merge bfiles</span></span>
<span id="cb46-36"><a href="bad.html#cb46-36" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> bfile-mix.list</span>
<span id="cb46-37"><a href="bad.html#cb46-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-38"><a href="bad.html#cb46-38" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span>  <span class="st">&quot;../gen/tmp/bhr</span><span class="va">$j</span><span class="st">-mix&quot;</span> <span class="op">&gt;&gt;</span>bfile-mix.list</span>
<span id="cb46-39"><a href="bad.html#cb46-39" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-40"><a href="bad.html#cb46-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-41"><a href="bad.html#cb46-41" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb46-42"><a href="bad.html#cb46-42" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb46-43"><a href="bad.html#cb46-43" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb46-44"><a href="bad.html#cb46-44" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb46-45"><a href="bad.html#cb46-45" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb46-46"><a href="bad.html#cb46-46" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb46-47"><a href="bad.html#cb46-47" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --make-bed ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb46-48"><a href="bad.html#cb46-48" aria-hidden="true" tabindex="-1"></a><span class="st">          --mbfile ../gen/bfile-mix.list </span><span class="dt">\</span></span>
<span id="cb46-49"><a href="bad.html#cb46-49" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb46-50"><a href="bad.html#cb46-50" aria-hidden="true" tabindex="-1"></a><span class="st">          --exclude-dups YES  </span></span>
<span id="cb46-51"><a href="bad.html#cb46-51" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/merge-mbfiles-mix-pop.sh</span>
<span id="cb46-52"><a href="bad.html#cb46-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-53"><a href="bad.html#cb46-53" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the script</span></span>
<span id="cb46-54"><a href="bad.html#cb46-54" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/merge-mbfiles-mix-pop.sh <span class="op">&gt;</span>../job-records/merge-mbfiles-mix</span>
<span id="cb46-55"><a href="bad.html#cb46-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-56"><a href="bad.html#cb46-56" aria-hidden="true" tabindex="-1"></a><span class="co">#-------</span></span>
<span id="cb46-57"><a href="bad.html#cb46-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. prune SNPs</span></span>
<span id="cb46-58"><a href="bad.html#cb46-58" aria-hidden="true" tabindex="-1"></a><span class="co">#-------</span></span>
<span id="cb46-59"><a href="bad.html#cb46-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-60"><a href="bad.html#cb46-60" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb46-61"><a href="bad.html#cb46-61" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb46-62"><a href="bad.html#cb46-62" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb46-63"><a href="bad.html#cb46-63" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 4</span></span>
<span id="cb46-64"><a href="bad.html#cb46-64" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb46-65"><a href="bad.html#cb46-65" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb46-66"><a href="bad.html#cb46-66" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 4 </span><span class="dt">\</span></span>
<span id="cb46-67"><a href="bad.html#cb46-67" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-prune 0.05 </span><span class="dt">\</span></span>
<span id="cb46-68"><a href="bad.html#cb46-68" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-kb 1000 </span><span class="dt">\</span></span>
<span id="cb46-69"><a href="bad.html#cb46-69" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb46-70"><a href="bad.html#cb46-70" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb46-71"><a href="bad.html#cb46-71" aria-hidden="true" tabindex="-1"></a><span class="st">          --thin ../thin/thin-chr</span><span class="va">$j</span></span>
<span id="cb46-72"><a href="bad.html#cb46-72" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>  <span class="op">&gt;</span> sh_script/thin<span class="va">$j</span></span>
<span id="cb46-73"><a href="bad.html#cb46-73" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-74"><a href="bad.html#cb46-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-75"><a href="bad.html#cb46-75" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-76"><a href="bad.html#cb46-76" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/thin<span class="va">$j</span></span>
<span id="cb46-77"><a href="bad.html#cb46-77" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/thin-snps</span>
<span id="cb46-78"><a href="bad.html#cb46-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-79"><a href="bad.html#cb46-79" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------</span></span>
<span id="cb46-80"><a href="bad.html#cb46-80" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. kinship matrix under GCTA</span></span>
<span id="cb46-81"><a href="bad.html#cb46-81" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------</span></span>
<span id="cb46-82"><a href="bad.html#cb46-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-83"><a href="bad.html#cb46-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{black</span><span class="op">,</span><span class="dt">asian}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-84"><a href="bad.html#cb46-84" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-85"><a href="bad.html#cb46-85" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb46-86"><a href="bad.html#cb46-86" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb46-87"><a href="bad.html#cb46-87" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb46-88"><a href="bad.html#cb46-88" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb46-89"><a href="bad.html#cb46-89" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 1:0:0</span></span>
<span id="cb46-90"><a href="bad.html#cb46-90" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb46-91"><a href="bad.html#cb46-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-92"><a href="bad.html#cb46-92" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb46-93"><a href="bad.html#cb46-93" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/</span><span class="va">$pop</span><span class="st">-gcta-thin</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb46-94"><a href="bad.html#cb46-94" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb46-95"><a href="bad.html#cb46-95" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../overlap-</span><span class="va">$pop</span><span class="st">-complete-cov.id</span><span class="dt">\</span></span>
<span id="cb46-96"><a href="bad.html#cb46-96" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../thin/thin-chr</span><span class="va">$j</span><span class="st">.in </span><span class="dt">\</span></span>
<span id="cb46-97"><a href="bad.html#cb46-97" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb46-98"><a href="bad.html#cb46-98" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb46-99"><a href="bad.html#cb46-99" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb46-100"><a href="bad.html#cb46-100" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb46-101"><a href="bad.html#cb46-101" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/<span class="va">$pop</span>-grm<span class="va">$j</span></span>
<span id="cb46-102"><a href="bad.html#cb46-102" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-103"><a href="bad.html#cb46-103" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-104"><a href="bad.html#cb46-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-105"><a href="bad.html#cb46-105" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files</span></span>
<span id="cb46-106"><a href="bad.html#cb46-106" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{black</span><span class="op">,</span><span class="dt">asian}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb46-107"><a href="bad.html#cb46-107" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-108"><a href="bad.html#cb46-108" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$pop</span>-grm<span class="va">$j</span></span>
<span id="cb46-109"><a href="bad.html#cb46-109" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-110"><a href="bad.html#cb46-110" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-pops</span>
<span id="cb46-111"><a href="bad.html#cb46-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-112"><a href="bad.html#cb46-112" aria-hidden="true" tabindex="-1"></a><span class="co"># merge grms</span></span>
<span id="cb46-113"><a href="bad.html#cb46-113" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{black</span><span class="op">,</span><span class="dt">asian}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-114"><a href="bad.html#cb46-114" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">$pop</span>-grm.list</span>
<span id="cb46-115"><a href="bad.html#cb46-115" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span> </span>
<span id="cb46-116"><a href="bad.html#cb46-116" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span> </span>
<span id="cb46-117"><a href="bad.html#cb46-117" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;../kinship/</span><span class="va">$pop</span><span class="st">-gcta-thin</span><span class="va">$j</span><span class="st">&quot;</span> <span class="op">&gt;&gt;</span> <span class="va">$pop</span>-grm.list</span>
<span id="cb46-118"><a href="bad.html#cb46-118" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-119"><a href="bad.html#cb46-119" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-120"><a href="bad.html#cb46-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-121"><a href="bad.html#cb46-121" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{black</span><span class="op">,</span><span class="dt">asian}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-122"><a href="bad.html#cb46-122" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb46-123"><a href="bad.html#cb46-123" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb46-124"><a href="bad.html#cb46-124" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb46-125"><a href="bad.html#cb46-125" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 80G</span></span>
<span id="cb46-126"><a href="bad.html#cb46-126" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb46-127"><a href="bad.html#cb46-127" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 12:0:0</span></span>
<span id="cb46-128"><a href="bad.html#cb46-128" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --add-grm ../kinship/</span><span class="va">$pop</span><span class="st">-gcta-thin --mgrm ../</span><span class="va">$pop</span><span class="st">-grm.list</span></span>
<span id="cb46-129"><a href="bad.html#cb46-129" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$pop</span>-grm.sh</span>
<span id="cb46-130"><a href="bad.html#cb46-130" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-131"><a href="bad.html#cb46-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-132"><a href="bad.html#cb46-132" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{black</span><span class="op">,</span><span class="dt">asian}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb46-133"><a href="bad.html#cb46-133" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$pop</span>-grm.sh </span>
<span id="cb46-134"><a href="bad.html#cb46-134" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-merge</span>
<span id="cb46-135"><a href="bad.html#cb46-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-136"><a href="bad.html#cb46-136" aria-hidden="true" tabindex="-1"></a><span class="co">#can now delete per-chr files</span></span>
<span id="cb46-137"><a href="bad.html#cb46-137" aria-hidden="true" tabindex="-1"></a><span class="co">#rm *gcta-thin{1..22}.*</span></span>
<span id="cb46-138"><a href="bad.html#cb46-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-139"><a href="bad.html#cb46-139" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------</span></span>
<span id="cb46-140"><a href="bad.html#cb46-140" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Relatedness filtering </span></span>
<span id="cb46-141"><a href="bad.html#cb46-141" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------</span></span>
<span id="cb46-142"><a href="bad.html#cb46-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-143"><a href="bad.html#cb46-143" aria-hidden="true" tabindex="-1"></a><span class="co"># relatedness filtering</span></span>
<span id="cb46-144"><a href="bad.html#cb46-144" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{asian</span><span class="op">,</span><span class="dt">black}</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb46-145"><a href="bad.html#cb46-145" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb46-146"><a href="bad.html#cb46-146" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb46-147"><a href="bad.html#cb46-147" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb46-148"><a href="bad.html#cb46-148" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb46-149"><a href="bad.html#cb46-149" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb46-150"><a href="bad.html#cb46-150" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 2:0:0</span></span>
<span id="cb46-151"><a href="bad.html#cb46-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-152"><a href="bad.html#cb46-152" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --filter ../relatedness/</span><span class="va">$pop</span><span class="st">-cut.05 </span><span class="dt">\</span></span>
<span id="cb46-153"><a href="bad.html#cb46-153" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/</span><span class="va">$pop</span><span class="st">-gcta-thin </span><span class="dt">\</span></span>
<span id="cb46-154"><a href="bad.html#cb46-154" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-rel 0.05 </span><span class="dt">\</span></span>
<span id="cb46-155"><a href="bad.html#cb46-155" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3</span></span>
<span id="cb46-156"><a href="bad.html#cb46-156" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$pop</span>-rel-cut.05.sh</span>
<span id="cb46-157"><a href="bad.html#cb46-157" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb46-158"><a href="bad.html#cb46-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-159"><a href="bad.html#cb46-159" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script</span></span>
<span id="cb46-160"><a href="bad.html#cb46-160" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{asian</span><span class="op">,</span><span class="dt">black}</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb46-161"><a href="bad.html#cb46-161" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$pop</span>-rel-cut.05.sh</span>
<span id="cb46-162"><a href="bad.html#cb46-162" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/relatedness-filtering</span>
<span id="cb46-163"><a href="bad.html#cb46-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-164"><a href="bad.html#cb46-164" aria-hidden="true" tabindex="-1"></a><span class="co"># remaining individuals</span></span>
<span id="cb46-165"><a href="bad.html#cb46-165" aria-hidden="true" tabindex="-1"></a><span class="co"># asian-cut.05.keep N = 3,448</span></span>
<span id="cb46-166"><a href="bad.html#cb46-166" aria-hidden="true" tabindex="-1"></a><span class="co"># black-cut.05.keep N = 3,024</span></span>
<span id="cb46-167"><a href="bad.html#cb46-167" aria-hidden="true" tabindex="-1"></a><span class="co"># sum = 6,472</span></span></code></pre></div>
</div>
<div id="final-list" class="section level3" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> final list</h3>
<p>To match the good GWAS, we will have N = 100k in total and replace 6,472 whites with Asians and Blacks.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="bad.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select  </span></span>
<span id="cb47-2"><a href="bad.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="ex">shuf</span> rand.100000 <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 93528 <span class="op">&gt;</span> white.rand.93528</span>
<span id="cb47-3"><a href="bad.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> white.rand.93528 relatedness/asian-cut.05.keep relatedness/black-cut.05.keep <span class="op">&gt;</span> mix-pop-gwas.id </span></code></pre></div>
</div>
<div id="pc-plot" class="section level3" number="9.1.4">
<h3><span class="header-section-number">9.1.4</span> PC plot</h3>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="bad.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># id</span></span>
<span id="cb48-2"><a href="bad.html#cb48-2" aria-hidden="true" tabindex="-1"></a>white<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;white.rand.93528&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb48-3"><a href="bad.html#cb48-3" aria-hidden="true" tabindex="-1"></a>black<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;relatedness/black-cut.05.keep&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb48-4"><a href="bad.html#cb48-4" aria-hidden="true" tabindex="-1"></a>asian<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;relatedness/asian-cut.05.keep&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb48-5"><a href="bad.html#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="bad.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co"># cov</span></span>
<span id="cb48-7"><a href="bad.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb48-8"><a href="bad.html#cb48-8" aria-hidden="true" tabindex="-1"></a>cov<span class="ot">=</span><span class="fu">vroom</span>(<span class="st">&quot;phen/covariates.phen&quot;</span>, <span class="at">col_names=</span>T)</span>
<span id="cb48-9"><a href="bad.html#cb48-9" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">=</span><span class="fu">match</span>(white<span class="sc">$</span>V1, cov<span class="sc">$</span>eid)</span>
<span id="cb48-10"><a href="bad.html#cb48-10" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">=</span><span class="fu">match</span>(black<span class="sc">$</span>V1, cov<span class="sc">$</span>eid)</span>
<span id="cb48-11"><a href="bad.html#cb48-11" aria-hidden="true" tabindex="-1"></a>m3<span class="ot">=</span><span class="fu">match</span>(asian<span class="sc">$</span>V1, cov<span class="sc">$</span>eid)</span>
<span id="cb48-12"><a href="bad.html#cb48-12" aria-hidden="true" tabindex="-1"></a>white<span class="ot">=</span>cov[m1,<span class="fu">c</span>(<span class="st">&quot;eid&quot;</span>, <span class="st">&quot;pc1&quot;</span>, <span class="st">&quot;pc2&quot;</span>)]</span>
<span id="cb48-13"><a href="bad.html#cb48-13" aria-hidden="true" tabindex="-1"></a>white<span class="sc">$</span>ethnicity<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb48-14"><a href="bad.html#cb48-14" aria-hidden="true" tabindex="-1"></a>white<span class="sc">$</span>white<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb48-15"><a href="bad.html#cb48-15" aria-hidden="true" tabindex="-1"></a>black<span class="ot">=</span>cov[m2,<span class="fu">c</span>(<span class="st">&quot;eid&quot;</span>, <span class="st">&quot;pc1&quot;</span>, <span class="st">&quot;pc2&quot;</span>)]</span>
<span id="cb48-16"><a href="bad.html#cb48-16" aria-hidden="true" tabindex="-1"></a>black<span class="sc">$</span>ethnicity<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb48-17"><a href="bad.html#cb48-17" aria-hidden="true" tabindex="-1"></a>black<span class="sc">$</span>white<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb48-18"><a href="bad.html#cb48-18" aria-hidden="true" tabindex="-1"></a>asian<span class="ot">=</span>cov[m3,<span class="fu">c</span>(<span class="st">&quot;eid&quot;</span>, <span class="st">&quot;pc1&quot;</span>, <span class="st">&quot;pc2&quot;</span>)]</span>
<span id="cb48-19"><a href="bad.html#cb48-19" aria-hidden="true" tabindex="-1"></a>asian<span class="sc">$</span>ethnicity<span class="ot">=</span><span class="dv">3</span></span>
<span id="cb48-20"><a href="bad.html#cb48-20" aria-hidden="true" tabindex="-1"></a>asian<span class="sc">$</span>white<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb48-21"><a href="bad.html#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="bad.html#cb48-22" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">rbind</span>(white,black,asian)</span>
<span id="cb48-23"><a href="bad.html#cb48-23" aria-hidden="true" tabindex="-1"></a>pc1_ave<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>pc1,<span class="at">INDEX=</span>dat<span class="sc">$</span>ethnicity, mean)</span>
<span id="cb48-24"><a href="bad.html#cb48-24" aria-hidden="true" tabindex="-1"></a>pc2_ave<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>pc2,<span class="at">INDEX=</span>dat<span class="sc">$</span>ethnicity, mean)</span>
<span id="cb48-25"><a href="bad.html#cb48-25" aria-hidden="true" tabindex="-1"></a>pc1_se<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>pc1,<span class="at">INDEX=</span>dat<span class="sc">$</span>ethnicity, sd)</span>
<span id="cb48-26"><a href="bad.html#cb48-26" aria-hidden="true" tabindex="-1"></a>pc2_se<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>pc2,<span class="at">INDEX=</span>dat<span class="sc">$</span>ethnicity, sd)</span>
<span id="cb48-27"><a href="bad.html#cb48-27" aria-hidden="true" tabindex="-1"></a>ave<span class="ot">=</span><span class="fu">cbind</span>(pc1_ave,pc2_ave)</span>
<span id="cb48-28"><a href="bad.html#cb48-28" aria-hidden="true" tabindex="-1"></a>se<span class="ot">=</span><span class="fu">cbind</span>(pc1_se,pc2_se)</span>
<span id="cb48-29"><a href="bad.html#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="bad.html#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb48-31"><a href="bad.html#cb48-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-32"><a href="bad.html#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/white-black-asian-pc1-vs-pc2.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb48-33"><a href="bad.html#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb48-34"><a href="bad.html#cb48-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-35"><a href="bad.html#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>pc1[dat<span class="sc">$</span>ethnicity<span class="sc">==</span><span class="dv">1</span>], dat<span class="sc">$</span>pc2[dat<span class="sc">$</span>ethnicity<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb48-36"><a href="bad.html#cb48-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;1st PC&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;2nd PC&quot;</span>,</span>
<span id="cb48-37"><a href="bad.html#cb48-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span><span class="st">&quot;PC1 vs PC2&quot;</span>, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb48-38"><a href="bad.html#cb48-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>pc1),<span class="fu">max</span>(dat<span class="sc">$</span>pc1)), </span>
<span id="cb48-39"><a href="bad.html#cb48-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>pc2),<span class="fu">max</span>(dat<span class="sc">$</span>pc2)),</span>
<span id="cb48-40"><a href="bad.html#cb48-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">&quot;lightgray&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb48-41"><a href="bad.html#cb48-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-42"><a href="bad.html#cb48-42" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>pc1[dat<span class="sc">$</span>ethnicity<span class="sc">==</span><span class="dv">2</span>],dat<span class="sc">$</span>pc2[dat<span class="sc">$</span>ethnicity<span class="sc">==</span><span class="dv">2</span>], </span>
<span id="cb48-43"><a href="bad.html#cb48-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">16</span>,  <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb48-44"><a href="bad.html#cb48-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-45"><a href="bad.html#cb48-45" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>pc1[dat<span class="sc">$</span>ethnicity<span class="sc">==</span><span class="dv">3</span>],dat<span class="sc">$</span>pc2[dat<span class="sc">$</span>ethnicity<span class="sc">==</span><span class="dv">3</span>], </span>
<span id="cb48-46"><a href="bad.html#cb48-46" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">16</span>,  <span class="at">col=</span><span class="st">&quot;darkcyan&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb48-47"><a href="bad.html#cb48-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-48"><a href="bad.html#cb48-48" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(ave[<span class="dv">1</span>,<span class="dv">1</span>], ave[<span class="dv">1</span>,<span class="dv">2</span>], <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb48-49"><a href="bad.html#cb48-49" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(ave[<span class="dv">2</span>,<span class="dv">1</span>], ave[<span class="dv">2</span>,<span class="dv">2</span>], <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;red&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb48-50"><a href="bad.html#cb48-50" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(ave[<span class="dv">3</span>,<span class="dv">1</span>], ave[<span class="dv">3</span>,<span class="dv">2</span>], <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;blue&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb48-51"><a href="bad.html#cb48-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-52"><a href="bad.html#cb48-52" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
</div>
<div id="gwas-lm" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> GWAS-lm</h2>
<div id="basic-cov" class="section level3" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> basic cov</h3>
<p>We use basic covariates only: age, sex and townsend.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb49-1"><a href="bad.html#cb49-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-2"><a href="bad.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># covariates--------------------------------------------------------------------</span></span>
<span id="cb49-3"><a href="bad.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $3, $4, $5}&#39;</span> covariates.use <span class="op">&gt;</span> basic-covariates.use</span>
<span id="cb49-4"><a href="bad.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&lt;=5{print $0}&#39;</span> covariates.use-names <span class="op">&gt;</span> basic-covariates.use</span>
<span id="cb49-5"><a href="bad.html#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="bad.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># gwas</span></span>
<span id="cb49-7"><a href="bad.html#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb49-8"><a href="bad.html#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb49-9"><a href="bad.html#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb49-10"><a href="bad.html#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb49-11"><a href="bad.html#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb49-12"><a href="bad.html#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb49-13"><a href="bad.html#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb49-14"><a href="bad.html#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb49-15"><a href="bad.html#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="bad.html#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../gwas-mix/</span><span class="va">$i</span><span class="st">-linear-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb49-17"><a href="bad.html#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb49-18"><a href="bad.html#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb49-19"><a href="bad.html#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb49-20"><a href="bad.html#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb49-21"><a href="bad.html#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-unrel-inds.use </span><span class="dt">\</span></span>
<span id="cb49-22"><a href="bad.html#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb49-23"><a href="bad.html#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span></span>
<span id="cb49-24"><a href="bad.html#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-chr-<span class="va">$j</span>.sh</span>
<span id="cb49-25"><a href="bad.html#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb49-26"><a href="bad.html#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb49-27"><a href="bad.html#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="bad.html#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co"># --covar ../phen/covariates.use</span></span>
<span id="cb49-29"><a href="bad.html#cb49-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-30"><a href="bad.html#cb49-30" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb49-31"><a href="bad.html#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb49-32"><a href="bad.html#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb49-33"><a href="bad.html#cb49-33" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-chr-<span class="va">$j</span>.sh</span>
<span id="cb49-34"><a href="bad.html#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb49-35"><a href="bad.html#cb49-35" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-mix-pop</span>
<span id="cb49-36"><a href="bad.html#cb49-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-37"><a href="bad.html#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb49-38"><a href="bad.html#cb49-38" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/gwas-mix-pop</span>
<span id="cb49-39"><a href="bad.html#cb49-39" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb49-40"><a href="bad.html#cb49-40" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb49-41"><a href="bad.html#cb49-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb49-42"><a href="bad.html#cb49-42" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb49-43"><a href="bad.html#cb49-43" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb49-44"><a href="bad.html#cb49-44" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb49-45"><a href="bad.html#cb49-45" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb49-46"><a href="bad.html#cb49-46" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb49-47"><a href="bad.html#cb49-47" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb49-48"><a href="bad.html#cb49-48" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb49-49"><a href="bad.html#cb49-49" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb49-50"><a href="bad.html#cb49-50" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb49-51"><a href="bad.html#cb49-51" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb49-52"><a href="bad.html#cb49-52" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb49-53"><a href="bad.html#cb49-53" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb49-54"><a href="bad.html#cb49-54" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb49-55"><a href="bad.html#cb49-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-56"><a href="bad.html#cb49-56" aria-hidden="true" tabindex="-1"></a><span class="co"># combine results</span></span>
<span id="cb49-57"><a href="bad.html#cb49-57" aria-hidden="true" tabindex="-1"></a><span class="co"># only need .summaries &amp; .pvalues</span></span>
<span id="cb49-58"><a href="bad.html#cb49-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb49-59"><a href="bad.html#cb49-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb49-60"><a href="bad.html#cb49-60" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$j</span> <span class="ot">==</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb49-61"><a href="bad.html#cb49-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.summaries <span class="op">&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb49-62"><a href="bad.html#cb49-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.pvalues <span class="op">&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb49-63"><a href="bad.html#cb49-63" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> </span>
<span id="cb49-64"><a href="bad.html#cb49-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.summaries <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.summaries</span>
<span id="cb49-65"><a href="bad.html#cb49-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $0}&#39;</span> <span class="va">$i</span>-linear-chr-<span class="va">$j</span>.pvalues <span class="op">&gt;&gt;</span> <span class="va">$i</span>-linear.pvalues</span>
<span id="cb49-66"><a href="bad.html#cb49-66" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb49-67"><a href="bad.html#cb49-67" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb49-68"><a href="bad.html#cb49-68" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="basic-cov-pc" class="section level3" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> basic cov + PC</h3>
<p>Here we add PC one at a time until the tenth as covariates and conduct GWAS</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="bad.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># covariates--------------------------------------------------------------------</span></span>
<span id="cb50-2"><a href="bad.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb50-3"><a href="bad.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 999<span class="kw">)</span></span>
<span id="cb50-4"><a href="bad.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb50-5"><a href="bad.html#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;phen/covariates.phen&quot;</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb50-6"><a href="bad.html#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;eid&quot;</span><span class="ex">,</span><span class="st">&quot;age&quot;</span><span class="ex">,</span><span class="st">&quot;sex_gen&quot;</span><span class="ex">,</span> <span class="st">&quot;townsend&quot;</span>, paste0<span class="er">(</span><span class="st">&quot;pc&quot;</span><span class="ex">,1:40</span><span class="kw">))</span></span>
<span id="cb50-7"><a href="bad.html#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>cov[,nm]</span>
<span id="cb50-8"><a href="bad.html#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="bad.html#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:10<span class="kw">){</span></span>
<span id="cb50-10"><a href="bad.html#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">sel</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;eid&quot;</span><span class="ex">,</span><span class="st">&quot;eid&quot;</span><span class="ex">,</span><span class="st">&quot;age&quot;</span><span class="ex">,</span><span class="st">&quot;sex_gen&quot;</span><span class="ex">,</span> <span class="st">&quot;townsend&quot;</span>, paste0<span class="er">(</span><span class="st">&quot;pc&quot;</span><span class="ex">,</span> 1:i<span class="kw">))</span></span>
<span id="cb50-11"><a href="bad.html#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>cov[,sel]</span>
<span id="cb50-12"><a href="bad.html#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">file1</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;phen/covariates-basic-&quot;</span><span class="ex">,i,</span><span class="st">&quot;PC.use&quot;</span><span class="kw">)</span></span>
<span id="cb50-13"><a href="bad.html#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="va">file2</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;phen/covariates-basic-&quot;</span><span class="ex">,i,</span><span class="st">&quot;PC.use-names&quot;</span><span class="kw">)</span></span>
<span id="cb50-14"><a href="bad.html#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,file1,</span> col.names=F, row.names=F,quote=F<span class="kw">)</span></span>
<span id="cb50-15"><a href="bad.html#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">names</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">,file2,</span> col.names=F, row.names=F,quote=F<span class="kw">)</span></span>
<span id="cb50-16"><a href="bad.html#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb50-17"><a href="bad.html#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="bad.html#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co"># gwas--------------------------------------------------------------------------</span></span>
<span id="cb50-19"><a href="bad.html#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">10</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb50-20"><a href="bad.html#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-mix-<span class="va">$j</span><span class="st">&#39;PC&#39;</span></span>
<span id="cb50-21"><a href="bad.html#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb50-22"><a href="bad.html#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../gwas-mix-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>/<span class="va">$i</span>-linear</span>
<span id="cb50-23"><a href="bad.html#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>../phen/covariates-basic-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>.use</span>
<span id="cb50-24"><a href="bad.html#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb50-25"><a href="bad.html#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb50-26"><a href="bad.html#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb50-27"><a href="bad.html#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 6G</span></span>
<span id="cb50-28"><a href="bad.html#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb50-29"><a href="bad.html#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 6:0:0</span></span>
<span id="cb50-30"><a href="bad.html#cb50-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-31"><a href="bad.html#cb50-31" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb50-32"><a href="bad.html#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb50-33"><a href="bad.html#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb50-34"><a href="bad.html#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar </span><span class="va">$cov</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb50-35"><a href="bad.html#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb50-36"><a href="bad.html#cb50-36" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-unrel-inds.use </span><span class="dt">\</span></span>
<span id="cb50-37"><a href="bad.html#cb50-37" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb50-38"><a href="bad.html#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>.sh</span>
<span id="cb50-39"><a href="bad.html#cb50-39" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb50-40"><a href="bad.html#cb50-40" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb50-41"><a href="bad.html#cb50-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-42"><a href="bad.html#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb50-43"><a href="bad.html#cb50-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">10</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb50-44"><a href="bad.html#cb50-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb50-45"><a href="bad.html#cb50-45" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>.sh</span>
<span id="cb50-46"><a href="bad.html#cb50-46" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb50-47"><a href="bad.html#cb50-47" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-mix-pc</span>
<span id="cb50-48"><a href="bad.html#cb50-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-49"><a href="bad.html#cb50-49" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb50-50"><a href="bad.html#cb50-50" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/gwas-mix-pc</span>
<span id="cb50-51"><a href="bad.html#cb50-51" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb50-52"><a href="bad.html#cb50-52" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb50-53"><a href="bad.html#cb50-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb50-54"><a href="bad.html#cb50-54" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb50-55"><a href="bad.html#cb50-55" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb50-56"><a href="bad.html#cb50-56" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb50-57"><a href="bad.html#cb50-57" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb50-58"><a href="bad.html#cb50-58" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb50-59"><a href="bad.html#cb50-59" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb50-60"><a href="bad.html#cb50-60" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb50-61"><a href="bad.html#cb50-61" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb50-62"><a href="bad.html#cb50-62" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb50-63"><a href="bad.html#cb50-63" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb50-64"><a href="bad.html#cb50-64" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb50-65"><a href="bad.html#cb50-65" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb50-66"><a href="bad.html#cb50-66" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
</div>
<div id="gwas-bolt-lmm" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> GWAS-bolt-lmm</h2>
<p>Here we used linear mixed-effects models to test the association between genetic variants and phenotypes. The argument for the use of linear mixed-effects models is that it can account for the confounding effects from population stratification (check the rationale behind BLOT-LMM). Here we check if there is evidence of inflation in the chi-square test statistics from BOLT-LMM.</p>
<p>As shown below, the slopes are sig. different from zero, but they are negative, indicating that chi-square test statistics decreases as aver2_j increases. Based on the plots (chisq ~ aver2_j), it seems that most large signals (i.e., large chisq test statistics) have an aver2_j close to zero, indicating that aver2_j (or fake tagging) does not drive the GWAS signals. However, how aver2_j relates to chisq of bolt-lmm seems different from how aver2_j relates to chisq of good gwas.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb51-1"><a href="bad.html#cb51-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-2"><a href="bad.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># make filter files-------------------------------------------------------------</span></span>
<span id="cb51-3"><a href="bad.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="va">fam</span><span class="op">=</span>gen/geno-mix.fam</span>
<span id="cb51-4"><a href="bad.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="va">bim</span><span class="op">=</span>gen/geno-mix.bim</span>
<span id="cb51-5"><a href="bad.html#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>mix-pop-gwas.id</span>
<span id="cb51-6"><a href="bad.html#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="va">snp</span><span class="op">=</span>gen/snps-unrel-inds.use</span>
<span id="cb51-7"><a href="bad.html#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="va">id_remove</span><span class="op">=</span>BOLT-LMM_v2.3.5/mix-pop-gwas-id.exclude</span>
<span id="cb51-8"><a href="bad.html#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="va">snp_exclude</span><span class="op">=</span>BOLT-LMM_v2.3.5/snps-unrel-inds.remove</span>
<span id="cb51-9"><a href="bad.html#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="bad.html#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1];next} </span></span>
<span id="cb51-11"><a href="bad.html#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="st">     !($2 in a) {print $2}&#39;</span> <span class="va">$snp</span> <span class="va">$bim</span> <span class="op">&gt;</span> <span class="va">$snp_exclude</span></span>
<span id="cb51-12"><a href="bad.html#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co"># note the list is empty because $snp &amp; $bim contain the same list</span></span>
<span id="cb51-13"><a href="bad.html#cb51-13" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb51-14"><a href="bad.html#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1];next} </span></span>
<span id="cb51-15"><a href="bad.html#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="st">     !($1 in a) {print $0}&#39;</span> <span class="va">$id</span> <span class="va">$fam</span> <span class="op">&gt;</span> <span class="va">$id_remove</span></span>
<span id="cb51-16"><a href="bad.html#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="bad.html#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co"># organize phenotype files------------------------------------------------------</span></span>
<span id="cb51-18"><a href="bad.html#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb51-19"><a href="bad.html#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 999<span class="kw">)</span></span>
<span id="cb51-20"><a href="bad.html#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb51-21"><a href="bad.html#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="bad.html#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="co"># covariate file</span></span>
<span id="cb51-23"><a href="bad.html#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;phen/covariates.phen&quot;</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb51-24"><a href="bad.html#cb51-24" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;age&quot;</span><span class="ex">,</span><span class="st">&quot;sex_gen&quot;</span><span class="ex">,</span> <span class="st">&quot;townsend&quot;</span> ,paste0<span class="er">(</span><span class="st">&quot;pc&quot;</span><span class="ex">,1:40</span><span class="kw">))</span></span>
<span id="cb51-25"><a href="bad.html#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="bad.html#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb51-27"><a href="bad.html#cb51-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb51-28"><a href="bad.html#cb51-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb51-29"><a href="bad.html#cb51-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-30"><a href="bad.html#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb51-31"><a href="bad.html#cb51-31" aria-hidden="true" tabindex="-1"></a>    <span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb51-32"><a href="bad.html#cb51-32" aria-hidden="true" tabindex="-1"></a>    <span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;phen/continuous-traits/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;.raw.pheno&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb51-33"><a href="bad.html#cb51-33" aria-hidden="true" tabindex="-1"></a>    <span class="va">m</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">dat</span><span class="va">$X1</span><span class="ex">,cov</span><span class="va">$eid</span><span class="kw">)</span></span>
<span id="cb51-34"><a href="bad.html#cb51-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-35"><a href="bad.html#cb51-35" aria-hidden="true" tabindex="-1"></a>    <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">FID</span><span class="op">=</span>dat<span class="va">$X1</span>,</span>
<span id="cb51-36"><a href="bad.html#cb51-36" aria-hidden="true" tabindex="-1"></a>                   <span class="va">IID</span><span class="op">=</span>dat<span class="va">$X2</span>,</span>
<span id="cb51-37"><a href="bad.html#cb51-37" aria-hidden="true" tabindex="-1"></a>                   <span class="va">PHENO</span><span class="op">=</span>dat<span class="va">$X3</span>,</span>
<span id="cb51-38"><a href="bad.html#cb51-38" aria-hidden="true" tabindex="-1"></a>                   <span class="va">cov</span><span class="op">[</span>m,nm<span class="op">]</span><span class="kw">)</span></span>
<span id="cb51-39"><a href="bad.html#cb51-39" aria-hidden="true" tabindex="-1"></a>    <span class="va">old</span><span class="op">=</span>names<span class="kw">(</span><span class="ex">out</span><span class="kw">)</span></span>
<span id="cb51-40"><a href="bad.html#cb51-40" aria-hidden="true" tabindex="-1"></a>    <span class="va">new</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">names</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">[1:3],</span> paste0<span class="er">(</span><span class="st">&quot;COV&quot;</span><span class="ex">,1:43</span><span class="kw">))</span></span>
<span id="cb51-41"><a href="bad.html#cb51-41" aria-hidden="true" tabindex="-1"></a>    <span class="ex">names</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">=new</span></span>
<span id="cb51-42"><a href="bad.html#cb51-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;BOLT-LMM_v2.3.5/dat/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;.dat&quot;</span><span class="kw">)</span><span class="ex">,</span> col.names=T,</span>
<span id="cb51-43"><a href="bad.html#cb51-43" aria-hidden="true" tabindex="-1"></a>                <span class="ex">row.names=F,</span> quote=F<span class="kw">)</span></span>
<span id="cb51-44"><a href="bad.html#cb51-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">){</span></span>
<span id="cb51-45"><a href="bad.html#cb51-45" aria-hidden="true" tabindex="-1"></a>            <span class="ex">out.nm=data.frame</span><span class="er">(</span><span class="va">name</span><span class="op">=</span>new,true_name=old, <span class="va">stringsAsFactors</span><span class="op">=</span>F<span class="kw">)</span></span>
<span id="cb51-46"><a href="bad.html#cb51-46" aria-hidden="true" tabindex="-1"></a>            <span class="ex">write.table</span><span class="er">(</span><span class="ex">out.nm,</span><span class="st">&quot;BOLT-LMM_v2.3.5/dat/cov-names&quot;</span><span class="ex">,</span> </span>
<span id="cb51-47"><a href="bad.html#cb51-47" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb51-48"><a href="bad.html#cb51-48" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb51-49"><a href="bad.html#cb51-49" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb51-50"><a href="bad.html#cb51-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-51"><a href="bad.html#cb51-51" aria-hidden="true" tabindex="-1"></a><span class="co"># model SNPs--------------------------------------------------------------------</span></span>
<span id="cb51-52"><a href="bad.html#cb51-52" aria-hidden="true" tabindex="-1"></a><span class="co"># subset snps used in GRM for BOLT-LMM</span></span>
<span id="cb51-53"><a href="bad.html#cb51-53" aria-hidden="true" tabindex="-1"></a><span class="co"># we previously thinned SNPs: see &#39;relatedness filtering&#39; section of bad GWAS</span></span>
<span id="cb51-54"><a href="bad.html#cb51-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we just merge them across chromsomes</span></span>
<span id="cb51-55"><a href="bad.html#cb51-55" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>thin/geno-mix-thin-snps</span>
<span id="cb51-56"><a href="bad.html#cb51-56" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">$out</span> </span>
<span id="cb51-57"><a href="bad.html#cb51-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb51-58"><a href="bad.html#cb51-58" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{print $0}&#39;</span> thin/thin-chr<span class="va">$i</span>.in <span class="op">&gt;&gt;</span> <span class="va">$out</span></span>
<span id="cb51-59"><a href="bad.html#cb51-59" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb51-60"><a href="bad.html#cb51-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-61"><a href="bad.html#cb51-61" aria-hidden="true" tabindex="-1"></a><span class="co"># run BOLT-LMM------------------------------------------------------------------</span></span>
<span id="cb51-62"><a href="bad.html#cb51-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb51-63"><a href="bad.html#cb51-63" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>../gwas-bad</span>
<span id="cb51-64"><a href="bad.html#cb51-64" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb51-65"><a href="bad.html#cb51-65" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb51-66"><a href="bad.html#cb51-66" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb51-67"><a href="bad.html#cb51-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb51-68"><a href="bad.html#cb51-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb51-69"><a href="bad.html#cb51-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb51-70"><a href="bad.html#cb51-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-71"><a href="bad.html#cb51-71" aria-hidden="true" tabindex="-1"></a><span class="st">../bolt --bfile=../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb51-72"><a href="bad.html#cb51-72" aria-hidden="true" tabindex="-1"></a><span class="st">         --phenoFile=../dat/</span><span class="va">$i</span><span class="st">.dat </span><span class="dt">\</span></span>
<span id="cb51-73"><a href="bad.html#cb51-73" aria-hidden="true" tabindex="-1"></a><span class="st">         --phenoCol=PHENO </span><span class="dt">\</span></span>
<span id="cb51-74"><a href="bad.html#cb51-74" aria-hidden="true" tabindex="-1"></a><span class="st">         --remove=../mix-pop-gwas-id.exclude</span><span class="dt">\</span></span>
<span id="cb51-75"><a href="bad.html#cb51-75" aria-hidden="true" tabindex="-1"></a><span class="st">         --lmm </span><span class="dt">\</span></span>
<span id="cb51-76"><a href="bad.html#cb51-76" aria-hidden="true" tabindex="-1"></a><span class="st">         --LDscoresFile=../tables/LDSCORE.1000G_EUR.tab.gz </span><span class="dt">\</span></span>
<span id="cb51-77"><a href="bad.html#cb51-77" aria-hidden="true" tabindex="-1"></a><span class="st">         --LDscoresMatchBp </span><span class="dt">\</span></span>
<span id="cb51-78"><a href="bad.html#cb51-78" aria-hidden="true" tabindex="-1"></a><span class="st">         --covarFile=../dat/</span><span class="va">$i</span><span class="st">.dat </span><span class="dt">\</span></span>
<span id="cb51-79"><a href="bad.html#cb51-79" aria-hidden="true" tabindex="-1"></a><span class="st">         --qCovarCol=COV{1:3}</span><span class="dt">\</span></span>
<span id="cb51-80"><a href="bad.html#cb51-80" aria-hidden="true" tabindex="-1"></a><span class="st">         --modelSnps=../geno-mix-thin-snps </span><span class="dt">\</span></span>
<span id="cb51-81"><a href="bad.html#cb51-81" aria-hidden="true" tabindex="-1"></a><span class="st">         --maxMissingPerSnp=1 </span><span class="dt">\</span></span>
<span id="cb51-82"><a href="bad.html#cb51-82" aria-hidden="true" tabindex="-1"></a><span class="st">         --maxMissingPerIndiv=1 </span><span class="dt">\</span></span>
<span id="cb51-83"><a href="bad.html#cb51-83" aria-hidden="true" tabindex="-1"></a><span class="st">         --statsFile=</span><span class="va">$dir</span><span class="st">/</span><span class="va">$i</span><span class="st">.out </span><span class="dt">\</span></span>
<span id="cb51-84"><a href="bad.html#cb51-84" aria-hidden="true" tabindex="-1"></a><span class="st">         --numThreads=10 </span><span class="dt">\</span></span>
<span id="cb51-85"><a href="bad.html#cb51-85" aria-hidden="true" tabindex="-1"></a><span class="st">       2&gt;&amp;1 | tee </span><span class="va">$dir</span><span class="st">/</span><span class="va">$i</span><span class="st">.log</span></span>
<span id="cb51-86"><a href="bad.html#cb51-86" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-bolt-lmm.sh</span>
<span id="cb51-87"><a href="bad.html#cb51-87" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb51-88"><a href="bad.html#cb51-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-89"><a href="bad.html#cb51-89" aria-hidden="true" tabindex="-1"></a><span class="co"># submit scripts</span></span>
<span id="cb51-90"><a href="bad.html#cb51-90" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb51-91"><a href="bad.html#cb51-91" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-bolt-lmm.sh</span>
<span id="cb51-92"><a href="bad.html#cb51-92" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/bolt-lmm-bad</span>
<span id="cb51-93"><a href="bad.html#cb51-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-94"><a href="bad.html#cb51-94" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb51-95"><a href="bad.html#cb51-95" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/bolt-lmm-bad</span>
<span id="cb51-96"><a href="bad.html#cb51-96" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb51-97"><a href="bad.html#cb51-97" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb51-98"><a href="bad.html#cb51-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb51-99"><a href="bad.html#cb51-99" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb51-100"><a href="bad.html#cb51-100" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb51-101"><a href="bad.html#cb51-101" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb51-102"><a href="bad.html#cb51-102" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb51-103"><a href="bad.html#cb51-103" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb51-104"><a href="bad.html#cb51-104" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb51-105"><a href="bad.html#cb51-105" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb51-106"><a href="bad.html#cb51-106" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb51-107"><a href="bad.html#cb51-107" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb51-108"><a href="bad.html#cb51-108" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb51-109"><a href="bad.html#cb51-109" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb51-110"><a href="bad.html#cb51-110" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb51-111"><a href="bad.html#cb51-111" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb51-112"><a href="bad.html#cb51-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-113"><a href="bad.html#cb51-113" aria-hidden="true" tabindex="-1"></a><span class="co"># organize results -------------------------------------------------------------</span></span>
<span id="cb51-114"><a href="bad.html#cb51-114" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-norm-337k-out</span>
<span id="cb51-115"><a href="bad.html#cb51-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-116"><a href="bad.html#cb51-116" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb51-117"><a href="bad.html#cb51-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-118"><a href="bad.html#cb51-118" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-norm-337k/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb51-119"><a href="bad.html#cb51-119" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-ukbb-norm</span>
<span id="cb51-120"><a href="bad.html#cb51-120" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-norm-337k-out/<span class="va">$trait</span>.out</span>
<span id="cb51-121"><a href="bad.html#cb51-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-122"><a href="bad.html#cb51-122" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp    </span>
<span id="cb51-123"><a href="bad.html#cb51-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-124"><a href="bad.html#cb51-124" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb51-125"><a href="bad.html#cb51-125" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb51-126"><a href="bad.html#cb51-126" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb51-127"><a href="bad.html#cb51-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-128"><a href="bad.html#cb51-128" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb51-129"><a href="bad.html#cb51-129" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb51-130"><a href="bad.html#cb51-130" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb51-131"><a href="bad.html#cb51-131" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb51-132"><a href="bad.html#cb51-132" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2&quot;}</span></span>
<span id="cb51-133"><a href="bad.html#cb51-133" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb51-134"><a href="bad.html#cb51-134" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="correct-genotypes" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> correct genotypes</h2>
<p>Here we want to adjust genotypes for PCs. We add one PC at a time and check the change in the distribution of aver2. How is that compared to the aver2 from the good gwas?</p>
<div id="cal-aver2" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> cal-aver2</h3>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="bad.html#cb52-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-2"><a href="bad.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># organize covariate files [only PCs]-------------------------------------------</span></span>
<span id="cb52-3"><a href="bad.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb52-4"><a href="bad.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 999<span class="kw">)</span></span>
<span id="cb52-5"><a href="bad.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb52-6"><a href="bad.html#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;phen/covariates.phen&quot;</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb52-7"><a href="bad.html#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="va">nm</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;eid&quot;</span><span class="ex">,paste0</span><span class="er">(</span><span class="st">&quot;pc&quot;</span><span class="ex">,1:40</span><span class="kw">))</span></span>
<span id="cb52-8"><a href="bad.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>cov[,nm]</span>
<span id="cb52-9"><a href="bad.html#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="bad.html#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">#1:10, </span></span>
<span id="cb52-11"><a href="bad.html#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in c<span class="er">(</span><span class="ex">1:10,</span> 20, 40<span class="kw">)){</span></span>
<span id="cb52-12"><a href="bad.html#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">sel</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;eid&quot;</span><span class="ex">,</span> <span class="st">&quot;eid&quot;</span>, paste0<span class="er">(</span><span class="st">&quot;pc&quot;</span><span class="ex">,</span> 1:i<span class="kw">))</span></span>
<span id="cb52-13"><a href="bad.html#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>cov[,sel]</span>
<span id="cb52-14"><a href="bad.html#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="va">file1</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;phen/PC-&quot;</span><span class="ex">,i,</span><span class="st">&quot;.use&quot;</span><span class="kw">)</span></span>
<span id="cb52-15"><a href="bad.html#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="va">file2</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;phen/PC-&quot;</span><span class="ex">,i,</span><span class="st">&quot;.use-names&quot;</span><span class="kw">)</span></span>
<span id="cb52-16"><a href="bad.html#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,file1,</span> col.names=F, row.names=F,quote=F<span class="kw">)</span></span>
<span id="cb52-17"><a href="bad.html#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">names</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">,file2,</span> col.names=F, row.names=F,quote=F<span class="kw">)</span></span>
<span id="cb52-18"><a href="bad.html#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb52-19"><a href="bad.html#cb52-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-20"><a href="bad.html#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="co"># calc aver2 ---------------------------------------------------------------</span></span>
<span id="cb52-21"><a href="bad.html#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> inflation/adjust-geno</span>
<span id="cb52-22"><a href="bad.html#cb52-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-23"><a href="bad.html#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="co"># lista-------------------------------------------------------</span></span>
<span id="cb52-24"><a href="bad.html#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{1..10</span><span class="op">,</span><span class="dt">20</span><span class="op">,</span><span class="dt">40}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb52-25"><a href="bad.html#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb52-26"><a href="bad.html#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb52-27"><a href="bad.html#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../mix-pop-gwas.id </span>
<span id="cb52-28"><a href="bad.html#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-mix</span>
<span id="cb52-29"><a href="bad.html#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>../phen/PC-<span class="va">$i</span>.use</span>
<span id="cb52-30"><a href="bad.html#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/adjust-geno/aver2-lista-PC<span class="va">$i</span></span>
<span id="cb52-31"><a href="bad.html#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="bad.html#cb52-32" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb52-33"><a href="bad.html#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb52-34"><a href="bad.html#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb52-35"><a href="bad.html#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb52-36"><a href="bad.html#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb52-37"><a href="bad.html#cb52-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb52-38"><a href="bad.html#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb52-39"><a href="bad.html#cb52-39" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb52-40"><a href="bad.html#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar </span><span class="va">$cov</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb52-41"><a href="bad.html#cb52-41" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb52-42"><a href="bad.html#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb52-43"><a href="bad.html#cb52-43" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb52-44"><a href="bad.html#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb52-45"><a href="bad.html#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-lista-PC<span class="va">$i</span></span>
<span id="cb52-46"><a href="bad.html#cb52-46" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb52-47"><a href="bad.html#cb52-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-48"><a href="bad.html#cb52-48" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb52-49"><a href="bad.html#cb52-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{1:10</span><span class="op">,</span><span class="dt">20</span><span class="op">,</span><span class="dt">40}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb52-50"><a href="bad.html#cb52-50" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-lista-PC<span class="va">$i</span> </span>
<span id="cb52-51"><a href="bad.html#cb52-51" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/calc-aver2-adj-geno-lista</span>
<span id="cb52-52"><a href="bad.html#cb52-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-53"><a href="bad.html#cb52-53" aria-hidden="true" tabindex="-1"></a><span class="co"># listb-------------------------------------------------------</span></span>
<span id="cb52-54"><a href="bad.html#cb52-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-55"><a href="bad.html#cb52-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{1..10</span><span class="op">,</span><span class="dt">20</span><span class="op">,</span><span class="dt">40}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb52-56"><a href="bad.html#cb52-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-57"><a href="bad.html#cb52-57" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb52-58"><a href="bad.html#cb52-58" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb52-59"><a href="bad.html#cb52-59" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../mix-pop-gwas.id </span>
<span id="cb52-60"><a href="bad.html#cb52-60" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-mix</span>
<span id="cb52-61"><a href="bad.html#cb52-61" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>../phen/PC-<span class="va">$i</span>.use</span>
<span id="cb52-62"><a href="bad.html#cb52-62" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/adjust-geno/aver2-listb-PC<span class="va">$i</span></span>
<span id="cb52-63"><a href="bad.html#cb52-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-64"><a href="bad.html#cb52-64" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb52-65"><a href="bad.html#cb52-65" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb52-66"><a href="bad.html#cb52-66" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb52-67"><a href="bad.html#cb52-67" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb52-68"><a href="bad.html#cb52-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb52-69"><a href="bad.html#cb52-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:20:0</span></span>
<span id="cb52-70"><a href="bad.html#cb52-70" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb52-71"><a href="bad.html#cb52-71" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb52-72"><a href="bad.html#cb52-72" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar </span><span class="va">$cov</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb52-73"><a href="bad.html#cb52-73" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb52-74"><a href="bad.html#cb52-74" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb52-75"><a href="bad.html#cb52-75" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$listb</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb52-76"><a href="bad.html#cb52-76" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$lista</span></span>
<span id="cb52-77"><a href="bad.html#cb52-77" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-listb-PC<span class="va">$i</span></span>
<span id="cb52-78"><a href="bad.html#cb52-78" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb52-79"><a href="bad.html#cb52-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-80"><a href="bad.html#cb52-80" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb52-81"><a href="bad.html#cb52-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{1:10</span><span class="op">,</span><span class="dt">20</span><span class="op">,</span><span class="dt">40}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb52-82"><a href="bad.html#cb52-82" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-listb-PC<span class="va">$i</span> </span>
<span id="cb52-83"><a href="bad.html#cb52-83" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/calc-aver2-adj-geno-listb</span>
<span id="cb52-84"><a href="bad.html#cb52-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-85"><a href="bad.html#cb52-85" aria-hidden="true" tabindex="-1"></a><span class="co"># merge aver2 of the two lists--------------------------------------------------</span></span>
<span id="cb52-86"><a href="bad.html#cb52-86" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>inflation/adjust-geno</span>
<span id="cb52-87"><a href="bad.html#cb52-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-88"><a href="bad.html#cb52-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{1:10</span><span class="op">,</span><span class="dt">20</span><span class="op">,</span><span class="dt">40}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb52-89"><a href="bad.html#cb52-89" aria-hidden="true" tabindex="-1"></a><span class="va">a</span><span class="op">=</span><span class="va">$dir</span>/aver2-lista-PC<span class="va">$i</span>.rjk2.average</span>
<span id="cb52-90"><a href="bad.html#cb52-90" aria-hidden="true" tabindex="-1"></a><span class="va">b</span><span class="op">=</span><span class="va">$dir</span>/aver2-listb-PC<span class="va">$i</span>.rjk2.average</span>
<span id="cb52-91"><a href="bad.html#cb52-91" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$dir</span>/geno-mix-PC-<span class="va">$i</span>.aver2</span>
<span id="cb52-92"><a href="bad.html#cb52-92" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;FNR &gt; 1 {print $1, $2}&#39;</span>  <span class="va">$a</span> <span class="va">$b</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb52-93"><a href="bad.html#cb52-93" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="compare-changes-in-aver2" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> compare changes in aver2</h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="bad.html#cb53-1" aria-hidden="true" tabindex="-1"></a>good<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;summary/ave-r2-by-snp-goodgwas&quot;</span>, <span class="at">header=</span>F,</span>
<span id="cb53-2"><a href="bad.html#cb53-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb53-3"><a href="bad.html#cb53-3" aria-hidden="true" tabindex="-1"></a>bad<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;summary/ave-r2-by-snp-badgwas&quot;</span>, <span class="at">header=</span>F,</span>
<span id="cb53-4"><a href="bad.html#cb53-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb53-5"><a href="bad.html#cb53-5" aria-hidden="true" tabindex="-1"></a>pc<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">40</span>)</span>
<span id="cb53-6"><a href="bad.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pc)){</span>
<span id="cb53-7"><a href="bad.html#cb53-7" aria-hidden="true" tabindex="-1"></a>  file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;inflation/adjust-geno/geno-mix-PC-&quot;</span>,pc[i],<span class="st">&quot;.aver2&quot;</span>)</span>
<span id="cb53-8"><a href="bad.html#cb53-8" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">read.table</span>(file,<span class="at">header=</span>F)</span>
<span id="cb53-9"><a href="bad.html#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;pc&quot;</span>,pc[i]))</span>
<span id="cb53-10"><a href="bad.html#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){out<span class="ot">=</span>dat} <span class="cf">else</span>{out<span class="ot">=</span><span class="fu">cbind</span>(out,dat[,<span class="dv">2</span>]); <span class="fu">names</span>(out)[i<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;pc&quot;</span>,pc[i])}</span>
<span id="cb53-11"><a href="bad.html#cb53-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-12"><a href="bad.html#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="bad.html#cb53-13" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">=</span><span class="fu">match</span>(out<span class="sc">$</span>snp, good<span class="sc">$</span>V1)</span>
<span id="cb53-14"><a href="bad.html#cb53-14" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">=</span><span class="fu">match</span>(out<span class="sc">$</span>snp, bad<span class="sc">$</span>V1)</span>
<span id="cb53-15"><a href="bad.html#cb53-15" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>good<span class="ot">=</span>good<span class="sc">$</span>V2[m1]</span>
<span id="cb53-16"><a href="bad.html#cb53-16" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>bad<span class="ot">=</span>bad<span class="sc">$</span>V2[m2]</span>
<span id="cb53-17"><a href="bad.html#cb53-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-18"><a href="bad.html#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="co"># get the average and standard deviation</span></span>
<span id="cb53-19"><a href="bad.html#cb53-19" aria-hidden="true" tabindex="-1"></a>summary<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">gwas=</span><span class="fu">names</span>(out)[<span class="sc">-</span><span class="dv">1</span>],</span>
<span id="cb53-20"><a href="bad.html#cb53-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ave=</span><span class="fu">apply</span>(out[,<span class="sc">-</span><span class="dv">1</span>],<span class="dv">2</span>,mean),</span>
<span id="cb53-21"><a href="bad.html#cb53-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sd=</span><span class="fu">apply</span>(out[,<span class="sc">-</span><span class="dv">1</span>],<span class="dv">2</span>,sd))</span>
<span id="cb53-22"><a href="bad.html#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(summary,<span class="st">&quot;summary/aver2-correct-geno-using-pcs.txt&quot;</span>, <span class="at">col.names=</span>T, <span class="at">row.names=</span>F,</span>
<span id="cb53-23"><a href="bad.html#cb53-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote=</span>F)</span>
<span id="cb53-24"><a href="bad.html#cb53-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-25"><a href="bad.html#cb53-25" aria-hidden="true" tabindex="-1"></a><span class="co"># plot histograms</span></span>
<span id="cb53-26"><a href="bad.html#cb53-26" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tidyr)</span>
<span id="cb53-27"><a href="bad.html#cb53-27" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb53-28"><a href="bad.html#cb53-28" aria-hidden="true" tabindex="-1"></a>out_long<span class="ot">=</span><span class="fu">gather</span>(out, <span class="at">key=</span>gwas, <span class="at">value=</span>aver2, pc1<span class="sc">:</span>bad, <span class="at">factor_key=</span>F)</span>
<span id="cb53-29"><a href="bad.html#cb53-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-30"><a href="bad.html#cb53-30" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>out_long<span class="sc">$</span>gwas<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;pc1&quot;</span>,<span class="st">&quot;pc2&quot;</span>,<span class="st">&quot;pc20&quot;</span>, <span class="st">&quot;pc40&quot;</span>) </span>
<span id="cb53-31"><a href="bad.html#cb53-31" aria-hidden="true" tabindex="-1"></a>p<span class="ot">=</span><span class="fu">ggplot</span>(out_long[sel,], <span class="fu">aes</span>(aver2,<span class="at">fill=</span>gwas)) <span class="sc">+</span> </span>
<span id="cb53-32"><a href="bad.html#cb53-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="fl">0.2</span>)</span>
<span id="cb53-33"><a href="bad.html#cb53-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_histogram(alpha = 0.5, position = &#39;identity&#39;)</span></span>
<span id="cb53-34"><a href="bad.html#cb53-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-35"><a href="bad.html#cb53-35" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/aver2-pc-corrected.png&quot;</span>),</span>
<span id="cb53-36"><a href="bad.html#cb53-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">30</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb53-37"><a href="bad.html#cb53-37" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb53-38"><a href="bad.html#cb53-38" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb53-39"><a href="bad.html#cb53-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-40"><a href="bad.html#cb53-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-41"><a href="bad.html#cb53-41" aria-hidden="true" tabindex="-1"></a><span class="co"># qq plot get quantiles</span></span>
<span id="cb53-42"><a href="bad.html#cb53-42" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">as.data.frame</span>(<span class="fu">apply</span>(out[,<span class="sc">-</span><span class="dv">1</span>],<span class="dv">2</span>, </span>
<span id="cb53-43"><a href="bad.html#cb53-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(X)<span class="fu">quantile</span>(X, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>), <span class="at">na.rm=</span>T)))</span>
<span id="cb53-44"><a href="bad.html#cb53-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-45"><a href="bad.html#cb53-45" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb53-46"><a href="bad.html#cb53-46" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/aver2-bad-vs-pc-corrected.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb53-47"><a href="bad.html#cb53-47" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb53-48"><a href="bad.html#cb53-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>pc1, dat<span class="sc">$</span>pc10,</span>
<span id="cb53-49"><a href="bad.html#cb53-49" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2 bad gwas&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave r2 10 pc&quot;</span>,</span>
<span id="cb53-50"><a href="bad.html#cb53-50" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot; 1k vs. 10k SNPs&quot;</span>, </span>
<span id="cb53-51"><a href="bad.html#cb53-51" aria-hidden="true" tabindex="-1"></a>     <span class="co">#xlim=c(start, end), ylim=c(start, end),</span></span>
<span id="cb53-52"><a href="bad.html#cb53-52" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb53-53"><a href="bad.html#cb53-53" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb53-54"><a href="bad.html#cb53-54" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>pc1, dat<span class="sc">$</span>pc10,<span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb53-55"><a href="bad.html#cb53-55" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="chisq-aver2" class="section level3" number="9.4.3">
<h3><span class="header-section-number">9.4.3</span> chisq ~ aver2</h3>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb54-1"><a href="bad.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># organize info</span></span>
<span id="cb54-2"><a href="bad.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">10</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb54-3"><a href="bad.html#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb54-4"><a href="bad.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-mix/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb54-5"><a href="bad.html#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>inflation/adjust-geno/geno-mix-PC-<span class="va">$j</span>.aver2</span>
<span id="cb54-6"><a href="bad.html#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-unrel-inds.ldscore</span>
<span id="cb54-7"><a href="bad.html#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-mix-out/<span class="va">$trait</span>-correct-geno-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>.out</span>
<span id="cb54-8"><a href="bad.html#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="bad.html#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp    </span>
<span id="cb54-10"><a href="bad.html#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="bad.html#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb54-12"><a href="bad.html#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb54-13"><a href="bad.html#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb54-14"><a href="bad.html#cb54-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-15"><a href="bad.html#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb54-16"><a href="bad.html#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb54-17"><a href="bad.html#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb54-18"><a href="bad.html#cb54-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-19"><a href="bad.html#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb54-20"><a href="bad.html#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb54-21"><a href="bad.html#cb54-21" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb54-22"><a href="bad.html#cb54-22" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb54-23"><a href="bad.html#cb54-23" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb54-24"><a href="bad.html#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb54-25"><a href="bad.html#cb54-25" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb54-26"><a href="bad.html#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb54-27"><a href="bad.html#cb54-27" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="bad.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot--------------------------------------------------------------------------</span></span>
<span id="cb55-2"><a href="bad.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb55-3"><a href="bad.html#cb55-3" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb55-4"><a href="bad.html#cb55-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb55-5"><a href="bad.html#cb55-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb55-6"><a href="bad.html#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="bad.html#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">20</span>,<span class="dv">40</span>)){</span>
<span id="cb55-8"><a href="bad.html#cb55-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-9"><a href="bad.html#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-aver2-bin-bad-gwas-correct-geno-&quot;</span>,j,<span class="st">&quot;PC.png&quot;</span>), </span>
<span id="cb55-10"><a href="bad.html#cb55-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb55-11"><a href="bad.html#cb55-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-12"><a href="bad.html#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb55-13"><a href="bad.html#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="bad.html#cb55-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb55-15"><a href="bad.html#cb55-15" aria-hidden="true" tabindex="-1"></a>      trait<span class="ot">=</span>traits[i]</span>
<span id="cb55-16"><a href="bad.html#cb55-16" aria-hidden="true" tabindex="-1"></a>      file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-mix-out/&quot;</span>,trait,<span class="st">&quot;-correct-geno-&quot;</span>,j,<span class="st">&quot;PC.out&quot;</span>)</span>
<span id="cb55-17"><a href="bad.html#cb55-17" aria-hidden="true" tabindex="-1"></a>      dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb55-18"><a href="bad.html#cb55-18" aria-hidden="true" tabindex="-1"></a>      dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb55-19"><a href="bad.html#cb55-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-20"><a href="bad.html#cb55-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># linear model</span></span>
<span id="cb55-21"><a href="bad.html#cb55-21" aria-hidden="true" tabindex="-1"></a>      mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb55-22"><a href="bad.html#cb55-22" aria-hidden="true" tabindex="-1"></a>      p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb55-23"><a href="bad.html#cb55-23" aria-hidden="true" tabindex="-1"></a>      p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb55-24"><a href="bad.html#cb55-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-25"><a href="bad.html#cb55-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># bin a variable by quantile</span></span>
<span id="cb55-26"><a href="bad.html#cb55-26" aria-hidden="true" tabindex="-1"></a>      cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb55-27"><a href="bad.html#cb55-27" aria-hidden="true" tabindex="-1"></a>      dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb55-28"><a href="bad.html#cb55-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb55-29"><a href="bad.html#cb55-29" aria-hidden="true" tabindex="-1"></a>      <span class="co"># average chisq by bin values</span></span>
<span id="cb55-30"><a href="bad.html#cb55-30" aria-hidden="true" tabindex="-1"></a>      out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb55-31"><a href="bad.html#cb55-31" aria-hidden="true" tabindex="-1"></a>      out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb55-32"><a href="bad.html#cb55-32" aria-hidden="true" tabindex="-1"></a>      px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb55-33"><a href="bad.html#cb55-33" aria-hidden="true" tabindex="-1"></a>      py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb55-34"><a href="bad.html#cb55-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-35"><a href="bad.html#cb55-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># plot</span></span>
<span id="cb55-36"><a href="bad.html#cb55-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb55-37"><a href="bad.html#cb55-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb55-38"><a href="bad.html#cb55-38" aria-hidden="true" tabindex="-1"></a>               <span class="at">main=</span><span class="fu">paste0</span>(trait, <span class="st">&quot; &quot;</span>, j, <span class="st">&quot; PC&quot;</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb55-39"><a href="bad.html#cb55-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb55-40"><a href="bad.html#cb55-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb55-41"><a href="bad.html#cb55-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb55-42"><a href="bad.html#cb55-42" aria-hidden="true" tabindex="-1"></a>                      <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb55-43"><a href="bad.html#cb55-43" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb55-44"><a href="bad.html#cb55-44" aria-hidden="true" tabindex="-1"></a>              <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb55-45"><a href="bad.html#cb55-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-46"><a href="bad.html#cb55-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb55-47"><a href="bad.html#cb55-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-48"><a href="bad.html#cb55-48" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="chisq-aver2_j-1" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> chisq ~ aver2_j</h2>
<div id="calc-aver2_j" class="section level3" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> calc aver2_j</h3>
<p>Note we previously computed aver2_j based using <code>geno-mix</code> data. see <a href="compute-sum_ijm_1-m_2r2_ij.html#aver2j">15.5</a>.
Results are stored in <code>summary/ave-r2-by-snp-badgwas</code></p>
</div>
<div id="bolt-lmm" class="section level3" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> bolt-lmm</h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="bad.html#cb56-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-2"><a href="bad.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># organize data ----------------------------------------------------------------</span></span>
<span id="cb56-3"><a href="bad.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-bolt-lmm-out</span>
<span id="cb56-4"><a href="bad.html#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="bad.html#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb56-6"><a href="bad.html#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="bad.html#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>BOLT-LMM_v2.3.5/gwas-bad/<span class="va">$trait</span>.out</span>
<span id="cb56-8"><a href="bad.html#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-by-snp-badgwas</span>
<span id="cb56-9"><a href="bad.html#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-bolt-lmm-out/<span class="va">$trait</span>.out</span>
<span id="cb56-10"><a href="bad.html#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="bad.html#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, ($9/$10)^2 }&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp    </span>
<span id="cb56-12"><a href="bad.html#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="bad.html#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb56-14"><a href="bad.html#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb56-15"><a href="bad.html#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb56-16"><a href="bad.html#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="bad.html#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb56-18"><a href="bad.html#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb56-19"><a href="bad.html#cb56-19" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb56-20"><a href="bad.html#cb56-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb56-21"><a href="bad.html#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2&quot;}</span></span>
<span id="cb56-22"><a href="bad.html#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb56-23"><a href="bad.html#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb56-24"><a href="bad.html#cb56-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-25"><a href="bad.html#cb56-25" aria-hidden="true" tabindex="-1"></a><span class="co"># updated 17 April ----------------------------------------------------------------</span></span>
<span id="cb56-26"><a href="bad.html#cb56-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-27"><a href="bad.html#cb56-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb56-28"><a href="bad.html#cb56-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-29"><a href="bad.html#cb56-29" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>BOLT-LMM_v2.3.5/gwas-bad/<span class="va">$trait</span>.out</span>
<span id="cb56-30"><a href="bad.html#cb56-30" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-unrel-inds.ldscore</span>
<span id="cb56-31"><a href="bad.html#cb56-31" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-by-snp-badgwas</span>
<span id="cb56-32"><a href="bad.html#cb56-32" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-bolt-lmm-out/<span class="va">$trait</span>.out</span>
<span id="cb56-33"><a href="bad.html#cb56-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-34"><a href="bad.html#cb56-34" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, ($9/$10)^2 }&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp</span>
<span id="cb56-35"><a href="bad.html#cb56-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-36"><a href="bad.html#cb56-36" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb56-37"><a href="bad.html#cb56-37" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb56-38"><a href="bad.html#cb56-38" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb56-39"><a href="bad.html#cb56-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-40"><a href="bad.html#cb56-40" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb56-41"><a href="bad.html#cb56-41" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb56-42"><a href="bad.html#cb56-42" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb56-43"><a href="bad.html#cb56-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-44"><a href="bad.html#cb56-44" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb56-45"><a href="bad.html#cb56-45" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb56-46"><a href="bad.html#cb56-46" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb56-47"><a href="bad.html#cb56-47" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb56-48"><a href="bad.html#cb56-48" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb56-49"><a href="bad.html#cb56-49" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb56-50"><a href="bad.html#cb56-50" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb56-51"><a href="bad.html#cb56-51" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="bad.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb57-2"><a href="bad.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate slope: chisq ~ aver2_j</span></span>
<span id="cb57-3"><a href="bad.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb57-4"><a href="bad.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb57-5"><a href="bad.html#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="bad.html#cb57-6" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb57-7"><a href="bad.html#cb57-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb57-8"><a href="bad.html#cb57-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb57-9"><a href="bad.html#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="bad.html#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb57-11"><a href="bad.html#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="bad.html#cb57-12" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[i]</span>
<span id="cb57-13"><a href="bad.html#cb57-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-14"><a href="bad.html#cb57-14" aria-hidden="true" tabindex="-1"></a>    file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-bolt-lmm-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>)</span>
<span id="cb57-15"><a href="bad.html#cb57-15" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb57-16"><a href="bad.html#cb57-16" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb57-17"><a href="bad.html#cb57-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-18"><a href="bad.html#cb57-18" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc, <span class="at">data=</span>dat)</span>
<span id="cb57-19"><a href="bad.html#cb57-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-20"><a href="bad.html#cb57-20" aria-hidden="true" tabindex="-1"></a>    out0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb57-21"><a href="bad.html#cb57-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">p=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb57-22"><a href="bad.html#cb57-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb57-23"><a href="bad.html#cb57-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-24"><a href="bad.html#cb57-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){out<span class="ot">=</span>out0} <span class="cf">else</span> {out<span class="ot">=</span><span class="fu">rbind</span>(out,out0)}</span>
<span id="cb57-25"><a href="bad.html#cb57-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-26"><a href="bad.html#cb57-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-27"><a href="bad.html#cb57-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-28"><a href="bad.html#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(out,<span class="st">&quot;summary/chisq-aver2-full-model-bolt-lmm.out&quot;</span>, </span>
<span id="cb57-29"><a href="bad.html#cb57-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span>T, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span>
<span id="cb57-30"><a href="bad.html#cb57-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-31"><a href="bad.html#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb57-32"><a href="bad.html#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2_j  </span></span>
<span id="cb57-33"><a href="bad.html#cb57-33" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb57-34"><a href="bad.html#cb57-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-35"><a href="bad.html#cb57-35" aria-hidden="true" tabindex="-1"></a><span class="co"># aver2_j bin-------------------------------</span></span>
<span id="cb57-36"><a href="bad.html#cb57-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-37"><a href="bad.html#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb57-38"><a href="bad.html#cb57-38" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb57-39"><a href="bad.html#cb57-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb57-40"><a href="bad.html#cb57-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb57-41"><a href="bad.html#cb57-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-42"><a href="bad.html#cb57-42" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-bad-gwas-bolt-lmm.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb57-43"><a href="bad.html#cb57-43" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb57-44"><a href="bad.html#cb57-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-45"><a href="bad.html#cb57-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb57-46"><a href="bad.html#cb57-46" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb57-47"><a href="bad.html#cb57-47" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;gwas-bolt-lmm-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb57-48"><a href="bad.html#cb57-48" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb57-49"><a href="bad.html#cb57-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-50"><a href="bad.html#cb57-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb57-51"><a href="bad.html#cb57-51" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb57-52"><a href="bad.html#cb57-52" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb57-53"><a href="bad.html#cb57-53" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb57-54"><a href="bad.html#cb57-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-55"><a href="bad.html#cb57-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb57-56"><a href="bad.html#cb57-56" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb57-57"><a href="bad.html#cb57-57" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb57-58"><a href="bad.html#cb57-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-59"><a href="bad.html#cb57-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb57-60"><a href="bad.html#cb57-60" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb57-61"><a href="bad.html#cb57-61" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb57-62"><a href="bad.html#cb57-62" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb57-63"><a href="bad.html#cb57-63" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb57-64"><a href="bad.html#cb57-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-65"><a href="bad.html#cb57-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb57-66"><a href="bad.html#cb57-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb57-67"><a href="bad.html#cb57-67" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb57-68"><a href="bad.html#cb57-68" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb57-69"><a href="bad.html#cb57-69" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb57-70"><a href="bad.html#cb57-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb57-71"><a href="bad.html#cb57-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb57-72"><a href="bad.html#cb57-72" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb57-73"><a href="bad.html#cb57-73" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb57-74"><a href="bad.html#cb57-74" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb57-75"><a href="bad.html#cb57-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-76"><a href="bad.html#cb57-76" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-77"><a href="bad.html#cb57-77" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb57-78"><a href="bad.html#cb57-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-79"><a href="bad.html#cb57-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-80"><a href="bad.html#cb57-80" aria-hidden="true" tabindex="-1"></a><span class="co"># raw aver2_j &amp; chisq-------------------------------</span></span>
<span id="cb57-81"><a href="bad.html#cb57-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-82"><a href="bad.html#cb57-82" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb57-83"><a href="bad.html#cb57-83" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb57-84"><a href="bad.html#cb57-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb57-85"><a href="bad.html#cb57-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb57-86"><a href="bad.html#cb57-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-87"><a href="bad.html#cb57-87" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-by-aver2-bin-gwas-mix-bold-lmm-raw.png&quot;</span>),</span>
<span id="cb57-88"><a href="bad.html#cb57-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb57-89"><a href="bad.html#cb57-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb57-90"><a href="bad.html#cb57-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-91"><a href="bad.html#cb57-91" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb57-92"><a href="bad.html#cb57-92" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[i]</span>
<span id="cb57-93"><a href="bad.html#cb57-93" aria-hidden="true" tabindex="-1"></a>    file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-bolt-lmm-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>)</span>
<span id="cb57-94"><a href="bad.html#cb57-94" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb57-95"><a href="bad.html#cb57-95" aria-hidden="true" tabindex="-1"></a>    out<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb57-96"><a href="bad.html#cb57-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-97"><a href="bad.html#cb57-97" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>aver2, out<span class="sc">$</span>chisq,</span>
<span id="cb57-98"><a href="bad.html#cb57-98" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq&quot;</span>,</span>
<span id="cb57-99"><a href="bad.html#cb57-99" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb57-100"><a href="bad.html#cb57-100" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;gray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb57-101"><a href="bad.html#cb57-101" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb57-102"><a href="bad.html#cb57-102" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="basic-cov-pc-1" class="section level3" number="9.5.3">
<h3><span class="header-section-number">9.5.3</span> basic cov + PC</h3>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="bad.html#cb58-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-2"><a href="bad.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># old --------------------------------------------------------------------------</span></span>
<span id="cb58-3"><a href="bad.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-mix-pc-out</span>
<span id="cb58-4"><a href="bad.html#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="bad.html#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">10</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb58-6"><a href="bad.html#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb58-7"><a href="bad.html#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="bad.html#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-mix-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb58-9"><a href="bad.html#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-by-snp-badgwas</span>
<span id="cb58-10"><a href="bad.html#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-mix-pc-out/<span class="va">$trait</span>-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>.out</span>
<span id="cb58-11"><a href="bad.html#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="bad.html#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp    </span>
<span id="cb58-13"><a href="bad.html#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="bad.html#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb58-15"><a href="bad.html#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb58-16"><a href="bad.html#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb58-17"><a href="bad.html#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="bad.html#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb58-19"><a href="bad.html#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb58-20"><a href="bad.html#cb58-20" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb58-21"><a href="bad.html#cb58-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb58-22"><a href="bad.html#cb58-22" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2&quot;}</span></span>
<span id="cb58-23"><a href="bad.html#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb58-24"><a href="bad.html#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb58-25"><a href="bad.html#cb58-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb58-26"><a href="bad.html#cb58-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-27"><a href="bad.html#cb58-27" aria-hidden="true" tabindex="-1"></a><span class="co"># update 16/04 -----------------------------------------------------------------</span></span>
<span id="cb58-28"><a href="bad.html#cb58-28" aria-hidden="true" tabindex="-1"></a><span class="co"># here we put ldscore in as well.</span></span>
<span id="cb58-29"><a href="bad.html#cb58-29" aria-hidden="true" tabindex="-1"></a><span class="co"># note: ldscores for all SNPs of &#39;gen/snps-unrel-inds.use&#39; are in snps-unrel-inds.ldscore</span></span>
<span id="cb58-30"><a href="bad.html#cb58-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-31"><a href="bad.html#cb58-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">10</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb58-32"><a href="bad.html#cb58-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb58-33"><a href="bad.html#cb58-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-34"><a href="bad.html#cb58-34" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-mix-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb58-35"><a href="bad.html#cb58-35" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-by-snp-badgwas</span>
<span id="cb58-36"><a href="bad.html#cb58-36" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-unrel-inds.ldscore</span>
<span id="cb58-37"><a href="bad.html#cb58-37" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-mix-pc-out/<span class="va">$trait</span>-<span class="va">$j</span><span class="st">&#39;PC&#39;</span>.out</span>
<span id="cb58-38"><a href="bad.html#cb58-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-39"><a href="bad.html#cb58-39" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp</span>
<span id="cb58-40"><a href="bad.html#cb58-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-41"><a href="bad.html#cb58-41" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb58-42"><a href="bad.html#cb58-42" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb58-43"><a href="bad.html#cb58-43" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb58-44"><a href="bad.html#cb58-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-45"><a href="bad.html#cb58-45" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb58-46"><a href="bad.html#cb58-46" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb58-47"><a href="bad.html#cb58-47" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb58-48"><a href="bad.html#cb58-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-49"><a href="bad.html#cb58-49" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb58-50"><a href="bad.html#cb58-50" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb58-51"><a href="bad.html#cb58-51" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb58-52"><a href="bad.html#cb58-52" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb58-53"><a href="bad.html#cb58-53" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb58-54"><a href="bad.html#cb58-54" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb58-55"><a href="bad.html#cb58-55" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb58-56"><a href="bad.html#cb58-56" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb58-57"><a href="bad.html#cb58-57" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="bad.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb59-2"><a href="bad.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate slope: chisq ~ aver2_j</span></span>
<span id="cb59-3"><a href="bad.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb59-4"><a href="bad.html#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="bad.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb59-6"><a href="bad.html#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="bad.html#cb59-7" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb59-8"><a href="bad.html#cb59-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb59-9"><a href="bad.html#cb59-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb59-10"><a href="bad.html#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="bad.html#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb59-12"><a href="bad.html#cb59-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-13"><a href="bad.html#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb59-14"><a href="bad.html#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="bad.html#cb59-15" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[i]</span>
<span id="cb59-16"><a href="bad.html#cb59-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-17"><a href="bad.html#cb59-17" aria-hidden="true" tabindex="-1"></a>    file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-mix-pc-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,j,<span class="st">&quot;PC.out&quot;</span>)</span>
<span id="cb59-18"><a href="bad.html#cb59-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-19"><a href="bad.html#cb59-19" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb59-20"><a href="bad.html#cb59-20" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb59-21"><a href="bad.html#cb59-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-22"><a href="bad.html#cb59-22" aria-hidden="true" tabindex="-1"></a>    out0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb59-23"><a href="bad.html#cb59-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pc=</span>j,</span>
<span id="cb59-24"><a href="bad.html#cb59-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">p=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb59-25"><a href="bad.html#cb59-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb59-26"><a href="bad.html#cb59-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-27"><a href="bad.html#cb59-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="dv">1</span>){out<span class="ot">=</span>out0} <span class="cf">else</span> {out<span class="ot">=</span><span class="fu">rbind</span>(out,out0)}</span>
<span id="cb59-28"><a href="bad.html#cb59-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb59-29"><a href="bad.html#cb59-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-30"><a href="bad.html#cb59-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-31"><a href="bad.html#cb59-31" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>out[out<span class="sc">$</span>pc<span class="sc">==</span><span class="dv">4</span>,]</span>
<span id="cb59-32"><a href="bad.html#cb59-32" aria-hidden="true" tabindex="-1"></a>sel<span class="sc">$</span>sig<span class="ot">=</span>sel<span class="sc">$</span>p<span class="sc">&lt;</span><span class="fl">0.01</span><span class="sc">/</span><span class="dv">14</span></span>
<span id="cb59-33"><a href="bad.html#cb59-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-34"><a href="bad.html#cb59-34" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(out,<span class="st">&quot;summary/chisq-aver2-full-model-bad-gwas-pc.out&quot;</span>, </span>
<span id="cb59-35"><a href="bad.html#cb59-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span>T, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span>
<span id="cb59-36"><a href="bad.html#cb59-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-37"><a href="bad.html#cb59-37" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb59-38"><a href="bad.html#cb59-38" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2_j  </span></span>
<span id="cb59-39"><a href="bad.html#cb59-39" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb59-40"><a href="bad.html#cb59-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-41"><a href="bad.html#cb59-41" aria-hidden="true" tabindex="-1"></a><span class="co"># binned data -------------------------------------</span></span>
<span id="cb59-42"><a href="bad.html#cb59-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-43"><a href="bad.html#cb59-43" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb59-44"><a href="bad.html#cb59-44" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb59-45"><a href="bad.html#cb59-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb59-46"><a href="bad.html#cb59-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb59-47"><a href="bad.html#cb59-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-48"><a href="bad.html#cb59-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">1</span>){</span>
<span id="cb59-49"><a href="bad.html#cb59-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-50"><a href="bad.html#cb59-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-by-aver2-bin-bad-gwas-&quot;</span>,j,<span class="st">&quot;PC.png&quot;</span>), </span>
<span id="cb59-51"><a href="bad.html#cb59-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb59-52"><a href="bad.html#cb59-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-53"><a href="bad.html#cb59-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb59-54"><a href="bad.html#cb59-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-55"><a href="bad.html#cb59-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb59-56"><a href="bad.html#cb59-56" aria-hidden="true" tabindex="-1"></a>      trait<span class="ot">=</span>traits[i]</span>
<span id="cb59-57"><a href="bad.html#cb59-57" aria-hidden="true" tabindex="-1"></a>      file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-mix-pc-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,j,<span class="st">&quot;PC.out&quot;</span>)</span>
<span id="cb59-58"><a href="bad.html#cb59-58" aria-hidden="true" tabindex="-1"></a>      dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb59-59"><a href="bad.html#cb59-59" aria-hidden="true" tabindex="-1"></a>      dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb59-60"><a href="bad.html#cb59-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-61"><a href="bad.html#cb59-61" aria-hidden="true" tabindex="-1"></a>      <span class="co"># linear model</span></span>
<span id="cb59-62"><a href="bad.html#cb59-62" aria-hidden="true" tabindex="-1"></a>      mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb59-63"><a href="bad.html#cb59-63" aria-hidden="true" tabindex="-1"></a>      p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb59-64"><a href="bad.html#cb59-64" aria-hidden="true" tabindex="-1"></a>      p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb59-65"><a href="bad.html#cb59-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-66"><a href="bad.html#cb59-66" aria-hidden="true" tabindex="-1"></a>      <span class="co"># bin a variable by quantile</span></span>
<span id="cb59-67"><a href="bad.html#cb59-67" aria-hidden="true" tabindex="-1"></a>      cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb59-68"><a href="bad.html#cb59-68" aria-hidden="true" tabindex="-1"></a>      dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb59-69"><a href="bad.html#cb59-69" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb59-70"><a href="bad.html#cb59-70" aria-hidden="true" tabindex="-1"></a>      <span class="co"># average chisq by bin values</span></span>
<span id="cb59-71"><a href="bad.html#cb59-71" aria-hidden="true" tabindex="-1"></a>      out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb59-72"><a href="bad.html#cb59-72" aria-hidden="true" tabindex="-1"></a>      out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb59-73"><a href="bad.html#cb59-73" aria-hidden="true" tabindex="-1"></a>      px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb59-74"><a href="bad.html#cb59-74" aria-hidden="true" tabindex="-1"></a>      py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb59-75"><a href="bad.html#cb59-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-76"><a href="bad.html#cb59-76" aria-hidden="true" tabindex="-1"></a>      <span class="co"># plot</span></span>
<span id="cb59-77"><a href="bad.html#cb59-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb59-78"><a href="bad.html#cb59-78" aria-hidden="true" tabindex="-1"></a>               <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb59-79"><a href="bad.html#cb59-79" aria-hidden="true" tabindex="-1"></a>               <span class="at">main=</span><span class="fu">paste0</span>(trait, <span class="st">&quot; &quot;</span>, j, <span class="st">&quot; PC&quot;</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb59-80"><a href="bad.html#cb59-80" aria-hidden="true" tabindex="-1"></a>               <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb59-81"><a href="bad.html#cb59-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 ,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb59-82"><a href="bad.html#cb59-82" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb59-83"><a href="bad.html#cb59-83" aria-hidden="true" tabindex="-1"></a>                      <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb59-84"><a href="bad.html#cb59-84" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb59-85"><a href="bad.html#cb59-85" aria-hidden="true" tabindex="-1"></a>              <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb59-86"><a href="bad.html#cb59-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb59-87"><a href="bad.html#cb59-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb59-88"><a href="bad.html#cb59-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-89"><a href="bad.html#cb59-89" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-90"><a href="bad.html#cb59-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-91"><a href="bad.html#cb59-91" aria-hidden="true" tabindex="-1"></a><span class="co"># binned data. single trait varying # of PC ------------------------------------</span></span>
<span id="cb59-92"><a href="bad.html#cb59-92" aria-hidden="true" tabindex="-1"></a><span class="co"># BMI</span></span>
<span id="cb59-93"><a href="bad.html#cb59-93" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb59-94"><a href="bad.html#cb59-94" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb59-95"><a href="bad.html#cb59-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb59-96"><a href="bad.html#cb59-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb59-97"><a href="bad.html#cb59-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-98"><a href="bad.html#cb59-98" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-by-aver2-bin-bad-gwas-varying-PC-bmi.png&quot;</span>), </span>
<span id="cb59-99"><a href="bad.html#cb59-99" aria-hidden="true" tabindex="-1"></a>      <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">40</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb59-100"><a href="bad.html#cb59-100" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb59-101"><a href="bad.html#cb59-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-102"><a href="bad.html#cb59-102" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb59-103"><a href="bad.html#cb59-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-104"><a href="bad.html#cb59-104" aria-hidden="true" tabindex="-1"></a>      trait<span class="ot">=</span>traits[<span class="dv">2</span>]</span>
<span id="cb59-105"><a href="bad.html#cb59-105" aria-hidden="true" tabindex="-1"></a>      file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-mix-pc-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,j,<span class="st">&quot;PC.out&quot;</span>)</span>
<span id="cb59-106"><a href="bad.html#cb59-106" aria-hidden="true" tabindex="-1"></a>      dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb59-107"><a href="bad.html#cb59-107" aria-hidden="true" tabindex="-1"></a>      dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb59-108"><a href="bad.html#cb59-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-109"><a href="bad.html#cb59-109" aria-hidden="true" tabindex="-1"></a>      <span class="co"># linear model</span></span>
<span id="cb59-110"><a href="bad.html#cb59-110" aria-hidden="true" tabindex="-1"></a>      mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb59-111"><a href="bad.html#cb59-111" aria-hidden="true" tabindex="-1"></a>      p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb59-112"><a href="bad.html#cb59-112" aria-hidden="true" tabindex="-1"></a>      p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb59-113"><a href="bad.html#cb59-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-114"><a href="bad.html#cb59-114" aria-hidden="true" tabindex="-1"></a>      <span class="co"># bin a variable by quantile</span></span>
<span id="cb59-115"><a href="bad.html#cb59-115" aria-hidden="true" tabindex="-1"></a>      cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb59-116"><a href="bad.html#cb59-116" aria-hidden="true" tabindex="-1"></a>      dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb59-117"><a href="bad.html#cb59-117" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb59-118"><a href="bad.html#cb59-118" aria-hidden="true" tabindex="-1"></a>      <span class="co"># average chisq by bin values</span></span>
<span id="cb59-119"><a href="bad.html#cb59-119" aria-hidden="true" tabindex="-1"></a>      out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb59-120"><a href="bad.html#cb59-120" aria-hidden="true" tabindex="-1"></a>      out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb59-121"><a href="bad.html#cb59-121" aria-hidden="true" tabindex="-1"></a>      px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb59-122"><a href="bad.html#cb59-122" aria-hidden="true" tabindex="-1"></a>      py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb59-123"><a href="bad.html#cb59-123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-124"><a href="bad.html#cb59-124" aria-hidden="true" tabindex="-1"></a>      <span class="co"># plot</span></span>
<span id="cb59-125"><a href="bad.html#cb59-125" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb59-126"><a href="bad.html#cb59-126" aria-hidden="true" tabindex="-1"></a>               <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb59-127"><a href="bad.html#cb59-127" aria-hidden="true" tabindex="-1"></a>               <span class="at">main=</span><span class="fu">paste0</span>(trait, <span class="st">&quot; &quot;</span>, j, <span class="st">&quot; PC&quot;</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb59-128"><a href="bad.html#cb59-128" aria-hidden="true" tabindex="-1"></a>               <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb59-129"><a href="bad.html#cb59-129" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb59-130"><a href="bad.html#cb59-130" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb59-131"><a href="bad.html#cb59-131" aria-hidden="true" tabindex="-1"></a>                      <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb59-132"><a href="bad.html#cb59-132" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb59-133"><a href="bad.html#cb59-133" aria-hidden="true" tabindex="-1"></a>              <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb59-134"><a href="bad.html#cb59-134" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb59-135"><a href="bad.html#cb59-135" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb59-136"><a href="bad.html#cb59-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-137"><a href="bad.html#cb59-137" aria-hidden="true" tabindex="-1"></a><span class="co"># reaction</span></span>
<span id="cb59-138"><a href="bad.html#cb59-138" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb59-139"><a href="bad.html#cb59-139" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb59-140"><a href="bad.html#cb59-140" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb59-141"><a href="bad.html#cb59-141" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb59-142"><a href="bad.html#cb59-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-143"><a href="bad.html#cb59-143" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-by-aver2-bin-bad-gwas-varying-PC-reaction.png&quot;</span>), </span>
<span id="cb59-144"><a href="bad.html#cb59-144" aria-hidden="true" tabindex="-1"></a>      <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">40</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb59-145"><a href="bad.html#cb59-145" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb59-146"><a href="bad.html#cb59-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-147"><a href="bad.html#cb59-147" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb59-148"><a href="bad.html#cb59-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-149"><a href="bad.html#cb59-149" aria-hidden="true" tabindex="-1"></a>      trait<span class="ot">=</span>traits[<span class="dv">11</span>]</span>
<span id="cb59-150"><a href="bad.html#cb59-150" aria-hidden="true" tabindex="-1"></a>      file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-mix-pc-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,j,<span class="st">&quot;PC.out&quot;</span>)</span>
<span id="cb59-151"><a href="bad.html#cb59-151" aria-hidden="true" tabindex="-1"></a>      dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb59-152"><a href="bad.html#cb59-152" aria-hidden="true" tabindex="-1"></a>      dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb59-153"><a href="bad.html#cb59-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-154"><a href="bad.html#cb59-154" aria-hidden="true" tabindex="-1"></a>      <span class="co"># linear model</span></span>
<span id="cb59-155"><a href="bad.html#cb59-155" aria-hidden="true" tabindex="-1"></a>      mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc ,<span class="at">data=</span>dat)</span>
<span id="cb59-156"><a href="bad.html#cb59-156" aria-hidden="true" tabindex="-1"></a>      p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb59-157"><a href="bad.html#cb59-157" aria-hidden="true" tabindex="-1"></a>      p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb59-158"><a href="bad.html#cb59-158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-159"><a href="bad.html#cb59-159" aria-hidden="true" tabindex="-1"></a>      <span class="co"># bin a variable by quantile</span></span>
<span id="cb59-160"><a href="bad.html#cb59-160" aria-hidden="true" tabindex="-1"></a>      cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb59-161"><a href="bad.html#cb59-161" aria-hidden="true" tabindex="-1"></a>      dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb59-162"><a href="bad.html#cb59-162" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb59-163"><a href="bad.html#cb59-163" aria-hidden="true" tabindex="-1"></a>      <span class="co"># average chisq by bin values</span></span>
<span id="cb59-164"><a href="bad.html#cb59-164" aria-hidden="true" tabindex="-1"></a>      out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb59-165"><a href="bad.html#cb59-165" aria-hidden="true" tabindex="-1"></a>      out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb59-166"><a href="bad.html#cb59-166" aria-hidden="true" tabindex="-1"></a>      px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb59-167"><a href="bad.html#cb59-167" aria-hidden="true" tabindex="-1"></a>      py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb59-168"><a href="bad.html#cb59-168" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-169"><a href="bad.html#cb59-169" aria-hidden="true" tabindex="-1"></a>      <span class="co"># plot</span></span>
<span id="cb59-170"><a href="bad.html#cb59-170" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb59-171"><a href="bad.html#cb59-171" aria-hidden="true" tabindex="-1"></a>               <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb59-172"><a href="bad.html#cb59-172" aria-hidden="true" tabindex="-1"></a>               <span class="at">main=</span><span class="fu">paste0</span>(trait, <span class="st">&quot; &quot;</span>, j, <span class="st">&quot; PC&quot;</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb59-173"><a href="bad.html#cb59-173" aria-hidden="true" tabindex="-1"></a>               <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb59-174"><a href="bad.html#cb59-174" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb59-175"><a href="bad.html#cb59-175" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb59-176"><a href="bad.html#cb59-176" aria-hidden="true" tabindex="-1"></a>                      <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb59-177"><a href="bad.html#cb59-177" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb59-178"><a href="bad.html#cb59-178" aria-hidden="true" tabindex="-1"></a>              <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb59-179"><a href="bad.html#cb59-179" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb59-180"><a href="bad.html#cb59-180" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb59-181"><a href="bad.html#cb59-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-182"><a href="bad.html#cb59-182" aria-hidden="true" tabindex="-1"></a><span class="co"># raw data-------------------------------------------------------------------</span></span>
<span id="cb59-183"><a href="bad.html#cb59-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-184"><a href="bad.html#cb59-184" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb59-185"><a href="bad.html#cb59-185" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb59-186"><a href="bad.html#cb59-186" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb59-187"><a href="bad.html#cb59-187" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb59-188"><a href="bad.html#cb59-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-189"><a href="bad.html#cb59-189" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb59-190"><a href="bad.html#cb59-190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-191"><a href="bad.html#cb59-191" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-by-aver2-gwas-mix-&quot;</span>,j,<span class="st">&quot;PC-raw.png&quot;</span>),</span>
<span id="cb59-192"><a href="bad.html#cb59-192" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb59-193"><a href="bad.html#cb59-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb59-194"><a href="bad.html#cb59-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-195"><a href="bad.html#cb59-195" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb59-196"><a href="bad.html#cb59-196" aria-hidden="true" tabindex="-1"></a>    trait<span class="ot">=</span>traits[i]</span>
<span id="cb59-197"><a href="bad.html#cb59-197" aria-hidden="true" tabindex="-1"></a>    file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;gwas-mix-pc-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,j,<span class="st">&quot;PC.out&quot;</span>)</span>
<span id="cb59-198"><a href="bad.html#cb59-198" aria-hidden="true" tabindex="-1"></a>    dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T, <span class="at">delim=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb59-199"><a href="bad.html#cb59-199" aria-hidden="true" tabindex="-1"></a>    out<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb59-200"><a href="bad.html#cb59-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-201"><a href="bad.html#cb59-201" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>aver2, out<span class="sc">$</span>chisq,</span>
<span id="cb59-202"><a href="bad.html#cb59-202" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave chisq&quot;</span>,</span>
<span id="cb59-203"><a href="bad.html#cb59-203" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb59-204"><a href="bad.html#cb59-204" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb59-205"><a href="bad.html#cb59-205" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb59-206"><a href="bad.html#cb59-206" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb59-207"><a href="bad.html#cb59-207" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="ldsc-intercept-1" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> ldsc intercept</h2>
<div id="under-gcta-1" class="section level3" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> under gcta</h3>
<div class="sourceCode" id="cb60"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb60-1"><a href="bad.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb60-2"><a href="bad.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># using original ldsc</span></span>
<span id="cb60-3"><a href="bad.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb60-4"><a href="bad.html#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="bad.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># format stats for ldsc--------------------------------------------------------- </span></span>
<span id="cb60-6"><a href="bad.html#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="ex">library</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb60-7"><a href="bad.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 100<span class="kw">)</span></span>
<span id="cb60-8"><a href="bad.html#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="va">rs</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;doug/ukbb.ldsc&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb60-9"><a href="bad.html#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="va">phen</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span><span class="st">&quot;fvc&quot;</span><span class="ex">,</span></span>
<span id="cb60-10"><a href="bad.html#cb60-10" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;height&quot;</span><span class="ex">,</span><span class="st">&quot;imp&quot;</span><span class="ex">,</span><span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span></span>
<span id="cb60-11"><a href="bad.html#cb60-11" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="ex">,</span> <span class="st">&quot;quals&quot;</span><span class="kw">)</span></span>
<span id="cb60-12"><a href="bad.html#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="bad.html#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in phen<span class="kw">){</span></span>
<span id="cb60-14"><a href="bad.html#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="va">stat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;gwas-mix/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb60-15"><a href="bad.html#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="va">p</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;gwas-mix/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear.pvalues&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb60-16"><a href="bad.html#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> stat<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb60-17"><a href="bad.html#cb60-17" aria-hidden="true" tabindex="-1"></a>  <span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">rs</span><span class="va">$X1</span><span class="ex">,</span> p<span class="va">$Predictor</span><span class="kw">)</span></span>
<span id="cb60-18"><a href="bad.html#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">SNP</span><span class="op">=</span>rs<span class="va">$X2</span>,</span>
<span id="cb60-19"><a href="bad.html#cb60-19" aria-hidden="true" tabindex="-1"></a>                 <span class="va">N</span><span class="op">=</span>stat<span class="va">$n</span>[m1],</span>
<span id="cb60-20"><a href="bad.html#cb60-20" aria-hidden="true" tabindex="-1"></a>                 <span class="va">Z</span><span class="op">=</span><span class="va">(</span>sqrt<span class="er">(</span>stat<span class="va">$Stat)</span><span class="pp">*</span>stat<span class="va">$Direction</span><span class="kw">)</span><span class="ex">[m1],</span></span>
<span id="cb60-21"><a href="bad.html#cb60-21" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A1</span><span class="op">=</span>stat<span class="va">$A1</span>[m1],</span>
<span id="cb60-22"><a href="bad.html#cb60-22" aria-hidden="true" tabindex="-1"></a>                 <span class="va">A2</span><span class="op">=</span>stat<span class="va">$A2</span>[m1], </span>
<span id="cb60-23"><a href="bad.html#cb60-23" aria-hidden="true" tabindex="-1"></a>                 <span class="va">pval</span><span class="op">=</span>p<span class="va">$P</span>[m2], <span class="va">stringsAsFactors</span><span class="op">=</span>F<span class="er">)</span></span>
<span id="cb60-24"><a href="bad.html#cb60-24" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>out[complete.cases<span class="kw">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb60-25"><a href="bad.html#cb60-25" aria-hidden="true" tabindex="-1"></a>  <span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;gwas-mix/&quot;</span><span class="ex">,i,</span><span class="st">&quot;-linear-rs.summaries&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb60-26"><a href="bad.html#cb60-26" aria-hidden="true" tabindex="-1"></a>  <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb60-27"><a href="bad.html#cb60-27" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb60-28"><a href="bad.html#cb60-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-29"><a href="bad.html#cb60-29" aria-hidden="true" tabindex="-1"></a><span class="co"># perform ldsc------------------------------------------------------------------</span></span>
<span id="cb60-30"><a href="bad.html#cb60-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> out-mix-pop</span>
<span id="cb60-31"><a href="bad.html#cb60-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-32"><a href="bad.html#cb60-32" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb60-33"><a href="bad.html#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb60-34"><a href="bad.html#cb60-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb60-35"><a href="bad.html#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb60-36"><a href="bad.html#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb60-37"><a href="bad.html#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 08:00:0</span></span>
<span id="cb60-38"><a href="bad.html#cb60-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-39"><a href="bad.html#cb60-39" aria-hidden="true" tabindex="-1"></a><span class="st">.././munge_sumstats.py </span><span class="dt">\</span></span>
<span id="cb60-40"><a href="bad.html#cb60-40" aria-hidden="true" tabindex="-1"></a><span class="st">--sumstats ../../gwas-mix/</span><span class="va">$i</span><span class="st">-linear-rs.summaries </span><span class="dt">\</span></span>
<span id="cb60-41"><a href="bad.html#cb60-41" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-mix-pop/</span><span class="va">$i</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb60-42"><a href="bad.html#cb60-42" aria-hidden="true" tabindex="-1"></a><span class="st">--merge-alleles ../w_hm3.snplist</span></span>
<span id="cb60-43"><a href="bad.html#cb60-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-44"><a href="bad.html#cb60-44" aria-hidden="true" tabindex="-1"></a><span class="st">.././ldsc.py </span><span class="dt">\</span></span>
<span id="cb60-45"><a href="bad.html#cb60-45" aria-hidden="true" tabindex="-1"></a><span class="st">--h2 ../out-mix-pop/</span><span class="va">$i</span><span class="st">.sumstats.gz </span><span class="dt">\</span></span>
<span id="cb60-46"><a href="bad.html#cb60-46" aria-hidden="true" tabindex="-1"></a><span class="st">--ref-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb60-47"><a href="bad.html#cb60-47" aria-hidden="true" tabindex="-1"></a><span class="st">--w-ld-chr ../eur_w_ld_chr/ </span><span class="dt">\</span></span>
<span id="cb60-48"><a href="bad.html#cb60-48" aria-hidden="true" tabindex="-1"></a><span class="st">--out ../out-mix-pop/</span><span class="va">$i</span><span class="st">-ldsc</span></span>
<span id="cb60-49"><a href="bad.html#cb60-49" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/ldsc-<span class="va">$i</span>-mix-pop.sh</span>
<span id="cb60-50"><a href="bad.html#cb60-50" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-51"><a href="bad.html#cb60-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-52"><a href="bad.html#cb60-52" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs-------------------------------------------------------------------</span></span>
<span id="cb60-53"><a href="bad.html#cb60-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper</span><span class="op">,</span><span class="dt">quals}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-54"><a href="bad.html#cb60-54" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldsc-<span class="va">$i</span>-mix-pop.sh</span>
<span id="cb60-55"><a href="bad.html#cb60-55" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../../job-records/ldsc-mix-pop</span>
<span id="cb60-56"><a href="bad.html#cb60-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-57"><a href="bad.html#cb60-57" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb60-58"><a href="bad.html#cb60-58" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/ldsc-mix-pop</span>
<span id="cb60-59"><a href="bad.html#cb60-59" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb60-60"><a href="bad.html#cb60-60" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb60-61"><a href="bad.html#cb60-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-62"><a href="bad.html#cb60-62" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb60-63"><a href="bad.html#cb60-63" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb60-64"><a href="bad.html#cb60-64" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb60-65"><a href="bad.html#cb60-65" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb60-66"><a href="bad.html#cb60-66" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb60-67"><a href="bad.html#cb60-67" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-68"><a href="bad.html#cb60-68" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb60-69"><a href="bad.html#cb60-69" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb60-70"><a href="bad.html#cb60-70" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb60-71"><a href="bad.html#cb60-71" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb60-72"><a href="bad.html#cb60-72" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb60-73"><a href="bad.html#cb60-73" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb60-74"><a href="bad.html#cb60-74" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb60-75"><a href="bad.html#cb60-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-76"><a href="bad.html#cb60-76" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb60-77"><a href="bad.html#cb60-77" aria-hidden="true" tabindex="-1"></a><span class="co"># using sumher</span></span>
<span id="cb60-78"><a href="bad.html#cb60-78" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::</span></span>
<span id="cb60-79"><a href="bad.html#cb60-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-80"><a href="bad.html#cb60-80" aria-hidden="true" tabindex="-1"></a><span class="co"># insert genetic distance into bim file-----------------------------------------</span></span>
<span id="cb60-81"><a href="bad.html#cb60-81" aria-hidden="true" tabindex="-1"></a><span class="co"># here we want to use the same genetic distance as for unrelated individuals, i.e., good GWAS</span></span>
<span id="cb60-82"><a href="bad.html#cb60-82" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb60-83"><a href="bad.html#cb60-83" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;gen/geno-mix.bim&quot;</span><span class="ex">,</span> header=F, stringsAsFactors=F<span class="kw">)</span></span>
<span id="cb60-84"><a href="bad.html#cb60-84" aria-hidden="true" tabindex="-1"></a><span class="va">ref</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;gen/geno-unrel.bim&quot;</span><span class="ex">,</span> header=F, stringsAsFactors=F<span class="kw">)</span></span>
<span id="cb60-85"><a href="bad.html#cb60-85" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">dat</span><span class="va">$V2</span><span class="ex">,ref</span><span class="va">$V2</span><span class="kw">)</span></span>
<span id="cb60-86"><a href="bad.html#cb60-86" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="ex">dat</span><span class="va">$V1</span><span class="ex">,</span> dat<span class="va">$V2</span>, ref<span class="va">$V3</span>[m], dat<span class="va">$V4</span>, dat<span class="va">$V5</span>, dat<span class="va">$V6</span>, stringsAsFactors=F<span class="kw">)</span></span>
<span id="cb60-87"><a href="bad.html#cb60-87" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span><span class="st">&quot;gen/geno-mix.bim2&quot;</span><span class="ex">,</span> col.names=F, row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb60-88"><a href="bad.html#cb60-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-89"><a href="bad.html#cb60-89" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> geno-mix.bim geno-mix.bim0</span>
<span id="cb60-90"><a href="bad.html#cb60-90" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> geno-mix.bim2 geno-mix.bim</span>
<span id="cb60-91"><a href="bad.html#cb60-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-92"><a href="bad.html#cb60-92" aria-hidden="true" tabindex="-1"></a><span class="co"># compute tagging under gcta----------------------------------------------------</span></span>
<span id="cb60-93"><a href="bad.html#cb60-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-94"><a href="bad.html#cb60-94" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb60-95"><a href="bad.html#cb60-95" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb60-96"><a href="bad.html#cb60-96" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb60-97"><a href="bad.html#cb60-97" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb60-98"><a href="bad.html#cb60-98" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb60-99"><a href="bad.html#cb60-99" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb60-100"><a href="bad.html#cb60-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-101"><a href="bad.html#cb60-101" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-tagging ../tagging-mix-pop/gcta-hapmap3-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb60-102"><a href="bad.html#cb60-102" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb60-103"><a href="bad.html#cb60-103" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb60-104"><a href="bad.html#cb60-104" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb60-105"><a href="bad.html#cb60-105" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-cm 1 </span><span class="dt">\</span></span>
<span id="cb60-106"><a href="bad.html#cb60-106" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span></span>
<span id="cb60-107"><a href="bad.html#cb60-107" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/tagging-gcta-hapmap3-chr<span class="va">$j</span></span>
<span id="cb60-108"><a href="bad.html#cb60-108" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-109"><a href="bad.html#cb60-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-110"><a href="bad.html#cb60-110" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-111"><a href="bad.html#cb60-111" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/tagging-gcta-hapmap3-chr<span class="va">$j</span> </span>
<span id="cb60-112"><a href="bad.html#cb60-112" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/tagging-gcta-hadmap3-mix-pop</span>
<span id="cb60-113"><a href="bad.html#cb60-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-114"><a href="bad.html#cb60-114" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb60-115"><a href="bad.html#cb60-115" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/tagging-gcta-hadmap3-mix-pop</span>
<span id="cb60-116"><a href="bad.html#cb60-116" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb60-117"><a href="bad.html#cb60-117" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb60-118"><a href="bad.html#cb60-118" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-119"><a href="bad.html#cb60-119" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb60-120"><a href="bad.html#cb60-120" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb60-121"><a href="bad.html#cb60-121" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb60-122"><a href="bad.html#cb60-122" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb60-123"><a href="bad.html#cb60-123" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb60-124"><a href="bad.html#cb60-124" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-125"><a href="bad.html#cb60-125" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb60-126"><a href="bad.html#cb60-126" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb60-127"><a href="bad.html#cb60-127" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb60-128"><a href="bad.html#cb60-128" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb60-129"><a href="bad.html#cb60-129" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb60-130"><a href="bad.html#cb60-130" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb60-131"><a href="bad.html#cb60-131" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb60-132"><a href="bad.html#cb60-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-133"><a href="bad.html#cb60-133" aria-hidden="true" tabindex="-1"></a><span class="co"># merge tagging files-----------------------------------------------------------</span></span>
<span id="cb60-134"><a href="bad.html#cb60-134" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> list.txt</span>
<span id="cb60-135"><a href="bad.html#cb60-135" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb60-136"><a href="bad.html#cb60-136" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-mix-pop/gcta-hapmap3-chr-</span><span class="va">$j</span><span class="st">.tagging&quot;</span> <span class="op">&gt;&gt;</span> list.txt</span>
<span id="cb60-137"><a href="bad.html#cb60-137" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-138"><a href="bad.html#cb60-138" aria-hidden="true" tabindex="-1"></a><span class="ex">./ldak5.1</span> <span class="at">--join-tagging</span> tagging-mix-pop/gcta-hapmap3 <span class="at">--taglist</span> list.txt</span>
<span id="cb60-139"><a href="bad.html#cb60-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-140"><a href="bad.html#cb60-140" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept----------------------------------------------------------------</span></span>
<span id="cb60-141"><a href="bad.html#cb60-141" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> sumher-mix</span>
<span id="cb60-142"><a href="bad.html#cb60-142" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-143"><a href="bad.html#cb60-143" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb60-144"><a href="bad.html#cb60-144" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb60-145"><a href="bad.html#cb60-145" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb60-146"><a href="bad.html#cb60-146" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb60-147"><a href="bad.html#cb60-147" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb60-148"><a href="bad.html#cb60-148" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb60-149"><a href="bad.html#cb60-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-150"><a href="bad.html#cb60-150" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --sum-hers ../sumher-mix/</span><span class="va">$i</span><span class="st">-sumher-gcta </span><span class="dt">\</span></span>
<span id="cb60-151"><a href="bad.html#cb60-151" aria-hidden="true" tabindex="-1"></a><span class="st">          --tagfile ../tagging-mix-pop/gcta-hapmap3.tagging </span><span class="dt">\</span></span>
<span id="cb60-152"><a href="bad.html#cb60-152" aria-hidden="true" tabindex="-1"></a><span class="st">          --summary ../gwas-mix/</span><span class="va">$i</span><span class="st">-linear.summaries </span><span class="dt">\</span></span>
<span id="cb60-153"><a href="bad.html#cb60-153" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-sums NO </span><span class="dt">\</span></span>
<span id="cb60-154"><a href="bad.html#cb60-154" aria-hidden="true" tabindex="-1"></a><span class="st">          --intercept YES</span></span>
<span id="cb60-155"><a href="bad.html#cb60-155" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-sumher-gcta-mix-pop</span>
<span id="cb60-156"><a href="bad.html#cb60-156" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-157"><a href="bad.html#cb60-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-158"><a href="bad.html#cb60-158" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-159"><a href="bad.html#cb60-159" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-sumher-gcta-mix-pop</span>
<span id="cb60-160"><a href="bad.html#cb60-160" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/sumher-gcta-mix-pop</span>
<span id="cb60-161"><a href="bad.html#cb60-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-162"><a href="bad.html#cb60-162" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb60-163"><a href="bad.html#cb60-163" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/sumher-gcta-mix-pop</span>
<span id="cb60-164"><a href="bad.html#cb60-164" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb60-165"><a href="bad.html#cb60-165" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb60-166"><a href="bad.html#cb60-166" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb60-167"><a href="bad.html#cb60-167" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb60-168"><a href="bad.html#cb60-168" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb60-169"><a href="bad.html#cb60-169" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb60-170"><a href="bad.html#cb60-170" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb60-171"><a href="bad.html#cb60-171" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb60-172"><a href="bad.html#cb60-172" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb60-173"><a href="bad.html#cb60-173" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb60-174"><a href="bad.html#cb60-174" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb60-175"><a href="bad.html#cb60-175" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb60-176"><a href="bad.html#cb60-176" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb60-177"><a href="bad.html#cb60-177" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb60-178"><a href="bad.html#cb60-178" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb60-179"><a href="bad.html#cb60-179" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="under-ldak-thin-1" class="section level3" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> under ldak-thin</h3>
<div class="sourceCode" id="cb61"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb61-1"><a href="bad.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get weights-------------------------------------------------------------------</span></span>
<span id="cb61-2"><a href="bad.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="op">&lt;</span> ldak-thin/ldak-thin-hapmap3.in <span class="st">&#39;{print $1, 1}&#39;</span> <span class="op">&gt;</span> ldak-thin/weights.ldak-thin-hapmap3</span>
<span id="cb61-3"><a href="bad.html#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="bad.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate tagging under ldak-thin---------------------------------------------</span></span>
<span id="cb61-5"><a href="bad.html#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-6"><a href="bad.html#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb61-7"><a href="bad.html#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb61-8"><a href="bad.html#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 40G</span></span>
<span id="cb61-9"><a href="bad.html#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 5</span></span>
<span id="cb61-10"><a href="bad.html#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb61-11"><a href="bad.html#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb61-12"><a href="bad.html#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --calc-tagging ../tagging-mix-pop/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb61-13"><a href="bad.html#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb61-14"><a href="bad.html#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="st">          --weights ../ldak-thin/weights.ldak-thin-hapmap3 </span><span class="dt">\</span></span>
<span id="cb61-15"><a href="bad.html#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -.25 </span><span class="dt">\</span></span>
<span id="cb61-16"><a href="bad.html#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-cm 1 </span><span class="dt">\</span></span>
<span id="cb61-17"><a href="bad.html#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --chr </span><span class="va">$j</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb61-18"><a href="bad.html#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --save-matrix YES </span><span class="dt">\</span></span>
<span id="cb61-19"><a href="bad.html#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 5</span></span>
<span id="cb61-20"><a href="bad.html#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/tagging-ldak-thin-hapmap3-chr<span class="va">$j</span>.sh</span>
<span id="cb61-21"><a href="bad.html#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb61-22"><a href="bad.html#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="bad.html#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="co"># submit scripts</span></span>
<span id="cb61-24"><a href="bad.html#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-25"><a href="bad.html#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/tagging-ldak-thin-hapmap3-chr<span class="va">$j</span>.sh</span>
<span id="cb61-26"><a href="bad.html#cb61-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/tagging-ldak-thin-hapmap3</span>
<span id="cb61-27"><a href="bad.html#cb61-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-28"><a href="bad.html#cb61-28" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb61-29"><a href="bad.html#cb61-29" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/tagging-ldak-thin-hapmap3</span>
<span id="cb61-30"><a href="bad.html#cb61-30" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb61-31"><a href="bad.html#cb61-31" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb61-32"><a href="bad.html#cb61-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-33"><a href="bad.html#cb61-33" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb61-34"><a href="bad.html#cb61-34" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb61-35"><a href="bad.html#cb61-35" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb61-36"><a href="bad.html#cb61-36" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb61-37"><a href="bad.html#cb61-37" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb61-38"><a href="bad.html#cb61-38" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb61-39"><a href="bad.html#cb61-39" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb61-40"><a href="bad.html#cb61-40" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb61-41"><a href="bad.html#cb61-41" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb61-42"><a href="bad.html#cb61-42" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb61-43"><a href="bad.html#cb61-43" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb61-44"><a href="bad.html#cb61-44" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb61-45"><a href="bad.html#cb61-45" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb61-46"><a href="bad.html#cb61-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-47"><a href="bad.html#cb61-47" aria-hidden="true" tabindex="-1"></a><span class="co"># merge tagging files-----------------------------------------------------------</span></span>
<span id="cb61-48"><a href="bad.html#cb61-48" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> list.txt</span>
<span id="cb61-49"><a href="bad.html#cb61-49" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> matlist.txt</span>
<span id="cb61-50"><a href="bad.html#cb61-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span> </span>
<span id="cb61-51"><a href="bad.html#cb61-51" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-mix-pop/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st">.tagging&quot;</span> <span class="op">&gt;&gt;</span> list.txt</span>
<span id="cb61-52"><a href="bad.html#cb61-52" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;tagging-mix-pop/ldak-thin-hapmap3-chr-</span><span class="va">$j</span><span class="st">.matrix&quot;</span> <span class="op">&gt;&gt;</span> matlist.txt</span>
<span id="cb61-53"><a href="bad.html#cb61-53" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb61-54"><a href="bad.html#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="ex">./ldak5.1</span> <span class="at">--join-tagging</span> tagging-mix-pop/ldak-thin-hapmap3 <span class="at">--taglist</span> list.txt <span class="at">--matlist</span> matlist.txt</span>
<span id="cb61-55"><a href="bad.html#cb61-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-56"><a href="bad.html#cb61-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept----------------------------------------------------------------</span></span>
<span id="cb61-57"><a href="bad.html#cb61-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-58"><a href="bad.html#cb61-58" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb61-59"><a href="bad.html#cb61-59" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb61-60"><a href="bad.html#cb61-60" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb61-61"><a href="bad.html#cb61-61" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 5G</span></span>
<span id="cb61-62"><a href="bad.html#cb61-62" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb61-63"><a href="bad.html#cb61-63" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb61-64"><a href="bad.html#cb61-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-65"><a href="bad.html#cb61-65" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --sum-hers ../sumher-mix/</span><span class="va">$i</span><span class="st">-sumher-ldak-thin </span><span class="dt">\</span></span>
<span id="cb61-66"><a href="bad.html#cb61-66" aria-hidden="true" tabindex="-1"></a><span class="st">          --tagfile ../tagging-mix-pop/ldak-thin-hapmap3.tagging </span><span class="dt">\</span></span>
<span id="cb61-67"><a href="bad.html#cb61-67" aria-hidden="true" tabindex="-1"></a><span class="st">          --summary ../gwas-mix/</span><span class="va">$i</span><span class="st">-linear.summaries </span><span class="dt">\</span></span>
<span id="cb61-68"><a href="bad.html#cb61-68" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-sums NO </span><span class="dt">\</span></span>
<span id="cb61-69"><a href="bad.html#cb61-69" aria-hidden="true" tabindex="-1"></a><span class="st">          --intercept YES</span></span>
<span id="cb61-70"><a href="bad.html#cb61-70" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-sumher-ldak-thin-mix</span>
<span id="cb61-71"><a href="bad.html#cb61-71" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb61-72"><a href="bad.html#cb61-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-73"><a href="bad.html#cb61-73" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-74"><a href="bad.html#cb61-74" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-sumher-ldak-thin-mix</span>
<span id="cb61-75"><a href="bad.html#cb61-75" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/sumher-ldak-thin-mix</span>
<span id="cb61-76"><a href="bad.html#cb61-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-77"><a href="bad.html#cb61-77" aria-hidden="true" tabindex="-1"></a><span class="co"># check job-completion</span></span>
<span id="cb61-78"><a href="bad.html#cb61-78" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/sumher-ldak-thin-mix</span>
<span id="cb61-79"><a href="bad.html#cb61-79" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb61-80"><a href="bad.html#cb61-80" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb61-81"><a href="bad.html#cb61-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb61-82"><a href="bad.html#cb61-82" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb61-83"><a href="bad.html#cb61-83" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb61-84"><a href="bad.html#cb61-84" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb61-85"><a href="bad.html#cb61-85" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb61-86"><a href="bad.html#cb61-86" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb61-87"><a href="bad.html#cb61-87" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb61-88"><a href="bad.html#cb61-88" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb61-89"><a href="bad.html#cb61-89" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb61-90"><a href="bad.html#cb61-90" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb61-91"><a href="bad.html#cb61-91" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb61-92"><a href="bad.html#cb61-92" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb61-93"><a href="bad.html#cb61-93" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb61-94"><a href="bad.html#cb61-94" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="summary-5" class="section level3" number="9.6.3">
<h3><span class="header-section-number">9.6.3</span> summary</h3>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb62-1"><a href="bad.html#cb62-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2"><a href="bad.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># without 40 PCs----------------------------------------------------------------------</span></span>
<span id="cb62-3"><a href="bad.html#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># original ldsc</span></span>
<span id="cb62-4"><a href="bad.html#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept <span class="pp">*</span>ldsc.log <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[-]/); split($3, b, /[()]/); print a[1], $2, b[2]}&#39;</span> <span class="op">&gt;</span> ../../summary/ldsc-mix</span>
<span id="cb62-5"><a href="bad.html#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="bad.html#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co"># sumher under gcta</span></span>
<span id="cb62-7"><a href="bad.html#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-mix-est</span>
<span id="cb62-8"><a href="bad.html#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-mix-sd</span>
<span id="cb62-9"><a href="bad.html#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb62-10"><a href="bad.html#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-gcta-mix-est sumher-gcta-mix-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-gcta-mix</span>
<span id="cb62-11"><a href="bad.html#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> sumher-gcta-mix-sd sumher-gcta-mix-est</span>
<span id="cb62-12"><a href="bad.html#cb62-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-13"><a href="bad.html#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co"># suhmer under ldak-thin</span></span>
<span id="cb62-14"><a href="bad.html#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-mix-est</span>
<span id="cb62-15"><a href="bad.html#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-mix-sd</span>
<span id="cb62-16"><a href="bad.html#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb62-17"><a href="bad.html#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-ldak-thin-mix-est sumher-ldak-thin-mix-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-ldak-thin-mix</span>
<span id="cb62-18"><a href="bad.html#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> sumher-ldak-thin-mix-sd sumher-ldak-thin-mix-est</span>
<span id="cb62-19"><a href="bad.html#cb62-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-20"><a href="bad.html#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="co"># with covariates (i.e., including all 40 PCs)-------------------------------------------</span></span>
<span id="cb62-21"><a href="bad.html#cb62-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-22"><a href="bad.html#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="co"># original ldsc</span></span>
<span id="cb62-23"><a href="bad.html#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept <span class="pp">*</span>ldsc.log <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[-]/); split($3, b, /[()]/); print a[1], $2, b[2]}&#39;</span> <span class="op">&gt;</span> ../../summary/ldsc-mix-with-cov</span>
<span id="cb62-24"><a href="bad.html#cb62-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-25"><a href="bad.html#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="co"># sumher under gcta</span></span>
<span id="cb62-26"><a href="bad.html#cb62-26" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-mix-est</span>
<span id="cb62-27"><a href="bad.html#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>gcta.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-gcta-mix-sd</span>
<span id="cb62-28"><a href="bad.html#cb62-28" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb62-29"><a href="bad.html#cb62-29" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-gcta-mix-est sumher-gcta-mix-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-gcta-mix-with-cov</span>
<span id="cb62-30"><a href="bad.html#cb62-30" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> sumher-gcta-mix-sd sumher-gcta-mix-est</span>
<span id="cb62-31"><a href="bad.html#cb62-31" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-32"><a href="bad.html#cb62-32" aria-hidden="true" tabindex="-1"></a><span class="co"># suhmer under ldak-thin</span></span>
<span id="cb62-33"><a href="bad.html#cb62-33" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_Estimate <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-mix-est</span>
<span id="cb62-34"><a href="bad.html#cb62-34" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> Intercept_SD <span class="pp">*</span>ldak-thin.extra <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ split($1, a, /[-]/); print a[1], $2}&#39;</span> <span class="op">&gt;</span>../summary/sumher-ldak-thin-mix-sd</span>
<span id="cb62-35"><a href="bad.html#cb62-35" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../summary/</span>
<span id="cb62-36"><a href="bad.html#cb62-36" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> sumher-ldak-thin-mix-est sumher-ldak-thin-mix-sd <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $2, $4}&#39;</span> <span class="op">&gt;</span> sumher-ldak-thin-mix-with-cov</span>
<span id="cb62-37"><a href="bad.html#cb62-37" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> sumher-ldak-thin-mix-sd sumher-ldak-thin-mix-est</span></code></pre></div>
</div>
</div>
<div id="reml-1" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> REML</h2>
<div id="making-grms-1" class="section level3" number="9.7.1">
<h3><span class="header-section-number">9.7.1</span> making grms</h3>
<div class="sourceCode" id="cb63"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb63-1"><a href="bad.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># making grm -------------------------------------------------------------------</span></span>
<span id="cb63-2"><a href="bad.html#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="bad.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb63-4"><a href="bad.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb63-5"><a href="bad.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb63-6"><a href="bad.html#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="bad.html#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># all snps</span></span>
<span id="cb63-8"><a href="bad.html#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb63-9"><a href="bad.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb63-10"><a href="bad.html#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 120G</span></span>
<span id="cb63-11"><a href="bad.html#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb63-12"><a href="bad.html#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb63-13"><a href="bad.html#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb63-14"><a href="bad.html#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="bad.html#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb63-16"><a href="bad.html#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/gcta-all-mix </span><span class="dt">\</span></span>
<span id="cb63-17"><a href="bad.html#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb63-18"><a href="bad.html#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb63-19"><a href="bad.html#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb63-20"><a href="bad.html#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb63-21"><a href="bad.html#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb63-22"><a href="bad.html#cb63-22" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/grm-all-snps-mix</span>
<span id="cb63-23"><a href="bad.html#cb63-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-24"><a href="bad.html#cb63-24" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/grm-all-snps-mix <span class="op">&gt;</span> ../job-records/grm-all-snps-mix</span>
<span id="cb63-25"><a href="bad.html#cb63-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-26"><a href="bad.html#cb63-26" aria-hidden="true" tabindex="-1"></a><span class="co"># grm by snp blocks: right vs. left</span></span>
<span id="cb63-27"><a href="bad.html#cb63-27" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&lt;8 {print $2}&#39;</span> geno-mix.bim <span class="op">&gt;</span> left-mix-pop.snps </span>
<span id="cb63-28"><a href="bad.html#cb63-28" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1&gt;=8 {print $2}&#39;</span> geno-mix.bim <span class="op">&gt;</span> right-mix-pop.snps</span>
<span id="cb63-29"><a href="bad.html#cb63-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-30"><a href="bad.html#cb63-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-31"><a href="bad.html#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb63-32"><a href="bad.html#cb63-32" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb63-33"><a href="bad.html#cb63-33" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb63-34"><a href="bad.html#cb63-34" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb63-35"><a href="bad.html#cb63-35" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb63-36"><a href="bad.html#cb63-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb63-37"><a href="bad.html#cb63-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-38"><a href="bad.html#cb63-38" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb63-39"><a href="bad.html#cb63-39" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/gcta-</span><span class="va">$i</span><span class="st">-mix </span><span class="dt">\</span></span>
<span id="cb63-40"><a href="bad.html#cb63-40" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb63-41"><a href="bad.html#cb63-41" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb63-42"><a href="bad.html#cb63-42" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$i</span><span class="st">-mix-pop.snps </span><span class="dt">\</span></span>
<span id="cb63-43"><a href="bad.html#cb63-43" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -1 </span><span class="dt">\</span></span>
<span id="cb63-44"><a href="bad.html#cb63-44" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb63-45"><a href="bad.html#cb63-45" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb63-46"><a href="bad.html#cb63-46" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/grm-gcta-<span class="va">$i</span>-mix</span>
<span id="cb63-47"><a href="bad.html#cb63-47" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb63-48"><a href="bad.html#cb63-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-49"><a href="bad.html#cb63-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-50"><a href="bad.html#cb63-50" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/grm-gcta-<span class="va">$i</span>-mix </span>
<span id="cb63-51"><a href="bad.html#cb63-51" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-gcta-by-snps-mix</span>
<span id="cb63-52"><a href="bad.html#cb63-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-53"><a href="bad.html#cb63-53" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb63-54"><a href="bad.html#cb63-54" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/grm-gcta-by-snps-mix</span>
<span id="cb63-55"><a href="bad.html#cb63-55" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb63-56"><a href="bad.html#cb63-56" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb63-57"><a href="bad.html#cb63-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-58"><a href="bad.html#cb63-58" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb63-59"><a href="bad.html#cb63-59" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb63-60"><a href="bad.html#cb63-60" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb63-61"><a href="bad.html#cb63-61" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb63-62"><a href="bad.html#cb63-62" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb63-63"><a href="bad.html#cb63-63" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb63-64"><a href="bad.html#cb63-64" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb63-65"><a href="bad.html#cb63-65" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb63-66"><a href="bad.html#cb63-66" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb63-67"><a href="bad.html#cb63-67" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb63-68"><a href="bad.html#cb63-68" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb63-69"><a href="bad.html#cb63-69" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb63-70"><a href="bad.html#cb63-70" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb63-71"><a href="bad.html#cb63-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-72"><a href="bad.html#cb63-72" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb63-73"><a href="bad.html#cb63-73" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb63-74"><a href="bad.html#cb63-74" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb63-75"><a href="bad.html#cb63-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-76"><a href="bad.html#cb63-76" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------</span></span>
<span id="cb63-77"><a href="bad.html#cb63-77" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. thin snps</span></span>
<span id="cb63-78"><a href="bad.html#cb63-78" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------</span></span>
<span id="cb63-79"><a href="bad.html#cb63-79" aria-hidden="true" tabindex="-1"></a><span class="co"># we omit this step and use ldak-thin/ldak-thin-hapmap3.in, which was created previously</span></span>
<span id="cb63-80"><a href="bad.html#cb63-80" aria-hidden="true" tabindex="-1"></a><span class="co"># using geno-unrel bfiles. See above.</span></span>
<span id="cb63-81"><a href="bad.html#cb63-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-82"><a href="bad.html#cb63-82" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------</span></span>
<span id="cb63-83"><a href="bad.html#cb63-83" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. kinship matrix under ldak-thin</span></span>
<span id="cb63-84"><a href="bad.html#cb63-84" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------</span></span>
<span id="cb63-85"><a href="bad.html#cb63-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-86"><a href="bad.html#cb63-86" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb63-87"><a href="bad.html#cb63-87" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb63-88"><a href="bad.html#cb63-88" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb63-89"><a href="bad.html#cb63-89" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb63-90"><a href="bad.html#cb63-90" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb63-91"><a href="bad.html#cb63-91" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb63-92"><a href="bad.html#cb63-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-93"><a href="bad.html#cb63-93" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb63-94"><a href="bad.html#cb63-94" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/ldak-thin-all-mix </span><span class="dt">\</span></span>
<span id="cb63-95"><a href="bad.html#cb63-95" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb63-96"><a href="bad.html#cb63-96" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb63-97"><a href="bad.html#cb63-97" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../ldak-thin/ldak-thin-hapmap3.in </span><span class="dt">\</span></span>
<span id="cb63-98"><a href="bad.html#cb63-98" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -0.25 </span><span class="dt">\</span></span>
<span id="cb63-99"><a href="bad.html#cb63-99" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb63-100"><a href="bad.html#cb63-100" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb63-101"><a href="bad.html#cb63-101" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin-grm-all-snps-mix</span>
<span id="cb63-102"><a href="bad.html#cb63-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-103"><a href="bad.html#cb63-103" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin-grm-all-snps-mix<span class="op">&gt;</span> ../job-records/ldak-thin-grm-all-snps-mix</span>
<span id="cb63-104"><a href="bad.html#cb63-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-105"><a href="bad.html#cb63-105" aria-hidden="true" tabindex="-1"></a><span class="co"># grm by snp blocks: right vs. left</span></span>
<span id="cb63-106"><a href="bad.html#cb63-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-107"><a href="bad.html#cb63-107" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[:]/); if (a[1]&lt;8) print $1}&#39;</span> <span class="dt">\</span></span>
<span id="cb63-108"><a href="bad.html#cb63-108" aria-hidden="true" tabindex="-1"></a> ldak-thin/ldak-thin-hapmap3.in <span class="op">&gt;</span> gen/left-ldak-thin-hapmap3.snps </span>
<span id="cb63-109"><a href="bad.html#cb63-109" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{split($1, a, /[:]/); if (a[1]&gt;=8) print $1}&#39;</span> <span class="dt">\</span></span>
<span id="cb63-110"><a href="bad.html#cb63-110" aria-hidden="true" tabindex="-1"></a> ldak-thin/ldak-thin-hapmap3.in <span class="op">&gt;</span> gen/right-ldak-thin-hapmap3.snps </span>
<span id="cb63-111"><a href="bad.html#cb63-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-112"><a href="bad.html#cb63-112" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-113"><a href="bad.html#cb63-113" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb63-114"><a href="bad.html#cb63-114" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb63-115"><a href="bad.html#cb63-115" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb63-116"><a href="bad.html#cb63-116" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb63-117"><a href="bad.html#cb63-117" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 20:0:0</span></span>
<span id="cb63-118"><a href="bad.html#cb63-118" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb63-119"><a href="bad.html#cb63-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-120"><a href="bad.html#cb63-120" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 10 </span><span class="dt">\</span></span>
<span id="cb63-121"><a href="bad.html#cb63-121" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-kins-direct ../kinship/ldak-thin-</span><span class="va">$i</span><span class="st">-mix </span><span class="dt">\</span></span>
<span id="cb63-122"><a href="bad.html#cb63-122" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb63-123"><a href="bad.html#cb63-123" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb63-124"><a href="bad.html#cb63-124" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/</span><span class="va">$i</span><span class="st">-ldak-thin-hapmap3.snps </span><span class="dt">\</span></span>
<span id="cb63-125"><a href="bad.html#cb63-125" aria-hidden="true" tabindex="-1"></a><span class="st">          --power -0.25 </span><span class="dt">\</span></span>
<span id="cb63-126"><a href="bad.html#cb63-126" aria-hidden="true" tabindex="-1"></a><span class="st">          --ignore-weights YES </span><span class="dt">\</span></span>
<span id="cb63-127"><a href="bad.html#cb63-127" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb63-128"><a href="bad.html#cb63-128" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> sh_script/ldak-thin-grm-<span class="va">$i</span>-mix</span>
<span id="cb63-129"><a href="bad.html#cb63-129" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb63-130"><a href="bad.html#cb63-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-131"><a href="bad.html#cb63-131" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-132"><a href="bad.html#cb63-132" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/ldak-thin-grm-<span class="va">$i</span>-mix </span>
<span id="cb63-133"><a href="bad.html#cb63-133" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-ldak-thin-by-snps-mix</span>
<span id="cb63-134"><a href="bad.html#cb63-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-135"><a href="bad.html#cb63-135" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb63-136"><a href="bad.html#cb63-136" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/grm-ldak-thin-by-snps-mix</span>
<span id="cb63-137"><a href="bad.html#cb63-137" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb63-138"><a href="bad.html#cb63-138" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb63-139"><a href="bad.html#cb63-139" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb63-140"><a href="bad.html#cb63-140" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb63-141"><a href="bad.html#cb63-141" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb63-142"><a href="bad.html#cb63-142" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb63-143"><a href="bad.html#cb63-143" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb63-144"><a href="bad.html#cb63-144" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb63-145"><a href="bad.html#cb63-145" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb63-146"><a href="bad.html#cb63-146" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb63-147"><a href="bad.html#cb63-147" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb63-148"><a href="bad.html#cb63-148" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb63-149"><a href="bad.html#cb63-149" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb63-150"><a href="bad.html#cb63-150" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb63-151"><a href="bad.html#cb63-151" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb63-152"><a href="bad.html#cb63-152" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="fast-reml-1" class="section level3" number="9.7.2">
<h3><span class="header-section-number">9.7.2</span> fast-reml</h3>
<div class="sourceCode" id="cb64"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb64-1"><a href="bad.html#cb64-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2"><a href="bad.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb64-3"><a href="bad.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb64-4"><a href="bad.html#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb64-5"><a href="bad.html#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="bad.html#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co"># make script files-------------------------------------------------------------</span></span>
<span id="cb64-7"><a href="bad.html#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> reml-mix</span>
<span id="cb64-8"><a href="bad.html#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-9"><a href="bad.html#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-10"><a href="bad.html#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb64-11"><a href="bad.html#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb64-12"><a href="bad.html#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb64-13"><a href="bad.html#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb64-14"><a href="bad.html#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb64-15"><a href="bad.html#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb64-16"><a href="bad.html#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="bad.html#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --fast-reml ../reml-mix/</span><span class="va">$i</span><span class="st">-gcta-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb64-18"><a href="bad.html#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --repetitions 20 </span><span class="dt">\</span></span>
<span id="cb64-19"><a href="bad.html#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb64-20"><a href="bad.html#cb64-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb64-21"><a href="bad.html#cb64-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/gcta-</span><span class="va">$k</span><span class="st">-mix </span><span class="dt">\</span></span>
<span id="cb64-22"><a href="bad.html#cb64-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb64-23"><a href="bad.html#cb64-23" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb64-24"><a href="bad.html#cb64-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-reml-mix-gcta-<span class="va">$k</span>-snps</span>
<span id="cb64-25"><a href="bad.html#cb64-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-26"><a href="bad.html#cb64-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-27"><a href="bad.html#cb64-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-28"><a href="bad.html#cb64-28" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script files-----------------------------------------------------------</span></span>
<span id="cb64-29"><a href="bad.html#cb64-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-30"><a href="bad.html#cb64-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-31"><a href="bad.html#cb64-31" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-reml-mix-gcta-<span class="va">$k</span>-snps</span>
<span id="cb64-32"><a href="bad.html#cb64-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-33"><a href="bad.html#cb64-33" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/reml-mix-gcta</span>
<span id="cb64-34"><a href="bad.html#cb64-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-35"><a href="bad.html#cb64-35" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb64-36"><a href="bad.html#cb64-36" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/reml-mix-gcta</span>
<span id="cb64-37"><a href="bad.html#cb64-37" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb64-38"><a href="bad.html#cb64-38" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb64-39"><a href="bad.html#cb64-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-40"><a href="bad.html#cb64-40" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb64-41"><a href="bad.html#cb64-41" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb64-42"><a href="bad.html#cb64-42" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb64-43"><a href="bad.html#cb64-43" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb64-44"><a href="bad.html#cb64-44" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb64-45"><a href="bad.html#cb64-45" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-46"><a href="bad.html#cb64-46" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb64-47"><a href="bad.html#cb64-47" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb64-48"><a href="bad.html#cb64-48" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb64-49"><a href="bad.html#cb64-49" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb64-50"><a href="bad.html#cb64-50" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb64-51"><a href="bad.html#cb64-51" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb64-52"><a href="bad.html#cb64-52" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb64-53"><a href="bad.html#cb64-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-54"><a href="bad.html#cb64-54" aria-hidden="true" tabindex="-1"></a><span class="co"># cancel jobs </span></span>
<span id="cb64-55"><a href="bad.html#cb64-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">14</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-56"><a href="bad.html#cb64-56" aria-hidden="true" tabindex="-1"></a><span class="va">job</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;NR==i{print $0}&#39;</span> kill-jobs<span class="kw">`</span></span>
<span id="cb64-57"><a href="bad.html#cb64-57" aria-hidden="true" tabindex="-1"></a><span class="ex">scancel</span> <span class="va">$job</span></span>
<span id="cb64-58"><a href="bad.html#cb64-58" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-59"><a href="bad.html#cb64-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-60"><a href="bad.html#cb64-60" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb64-61"><a href="bad.html#cb64-61" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb64-62"><a href="bad.html#cb64-62" aria-hidden="true" tabindex="-1"></a><span class="co">#:::</span></span>
<span id="cb64-63"><a href="bad.html#cb64-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-64"><a href="bad.html#cb64-64" aria-hidden="true" tabindex="-1"></a><span class="co"># make script files-------------------------------------------------------------</span></span>
<span id="cb64-65"><a href="bad.html#cb64-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-66"><a href="bad.html#cb64-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-67"><a href="bad.html#cb64-67" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb64-68"><a href="bad.html#cb64-68" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb64-69"><a href="bad.html#cb64-69" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb64-70"><a href="bad.html#cb64-70" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 100G</span></span>
<span id="cb64-71"><a href="bad.html#cb64-71" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb64-72"><a href="bad.html#cb64-72" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 5:0:0</span></span>
<span id="cb64-73"><a href="bad.html#cb64-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-74"><a href="bad.html#cb64-74" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --fast-reml ../reml-mix/</span><span class="va">$i</span><span class="st">-ldak-thin-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb64-75"><a href="bad.html#cb64-75" aria-hidden="true" tabindex="-1"></a><span class="st">          --repetitions 20 </span><span class="dt">\</span></span>
<span id="cb64-76"><a href="bad.html#cb64-76" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb64-77"><a href="bad.html#cb64-77" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb64-78"><a href="bad.html#cb64-78" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/ldak-thin-</span><span class="va">$k</span><span class="st">-mix </span><span class="dt">\</span></span>
<span id="cb64-79"><a href="bad.html#cb64-79" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 2 </span><span class="dt">\</span></span>
<span id="cb64-80"><a href="bad.html#cb64-80" aria-hidden="true" tabindex="-1"></a><span class="st">          --single YES</span></span>
<span id="cb64-81"><a href="bad.html#cb64-81" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-reml-mix-ldak-thin-<span class="va">$k</span>-snps</span>
<span id="cb64-82"><a href="bad.html#cb64-82" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-83"><a href="bad.html#cb64-83" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-84"><a href="bad.html#cb64-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-85"><a href="bad.html#cb64-85" aria-hidden="true" tabindex="-1"></a><span class="co"># submit script files-----------------------------------------------------------</span></span>
<span id="cb64-86"><a href="bad.html#cb64-86" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-87"><a href="bad.html#cb64-87" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-88"><a href="bad.html#cb64-88" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-reml-mix-ldak-thin-<span class="va">$k</span>-snps</span>
<span id="cb64-89"><a href="bad.html#cb64-89" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-90"><a href="bad.html#cb64-90" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span>../job-records/reml-mix-ldak-thin</span>
<span id="cb64-91"><a href="bad.html#cb64-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-92"><a href="bad.html#cb64-92" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb64-93"><a href="bad.html#cb64-93" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/reml-mix-ldak-thin</span>
<span id="cb64-94"><a href="bad.html#cb64-94" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb64-95"><a href="bad.html#cb64-95" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb64-96"><a href="bad.html#cb64-96" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb64-97"><a href="bad.html#cb64-97" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb64-98"><a href="bad.html#cb64-98" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb64-99"><a href="bad.html#cb64-99" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb64-100"><a href="bad.html#cb64-100" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb64-101"><a href="bad.html#cb64-101" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb64-102"><a href="bad.html#cb64-102" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb64-103"><a href="bad.html#cb64-103" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb64-104"><a href="bad.html#cb64-104" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb64-105"><a href="bad.html#cb64-105" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb64-106"><a href="bad.html#cb64-106" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb64-107"><a href="bad.html#cb64-107" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb64-108"><a href="bad.html#cb64-108" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb64-109"><a href="bad.html#cb64-109" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="inflation-test-1" class="section level3" number="9.7.3">
<h3><span class="header-section-number">9.7.3</span> inflation test</h3>
<div class="sourceCode" id="cb65"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb65-1"><a href="bad.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb65-2"><a href="bad.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb65-3"><a href="bad.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb65-4"><a href="bad.html#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="bad.html#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb65-6"><a href="bad.html#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb65-7"><a href="bad.html#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-8"><a href="bad.html#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-gcta-right.reml</span>
<span id="cb65-9"><a href="bad.html#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb65-10"><a href="bad.html#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb65-11"><a href="bad.html#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-12"><a href="bad.html#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb65-13"><a href="bad.html#cb65-13" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb65-14"><a href="bad.html#cb65-14" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb65-15"><a href="bad.html#cb65-15" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-gcta-mix.right</span>
<span id="cb65-16"><a href="bad.html#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb65-17"><a href="bad.html#cb65-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-18"><a href="bad.html#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb65-19"><a href="bad.html#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-20"><a href="bad.html#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-gcta-left.reml</span>
<span id="cb65-21"><a href="bad.html#cb65-21" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb65-22"><a href="bad.html#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb65-23"><a href="bad.html#cb65-23" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-24"><a href="bad.html#cb65-24" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb65-25"><a href="bad.html#cb65-25" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb65-26"><a href="bad.html#cb65-26" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb65-27"><a href="bad.html#cb65-27" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-gcta-mix.left</span>
<span id="cb65-28"><a href="bad.html#cb65-28" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb65-29"><a href="bad.html#cb65-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-30"><a href="bad.html#cb65-30" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb65-31"><a href="bad.html#cb65-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-32"><a href="bad.html#cb65-32" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-gcta-all.reml</span>
<span id="cb65-33"><a href="bad.html#cb65-33" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb65-34"><a href="bad.html#cb65-34" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb65-35"><a href="bad.html#cb65-35" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-36"><a href="bad.html#cb65-36" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb65-37"><a href="bad.html#cb65-37" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb65-38"><a href="bad.html#cb65-38" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb65-39"><a href="bad.html#cb65-39" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-gcta-mix.all</span>
<span id="cb65-40"><a href="bad.html#cb65-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb65-41"><a href="bad.html#cb65-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-42"><a href="bad.html#cb65-42" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb65-43"><a href="bad.html#cb65-43" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb65-44"><a href="bad.html#cb65-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-45"><a href="bad.html#cb65-45" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-gcta-mix.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb65-46"><a href="bad.html#cb65-46" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-gcta-mix.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb65-47"><a href="bad.html#cb65-47" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-gcta-mix.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb65-48"><a href="bad.html#cb65-48" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb65-49"><a href="bad.html#cb65-49" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb65-50"><a href="bad.html#cb65-50" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-51"><a href="bad.html#cb65-51" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-52"><a href="bad.html#cb65-52" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-53"><a href="bad.html#cb65-53" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-54"><a href="bad.html#cb65-54" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-55"><a href="bad.html#cb65-55" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb65-56"><a href="bad.html#cb65-56" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb65-57"><a href="bad.html#cb65-57" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb65-58"><a href="bad.html#cb65-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-59"><a href="bad.html#cb65-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb65-60"><a href="bad.html#cb65-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-61"><a href="bad.html#cb65-61" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb65-62"><a href="bad.html#cb65-62" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb65-63"><a href="bad.html#cb65-63" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb65-64"><a href="bad.html#cb65-64" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb65-65"><a href="bad.html#cb65-65" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb65-66"><a href="bad.html#cb65-66" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb65-67"><a href="bad.html#cb65-67" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb65-68"><a href="bad.html#cb65-68" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb65-69"><a href="bad.html#cb65-69" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb65-70"><a href="bad.html#cb65-70" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb65-71"><a href="bad.html#cb65-71" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb65-72"><a href="bad.html#cb65-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-73"><a href="bad.html#cb65-73" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb65-74"><a href="bad.html#cb65-74" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb65-75"><a href="bad.html#cb65-75" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb65-76"><a href="bad.html#cb65-76" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb65-77"><a href="bad.html#cb65-77" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb65-78"><a href="bad.html#cb65-78" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb65-79"><a href="bad.html#cb65-79" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb65-80"><a href="bad.html#cb65-80" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb65-81"><a href="bad.html#cb65-81" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb65-82"><a href="bad.html#cb65-82" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb65-83"><a href="bad.html#cb65-83" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/reml-gcta-inflation-mix-gwas.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-84"><a href="bad.html#cb65-84" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb65-85"><a href="bad.html#cb65-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-86"><a href="bad.html#cb65-86" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb65-87"><a href="bad.html#cb65-87" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb65-88"><a href="bad.html#cb65-88" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb65-89"><a href="bad.html#cb65-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-90"><a href="bad.html#cb65-90" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb65-91"><a href="bad.html#cb65-91" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb65-92"><a href="bad.html#cb65-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-93"><a href="bad.html#cb65-93" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-ldak-thin-right.reml</span>
<span id="cb65-94"><a href="bad.html#cb65-94" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb65-95"><a href="bad.html#cb65-95" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb65-96"><a href="bad.html#cb65-96" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-97"><a href="bad.html#cb65-97" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb65-98"><a href="bad.html#cb65-98" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb65-99"><a href="bad.html#cb65-99" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb65-100"><a href="bad.html#cb65-100" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-ldak-thin-mix.right</span>
<span id="cb65-101"><a href="bad.html#cb65-101" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb65-102"><a href="bad.html#cb65-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-103"><a href="bad.html#cb65-103" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb65-104"><a href="bad.html#cb65-104" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-105"><a href="bad.html#cb65-105" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-ldak-thin-left.reml</span>
<span id="cb65-106"><a href="bad.html#cb65-106" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb65-107"><a href="bad.html#cb65-107" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb65-108"><a href="bad.html#cb65-108" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-109"><a href="bad.html#cb65-109" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb65-110"><a href="bad.html#cb65-110" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb65-111"><a href="bad.html#cb65-111" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb65-112"><a href="bad.html#cb65-112" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-ldak-thin-mix.left</span>
<span id="cb65-113"><a href="bad.html#cb65-113" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb65-114"><a href="bad.html#cb65-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-115"><a href="bad.html#cb65-115" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb65-116"><a href="bad.html#cb65-116" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb65-117"><a href="bad.html#cb65-117" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>reml-mix/<span class="va">$i</span>-ldak-thin-all.reml</span>
<span id="cb65-118"><a href="bad.html#cb65-118" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/est.tmp</span>
<span id="cb65-119"><a href="bad.html#cb65-119" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;$1==&quot;Converged&quot; {print$2}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/converge.tmp</span>
<span id="cb65-120"><a href="bad.html#cb65-120" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb65-121"><a href="bad.html#cb65-121" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span>  summary/est.tmp <span class="dt">\</span></span>
<span id="cb65-122"><a href="bad.html#cb65-122" aria-hidden="true" tabindex="-1"></a>       summary/converge.tmp <span class="dt">\</span></span>
<span id="cb65-123"><a href="bad.html#cb65-123" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;code h2 se converge&quot;}{print i, $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb65-124"><a href="bad.html#cb65-124" aria-hidden="true" tabindex="-1"></a>       <span class="op">&gt;</span> summary/reml-ldak-thin-mix.all</span>
<span id="cb65-125"><a href="bad.html#cb65-125" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/est.tmp summary/converge.tmp</span>
<span id="cb65-126"><a href="bad.html#cb65-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-127"><a href="bad.html#cb65-127" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb65-128"><a href="bad.html#cb65-128" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb65-129"><a href="bad.html#cb65-129" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-mix.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb65-130"><a href="bad.html#cb65-130" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-mix.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb65-131"><a href="bad.html#cb65-131" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-mix.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=T<span class="kw">)</span></span>
<span id="cb65-132"><a href="bad.html#cb65-132" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb65-133"><a href="bad.html#cb65-133" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb65-134"><a href="bad.html#cb65-134" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-135"><a href="bad.html#cb65-135" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-136"><a href="bad.html#cb65-136" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-137"><a href="bad.html#cb65-137" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-138"><a href="bad.html#cb65-138" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb65-139"><a href="bad.html#cb65-139" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb65-140"><a href="bad.html#cb65-140" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb65-141"><a href="bad.html#cb65-141" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb65-142"><a href="bad.html#cb65-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-143"><a href="bad.html#cb65-143" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb65-144"><a href="bad.html#cb65-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-145"><a href="bad.html#cb65-145" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb65-146"><a href="bad.html#cb65-146" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb65-147"><a href="bad.html#cb65-147" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb65-148"><a href="bad.html#cb65-148" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb65-149"><a href="bad.html#cb65-149" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb65-150"><a href="bad.html#cb65-150" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb65-151"><a href="bad.html#cb65-151" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb65-152"><a href="bad.html#cb65-152" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb65-153"><a href="bad.html#cb65-153" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb65-154"><a href="bad.html#cb65-154" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb65-155"><a href="bad.html#cb65-155" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb65-156"><a href="bad.html#cb65-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-157"><a href="bad.html#cb65-157" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb65-158"><a href="bad.html#cb65-158" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb65-159"><a href="bad.html#cb65-159" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb65-160"><a href="bad.html#cb65-160" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb65-161"><a href="bad.html#cb65-161" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb65-162"><a href="bad.html#cb65-162" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb65-163"><a href="bad.html#cb65-163" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb65-164"><a href="bad.html#cb65-164" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb65-165"><a href="bad.html#cb65-165" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb65-166"><a href="bad.html#cb65-166" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb65-167"><a href="bad.html#cb65-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-168"><a href="bad.html#cb65-168" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/reml-ldak-thin-inflation-mix-gwas.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb65-169"><a href="bad.html#cb65-169" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span></code></pre></div>
</div>
</div>
<div id="he-1" class="section level2" number="9.8">
<h2><span class="header-section-number">9.8</span> HE</h2>
<div id="estimation-1" class="section level3" number="9.8.1">
<h3><span class="header-section-number">9.8.1</span> estimation</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb66-1"><a href="bad.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regress grm on covariates-----------------------------------------------------</span></span>
<span id="cb66-2"><a href="bad.html#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="bad.html#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grm <span class="kw">in</span> gcta-all-mix gcta-left-mix gcta-right-mix ldak-thin-all-mix ldak-thin-left-mix ldak-thin-right-mix<span class="kw">;</span> <span class="cf">do</span>  </span>
<span id="cb66-4"><a href="bad.html#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb66-5"><a href="bad.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb66-6"><a href="bad.html#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb66-7"><a href="bad.html#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 50G</span></span>
<span id="cb66-8"><a href="bad.html#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 5</span></span>
<span id="cb66-9"><a href="bad.html#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb66-10"><a href="bad.html#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --adjust-grm ../kinship/</span><span class="va">$grm</span><span class="st">.covar </span><span class="dt">\</span></span>
<span id="cb66-11"><a href="bad.html#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/</span><span class="va">$grm</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb66-12"><a href="bad.html#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb66-13"><a href="bad.html#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 5</span></span>
<span id="cb66-14"><a href="bad.html#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$grm</span>-adjust.sh</span>
<span id="cb66-15"><a href="bad.html#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-16"><a href="bad.html#cb66-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-17"><a href="bad.html#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="co"># submit jobs</span></span>
<span id="cb66-18"><a href="bad.html#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grm <span class="kw">in</span> gcta-all-mix gcta-left-mix gcta-right-mix ldak-thin-all-mix ldak-thin-left-mix ldak-thin-right-mix<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-19"><a href="bad.html#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$grm</span>-adjust.sh</span>
<span id="cb66-20"><a href="bad.html#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/grm-adjust-for-HE</span>
<span id="cb66-21"><a href="bad.html#cb66-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-22"><a href="bad.html#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion----------------------------------------------------------</span></span>
<span id="cb66-23"><a href="bad.html#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/grm-adjust-for-HE</span>
<span id="cb66-24"><a href="bad.html#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb66-25"><a href="bad.html#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb66-26"><a href="bad.html#cb66-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-27"><a href="bad.html#cb66-27" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb66-28"><a href="bad.html#cb66-28" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb66-29"><a href="bad.html#cb66-29" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb66-30"><a href="bad.html#cb66-30" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb66-31"><a href="bad.html#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb66-32"><a href="bad.html#cb66-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-33"><a href="bad.html#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb66-34"><a href="bad.html#cb66-34" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb66-35"><a href="bad.html#cb66-35" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb66-36"><a href="bad.html#cb66-36" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb66-37"><a href="bad.html#cb66-37" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb66-38"><a href="bad.html#cb66-38" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb66-39"><a href="bad.html#cb66-39" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span>
<span id="cb66-40"><a href="bad.html#cb66-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-41"><a href="bad.html#cb66-41" aria-hidden="true" tabindex="-1"></a><span class="co"># HE under gcta-----------------------------------------------------------------</span></span>
<span id="cb66-42"><a href="bad.html#cb66-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-43"><a href="bad.html#cb66-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-44"><a href="bad.html#cb66-44" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb66-45"><a href="bad.html#cb66-45" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb66-46"><a href="bad.html#cb66-46" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb66-47"><a href="bad.html#cb66-47" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb66-48"><a href="bad.html#cb66-48" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb66-49"><a href="bad.html#cb66-49" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:30:0</span></span>
<span id="cb66-50"><a href="bad.html#cb66-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-51"><a href="bad.html#cb66-51" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --he ../he-mix/</span><span class="va">$i</span><span class="st">-he-gcta-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb66-52"><a href="bad.html#cb66-52" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb66-53"><a href="bad.html#cb66-53" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/gcta-</span><span class="va">$k</span><span class="st">-mix.covar </span><span class="dt">\</span></span>
<span id="cb66-54"><a href="bad.html#cb66-54" aria-hidden="true" tabindex="-1"></a><span class="st">          --kinship-details NO </span><span class="dt">\</span></span>
<span id="cb66-55"><a href="bad.html#cb66-55" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-root NO </span><span class="dt">\</span></span>
<span id="cb66-56"><a href="bad.html#cb66-56" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb66-57"><a href="bad.html#cb66-57" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 1 </span><span class="dt">\</span></span>
<span id="cb66-58"><a href="bad.html#cb66-58" aria-hidden="true" tabindex="-1"></a><span class="st">          --memory-save YES</span></span>
<span id="cb66-59"><a href="bad.html#cb66-59" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-he-gcta-<span class="va">$k</span>-snps.sh</span>
<span id="cb66-60"><a href="bad.html#cb66-60" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-61"><a href="bad.html#cb66-61" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-62"><a href="bad.html#cb66-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-63"><a href="bad.html#cb66-63" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb66-64"><a href="bad.html#cb66-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-65"><a href="bad.html#cb66-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-66"><a href="bad.html#cb66-66" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-he-gcta-<span class="va">$k</span>-snps.sh</span>
<span id="cb66-67"><a href="bad.html#cb66-67" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-68"><a href="bad.html#cb66-68" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/he-gcta</span>
<span id="cb66-69"><a href="bad.html#cb66-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-70"><a href="bad.html#cb66-70" aria-hidden="true" tabindex="-1"></a><span class="co"># HE under ldak-thin------------------------------------------------------------</span></span>
<span id="cb66-71"><a href="bad.html#cb66-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-72"><a href="bad.html#cb66-72" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-73"><a href="bad.html#cb66-73" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb66-74"><a href="bad.html#cb66-74" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb66-75"><a href="bad.html#cb66-75" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb66-76"><a href="bad.html#cb66-76" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 2G</span></span>
<span id="cb66-77"><a href="bad.html#cb66-77" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 1</span></span>
<span id="cb66-78"><a href="bad.html#cb66-78" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 0:30:0</span></span>
<span id="cb66-79"><a href="bad.html#cb66-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-80"><a href="bad.html#cb66-80" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --he ../he-mix/</span><span class="va">$i</span><span class="st">-he-ldak-thin-</span><span class="va">$k</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb66-81"><a href="bad.html#cb66-81" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb66-82"><a href="bad.html#cb66-82" aria-hidden="true" tabindex="-1"></a><span class="st">          --grm ../kinship/ldak-thin-</span><span class="va">$k</span><span class="st">-mix.covar </span><span class="dt">\</span></span>
<span id="cb66-83"><a href="bad.html#cb66-83" aria-hidden="true" tabindex="-1"></a><span class="st">          --kinship-details NO </span><span class="dt">\</span></span>
<span id="cb66-84"><a href="bad.html#cb66-84" aria-hidden="true" tabindex="-1"></a><span class="st">          --check-root NO </span><span class="dt">\</span></span>
<span id="cb66-85"><a href="bad.html#cb66-85" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb66-86"><a href="bad.html#cb66-86" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 1 </span><span class="dt">\</span></span>
<span id="cb66-87"><a href="bad.html#cb66-87" aria-hidden="true" tabindex="-1"></a><span class="st">          --memory-save YES</span></span>
<span id="cb66-88"><a href="bad.html#cb66-88" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-he-ldak-thin-<span class="va">$k</span>-snps.sh</span>
<span id="cb66-89"><a href="bad.html#cb66-89" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-90"><a href="bad.html#cb66-90" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-91"><a href="bad.html#cb66-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-92"><a href="bad.html#cb66-92" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files------------------------------------------------------------------</span></span>
<span id="cb66-93"><a href="bad.html#cb66-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-94"><a href="bad.html#cb66-94" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> all left right<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb66-95"><a href="bad.html#cb66-95" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-he-ldak-thin-<span class="va">$k</span>-snps.sh</span>
<span id="cb66-96"><a href="bad.html#cb66-96" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb66-97"><a href="bad.html#cb66-97" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../job-records/he-ldak-thin</span></code></pre></div>
</div>
<div id="summary-6" class="section level3" number="9.8.2">
<h3><span class="header-section-number">9.8.2</span> summary</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb67-1"><a href="bad.html#cb67-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-2"><a href="bad.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb67-3"><a href="bad.html#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># under gcta</span></span>
<span id="cb67-4"><a href="bad.html#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb67-5"><a href="bad.html#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="bad.html#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb67-7"><a href="bad.html#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb67-8"><a href="bad.html#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-mix.right </span>
<span id="cb67-9"><a href="bad.html#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-10"><a href="bad.html#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-gcta-right.he</span>
<span id="cb67-11"><a href="bad.html#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-mix.right</span>
<span id="cb67-12"><a href="bad.html#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-13"><a href="bad.html#cb67-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-14"><a href="bad.html#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb67-15"><a href="bad.html#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-mix.left</span>
<span id="cb67-16"><a href="bad.html#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-17"><a href="bad.html#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-gcta-left.he</span>
<span id="cb67-18"><a href="bad.html#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-mix.left</span>
<span id="cb67-19"><a href="bad.html#cb67-19" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-20"><a href="bad.html#cb67-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-21"><a href="bad.html#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb67-22"><a href="bad.html#cb67-22" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-gcta-mix.all</span>
<span id="cb67-23"><a href="bad.html#cb67-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-24"><a href="bad.html#cb67-24" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-gcta-all.he</span>
<span id="cb67-25"><a href="bad.html#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-gcta-mix.all</span>
<span id="cb67-26"><a href="bad.html#cb67-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-27"><a href="bad.html#cb67-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-28"><a href="bad.html#cb67-28" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb67-29"><a href="bad.html#cb67-29" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb67-30"><a href="bad.html#cb67-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-31"><a href="bad.html#cb67-31" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-mix.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb67-32"><a href="bad.html#cb67-32" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-mix.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb67-33"><a href="bad.html#cb67-33" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-gcta-mix.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb67-34"><a href="bad.html#cb67-34" aria-hidden="true" tabindex="-1"></a><span class="ex">names</span><span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">left</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;code&quot;</span><span class="ex">,</span><span class="st">&quot;h2&quot;</span><span class="ex">,</span><span class="st">&quot;se&quot;</span><span class="kw">)</span></span>
<span id="cb67-35"><a href="bad.html#cb67-35" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb67-36"><a href="bad.html#cb67-36" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb67-37"><a href="bad.html#cb67-37" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb67-38"><a href="bad.html#cb67-38" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb67-39"><a href="bad.html#cb67-39" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb67-40"><a href="bad.html#cb67-40" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb67-41"><a href="bad.html#cb67-41" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb67-42"><a href="bad.html#cb67-42" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb67-43"><a href="bad.html#cb67-43" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb67-44"><a href="bad.html#cb67-44" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb67-45"><a href="bad.html#cb67-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-46"><a href="bad.html#cb67-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb67-47"><a href="bad.html#cb67-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-48"><a href="bad.html#cb67-48" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb67-49"><a href="bad.html#cb67-49" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb67-50"><a href="bad.html#cb67-50" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb67-51"><a href="bad.html#cb67-51" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb67-52"><a href="bad.html#cb67-52" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb67-53"><a href="bad.html#cb67-53" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb67-54"><a href="bad.html#cb67-54" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb67-55"><a href="bad.html#cb67-55" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb67-56"><a href="bad.html#cb67-56" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb67-57"><a href="bad.html#cb67-57" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb67-58"><a href="bad.html#cb67-58" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb67-59"><a href="bad.html#cb67-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-60"><a href="bad.html#cb67-60" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb67-61"><a href="bad.html#cb67-61" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb67-62"><a href="bad.html#cb67-62" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb67-63"><a href="bad.html#cb67-63" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb67-64"><a href="bad.html#cb67-64" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb67-65"><a href="bad.html#cb67-65" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb67-66"><a href="bad.html#cb67-66" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb67-67"><a href="bad.html#cb67-67" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb67-68"><a href="bad.html#cb67-68" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb67-69"><a href="bad.html#cb67-69" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb67-70"><a href="bad.html#cb67-70" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/he-gcta-inflation-mix-gwas.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb67-71"><a href="bad.html#cb67-71" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb67-72"><a href="bad.html#cb67-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-73"><a href="bad.html#cb67-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-74"><a href="bad.html#cb67-74" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb67-75"><a href="bad.html#cb67-75" aria-hidden="true" tabindex="-1"></a><span class="co"># under ldak-thin</span></span>
<span id="cb67-76"><a href="bad.html#cb67-76" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::</span></span>
<span id="cb67-77"><a href="bad.html#cb67-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-78"><a href="bad.html#cb67-78" aria-hidden="true" tabindex="-1"></a><span class="co"># extract h2 estimates ---------------------------------------------------------</span></span>
<span id="cb67-79"><a href="bad.html#cb67-79" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb67-80"><a href="bad.html#cb67-80" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-mix.right </span>
<span id="cb67-81"><a href="bad.html#cb67-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-82"><a href="bad.html#cb67-82" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-ldak-thin-right.he</span>
<span id="cb67-83"><a href="bad.html#cb67-83" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-mix.right</span>
<span id="cb67-84"><a href="bad.html#cb67-84" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-85"><a href="bad.html#cb67-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-86"><a href="bad.html#cb67-86" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb67-87"><a href="bad.html#cb67-87" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-mix.left</span>
<span id="cb67-88"><a href="bad.html#cb67-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-89"><a href="bad.html#cb67-89" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-ldak-thin-left.he</span>
<span id="cb67-90"><a href="bad.html#cb67-90" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-mix.left</span>
<span id="cb67-91"><a href="bad.html#cb67-91" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-92"><a href="bad.html#cb67-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-93"><a href="bad.html#cb67-93" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb67-94"><a href="bad.html#cb67-94" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> summary/he-ldak-thin-mix.all</span>
<span id="cb67-95"><a href="bad.html#cb67-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb67-96"><a href="bad.html#cb67-96" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>he-mix/<span class="va">$i</span>-he-gcta-all.he</span>
<span id="cb67-97"><a href="bad.html#cb67-97" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1==&quot;Her_All&quot; {print i, $2, $3}&#39;</span> <span class="va">$outfile</span> <span class="op">&gt;&gt;</span> summary/he-ldak-thin-mix.all</span>
<span id="cb67-98"><a href="bad.html#cb67-98" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb67-99"><a href="bad.html#cb67-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-100"><a href="bad.html#cb67-100" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation test----------------------------------------------------------------</span></span>
<span id="cb67-101"><a href="bad.html#cb67-101" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb67-102"><a href="bad.html#cb67-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-103"><a href="bad.html#cb67-103" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-mix.all&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb67-104"><a href="bad.html#cb67-104" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-mix.left&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb67-105"><a href="bad.html#cb67-105" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>read.table<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-mix.right&quot;</span><span class="kw">)</span><span class="ex">,</span> header=F<span class="kw">)</span></span>
<span id="cb67-106"><a href="bad.html#cb67-106" aria-hidden="true" tabindex="-1"></a><span class="ex">names</span><span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">left</span><span class="kw">)</span><span class="ex">=names</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;code&quot;</span><span class="ex">,</span><span class="st">&quot;h2&quot;</span><span class="ex">,</span><span class="st">&quot;se&quot;</span><span class="kw">)</span></span>
<span id="cb67-107"><a href="bad.html#cb67-107" aria-hidden="true" tabindex="-1"></a><span class="co"># some analyses did not complete --&gt; match dataframes</span></span>
<span id="cb67-108"><a href="bad.html#cb67-108" aria-hidden="true" tabindex="-1"></a><span class="ex">dim</span><span class="er">(</span><span class="ex">full</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">left</span><span class="kw">);</span><span class="ex">dim</span><span class="er">(</span><span class="ex">right</span><span class="kw">)</span></span>
<span id="cb67-109"><a href="bad.html#cb67-109" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">full</span><span class="va">$code</span><span class="ex">,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb67-110"><a href="bad.html#cb67-110" aria-hidden="true" tabindex="-1"></a><span class="va">common</span><span class="op">=</span>intersect<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb67-111"><a href="bad.html#cb67-111" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> right<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb67-112"><a href="bad.html#cb67-112" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> full<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb67-113"><a href="bad.html#cb67-113" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">common,</span> left<span class="va">$code</span><span class="kw">)</span></span>
<span id="cb67-114"><a href="bad.html#cb67-114" aria-hidden="true" tabindex="-1"></a><span class="va">right</span><span class="op">=</span>right[m1,]</span>
<span id="cb67-115"><a href="bad.html#cb67-115" aria-hidden="true" tabindex="-1"></a><span class="va">full</span><span class="op">=</span>full[m2,]</span>
<span id="cb67-116"><a href="bad.html#cb67-116" aria-hidden="true" tabindex="-1"></a><span class="va">left</span><span class="op">=</span>left[m3,]</span>
<span id="cb67-117"><a href="bad.html#cb67-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-118"><a href="bad.html#cb67-118" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:dim<span class="er">(</span><span class="ex">full</span><span class="kw">)</span><span class="ex">[1]</span><span class="kw">){</span></span>
<span id="cb67-119"><a href="bad.html#cb67-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-120"><a href="bad.html#cb67-120" aria-hidden="true" tabindex="-1"></a>    <span class="va">est1</span><span class="op">=</span>left<span class="va">$h2</span>[i]</span>
<span id="cb67-121"><a href="bad.html#cb67-121" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd1</span><span class="op">=</span>left<span class="va">$se</span>[i]</span>
<span id="cb67-122"><a href="bad.html#cb67-122" aria-hidden="true" tabindex="-1"></a>    <span class="va">est2</span><span class="op">=</span>right<span class="va">$h2</span>[i]</span>
<span id="cb67-123"><a href="bad.html#cb67-123" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd2</span><span class="op">=</span>right<span class="va">$se</span>[i]</span>
<span id="cb67-124"><a href="bad.html#cb67-124" aria-hidden="true" tabindex="-1"></a>    <span class="va">est</span><span class="op">=</span>full<span class="va">$h2</span>[i]</span>
<span id="cb67-125"><a href="bad.html#cb67-125" aria-hidden="true" tabindex="-1"></a>    <span class="va">sd</span><span class="op">=</span>full<span class="va">$se</span>[i]</span>
<span id="cb67-126"><a href="bad.html#cb67-126" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span><span class="op">=</span>100000</span>
<span id="cb67-127"><a href="bad.html#cb67-127" aria-hidden="true" tabindex="-1"></a>    <span class="va">d1</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est1,sd1</span><span class="kw">)</span></span>
<span id="cb67-128"><a href="bad.html#cb67-128" aria-hidden="true" tabindex="-1"></a>    <span class="va">d2</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est2,sd2</span><span class="kw">)</span></span>
<span id="cb67-129"><a href="bad.html#cb67-129" aria-hidden="true" tabindex="-1"></a>    <span class="va">d</span><span class="op">=</span>rnorm<span class="kw">(</span><span class="ex">N,est,sd</span><span class="kw">)</span></span>
<span id="cb67-130"><a href="bad.html#cb67-130" aria-hidden="true" tabindex="-1"></a>    <span class="va">p</span><span class="op">=</span>1-mean<span class="kw">(</span><span class="ex">d1+d2-d</span><span class="op">&gt;</span>=0<span class="kw">)</span></span>
<span id="cb67-131"><a href="bad.html#cb67-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-132"><a href="bad.html#cb67-132" aria-hidden="true" tabindex="-1"></a>    <span class="va">out0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">code</span><span class="op">=</span>full<span class="va">$code</span>[i],</span>
<span id="cb67-133"><a href="bad.html#cb67-133" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_est</span><span class="op">=</span>est2,</span>
<span id="cb67-134"><a href="bad.html#cb67-134" aria-hidden="true" tabindex="-1"></a>                    <span class="va">right_sd</span><span class="op">=</span>sd2,</span>
<span id="cb67-135"><a href="bad.html#cb67-135" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_est</span><span class="op">=</span>est1,</span>
<span id="cb67-136"><a href="bad.html#cb67-136" aria-hidden="true" tabindex="-1"></a>                    <span class="va">left_sd</span><span class="op">=</span>sd1,</span>
<span id="cb67-137"><a href="bad.html#cb67-137" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_est</span><span class="op">=</span>est,</span>
<span id="cb67-138"><a href="bad.html#cb67-138" aria-hidden="true" tabindex="-1"></a>                    <span class="va">all_sd</span><span class="op">=</span>sd,</span>
<span id="cb67-139"><a href="bad.html#cb67-139" aria-hidden="true" tabindex="-1"></a>                    <span class="va">p_inflation</span><span class="op">=</span>p<span class="kw">)</span></span>
<span id="cb67-140"><a href="bad.html#cb67-140" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{out=out0}else</span><span class="dt">{out=rbind(out</span><span class="op">,</span><span class="dt">out0)}</span></span>
<span id="cb67-141"><a href="bad.html#cb67-141" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb67-142"><a href="bad.html#cb67-142" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span> paste0<span class="er">(</span><span class="st">&quot;summary/he-ldak-thin-inflation-mix-gwas.txt&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb67-143"><a href="bad.html#cb67-143" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="good.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ukbb.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/04.2-bad-gwas.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
