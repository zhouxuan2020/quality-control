<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Good VS Bad GWAS | GWAS Quality Control</title>
  <meta name="description" content="3 Good VS Bad GWAS | GWAS Quality Control" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Good VS Bad GWAS | GWAS Quality Control" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Good VS Bad GWAS | GWAS Quality Control" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="summaries.html"/>
<link rel="next" href="mathematical-details.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Quality Control Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> General Info</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#topic"><i class="fa fa-check"></i><b>1.1</b> Topic</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#frequently-used-commands"><i class="fa fa-check"></i><b>1.2</b> Frequently used commands</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summaries.html"><a href="summaries.html"><i class="fa fa-check"></i><b>2</b> Summaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="summaries.html"><a href="summaries.html#good-gwas"><i class="fa fa-check"></i><b>2.1</b> Good GWAS</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher"><i class="fa fa-check"></i><b>2.1.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="2.1.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression"><i class="fa fa-check"></i><b>2.1.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="summaries.html"><a href="summaries.html#bad-gwas"><i class="fa fa-check"></i><b>2.2</b> Bad GWAS</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-1"><i class="fa fa-check"></i><b>2.2.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="2.2.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-1"><i class="fa fa-check"></i><b>2.2.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="summaries.html"><a href="summaries.html#ukbb-recommended"><i class="fa fa-check"></i><b>2.3</b> UKBB recommended</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-2"><i class="fa fa-check"></i><b>2.3.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="2.3.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-2"><i class="fa fa-check"></i><b>2.3.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="summaries.html"><a href="summaries.html#control-gwas"><i class="fa fa-check"></i><b>2.4</b> Control GWAS</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-3"><i class="fa fa-check"></i><b>2.4.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="2.4.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-3"><i class="fa fa-check"></i><b>2.4.2</b> Haseman Elston Regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html"><i class="fa fa-check"></i><b>3</b> Good VS Bad GWAS</a>
<ul>
<li class="chapter" data-level="3.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#test-statistics-ld-score"><i class="fa fa-check"></i><b>3.1</b> test statistics ~ LD score</a></li>
<li class="chapter" data-level="3.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#new-models"><i class="fa fa-check"></i><b>3.2</b> New models?</a></li>
<li class="chapter" data-level="3.3" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#ld-scores-based-on-individual-level-data"><i class="fa fa-check"></i><b>3.3</b> LD scores based on individual level data</a></li>
<li class="chapter" data-level="3.4" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#test-the-new-model"><i class="fa fa-check"></i><b>3.4</b> Test the new model</a></li>
<li class="chapter" data-level="3.5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#predictors-of-inflation"><i class="fa fa-check"></i><b>3.5</b> predictors of inflation?</a></li>
<li class="chapter" data-level="3.6" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#regress-bad-chisq-mean-r2_j"><i class="fa fa-check"></i><b>3.6</b> regress bad chisq ~ mean r^2_j</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mathematical-details.html"><a href="mathematical-details.html"><i class="fa fa-check"></i><b>4</b> Mathematical Details</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mathematical-details.html"><a href="mathematical-details.html#trk_rightk_left"><i class="fa fa-check"></i><b>4.1</b> <span class="math inline">\(tr(K_{right}K_{left})\)</span></a></li>
<li class="chapter" data-level="4.2" data-path="mathematical-details.html"><a href="mathematical-details.html#verification"><i class="fa fa-check"></i><b>4.2</b> verification</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html"><i class="fa fa-check"></i><b>5</b> chi square ~ <span class="math inline">\(\overline{r^2_j}\)</span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#overliner2_j-choice-of-snps"><i class="fa fa-check"></i><b>5.1</b> <span class="math inline">\(\overline{r^2_j}\)</span> &amp; choice of SNPs</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#number-of-snps"><i class="fa fa-check"></i><b>5.1.1</b> number of SNPs</a></li>
<li class="chapter" data-level="5.1.2" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#maf"><i class="fa fa-check"></i><b>5.1.2</b> maf</a></li>
<li class="chapter" data-level="5.1.3" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#summary"><i class="fa fa-check"></i><b>5.1.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#varying-levels-of-confouding"><i class="fa fa-check"></i><b>5.2</b> varying levels of confouding</a></li>
<li class="chapter" data-level="5.3" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#results-summary"><i class="fa fa-check"></i><b>5.3</b> results summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="good.html"><a href="good.html"><i class="fa fa-check"></i><b>6</b> Good GWAS</a>
<ul>
<li class="chapter" data-level="6.1" data-path="good.html"><a href="good.html#goodid"><i class="fa fa-check"></i><b>6.1</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="6.2" data-path="good.html"><a href="good.html#extract-covariates"><i class="fa fa-check"></i><b>6.2</b> extract covariates</a></li>
<li class="chapter" data-level="6.3" data-path="good.html"><a href="good.html#gwas"><i class="fa fa-check"></i><b>6.3</b> GWAS</a></li>
<li class="chapter" data-level="6.4" data-path="good.html"><a href="good.html#ldsc-intercept"><i class="fa fa-check"></i><b>6.4</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="good.html"><a href="good.html#under-gcta"><i class="fa fa-check"></i><b>6.4.1</b> under gcta</a></li>
<li class="chapter" data-level="6.4.2" data-path="good.html"><a href="good.html#under-ldak-thin"><i class="fa fa-check"></i><b>6.4.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="6.4.3" data-path="good.html"><a href="good.html#summary-1"><i class="fa fa-check"></i><b>6.4.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="good.html"><a href="good.html#reml"><i class="fa fa-check"></i><b>6.5</b> REML</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="good.html"><a href="good.html#making-grms"><i class="fa fa-check"></i><b>6.5.1</b> making grms</a></li>
<li class="chapter" data-level="6.5.2" data-path="good.html"><a href="good.html#fast-reml"><i class="fa fa-check"></i><b>6.5.2</b> fast-reml</a></li>
<li class="chapter" data-level="6.5.3" data-path="good.html"><a href="good.html#inflation-test"><i class="fa fa-check"></i><b>6.5.3</b> inflation test</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="good.html"><a href="good.html#he"><i class="fa fa-check"></i><b>6.6</b> HE</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="good.html"><a href="good.html#estimation"><i class="fa fa-check"></i><b>6.6.1</b> estimation</a></li>
<li class="chapter" data-level="6.6.2" data-path="good.html"><a href="good.html#summary-2"><i class="fa fa-check"></i><b>6.6.2</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bad.html"><a href="bad.html"><i class="fa fa-check"></i><b>7</b> Bad GWAS</a>
<ul>
<li class="chapter" data-level="7.1" data-path="bad.html"><a href="bad.html#badid"><i class="fa fa-check"></i><b>7.1</b> ID list</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="bad.html"><a href="bad.html#initial-selection"><i class="fa fa-check"></i><b>7.1.1</b> initial selection</a></li>
<li class="chapter" data-level="7.1.2" data-path="bad.html"><a href="bad.html#relatedness-filtering"><i class="fa fa-check"></i><b>7.1.2</b> relatedness filtering</a></li>
<li class="chapter" data-level="7.1.3" data-path="bad.html"><a href="bad.html#final-list"><i class="fa fa-check"></i><b>7.1.3</b> final list</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="bad.html"><a href="bad.html#gwas-1"><i class="fa fa-check"></i><b>7.2</b> GWAS</a></li>
<li class="chapter" data-level="7.3" data-path="bad.html"><a href="bad.html#ldsc-intercept-1"><i class="fa fa-check"></i><b>7.3</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="bad.html"><a href="bad.html#under-gcta-1"><i class="fa fa-check"></i><b>7.3.1</b> under gcta</a></li>
<li class="chapter" data-level="7.3.2" data-path="bad.html"><a href="bad.html#under-ldak-thin-1"><i class="fa fa-check"></i><b>7.3.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="7.3.3" data-path="bad.html"><a href="bad.html#summary-3"><i class="fa fa-check"></i><b>7.3.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="bad.html"><a href="bad.html#reml-1"><i class="fa fa-check"></i><b>7.4</b> REML</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="bad.html"><a href="bad.html#making-grms-1"><i class="fa fa-check"></i><b>7.4.1</b> making grms</a></li>
<li class="chapter" data-level="7.4.2" data-path="bad.html"><a href="bad.html#fast-reml-1"><i class="fa fa-check"></i><b>7.4.2</b> fast-reml</a></li>
<li class="chapter" data-level="7.4.3" data-path="bad.html"><a href="bad.html#inflation-test-1"><i class="fa fa-check"></i><b>7.4.3</b> inflation test</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="bad.html"><a href="bad.html#he-1"><i class="fa fa-check"></i><b>7.5</b> HE</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="bad.html"><a href="bad.html#estimation-1"><i class="fa fa-check"></i><b>7.5.1</b> estimation</a></li>
<li class="chapter" data-level="7.5.2" data-path="bad.html"><a href="bad.html#summary-4"><i class="fa fa-check"></i><b>7.5.2</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ukbb.html"><a href="ukbb.html"><i class="fa fa-check"></i><b>8</b> UKBB recommended</a>
<ul>
<li class="chapter" data-level="8.1" data-path="ukbb.html"><a href="ukbb.html#total-n-337k"><i class="fa fa-check"></i><b>8.1</b> total N = 337k</a></li>
<li class="chapter" data-level="8.2" data-path="ukbb.html"><a href="ukbb.html#qc-of-hp3-snps"><i class="fa fa-check"></i><b>8.2</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="8.3" data-path="ukbb.html"><a href="ukbb.html#gwas-2"><i class="fa fa-check"></i><b>8.3</b> GWAS</a></li>
<li class="chapter" data-level="8.4" data-path="ukbb.html"><a href="ukbb.html#ldsc-intercept-2"><i class="fa fa-check"></i><b>8.4</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="ukbb.html"><a href="ukbb.html#under-gcta-2"><i class="fa fa-check"></i><b>8.4.1</b> under gcta</a></li>
<li class="chapter" data-level="8.4.2" data-path="ukbb.html"><a href="ukbb.html#under-ldak-thin-2"><i class="fa fa-check"></i><b>8.4.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="8.4.3" data-path="ukbb.html"><a href="ukbb.html#summary-5"><i class="fa fa-check"></i><b>8.4.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="ukbb.html"><a href="ukbb.html#he-2"><i class="fa fa-check"></i><b>8.5</b> HE</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="ukbb.html"><a href="ukbb.html#making-grms-2"><i class="fa fa-check"></i><b>8.5.1</b> making grms</a></li>
<li class="chapter" data-level="8.5.2" data-path="ukbb.html"><a href="ukbb.html#estimation-2"><i class="fa fa-check"></i><b>8.5.2</b> estimation</a></li>
<li class="chapter" data-level="8.5.3" data-path="ukbb.html"><a href="ukbb.html#summary-6"><i class="fa fa-check"></i><b>8.5.3</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="control.html"><a href="control.html"><i class="fa fa-check"></i><b>9</b> control GWAS</a>
<ul>
<li class="chapter" data-level="9.1" data-path="control.html"><a href="control.html#id-list"><i class="fa fa-check"></i><b>9.1</b> ID list</a></li>
<li class="chapter" data-level="9.2" data-path="control.html"><a href="control.html#qc-of-hp3-snps-1"><i class="fa fa-check"></i><b>9.2</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="9.3" data-path="control.html"><a href="control.html#gwas-3"><i class="fa fa-check"></i><b>9.3</b> GWAS</a></li>
<li class="chapter" data-level="9.4" data-path="control.html"><a href="control.html#ldsc-intercept-3"><i class="fa fa-check"></i><b>9.4</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="control.html"><a href="control.html#under-gcta-3"><i class="fa fa-check"></i><b>9.4.1</b> under gcta</a></li>
<li class="chapter" data-level="9.4.2" data-path="control.html"><a href="control.html#under-ldak-thin-3"><i class="fa fa-check"></i><b>9.4.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="9.4.3" data-path="control.html"><a href="control.html#summary-7"><i class="fa fa-check"></i><b>9.4.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="control.html"><a href="control.html#he-3"><i class="fa fa-check"></i><b>9.5</b> HE</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="control.html"><a href="control.html#making-grms-3"><i class="fa fa-check"></i><b>9.5.1</b> making grms</a></li>
<li class="chapter" data-level="9.5.2" data-path="control.html"><a href="control.html#estimation-3"><i class="fa fa-check"></i><b>9.5.2</b> estimation</a></li>
<li class="chapter" data-level="9.5.3" data-path="control.html"><a href="control.html#summary-8"><i class="fa fa-check"></i><b>9.5.3</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html"><i class="fa fa-check"></i><b>10</b> compute <span class="math inline">\(\sum_{i,j}^{m_1, m_2}r^2_{i,j}\)</span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#good-gwas-all-qced-snps"><i class="fa fa-check"></i><b>10.1</b> good GWAS-all qced snps</a></li>
<li class="chapter" data-level="10.2" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#good-gwass--ldak-thin-snps"><i class="fa fa-check"></i><b>10.2</b> good GWASs- ldak-thin snps</a></li>
<li class="chapter" data-level="10.3" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#bad-gwass-all-qced-snps"><i class="fa fa-check"></i><b>10.3</b> bad GWASs-all qced snps</a></li>
<li class="chapter" data-level="10.4" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#summary-9"><i class="fa fa-check"></i><b>10.4</b> summary</a></li>
<li class="chapter" data-level="10.5" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#compute-overliner2_j"><i class="fa fa-check"></i><b>10.5</b> compute <span class="math inline">\(\overline{r^2_j}\)</span></a></li>
<li class="chapter" data-level="10.6" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#mixed-pop-gwas-with-pc-as-covariates"><i class="fa fa-check"></i><b>10.6</b> mixed pop GWAS with PC as covariates</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GWAS Quality Control</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="good-vs-bad-gwas" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Good VS Bad GWAS</h1>
<p>Here we investigate the inflation in test statistics from the bad GWASs. We want to find out 1) if the inflation is constant; 2) if it can be predicted in some way.</p>
<div id="test-statistics-ld-score" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> test statistics ~ LD score</h2>
<p>The inflation in GWAS test statistics due to confouding is not always constant, as assumed by LDSC. Below we plotted the chi-square test statistics from the bad (colored in red), good (orange), and control (gray) GWASs as a function of LD score ( Fig <a href="good-vs-bad-gwas.html#fig:good-vs-bad-by-ldscorebin">3.1</a> ). The linear model assumed by LDSC is only appropriate for four traits, namely chron, pulse, quals, and snoring. For these traits, LDSC accounts for the inflation due to confounding (i.e., intercept) and the inflation due to polygenity (i.e., slope). However, LDSC is inadequate for other traits, where the inflation is non-linear. More specifically, for these traits, the test statistics for SNPs with a low LD score are much more inflated than would be expected by LDSC. Thus, although LDSC can detect the inflation in GWAS test statistics due to confounding, it cannot be used to correct the inflation for some traits.</p>
<div class="figure" style="text-align: left"><span style="display:block;" id="fig:good-vs-bad-by-ldscorebin"></span>
<img src="fig-to-insert/gwas-stat-by-ldscbin.png" alt="Test statistics by LD score for good, bad and control GWASs." width="100%" />
<p class="caption">
Figure 3.1: Test statistics by LD score for good, bad and control GWASs.
</p>
</div>
</div>
<div id="new-models" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> New models?</h2>
<ol style="list-style-type: decimal">
<li><ul>
<li><span class="math inline">\(S_{j} = 1 + n_{j}a + n_{j}\sum_{i}^{m}(r_{ji}^2 \ q_{i}/Q) h^2_{snp} + \epsilon_{j}\)</span>
<ul>
<li>under GCTA: <span class="math inline">\(q_{i}=1, Q=\sum_{i}^{m}q_i=m\)</span></li>
<li>under LDAK-thin: <span class="math inline">\(q_{i}=I_{i}[f_{i}(1-f_{i})]^{0.75}\)</span></li>
</ul></li>
</ul></li>
<li><ul>
<li><span class="math inline">\(S_{j} = 1 + n_{j}a + n_{j}\sum_{i}^{k}(r_{ji}^2 \ q_{i}/Q) h^2_{snp} + n_j \sum ()h + \epsilon_{j}\)</span>
<ul>
<li>under GCTA: <span class="math inline">\(q_{i}=1, Q=\sum_{i}^{m}q_i=m\)</span></li>
<li>under LDAK-thin: <span class="math inline">\(q_{i}=I_{i}[f_{i}(1-f_{i})]^{0.75}\)</span></li>
</ul></li>
</ul></li>
</ol>
</div>
<div id="ld-scores-based-on-individual-level-data" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> LD scores based on individual level data</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="good-vs-bad-gwas.html#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="good-vs-bad-gwas.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ldsc/ldscore-individual-data</span>
<span id="cb1-3"><a href="good-vs-bad-gwas.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gen/snps-unrel-inds-by-chrom</span>
<span id="cb1-4"><a href="good-vs-bad-gwas.html#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="good-vs-bad-gwas.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># divide snp list by chrom</span></span>
<span id="cb1-6"><a href="good-vs-bad-gwas.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb1-7"><a href="good-vs-bad-gwas.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;{split($0, a , &quot;:&quot;)} (a[1]==i) {print $0}&#39;</span> gen/snps-unrel-inds.use <span class="op">&gt;</span> gen/snps-unrel-inds-by-chrom/snps-unrel-inds-<span class="va">$i</span></span>
<span id="cb1-8"><a href="good-vs-bad-gwas.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb1-9"><a href="good-vs-bad-gwas.html#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="good-vs-bad-gwas.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># compute LD scores</span></span>
<span id="cb1-11"><a href="good-vs-bad-gwas.html#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="good-vs-bad-gwas.html#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb1-13"><a href="good-vs-bad-gwas.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb1-14"><a href="good-vs-bad-gwas.html#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb1-15"><a href="good-vs-bad-gwas.html#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb1-16"><a href="good-vs-bad-gwas.html#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 80G</span></span>
<span id="cb1-17"><a href="good-vs-bad-gwas.html#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb1-18"><a href="good-vs-bad-gwas.html#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb1-19"><a href="good-vs-bad-gwas.html#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="good-vs-bad-gwas.html#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="st">.././ldsc.py </span><span class="dt">\</span></span>
<span id="cb1-21"><a href="good-vs-bad-gwas.html#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="st">      --bfile ../../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb1-22"><a href="good-vs-bad-gwas.html#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="st">      --extract ../../gen/snps-unrel-inds-by-chrom/snps-unrel-inds-</span><span class="va">$i</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb1-23"><a href="good-vs-bad-gwas.html#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="st">      --keep ../../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb1-24"><a href="good-vs-bad-gwas.html#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="st">      --l2 </span><span class="dt">\</span></span>
<span id="cb1-25"><a href="good-vs-bad-gwas.html#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="st">      --ld-wind-cm 1 </span><span class="dt">\</span></span>
<span id="cb1-26"><a href="good-vs-bad-gwas.html#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="st">      --out ../ldscore-individual-data/ldsc-mix-</span><span class="va">$i</span></span>
<span id="cb1-27"><a href="good-vs-bad-gwas.html#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/compute-ldsc-<span class="va">$i</span>.sh</span>
<span id="cb1-28"><a href="good-vs-bad-gwas.html#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb1-29"><a href="good-vs-bad-gwas.html#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="good-vs-bad-gwas.html#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb1-31"><a href="good-vs-bad-gwas.html#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/compute-ldsc-<span class="va">$i</span>.sh</span>
<span id="cb1-32"><a href="good-vs-bad-gwas.html#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../../job-records/compute-ldsc-mix</span>
<span id="cb1-33"><a href="good-vs-bad-gwas.html#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="good-vs-bad-gwas.html#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion</span></span>
<span id="cb1-35"><a href="good-vs-bad-gwas.html#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/compute-ldsc-mix</span>
<span id="cb1-36"><a href="good-vs-bad-gwas.html#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb1-37"><a href="good-vs-bad-gwas.html#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb1-38"><a href="good-vs-bad-gwas.html#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb1-39"><a href="good-vs-bad-gwas.html#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb1-40"><a href="good-vs-bad-gwas.html#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb1-41"><a href="good-vs-bad-gwas.html#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb1-42"><a href="good-vs-bad-gwas.html#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb1-43"><a href="good-vs-bad-gwas.html#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb1-44"><a href="good-vs-bad-gwas.html#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb1-45"><a href="good-vs-bad-gwas.html#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb1-46"><a href="good-vs-bad-gwas.html#cb1-46" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb1-47"><a href="good-vs-bad-gwas.html#cb1-47" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb1-48"><a href="good-vs-bad-gwas.html#cb1-48" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb1-49"><a href="good-vs-bad-gwas.html#cb1-49" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb1-50"><a href="good-vs-bad-gwas.html#cb1-50" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb1-51"><a href="good-vs-bad-gwas.html#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="test-the-new-model" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Test the new model</h2>
<p>Inflation = np^2 (h2-h2local) &lt;=np^2</p>
<ol style="list-style-type: decimal">
<li><p>extract heritability estimates from good GWASs</p></li>
<li><p>n<em>p2</em>h2</p></li>
<li><p><span class="math inline">\(S_{true}\)</span> vs <span class="math inline">\(\hat{S}_{ldsc}\)</span> vs <span class="math inline">\(\hat{S}_{new}\)</span></p></li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="good-vs-bad-gwas.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract heritability estimates</span></span>
<span id="cb2-2"><a href="good-vs-bad-gwas.html#cb2-2" aria-hidden="true" tabindex="-1"></a>h2_gcta<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-gcta-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb2-3"><a href="good-vs-bad-gwas.html#cb2-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb2-4"><a href="good-vs-bad-gwas.html#cb2-4" aria-hidden="true" tabindex="-1"></a>h2_ldak<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-ldak-thin-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb2-5"><a href="good-vs-bad-gwas.html#cb2-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb2-6"><a href="good-vs-bad-gwas.html#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="good-vs-bad-gwas.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># average r_ij^2</span></span>
<span id="cb2-8"><a href="good-vs-bad-gwas.html#cb2-8" aria-hidden="true" tabindex="-1"></a>r2_good<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;inflation/summary/ave-r2-1k-snps-goodgwas&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb2-9"><a href="good-vs-bad-gwas.html#cb2-9" aria-hidden="true" tabindex="-1"></a>r2_bad<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;inflation/summary/ave-r2-1k-snps-badgwas&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb2-10"><a href="good-vs-bad-gwas.html#cb2-10" aria-hidden="true" tabindex="-1"></a>r2_good<span class="ot">=</span><span class="fu">mean</span>(r2_good<span class="sc">$</span>V1)</span>
<span id="cb2-11"><a href="good-vs-bad-gwas.html#cb2-11" aria-hidden="true" tabindex="-1"></a>r2_bad<span class="ot">=</span><span class="fu">mean</span>(r2_bad<span class="sc">$</span>V1)</span>
<span id="cb2-12"><a href="good-vs-bad-gwas.html#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="good-vs-bad-gwas.html#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept estimates</span></span>
<span id="cb2-14"><a href="good-vs-bad-gwas.html#cb2-14" aria-hidden="true" tabindex="-1"></a>ldsc_bad<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;summary/ldsc-mix&quot;</span>, <span class="at">header=</span>F, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb2-15"><a href="good-vs-bad-gwas.html#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="good-vs-bad-gwas.html#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># GWAS test stats &amp; LD scores</span></span>
<span id="cb2-17"><a href="good-vs-bad-gwas.html#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="good-vs-bad-gwas.html#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;vroom&quot;</span>)</span>
<span id="cb2-19"><a href="good-vs-bad-gwas.html#cb2-19" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb2-20"><a href="good-vs-bad-gwas.html#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>,</span>
<span id="cb2-21"><a href="good-vs-bad-gwas.html#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb2-22"><a href="good-vs-bad-gwas.html#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># c(&quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;)</span></span>
<span id="cb2-23"><a href="good-vs-bad-gwas.html#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="good-vs-bad-gwas.html#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/predcited-chisq-by-ldscbin.png&quot;</span>),</span>
<span id="cb2-25"><a href="good-vs-bad-gwas.html#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb2-26"><a href="good-vs-bad-gwas.html#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb2-27"><a href="good-vs-bad-gwas.html#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="good-vs-bad-gwas.html#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb2-29"><a href="good-vs-bad-gwas.html#cb2-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-30"><a href="good-vs-bad-gwas.html#cb2-30" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">100000</span></span>
<span id="cb2-31"><a href="good-vs-bad-gwas.html#cb2-31" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb2-32"><a href="good-vs-bad-gwas.html#cb2-32" aria-hidden="true" tabindex="-1"></a>ldsc_intercept<span class="ot">=</span>ldsc_bad<span class="sc">$</span>V2[ldsc_bad<span class="sc">$</span>V1<span class="sc">==</span>trait]</span>
<span id="cb2-33"><a href="good-vs-bad-gwas.html#cb2-33" aria-hidden="true" tabindex="-1"></a>h2<span class="ot">=</span>h2_ldak<span class="sc">$</span>all_est[h2_ldak<span class="sc">$</span>code<span class="sc">==</span>trait]</span>
<span id="cb2-34"><a href="good-vs-bad-gwas.html#cb2-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-35"><a href="good-vs-bad-gwas.html#cb2-35" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>,trait,<span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb2-36"><a href="good-vs-bad-gwas.html#cb2-36" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>chisq_ldsc<span class="ot">=</span>dat<span class="sc">$</span>good_chisq<span class="sc">+</span>ldsc_intercept<span class="dv">-1</span></span>
<span id="cb2-37"><a href="good-vs-bad-gwas.html#cb2-37" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>chisq_new<span class="ot">=</span>dat<span class="sc">$</span>good_chisq<span class="sc">+</span>n<span class="sc">*</span>r2_bad<span class="sc">*</span>h2</span>
<span id="cb2-38"><a href="good-vs-bad-gwas.html#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="good-vs-bad-gwas.html#cb2-39" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">ave_ldscore=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>ldsc_ref,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb2-40"><a href="good-vs-bad-gwas.html#cb2-40" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_chisq_ldsc=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq_ldsc,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb2-41"><a href="good-vs-bad-gwas.html#cb2-41" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_chisq_new=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq_new,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb2-42"><a href="good-vs-bad-gwas.html#cb2-42" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_good_chisq=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>good_chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb2-43"><a href="good-vs-bad-gwas.html#cb2-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_bad_chisq=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>bad_chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean))</span>
<span id="cb2-44"><a href="good-vs-bad-gwas.html#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="good-vs-bad-gwas.html#cb2-45" aria-hidden="true" tabindex="-1"></a>end<span class="ot">=</span><span class="fu">round</span>(<span class="fu">max</span>(<span class="fu">c</span>(out[,<span class="dv">2</span>], out[,<span class="dv">3</span>], out[,<span class="dv">4</span>]), out[,<span class="dv">5</span>]),<span class="dv">0</span>)</span>
<span id="cb2-46"><a href="good-vs-bad-gwas.html#cb2-46" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="fu">round</span>(<span class="fu">min</span>(<span class="fu">c</span>(out[,<span class="dv">2</span>], out[,<span class="dv">3</span>], out[,<span class="dv">4</span>]), out[,<span class="dv">5</span>]),<span class="dv">0</span>)</span>
<span id="cb2-47"><a href="good-vs-bad-gwas.html#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-48"><a href="good-vs-bad-gwas.html#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>ave_ldscore, out<span class="sc">$</span>ave_bad_chisq,</span>
<span id="cb2-49"><a href="good-vs-bad-gwas.html#cb2-49" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ldscore bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisquare&quot;</span>, </span>
<span id="cb2-50"><a href="good-vs-bad-gwas.html#cb2-50" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb2-51"><a href="good-vs-bad-gwas.html#cb2-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb2-52"><a href="good-vs-bad-gwas.html#cb2-52" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb2-53"><a href="good-vs-bad-gwas.html#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out<span class="sc">$</span>ave_ldscore, out<span class="sc">$</span>ave_chisq_new,</span>
<span id="cb2-54"><a href="good-vs-bad-gwas.html#cb2-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>)</span>
<span id="cb2-55"><a href="good-vs-bad-gwas.html#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out<span class="sc">$</span>ave_ldscore, out<span class="sc">$</span>ave_chisq_ldsc,</span>
<span id="cb2-56"><a href="good-vs-bad-gwas.html#cb2-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb2-57"><a href="good-vs-bad-gwas.html#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="co">#points(out$ave_ldscore, out$ave_good_chisq,</span></span>
<span id="cb2-58"><a href="good-vs-bad-gwas.html#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="co">#       cex = 1.5, pch=21, col=&quot;white&quot;, bg=&quot;gray&quot;)</span></span>
<span id="cb2-59"><a href="good-vs-bad-gwas.html#cb2-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-60"><a href="good-vs-bad-gwas.html#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="predictors-of-inflation" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> predictors of inflation?</h2>
<p>Potential predictors considered:
1. MAF
2. ave r^2_ij for each j cross chromsomes [10k SNPs]</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="good-vs-bad-gwas.html#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="good-vs-bad-gwas.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># prep: convert snp labels to rs system</span></span>
<span id="cb3-3"><a href="good-vs-bad-gwas.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1]; b[$1]=$2; next}($1 in a){print b[$1], $2, $3, $5}&#39;</span> doug/ukbb.ldsc gen/geno-unrel.stats <span class="op">&gt;</span> gen/geno-unrel-rs.maf</span>
<span id="cb3-4"><a href="good-vs-bad-gwas.html#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="good-vs-bad-gwas.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb3-6"><a href="good-vs-bad-gwas.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="st">&quot;vroom&quot;</span><span class="kw">)</span></span>
<span id="cb3-7"><a href="good-vs-bad-gwas.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># files for maf &amp; ave r2 by snp</span></span>
<span id="cb3-8"><a href="good-vs-bad-gwas.html#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="va">stat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;gen/geno-unrel-rs.maf&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb3-9"><a href="good-vs-bad-gwas.html#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="va">r2_good</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;summary/ave-r2-by-snp-goodgwas-rs&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb3-10"><a href="good-vs-bad-gwas.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="va">r2_bad</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;summary/ave-r2-by-snp-badgwas-rs&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb3-11"><a href="good-vs-bad-gwas.html#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="good-vs-bad-gwas.html#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># compute inflation in chisq (good vs. bad) by trait</span></span>
<span id="cb3-13"><a href="good-vs-bad-gwas.html#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb3-14"><a href="good-vs-bad-gwas.html#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb3-15"><a href="good-vs-bad-gwas.html#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb3-16"><a href="good-vs-bad-gwas.html#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="good-vs-bad-gwas.html#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb3-18"><a href="good-vs-bad-gwas.html#cb3-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-19"><a href="good-vs-bad-gwas.html#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb3-20"><a href="good-vs-bad-gwas.html#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb3-21"><a href="good-vs-bad-gwas.html#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="va">inflation</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">snp</span><span class="op">=</span>dat<span class="va">$SNP</span>,</span>
<span id="cb3-22"><a href="good-vs-bad-gwas.html#cb3-22" aria-hidden="true" tabindex="-1"></a>                     <span class="va">inflation</span><span class="op">=</span>dat<span class="va">$bad_chisq</span>-dat<span class="va">$good_chisq</span>,</span>
<span id="cb3-23"><a href="good-vs-bad-gwas.html#cb3-23" aria-hidden="true" tabindex="-1"></a>                     <span class="va">bad_chisq</span><span class="op">=</span>dat<span class="va">$bad_chisq</span>,</span>
<span id="cb3-24"><a href="good-vs-bad-gwas.html#cb3-24" aria-hidden="true" tabindex="-1"></a>                     <span class="va">good_chisq</span><span class="op">=</span>dat<span class="va">$good_chisq</span>,</span>
<span id="cb3-25"><a href="good-vs-bad-gwas.html#cb3-25" aria-hidden="true" tabindex="-1"></a>                     <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb3-26"><a href="good-vs-bad-gwas.html#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="good-vs-bad-gwas.html#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">inflation</span><span class="va">$snp</span><span class="ex">,</span> stat<span class="va">$X1</span><span class="kw">)</span></span>
<span id="cb3-28"><a href="good-vs-bad-gwas.html#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">inflation</span><span class="va">$snp</span><span class="ex">,r2_good</span><span class="va">$X1</span><span class="kw">)</span></span>
<span id="cb3-29"><a href="good-vs-bad-gwas.html#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">inflation</span><span class="va">$snp</span><span class="ex">,r2_bad</span><span class="va">$X1</span><span class="kw">)</span></span>
<span id="cb3-30"><a href="good-vs-bad-gwas.html#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="ex">inflation,</span></span>
<span id="cb3-31"><a href="good-vs-bad-gwas.html#cb3-31" aria-hidden="true" tabindex="-1"></a>               <span class="va">maf</span><span class="op">=</span>stat<span class="va">$X4</span>[m1], </span>
<span id="cb3-32"><a href="good-vs-bad-gwas.html#cb3-32" aria-hidden="true" tabindex="-1"></a>               <span class="va">r2_good</span><span class="op">=</span>r2_good<span class="va">$X2</span>[m2],</span>
<span id="cb3-33"><a href="good-vs-bad-gwas.html#cb3-33" aria-hidden="true" tabindex="-1"></a>               <span class="va">r2_bad</span><span class="op">=</span>r2_bad<span class="va">$X2</span>[m2], <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb3-34"><a href="good-vs-bad-gwas.html#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="good-vs-bad-gwas.html#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co"># bin maf &amp; r2_bad according to quantiles</span></span>
<span id="cb3-36"><a href="good-vs-bad-gwas.html#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="va">cutoff1</span><span class="op">=</span>quantile<span class="kw">(</span><span class="ex">out</span><span class="va">$maf</span><span class="ex">,</span> probs = seq<span class="er">(</span><span class="ex">0,</span> 1, 0.005<span class="kw">)</span><span class="ex">,</span> na.rm=T<span class="kw">)</span></span>
<span id="cb3-37"><a href="good-vs-bad-gwas.html#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="va">cutoff2</span><span class="op">=</span>quantile<span class="kw">(</span><span class="ex">out</span><span class="va">$r2_bad</span><span class="ex">,</span> probs = seq<span class="er">(</span><span class="ex">0,</span> 1, 0.005<span class="kw">)</span><span class="ex">,</span> na.rm=T<span class="kw">)</span></span>
<span id="cb3-38"><a href="good-vs-bad-gwas.html#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="good-vs-bad-gwas.html#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$maf_bin</span><span class="ex">=cut</span><span class="er">(</span><span class="ex">out</span><span class="va">$maf</span><span class="ex">,</span> breaks=cutoff1, labels=1:<span class="er">(</span><span class="ex">length</span><span class="er">(</span><span class="ex">cutoff1</span><span class="kw">)</span><span class="ex">-1</span><span class="kw">))</span></span>
<span id="cb3-40"><a href="good-vs-bad-gwas.html#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$r2_bad_bin</span><span class="ex">=cut</span><span class="er">(</span><span class="ex">out</span><span class="va">$r2_bad</span><span class="ex">,</span> breaks=cutoff2, labels=1:<span class="er">(</span><span class="ex">length</span><span class="er">(</span><span class="ex">cutoff2</span><span class="kw">)</span><span class="ex">-1</span><span class="kw">))</span></span>
<span id="cb3-41"><a href="good-vs-bad-gwas.html#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="good-vs-bad-gwas.html#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;inflation/summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-inflation-by-maf-r2&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb3-43"><a href="good-vs-bad-gwas.html#cb3-43" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb3-44"><a href="good-vs-bad-gwas.html#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb3-45"><a href="good-vs-bad-gwas.html#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="good-vs-bad-gwas.html#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co"># plot by maf</span></span>
<span id="cb3-47"><a href="good-vs-bad-gwas.html#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb3-48"><a href="good-vs-bad-gwas.html#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb3-49"><a href="good-vs-bad-gwas.html#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> </span>
<span id="cb3-50"><a href="good-vs-bad-gwas.html#cb3-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb3-51"><a href="good-vs-bad-gwas.html#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb3-52"><a href="good-vs-bad-gwas.html#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="ex">png</span><span class="er">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;fig/inflation-by-mafbin.png&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb3-53"><a href="good-vs-bad-gwas.html#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="ex">width</span> =40, height = 30, units = <span class="st">&quot;cm&quot;</span>, res=600<span class="kw">)</span></span>
<span id="cb3-54"><a href="good-vs-bad-gwas.html#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="ex">par</span><span class="er">(</span><span class="va">mfrow</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">3,4</span><span class="kw">))</span></span>
<span id="cb3-55"><a href="good-vs-bad-gwas.html#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb3-56"><a href="good-vs-bad-gwas.html#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb3-57"><a href="good-vs-bad-gwas.html#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-inflation-by-maf-r2&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb3-58"><a href="good-vs-bad-gwas.html#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>dat[,c<span class="kw">(</span><span class="st">&quot;snp&quot;</span><span class="ex">,</span><span class="st">&quot;inflation&quot;</span><span class="ex">,</span><span class="st">&quot;maf&quot;</span><span class="ex">,</span><span class="st">&quot;maf_bin&quot;</span><span class="kw">)</span><span class="ex">]</span></span>
<span id="cb3-59"><a href="good-vs-bad-gwas.html#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>sel[complete.cases<span class="kw">(</span><span class="ex">sel</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb3-60"><a href="good-vs-bad-gwas.html#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">inflation</span><span class="op">=</span>tapply<span class="kw">(</span><span class="ex">sel</span><span class="va">$inflation</span><span class="ex">,INDEX=sel</span><span class="va">$maf_bin</span><span class="ex">,</span> mean<span class="kw">))</span></span>
<span id="cb3-61"><a href="good-vs-bad-gwas.html#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$maf_bin</span><span class="ex">=1:dim</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">[1]</span></span>
<span id="cb3-62"><a href="good-vs-bad-gwas.html#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$maf_bin_val</span><span class="ex">=tapply</span><span class="er">(</span><span class="ex">sel</span><span class="va">$maf</span><span class="ex">,INDEX=sel</span><span class="va">$maf_bin</span><span class="ex">,</span> mean<span class="kw">)</span></span>
<span id="cb3-63"><a href="good-vs-bad-gwas.html#cb3-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-64"><a href="good-vs-bad-gwas.html#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="ex">plot</span><span class="er">(</span><span class="ex">out</span><span class="va">$maf_bin_val</span><span class="ex">,</span> out<span class="va">$inflation</span>,</span>
<span id="cb3-65"><a href="good-vs-bad-gwas.html#cb3-65" aria-hidden="true" tabindex="-1"></a>     <span class="va">xlab</span><span class="op">=</span><span class="st">&quot;maf bin&quot;</span>, <span class="va">ylab</span><span class="op">=</span><span class="st">&quot;mean inflation&quot;</span>,</span>
<span id="cb3-66"><a href="good-vs-bad-gwas.html#cb3-66" aria-hidden="true" tabindex="-1"></a>     <span class="va">main</span><span class="op">=</span>trait, <span class="va">las</span><span class="op">=</span>1,</span>
<span id="cb3-67"><a href="good-vs-bad-gwas.html#cb3-67" aria-hidden="true" tabindex="-1"></a>     <span class="ex">cex</span> = 1.5, pch=21,  bg=<span class="st">&quot;grey&quot;</span>, col=<span class="st">&quot;white&quot;</span>, lwd=0.5<span class="kw">)</span></span>
<span id="cb3-68"><a href="good-vs-bad-gwas.html#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb3-69"><a href="good-vs-bad-gwas.html#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off()</span></span>
<span id="cb3-70"><a href="good-vs-bad-gwas.html#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="good-vs-bad-gwas.html#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="co"># plot by r2_bad bin</span></span>
<span id="cb3-72"><a href="good-vs-bad-gwas.html#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="good-vs-bad-gwas.html#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb3-74"><a href="good-vs-bad-gwas.html#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb3-75"><a href="good-vs-bad-gwas.html#cb3-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> </span>
<span id="cb3-76"><a href="good-vs-bad-gwas.html#cb3-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb3-77"><a href="good-vs-bad-gwas.html#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb3-78"><a href="good-vs-bad-gwas.html#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="ex">png</span><span class="er">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;fig/inflation-by-aver2.png&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb3-79"><a href="good-vs-bad-gwas.html#cb3-79" aria-hidden="true" tabindex="-1"></a>    <span class="ex">width</span> =40, height = 30, units = <span class="st">&quot;cm&quot;</span>, res=600<span class="kw">)</span></span>
<span id="cb3-80"><a href="good-vs-bad-gwas.html#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="ex">par</span><span class="er">(</span><span class="va">mfrow</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">3,4</span><span class="kw">))</span></span>
<span id="cb3-81"><a href="good-vs-bad-gwas.html#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb3-82"><a href="good-vs-bad-gwas.html#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb3-83"><a href="good-vs-bad-gwas.html#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-inflation-by-maf-r2&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb3-84"><a href="good-vs-bad-gwas.html#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>dat[,c<span class="kw">(</span><span class="st">&quot;snp&quot;</span><span class="ex">,</span><span class="st">&quot;inflation&quot;</span><span class="ex">,</span><span class="st">&quot;r2_bad&quot;</span><span class="ex">,</span><span class="st">&quot;r2_bad_bin&quot;</span><span class="kw">)</span><span class="ex">]</span></span>
<span id="cb3-85"><a href="good-vs-bad-gwas.html#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>sel[complete.cases<span class="kw">(</span><span class="ex">sel</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb3-86"><a href="good-vs-bad-gwas.html#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">inflation</span><span class="op">=</span>tapply<span class="kw">(</span><span class="ex">sel</span><span class="va">$inflation</span><span class="ex">,INDEX=sel</span><span class="va">$r2_bad_bin</span><span class="ex">,</span> mean<span class="kw">))</span></span>
<span id="cb3-87"><a href="good-vs-bad-gwas.html#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$r2_bad_bin</span><span class="ex">=1:dim</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">[1]</span></span>
<span id="cb3-88"><a href="good-vs-bad-gwas.html#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$r2_bad_bin_val</span><span class="ex">=tapply</span><span class="er">(</span><span class="ex">sel</span><span class="va">$r2_bad</span><span class="ex">,INDEX=sel</span><span class="va">$r2_bad_bin</span><span class="ex">,</span> mean<span class="kw">)</span></span>
<span id="cb3-89"><a href="good-vs-bad-gwas.html#cb3-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-90"><a href="good-vs-bad-gwas.html#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="ex">plot</span><span class="er">(</span><span class="ex">out</span><span class="va">$r2_bad_bin_val</span><span class="ex">,</span> out<span class="va">$inflation</span>,</span>
<span id="cb3-91"><a href="good-vs-bad-gwas.html#cb3-91" aria-hidden="true" tabindex="-1"></a>     <span class="va">xlab</span><span class="op">=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="va">ylab</span><span class="op">=</span><span class="st">&quot;mean inflation&quot;</span>,</span>
<span id="cb3-92"><a href="good-vs-bad-gwas.html#cb3-92" aria-hidden="true" tabindex="-1"></a>     <span class="va">main</span><span class="op">=</span>trait, <span class="va">las</span><span class="op">=</span>1,</span>
<span id="cb3-93"><a href="good-vs-bad-gwas.html#cb3-93" aria-hidden="true" tabindex="-1"></a>     <span class="ex">cex</span> = 1.5, pch=21,  bg=<span class="st">&quot;grey&quot;</span>, col=<span class="st">&quot;white&quot;</span>, lwd=0.5<span class="kw">)</span></span>
<span id="cb3-94"><a href="good-vs-bad-gwas.html#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb3-95"><a href="good-vs-bad-gwas.html#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off()</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="good-vs-bad-gwas.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## inflation by raw ave r2 </span></span>
<span id="cb4-2"><a href="good-vs-bad-gwas.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb4-3"><a href="good-vs-bad-gwas.html#cb4-3" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb4-4"><a href="good-vs-bad-gwas.html#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, </span>
<span id="cb4-5"><a href="good-vs-bad-gwas.html#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb4-6"><a href="good-vs-bad-gwas.html#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fvc&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb4-7"><a href="good-vs-bad-gwas.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-by-aver2-raw.png&quot;</span>),</span>
<span id="cb4-8"><a href="good-vs-bad-gwas.html#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb4-9"><a href="good-vs-bad-gwas.html#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb4-10"><a href="good-vs-bad-gwas.html#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb4-11"><a href="good-vs-bad-gwas.html#cb4-11" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb4-12"><a href="good-vs-bad-gwas.html#cb4-12" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb4-13"><a href="good-vs-bad-gwas.html#cb4-13" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;inflation&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>)]</span>
<span id="cb4-14"><a href="good-vs-bad-gwas.html#cb4-14" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb4-15"><a href="good-vs-bad-gwas.html#cb4-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-16"><a href="good-vs-bad-gwas.html#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_bad, sel<span class="sc">$</span>inflation,</span>
<span id="cb4-17"><a href="good-vs-bad-gwas.html#cb4-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation&quot;</span>,</span>
<span id="cb4-18"><a href="good-vs-bad-gwas.html#cb4-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb4-19"><a href="good-vs-bad-gwas.html#cb4-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb4-20"><a href="good-vs-bad-gwas.html#cb4-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-21"><a href="good-vs-bad-gwas.html#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb4-22"><a href="good-vs-bad-gwas.html#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="good-vs-bad-gwas.html#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="good-vs-bad-gwas.html#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb4-25"><a href="good-vs-bad-gwas.html#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb4-26"><a href="good-vs-bad-gwas.html#cb4-26" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb4-27"><a href="good-vs-bad-gwas.html#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, </span>
<span id="cb4-28"><a href="good-vs-bad-gwas.html#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb4-29"><a href="good-vs-bad-gwas.html#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb4-30"><a href="good-vs-bad-gwas.html#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-by-aver2-goodgwas-raw.png&quot;</span>),</span>
<span id="cb4-31"><a href="good-vs-bad-gwas.html#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb4-32"><a href="good-vs-bad-gwas.html#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb4-33"><a href="good-vs-bad-gwas.html#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb4-34"><a href="good-vs-bad-gwas.html#cb4-34" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb4-35"><a href="good-vs-bad-gwas.html#cb4-35" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb4-36"><a href="good-vs-bad-gwas.html#cb4-36" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;inflation&quot;</span>,<span class="st">&quot;r2_good&quot;</span>)]</span>
<span id="cb4-37"><a href="good-vs-bad-gwas.html#cb4-37" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb4-38"><a href="good-vs-bad-gwas.html#cb4-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-39"><a href="good-vs-bad-gwas.html#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_good, sel<span class="sc">$</span>inflation,</span>
<span id="cb4-40"><a href="good-vs-bad-gwas.html#cb4-40" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation&quot;</span>,</span>
<span id="cb4-41"><a href="good-vs-bad-gwas.html#cb4-41" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb4-42"><a href="good-vs-bad-gwas.html#cb4-42" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb4-43"><a href="good-vs-bad-gwas.html#cb4-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-44"><a href="good-vs-bad-gwas.html#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb4-45"><a href="good-vs-bad-gwas.html#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="good-vs-bad-gwas.html#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="good-vs-bad-gwas.html#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="do">## histogram</span></span>
<span id="cb4-48"><a href="good-vs-bad-gwas.html#cb4-48" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb4-49"><a href="good-vs-bad-gwas.html#cb4-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, </span>
<span id="cb4-50"><a href="good-vs-bad-gwas.html#cb4-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb4-51"><a href="good-vs-bad-gwas.html#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb4-52"><a href="good-vs-bad-gwas.html#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/hist-aver2-goodgwas.png&quot;</span>),</span>
<span id="cb4-53"><a href="good-vs-bad-gwas.html#cb4-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb4-54"><a href="good-vs-bad-gwas.html#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb4-55"><a href="good-vs-bad-gwas.html#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb4-56"><a href="good-vs-bad-gwas.html#cb4-56" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb4-57"><a href="good-vs-bad-gwas.html#cb4-57" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb4-58"><a href="good-vs-bad-gwas.html#cb4-58" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;inflation&quot;</span>,<span class="st">&quot;r2_good&quot;</span>)]</span>
<span id="cb4-59"><a href="good-vs-bad-gwas.html#cb4-59" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb4-60"><a href="good-vs-bad-gwas.html#cb4-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-61"><a href="good-vs-bad-gwas.html#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(sel<span class="sc">$</span>r2_good, <span class="at">breaks=</span><span class="dv">100</span>, <span class="at">main=</span>trait)</span>
<span id="cb4-62"><a href="good-vs-bad-gwas.html#cb4-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-63"><a href="good-vs-bad-gwas.html#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="regress-bad-chisq-mean-r2_j" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> regress bad chisq ~ mean r^2_j</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="good-vs-bad-gwas.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::</span></span>
<span id="cb5-2"><a href="good-vs-bad-gwas.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># by binned ave r2</span></span>
<span id="cb5-3"><a href="good-vs-bad-gwas.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::</span></span>
<span id="cb5-4"><a href="good-vs-bad-gwas.html#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="good-vs-bad-gwas.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># bad chisq by binned ave r2 </span></span>
<span id="cb5-6"><a href="good-vs-bad-gwas.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb5-7"><a href="good-vs-bad-gwas.html#cb5-7" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb5-8"><a href="good-vs-bad-gwas.html#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb5-9"><a href="good-vs-bad-gwas.html#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb5-10"><a href="good-vs-bad-gwas.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/badgwas-chisq-by-aver2-bin.png&quot;</span>),</span>
<span id="cb5-11"><a href="good-vs-bad-gwas.html#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb5-12"><a href="good-vs-bad-gwas.html#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb5-13"><a href="good-vs-bad-gwas.html#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb5-14"><a href="good-vs-bad-gwas.html#cb5-14" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb5-15"><a href="good-vs-bad-gwas.html#cb5-15" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb5-16"><a href="good-vs-bad-gwas.html#cb5-16" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;bad_chisq&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>,<span class="st">&quot;r2_bad_bin&quot;</span>)]</span>
<span id="cb5-17"><a href="good-vs-bad-gwas.html#cb5-17" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb5-18"><a href="good-vs-bad-gwas.html#cb5-18" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">bad_chisq=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>bad_chisq,<span class="at">INDEX=</span>sel<span class="sc">$</span>r2_bad_bin, mean))</span>
<span id="cb5-19"><a href="good-vs-bad-gwas.html#cb5-19" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_bad_bin<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(out)[<span class="dv">1</span>]</span>
<span id="cb5-20"><a href="good-vs-bad-gwas.html#cb5-20" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_bad_bin_val<span class="ot">=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>r2_bad,<span class="at">INDEX=</span>sel<span class="sc">$</span>r2_bad_bin, mean)</span>
<span id="cb5-21"><a href="good-vs-bad-gwas.html#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="good-vs-bad-gwas.html#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>r2_bad_bin_val, out<span class="sc">$</span>bad_chisq,</span>
<span id="cb5-23"><a href="good-vs-bad-gwas.html#cb5-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq test stat&quot;</span>,</span>
<span id="cb5-24"><a href="good-vs-bad-gwas.html#cb5-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb5-25"><a href="good-vs-bad-gwas.html#cb5-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb5-26"><a href="good-vs-bad-gwas.html#cb5-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-27"><a href="good-vs-bad-gwas.html#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb5-28"><a href="good-vs-bad-gwas.html#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="good-vs-bad-gwas.html#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::</span></span>
<span id="cb5-30"><a href="good-vs-bad-gwas.html#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co"># by raw ave r2</span></span>
<span id="cb5-31"><a href="good-vs-bad-gwas.html#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::</span></span>
<span id="cb5-32"><a href="good-vs-bad-gwas.html#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="good-vs-bad-gwas.html#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co"># bad chisq by raw ave r2 </span></span>
<span id="cb5-34"><a href="good-vs-bad-gwas.html#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb5-35"><a href="good-vs-bad-gwas.html#cb5-35" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb5-36"><a href="good-vs-bad-gwas.html#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb5-37"><a href="good-vs-bad-gwas.html#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb5-38"><a href="good-vs-bad-gwas.html#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="good-vs-bad-gwas.html#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/badgwas-chisq-by-aver2.png&quot;</span>),</span>
<span id="cb5-40"><a href="good-vs-bad-gwas.html#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb5-41"><a href="good-vs-bad-gwas.html#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb5-42"><a href="good-vs-bad-gwas.html#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb5-43"><a href="good-vs-bad-gwas.html#cb5-43" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb5-44"><a href="good-vs-bad-gwas.html#cb5-44" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb5-45"><a href="good-vs-bad-gwas.html#cb5-45" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;bad_chisq&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>)]</span>
<span id="cb5-46"><a href="good-vs-bad-gwas.html#cb5-46" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb5-47"><a href="good-vs-bad-gwas.html#cb5-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-48"><a href="good-vs-bad-gwas.html#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_bad, sel<span class="sc">$</span>bad_chisq,</span>
<span id="cb5-49"><a href="good-vs-bad-gwas.html#cb5-49" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq test stat&quot;</span>,</span>
<span id="cb5-50"><a href="good-vs-bad-gwas.html#cb5-50" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb5-51"><a href="good-vs-bad-gwas.html#cb5-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb5-52"><a href="good-vs-bad-gwas.html#cb5-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-53"><a href="good-vs-bad-gwas.html#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb5-54"><a href="good-vs-bad-gwas.html#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="good-vs-bad-gwas.html#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="co"># good chisq by raw ave r2 </span></span>
<span id="cb5-56"><a href="good-vs-bad-gwas.html#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb5-57"><a href="good-vs-bad-gwas.html#cb5-57" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb5-58"><a href="good-vs-bad-gwas.html#cb5-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb5-59"><a href="good-vs-bad-gwas.html#cb5-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb5-60"><a href="good-vs-bad-gwas.html#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="good-vs-bad-gwas.html#cb5-61" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/goodgwas-chisq-by-aver2.png&quot;</span>),</span>
<span id="cb5-62"><a href="good-vs-bad-gwas.html#cb5-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb5-63"><a href="good-vs-bad-gwas.html#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb5-64"><a href="good-vs-bad-gwas.html#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb5-65"><a href="good-vs-bad-gwas.html#cb5-65" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb5-66"><a href="good-vs-bad-gwas.html#cb5-66" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb5-67"><a href="good-vs-bad-gwas.html#cb5-67" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;good_chisq&quot;</span>,<span class="st">&quot;r2_good&quot;</span>)]</span>
<span id="cb5-68"><a href="good-vs-bad-gwas.html#cb5-68" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb5-69"><a href="good-vs-bad-gwas.html#cb5-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-70"><a href="good-vs-bad-gwas.html#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_good, sel<span class="sc">$</span>good_chisq,</span>
<span id="cb5-71"><a href="good-vs-bad-gwas.html#cb5-71" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq test stat&quot;</span>,</span>
<span id="cb5-72"><a href="good-vs-bad-gwas.html#cb5-72" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb5-73"><a href="good-vs-bad-gwas.html#cb5-73" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb5-74"><a href="good-vs-bad-gwas.html#cb5-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-75"><a href="good-vs-bad-gwas.html#cb5-75" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb5-76"><a href="good-vs-bad-gwas.html#cb5-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-77"><a href="good-vs-bad-gwas.html#cb5-77" aria-hidden="true" tabindex="-1"></a><span class="co"># regression: chisq test stats ~ ave r^2_j --------------------------------------</span></span>
<span id="cb5-78"><a href="good-vs-bad-gwas.html#cb5-78" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb5-79"><a href="good-vs-bad-gwas.html#cb5-79" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb5-80"><a href="good-vs-bad-gwas.html#cb5-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb5-81"><a href="good-vs-bad-gwas.html#cb5-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb5-82"><a href="good-vs-bad-gwas.html#cb5-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-83"><a href="good-vs-bad-gwas.html#cb5-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb5-84"><a href="good-vs-bad-gwas.html#cb5-84" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb5-85"><a href="good-vs-bad-gwas.html#cb5-85" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb5-86"><a href="good-vs-bad-gwas.html#cb5-86" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;bad_chisq&quot;</span>,<span class="st">&quot;good_chisq&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>, <span class="st">&quot;r2_good&quot;</span>, <span class="st">&quot;maf&quot;</span>)]</span>
<span id="cb5-87"><a href="good-vs-bad-gwas.html#cb5-87" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb5-88"><a href="good-vs-bad-gwas.html#cb5-88" aria-hidden="true" tabindex="-1"></a>sel<span class="sc">$</span>maf2<span class="ot">=</span>sel<span class="sc">$</span>maf<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb5-89"><a href="good-vs-bad-gwas.html#cb5-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-90"><a href="good-vs-bad-gwas.html#cb5-90" aria-hidden="true" tabindex="-1"></a>mod1<span class="ot">=</span><span class="fu">lm</span>(sel<span class="sc">$</span>bad_chisq<span class="sc">~</span>sel<span class="sc">$</span>r2_bad)</span>
<span id="cb5-91"><a href="good-vs-bad-gwas.html#cb5-91" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.1=lm(sel$bad_chisq~sel$maf)</span></span>
<span id="cb5-92"><a href="good-vs-bad-gwas.html#cb5-92" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.2=lm(sel$bad_chisq~ sel$maf + sel$maf2)</span></span>
<span id="cb5-93"><a href="good-vs-bad-gwas.html#cb5-93" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.3=lm(sel$bad_chisq~sel$r2_bad+sel$maf)</span></span>
<span id="cb5-94"><a href="good-vs-bad-gwas.html#cb5-94" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.4=lm(sel$bad_chisq~sel$r2_bad+sel$maf+sel$maf2)</span></span>
<span id="cb5-95"><a href="good-vs-bad-gwas.html#cb5-95" aria-hidden="true" tabindex="-1"></a>mod2<span class="ot">=</span><span class="fu">lm</span>(sel<span class="sc">$</span>good_chisq<span class="sc">~</span>sel<span class="sc">$</span>r2_good)</span>
<span id="cb5-96"><a href="good-vs-bad-gwas.html#cb5-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-97"><a href="good-vs-bad-gwas.html#cb5-97" aria-hidden="true" tabindex="-1"></a>slope0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb5-98"><a href="good-vs-bad-gwas.html#cb5-98" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope_bad=</span><span class="fu">coef</span>(mod1)[<span class="dv">2</span>],</span>
<span id="cb5-99"><a href="good-vs-bad-gwas.html#cb5-99" aria-hidden="true" tabindex="-1"></a>                  <span class="at">p_bad=</span><span class="fu">summary</span>(mod1)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb5-100"><a href="good-vs-bad-gwas.html#cb5-100" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope_good=</span><span class="fu">coef</span>(mod2)[<span class="dv">2</span>],</span>
<span id="cb5-101"><a href="good-vs-bad-gwas.html#cb5-101" aria-hidden="true" tabindex="-1"></a>                  <span class="at">p_good=</span><span class="fu">summary</span>(mod2)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb5-102"><a href="good-vs-bad-gwas.html#cb5-102" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb5-103"><a href="good-vs-bad-gwas.html#cb5-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-104"><a href="good-vs-bad-gwas.html#cb5-104" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){slope<span class="ot">=</span>slope0} <span class="cf">else</span> {slope<span class="ot">=</span><span class="fu">rbind</span>(slope,slope0)}</span>
<span id="cb5-105"><a href="good-vs-bad-gwas.html#cb5-105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-106"><a href="good-vs-bad-gwas.html#cb5-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-107"><a href="good-vs-bad-gwas.html#cb5-107" aria-hidden="true" tabindex="-1"></a>slope<span class="sc">$</span>good_div_n<span class="ot">=</span>slope<span class="sc">$</span>slope_good<span class="sc">/</span><span class="dv">100000</span></span>
<span id="cb5-108"><a href="good-vs-bad-gwas.html#cb5-108" aria-hidden="true" tabindex="-1"></a>slope<span class="sc">$</span>bad_div_n<span class="ot">=</span>slope<span class="sc">$</span>slope_bad<span class="sc">/</span><span class="dv">100000</span></span>
<span id="cb5-109"><a href="good-vs-bad-gwas.html#cb5-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-110"><a href="good-vs-bad-gwas.html#cb5-110" aria-hidden="true" tabindex="-1"></a><span class="co"># heritability estimates</span></span>
<span id="cb5-111"><a href="good-vs-bad-gwas.html#cb5-111" aria-hidden="true" tabindex="-1"></a>h2_gcta<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-gcta-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb5-112"><a href="good-vs-bad-gwas.html#cb5-112" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb5-113"><a href="good-vs-bad-gwas.html#cb5-113" aria-hidden="true" tabindex="-1"></a>h2_ldak<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-ldak-thin-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb5-114"><a href="good-vs-bad-gwas.html#cb5-114" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb5-115"><a href="good-vs-bad-gwas.html#cb5-115" aria-hidden="true" tabindex="-1"></a>h2<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>h2_gcta<span class="sc">$</span>code,<span class="at">gcta=</span>h2_gcta<span class="sc">$</span>all_est, <span class="at">ldak=</span>h2_ldak<span class="sc">$</span>all_est)</span>
<span id="cb5-116"><a href="good-vs-bad-gwas.html#cb5-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-117"><a href="good-vs-bad-gwas.html#cb5-117" aria-hidden="true" tabindex="-1"></a><span class="co"># together</span></span>
<span id="cb5-118"><a href="good-vs-bad-gwas.html#cb5-118" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span><span class="fu">match</span>(slope<span class="sc">$</span>trait,h2<span class="sc">$</span>trait)</span>
<span id="cb5-119"><a href="good-vs-bad-gwas.html#cb5-119" aria-hidden="true" tabindex="-1"></a>all<span class="ot">=</span><span class="fu">cbind</span>(slope,h2[m,<span class="sc">-</span><span class="dv">1</span>])</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="summaries.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mathematical-details.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-inflation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
