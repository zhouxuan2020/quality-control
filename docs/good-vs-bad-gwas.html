<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Good VS Bad GWAS | GWAS Quality Control</title>
  <meta name="description" content="5 Good VS Bad GWAS | GWAS Quality Control" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Good VS Bad GWAS | GWAS Quality Control" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Good VS Bad GWAS | GWAS Quality Control" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="summary-1.html"/>
<link rel="next" href="mathematical-details.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Quality Control Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> General Info</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#topic"><i class="fa fa-check"></i><b>1.1</b> Topic</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#frequently-used-commands"><i class="fa fa-check"></i><b>1.2</b> Frequently used commands</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>2</b> summary</a></li>
<li class="chapter" data-level="3" data-path="summaries.html"><a href="summaries.html"><i class="fa fa-check"></i><b>3</b> Summaries</a>
<ul>
<li class="chapter" data-level="3.1" data-path="summaries.html"><a href="summaries.html#good-gwas"><i class="fa fa-check"></i><b>3.1</b> Good GWAS</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher"><i class="fa fa-check"></i><b>3.1.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.1.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression"><i class="fa fa-check"></i><b>3.1.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="summaries.html"><a href="summaries.html#bad-gwas"><i class="fa fa-check"></i><b>3.2</b> Bad GWAS</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-1"><i class="fa fa-check"></i><b>3.2.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.2.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-1"><i class="fa fa-check"></i><b>3.2.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="summaries.html"><a href="summaries.html#ukbb-recommended"><i class="fa fa-check"></i><b>3.3</b> UKBB recommended</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-2"><i class="fa fa-check"></i><b>3.3.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.3.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-2"><i class="fa fa-check"></i><b>3.3.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="summaries.html"><a href="summaries.html#control-gwas"><i class="fa fa-check"></i><b>3.4</b> Control GWAS</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-3"><i class="fa fa-check"></i><b>3.4.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.4.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-3"><i class="fa fa-check"></i><b>3.4.2</b> Haseman Elston Regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="summary-1.html"><a href="summary-1.html"><i class="fa fa-check"></i><b>4</b> summary</a></li>
<li class="chapter" data-level="5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html"><i class="fa fa-check"></i><b>5</b> Good VS Bad GWAS</a>
<ul>
<li class="chapter" data-level="5.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#test-statistics-ld-score"><i class="fa fa-check"></i><b>5.1</b> test statistics ~ LD score</a></li>
<li class="chapter" data-level="5.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#new-models"><i class="fa fa-check"></i><b>5.2</b> New models?</a></li>
<li class="chapter" data-level="5.3" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#ld-scores-based-on-individual-level-data"><i class="fa fa-check"></i><b>5.3</b> LD scores based on individual level data</a></li>
<li class="chapter" data-level="5.4" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#test-the-new-model"><i class="fa fa-check"></i><b>5.4</b> Test the new model</a></li>
<li class="chapter" data-level="5.5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#predictors-of-inflation"><i class="fa fa-check"></i><b>5.5</b> predictors of inflation?</a></li>
<li class="chapter" data-level="5.6" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#regress-chisq-mean-r2_j"><i class="fa fa-check"></i><b>5.6</b> regress chisq ~ mean r^2_j</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#plots"><i class="fa fa-check"></i><b>5.6.1</b> plots</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#predict-inflation-aver2_j"><i class="fa fa-check"></i><b>5.7</b> predict inflation | aver2_j ?</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good_chisq-vs.-adj_chisq"><i class="fa fa-check"></i><b>5.7.1</b> good_chisq vs. adj_chisq</a></li>
<li class="chapter" data-level="5.7.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-vs.-inf._hat-raw"><i class="fa fa-check"></i><b>5.7.2</b> bad gwas: inf. vs. inf._hat: raw</a></li>
<li class="chapter" data-level="5.7.3" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-vs.-inf._hat-ave"><i class="fa fa-check"></i><b>5.7.3</b> bad gwas: inf. vs. inf._hat: ave</a></li>
<li class="chapter" data-level="5.7.4" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-from-full-model"><i class="fa fa-check"></i><b>5.7.4</b> bad gwas: inf. from full model</a></li>
<li class="chapter" data-level="5.7.5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#to-explore-change"><i class="fa fa-check"></i><b>5.7.5</b> To Explore: change??</a></li>
<li class="chapter" data-level="5.7.6" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good-gwas-inf.-vs.-inf._hat-raw"><i class="fa fa-check"></i><b>5.7.6</b> good gwas: inf. vs. inf._hat: raw</a></li>
<li class="chapter" data-level="5.7.7" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good-gwas-inf.-vs.-inf._hat-ave"><i class="fa fa-check"></i><b>5.7.7</b> good gwas: inf. vs. inf._hat: ave</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#ukbb_337k_inflation"><i class="fa fa-check"></i><b>5.8</b> UKBB N = 337k</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#organize-data"><i class="fa fa-check"></i><b>5.8.1</b> organize data</a></li>
<li class="chapter" data-level="5.8.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#plot"><i class="fa fa-check"></i><b>5.8.2</b> plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mathematical-details.html"><a href="mathematical-details.html"><i class="fa fa-check"></i><b>6</b> Mathematical Details</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mathematical-details.html"><a href="mathematical-details.html#trk_rightk_left"><i class="fa fa-check"></i><b>6.1</b> <span class="math inline">\(tr(K_{right}K_{left})\)</span></a></li>
<li class="chapter" data-level="6.2" data-path="mathematical-details.html"><a href="mathematical-details.html#verification"><i class="fa fa-check"></i><b>6.2</b> verification</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html"><i class="fa fa-check"></i><b>7</b> chi square ~ <span class="math inline">\(\overline{r^2_j}\)</span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#overliner2_j-choice-of-snps"><i class="fa fa-check"></i><b>7.1</b> <span class="math inline">\(\overline{r^2_j}\)</span> &amp; choice of SNPs</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#number-of-snps"><i class="fa fa-check"></i><b>7.1.1</b> number of SNPs</a></li>
<li class="chapter" data-level="7.1.2" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#maf"><i class="fa fa-check"></i><b>7.1.2</b> maf</a></li>
<li class="chapter" data-level="7.1.3" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#summary-2"><i class="fa fa-check"></i><b>7.1.3</b> summary</a></li>
<li class="chapter" data-level="7.1.4" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#final-plots"><i class="fa fa-check"></i><b>7.1.4</b> Final plots</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#varying-levels-of-confouding"><i class="fa fa-check"></i><b>7.2</b> varying levels of confouding</a></li>
<li class="chapter" data-level="7.3" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#results-summary"><i class="fa fa-check"></i><b>7.3</b> results summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="good.html"><a href="good.html"><i class="fa fa-check"></i><b>8</b> Good GWAS</a>
<ul>
<li class="chapter" data-level="8.1" data-path="good.html"><a href="good.html#goodid"><i class="fa fa-check"></i><b>8.1</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="8.2" data-path="good.html"><a href="good.html#extract-covariates"><i class="fa fa-check"></i><b>8.2</b> extract covariates</a></li>
<li class="chapter" data-level="8.3" data-path="good.html"><a href="good.html#gwas"><i class="fa fa-check"></i><b>8.3</b> GWAS</a></li>
<li class="chapter" data-level="8.4" data-path="good.html"><a href="good.html#chisq-aver2_j"><i class="fa fa-check"></i><b>8.4</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="8.5" data-path="good.html"><a href="good.html#ldsc-interce"><i class="fa fa-check"></i><b>8.5</b> ldsc interce</a></li>
<li class="chapter" data-level="8.6" data-path="good.html"><a href="good.html#ldsc-intercept"><i class="fa fa-check"></i><b>8.6</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="good.html"><a href="good.html#under-gcta"><i class="fa fa-check"></i><b>8.6.1</b> under gcta</a></li>
<li class="chapter" data-level="8.6.2" data-path="good.html"><a href="good.html#under-ldak-thin"><i class="fa fa-check"></i><b>8.6.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="8.6.3" data-path="good.html"><a href="good.html#summary-3"><i class="fa fa-check"></i><b>8.6.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="good.html"><a href="good.html#reml"><i class="fa fa-check"></i><b>8.7</b> REML</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="good.html"><a href="good.html#making-grms"><i class="fa fa-check"></i><b>8.7.1</b> making grms</a></li>
<li class="chapter" data-level="8.7.2" data-path="good.html"><a href="good.html#fast-reml"><i class="fa fa-check"></i><b>8.7.2</b> fast-reml</a></li>
<li class="chapter" data-level="8.7.3" data-path="good.html"><a href="good.html#inflation-test"><i class="fa fa-check"></i><b>8.7.3</b> inflation test</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="good.html"><a href="good.html#he"><i class="fa fa-check"></i><b>8.8</b> HE</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="good.html"><a href="good.html#estimation"><i class="fa fa-check"></i><b>8.8.1</b> estimation</a></li>
<li class="chapter" data-level="8.8.2" data-path="good.html"><a href="good.html#summary-4"><i class="fa fa-check"></i><b>8.8.2</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bad.html"><a href="bad.html"><i class="fa fa-check"></i><b>9</b> Bad GWAS</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bad.html"><a href="bad.html#badid"><i class="fa fa-check"></i><b>9.1</b> ID list</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="bad.html"><a href="bad.html#initial-selection"><i class="fa fa-check"></i><b>9.1.1</b> initial selection</a></li>
<li class="chapter" data-level="9.1.2" data-path="bad.html"><a href="bad.html#relatedness-filtering"><i class="fa fa-check"></i><b>9.1.2</b> relatedness filtering</a></li>
<li class="chapter" data-level="9.1.3" data-path="bad.html"><a href="bad.html#final-list"><i class="fa fa-check"></i><b>9.1.3</b> final list</a></li>
<li class="chapter" data-level="9.1.4" data-path="bad.html"><a href="bad.html#pc-plot"><i class="fa fa-check"></i><b>9.1.4</b> PC plot</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="bad.html"><a href="bad.html#gwas-lm"><i class="fa fa-check"></i><b>9.2</b> GWAS-lm</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="bad.html"><a href="bad.html#basic-cov"><i class="fa fa-check"></i><b>9.2.1</b> basic cov</a></li>
<li class="chapter" data-level="9.2.2" data-path="bad.html"><a href="bad.html#basic-cov-pc"><i class="fa fa-check"></i><b>9.2.2</b> basic cov + PC</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="bad.html"><a href="bad.html#gwas-bolt-lmm"><i class="fa fa-check"></i><b>9.3</b> GWAS-bolt-lmm</a></li>
<li class="chapter" data-level="9.4" data-path="bad.html"><a href="bad.html#correct-genotypes"><i class="fa fa-check"></i><b>9.4</b> correct genotypes</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="bad.html"><a href="bad.html#cal-aver2"><i class="fa fa-check"></i><b>9.4.1</b> cal-aver2</a></li>
<li class="chapter" data-level="9.4.2" data-path="bad.html"><a href="bad.html#compare-changes-in-aver2"><i class="fa fa-check"></i><b>9.4.2</b> compare changes in aver2</a></li>
<li class="chapter" data-level="9.4.3" data-path="bad.html"><a href="bad.html#chisq-aver2"><i class="fa fa-check"></i><b>9.4.3</b> chisq ~ aver2</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="bad.html"><a href="bad.html#chisq-aver2_j-1"><i class="fa fa-check"></i><b>9.5</b> chisq ~ aver2_j</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="bad.html"><a href="bad.html#calc-aver2_j"><i class="fa fa-check"></i><b>9.5.1</b> calc aver2_j</a></li>
<li class="chapter" data-level="9.5.2" data-path="bad.html"><a href="bad.html#bolt-lmm"><i class="fa fa-check"></i><b>9.5.2</b> bolt-lmm</a></li>
<li class="chapter" data-level="9.5.3" data-path="bad.html"><a href="bad.html#basic-cov-pc-1"><i class="fa fa-check"></i><b>9.5.3</b> basic cov + PC</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="bad.html"><a href="bad.html#ldsc-intercept-1"><i class="fa fa-check"></i><b>9.6</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="bad.html"><a href="bad.html#under-gcta-1"><i class="fa fa-check"></i><b>9.6.1</b> under gcta</a></li>
<li class="chapter" data-level="9.6.2" data-path="bad.html"><a href="bad.html#under-ldak-thin-1"><i class="fa fa-check"></i><b>9.6.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="9.6.3" data-path="bad.html"><a href="bad.html#summary-5"><i class="fa fa-check"></i><b>9.6.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="bad.html"><a href="bad.html#reml-1"><i class="fa fa-check"></i><b>9.7</b> REML</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="bad.html"><a href="bad.html#making-grms-1"><i class="fa fa-check"></i><b>9.7.1</b> making grms</a></li>
<li class="chapter" data-level="9.7.2" data-path="bad.html"><a href="bad.html#fast-reml-1"><i class="fa fa-check"></i><b>9.7.2</b> fast-reml</a></li>
<li class="chapter" data-level="9.7.3" data-path="bad.html"><a href="bad.html#inflation-test-1"><i class="fa fa-check"></i><b>9.7.3</b> inflation test</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="bad.html"><a href="bad.html#he-1"><i class="fa fa-check"></i><b>9.8</b> HE</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="bad.html"><a href="bad.html#estimation-1"><i class="fa fa-check"></i><b>9.8.1</b> estimation</a></li>
<li class="chapter" data-level="9.8.2" data-path="bad.html"><a href="bad.html#summary-6"><i class="fa fa-check"></i><b>9.8.2</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ukbb.html"><a href="ukbb.html"><i class="fa fa-check"></i><b>10</b> UKBB recommended</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ukbb.html"><a href="ukbb.html#total-n-337k"><i class="fa fa-check"></i><b>10.1</b> total N = 337k</a></li>
<li class="chapter" data-level="10.2" data-path="ukbb.html"><a href="ukbb.html#qc-of-hp3-snps"><i class="fa fa-check"></i><b>10.2</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="10.3" data-path="ukbb.html"><a href="ukbb.html#gwas-100k"><i class="fa fa-check"></i><b>10.3</b> GWAS-100k</a></li>
<li class="chapter" data-level="10.4" data-path="ukbb.html"><a href="ukbb.html#gwas-337k"><i class="fa fa-check"></i><b>10.4</b> GWAS-337k</a></li>
<li class="chapter" data-level="10.5" data-path="ukbb.html"><a href="ukbb.html#ldsc-100k"><i class="fa fa-check"></i><b>10.5</b> ldsc-100k</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="ukbb.html"><a href="ukbb.html#under-gcta-2"><i class="fa fa-check"></i><b>10.5.1</b> under gcta</a></li>
<li class="chapter" data-level="10.5.2" data-path="ukbb.html"><a href="ukbb.html#under-ldak-thin-2"><i class="fa fa-check"></i><b>10.5.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="10.5.3" data-path="ukbb.html"><a href="ukbb.html#summary-7"><i class="fa fa-check"></i><b>10.5.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="ukbb.html"><a href="ukbb.html#ldsc-337k"><i class="fa fa-check"></i><b>10.6</b> ldsc-337k</a></li>
<li class="chapter" data-level="10.7" data-path="ukbb.html"><a href="ukbb.html#aver2_j-337k"><i class="fa fa-check"></i><b>10.7</b> aver2_j-337k</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="ukbb.html"><a href="ukbb.html#calc"><i class="fa fa-check"></i><b>10.7.1</b> calc</a></li>
<li class="chapter" data-level="10.7.2" data-path="ukbb.html"><a href="ukbb.html#organize-data-1"><i class="fa fa-check"></i><b>10.7.2</b> organize data</a></li>
<li class="chapter" data-level="10.7.3" data-path="ukbb.html"><a href="ukbb.html#chisq-aver2_j-2"><i class="fa fa-check"></i><b>10.7.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="ukbb.html"><a href="ukbb.html#he-2"><i class="fa fa-check"></i><b>10.8</b> HE</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="ukbb.html"><a href="ukbb.html#making-grms-2"><i class="fa fa-check"></i><b>10.8.1</b> making grms</a></li>
<li class="chapter" data-level="10.8.2" data-path="ukbb.html"><a href="ukbb.html#estimation-2"><i class="fa fa-check"></i><b>10.8.2</b> estimation</a></li>
<li class="chapter" data-level="10.8.3" data-path="ukbb.html"><a href="ukbb.html#summary-8"><i class="fa fa-check"></i><b>10.8.3</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="control.html"><a href="control.html"><i class="fa fa-check"></i><b>11</b> control GWAS</a>
<ul>
<li class="chapter" data-level="11.1" data-path="control.html"><a href="control.html#id-list"><i class="fa fa-check"></i><b>11.1</b> ID list</a></li>
<li class="chapter" data-level="11.2" data-path="control.html"><a href="control.html#qc-of-hp3-snps-1"><i class="fa fa-check"></i><b>11.2</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="11.3" data-path="control.html"><a href="control.html#gwas-1"><i class="fa fa-check"></i><b>11.3</b> GWAS</a></li>
<li class="chapter" data-level="11.4" data-path="control.html"><a href="control.html#ldsc-intercept-2"><i class="fa fa-check"></i><b>11.4</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="control.html"><a href="control.html#under-gcta-3"><i class="fa fa-check"></i><b>11.4.1</b> under gcta</a></li>
<li class="chapter" data-level="11.4.2" data-path="control.html"><a href="control.html#under-ldak-thin-3"><i class="fa fa-check"></i><b>11.4.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="11.4.3" data-path="control.html"><a href="control.html#summary-9"><i class="fa fa-check"></i><b>11.4.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="control.html"><a href="control.html#he-3"><i class="fa fa-check"></i><b>11.5</b> HE</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="control.html"><a href="control.html#making-grms-3"><i class="fa fa-check"></i><b>11.5.1</b> making grms</a></li>
<li class="chapter" data-level="11.5.2" data-path="control.html"><a href="control.html#estimation-3"><i class="fa fa-check"></i><b>11.5.2</b> estimation</a></li>
<li class="chapter" data-level="11.5.3" data-path="control.html"><a href="control.html#summary-10"><i class="fa fa-check"></i><b>11.5.3</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="previous-gwas.html"><a href="previous-gwas.html"><i class="fa fa-check"></i><b>12</b> previous GWAS</a>
<ul>
<li class="chapter" data-level="12.1" data-path="previous-gwas.html"><a href="previous-gwas.html#qc"><i class="fa fa-check"></i><b>12.1</b> QC</a></li>
<li class="chapter" data-level="12.2" data-path="previous-gwas.html"><a href="previous-gwas.html#gwas-telomere-length"><i class="fa fa-check"></i><b>12.2</b> gwas-telomere length</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="previous-gwas.html"><a href="previous-gwas.html#aver2_j"><i class="fa fa-check"></i><b>12.2.1</b> aver2_j</a></li>
<li class="chapter" data-level="12.2.2" data-path="previous-gwas.html"><a href="previous-gwas.html#organize-data-2"><i class="fa fa-check"></i><b>12.2.2</b> organize data</a></li>
<li class="chapter" data-level="12.2.3" data-path="previous-gwas.html"><a href="previous-gwas.html#chisq-aver2_j-3"><i class="fa fa-check"></i><b>12.2.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="previous-gwas.html"><a href="previous-gwas.html#pr-interval-gwas"><i class="fa fa-check"></i><b>12.3</b> PR interval GWAS</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="previous-gwas.html"><a href="previous-gwas.html#aver2_j-1"><i class="fa fa-check"></i><b>12.3.1</b> aver2_j</a></li>
<li class="chapter" data-level="12.3.2" data-path="previous-gwas.html"><a href="previous-gwas.html#organize-data-3"><i class="fa fa-check"></i><b>12.3.2</b> organize data</a></li>
<li class="chapter" data-level="12.3.3" data-path="previous-gwas.html"><a href="previous-gwas.html#chisq-aver2_j-4"><i class="fa fa-check"></i><b>12.3.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="previous-gwas.html"><a href="previous-gwas.html#ben-neale-pan-ukbb"><i class="fa fa-check"></i><b>12.4</b> Ben Neale Pan-UKBB</a></li>
<li class="chapter" data-level="12.5" data-path="previous-gwas.html"><a href="previous-gwas.html#notesconcerns"><i class="fa fa-check"></i><b>12.5</b> notes/concerns</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html"><i class="fa fa-check"></i><b>13</b> GWAS: White British + Irish</a>
<ul>
<li class="chapter" data-level="13.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#id-list-1"><i class="fa fa-check"></i><b>13.1</b> ID list</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#ids-who-have-no-missing-data"><i class="fa fa-check"></i><b>13.1.1</b> Ids who have no missing data</a></li>
<li class="chapter" data-level="13.1.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#relatedness-filtering-1"><i class="fa fa-check"></i><b>13.1.2</b> relatedness filtering</a></li>
<li class="chapter" data-level="13.1.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#pc-plot-1"><i class="fa fa-check"></i><b>13.1.3</b> PC plot</a></li>
<li class="chapter" data-level="13.1.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#phenotypic-differences"><i class="fa fa-check"></i><b>13.1.4</b> phenotypic differences</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#gwas-lm-1"><i class="fa fa-check"></i><b>13.2</b> GWAS-lm</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#basic-covariates"><i class="fa fa-check"></i><b>13.2.1</b> basic covariates</a></li>
<li class="chapter" data-level="13.2.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#basic-covariates-pcs"><i class="fa fa-check"></i><b>13.2.2</b> basic covariates + PCs</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#chisq-aver2_j-5"><i class="fa fa-check"></i><b>13.3</b> chisq ~ aver2_j</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#calc-aver2_j-1"><i class="fa fa-check"></i><b>13.3.1</b> calc aver2_j</a></li>
<li class="chapter" data-level="13.3.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#organize-data-4"><i class="fa fa-check"></i><b>13.3.2</b> organize data</a></li>
<li class="chapter" data-level="13.3.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#detect-confounding-wt-pcs"><i class="fa fa-check"></i><b>13.3.3</b> detect confounding: w/t PCs</a></li>
<li class="chapter" data-level="13.3.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#detect-confounding-with-pcs"><i class="fa fa-check"></i><b>13.3.4</b> detect confounding: with PCs</a></li>
<li class="chapter" data-level="13.3.5" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#inflation-good-gwas-vs.-control-vs.-british-irish"><i class="fa fa-check"></i><b>13.3.5</b> inflation: good gwas vs. control vs. british-irish</a></li>
<li class="chapter" data-level="13.3.6" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#inflation-aver2"><i class="fa fa-check"></i><b>13.3.6</b> inflation | aver2</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#ideas-to-explore-to-do-list"><i class="fa fa-check"></i><b>13.4</b> Ideas to explore/ to do list:</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="related-individuals.html"><a href="related-individuals.html"><i class="fa fa-check"></i><b>14</b> related individuals</a>
<ul>
<li class="chapter" data-level="14.1" data-path="related-individuals.html"><a href="related-individuals.html#genotyped-snps"><i class="fa fa-check"></i><b>14.1</b> genotyped SNPs</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-2"><i class="fa fa-check"></i><b>14.1.1</b> aver2_j</a></li>
<li class="chapter" data-level="14.1.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-2"><i class="fa fa-check"></i><b>14.1.2</b> gwas</a></li>
<li class="chapter" data-level="14.1.3" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-5"><i class="fa fa-check"></i><b>14.1.3</b> organize data</a></li>
<li class="chapter" data-level="14.1.4" data-path="related-individuals.html"><a href="related-individuals.html#summary-11"><i class="fa fa-check"></i><b>14.1.4</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="related-individuals.html"><a href="related-individuals.html#hapmap3-snps"><i class="fa fa-check"></i><b>14.2</b> hapmap3 SNPs</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="related-individuals.html"><a href="related-individuals.html#genotype-data"><i class="fa fa-check"></i><b>14.2.1</b> genotype data</a></li>
<li class="chapter" data-level="14.2.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-3"><i class="fa fa-check"></i><b>14.2.2</b> gwas</a></li>
<li class="chapter" data-level="14.2.3" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-3"><i class="fa fa-check"></i><b>14.2.3</b> aver2_j</a></li>
<li class="chapter" data-level="14.2.4" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-6"><i class="fa fa-check"></i><b>14.2.4</b> organize data</a></li>
<li class="chapter" data-level="14.2.5" data-path="related-individuals.html"><a href="related-individuals.html#chisq-aver2_j-6"><i class="fa fa-check"></i><b>14.2.5</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="14.2.6" data-path="related-individuals.html"><a href="related-individuals.html#inflation-aver2_j"><i class="fa fa-check"></i><b>14.2.6</b> inflation ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="related-individuals.html"><a href="related-individuals.html#mix-unrel-rel"><i class="fa fa-check"></i><b>14.3</b> mix unrel &amp; rel</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="related-individuals.html"><a href="related-individuals.html#genotype"><i class="fa fa-check"></i><b>14.3.1</b> genotype</a></li>
<li class="chapter" data-level="14.3.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-4"><i class="fa fa-check"></i><b>14.3.2</b> gwas</a></li>
<li class="chapter" data-level="14.3.3" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-4"><i class="fa fa-check"></i><b>14.3.3</b> aver2_j</a></li>
<li class="chapter" data-level="14.3.4" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-7"><i class="fa fa-check"></i><b>14.3.4</b> organize data</a></li>
<li class="chapter" data-level="14.3.5" data-path="related-individuals.html"><a href="related-individuals.html#chisq-aver2_j-7"><i class="fa fa-check"></i><b>14.3.5</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="14.3.6" data-path="related-individuals.html"><a href="related-individuals.html#inflation-aver2_j-1"><i class="fa fa-check"></i><b>14.3.6</b> inflation ~ aver2_j</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html"><i class="fa fa-check"></i><b>15</b> compute <span class="math inline">\(\sum_{i,j}^{m_1, m_2}r^2_{i,j}\)</span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#good-gwas-all-qced-snps"><i class="fa fa-check"></i><b>15.1</b> good GWAS-all qced snps</a></li>
<li class="chapter" data-level="15.2" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#good-gwass--ldak-thin-snps"><i class="fa fa-check"></i><b>15.2</b> good GWASs- ldak-thin snps</a></li>
<li class="chapter" data-level="15.3" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#bad-gwass-all-qced-snps"><i class="fa fa-check"></i><b>15.3</b> bad GWASs-all qced snps</a></li>
<li class="chapter" data-level="15.4" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#summary-12"><i class="fa fa-check"></i><b>15.4</b> summary</a></li>
<li class="chapter" data-level="15.5" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#aver2j"><i class="fa fa-check"></i><b>15.5</b> compute aver2_j</a></li>
<li class="chapter" data-level="15.6" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#mixed-pop-gwas-with-pc-as-covariates"><i class="fa fa-check"></i><b>15.6</b> mixed pop GWAS with PC as covariates</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="assortative-mating.html"><a href="assortative-mating.html"><i class="fa fa-check"></i><b>16</b> Assortative mating</a>
<ul>
<li class="chapter" data-level="16.1" data-path="assortative-mating.html"><a href="assortative-mating.html#test-the-idea"><i class="fa fa-check"></i><b>16.1</b> Test the idea</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="assortative-mating.html"><a href="assortative-mating.html#st-try"><i class="fa fa-check"></i><b>16.1.1</b> 1st try</a></li>
<li class="chapter" data-level="16.1.2" data-path="assortative-mating.html"><a href="assortative-mating.html#nd-try"><i class="fa fa-check"></i><b>16.1.2</b> 2nd try</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html"><i class="fa fa-check"></i><b>17</b> Reference Panel: 1k Genome</a>
<ul>
<li class="chapter" data-level="17.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#common-snplist"><i class="fa fa-check"></i><b>17.1</b> common snplist</a></li>
<li class="chapter" data-level="17.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#compute-aver2"><i class="fa fa-check"></i><b>17.2</b> compute aver2</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#bad-gwas-1"><i class="fa fa-check"></i><b>17.2.1</b> bad gwas</a></li>
<li class="chapter" data-level="17.2.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#varying-levels-of-confounding"><i class="fa fa-check"></i><b>17.2.2</b> varying levels of confounding</a></li>
<li class="chapter" data-level="17.2.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#good-gwas-1"><i class="fa fa-check"></i><b>17.2.3</b> good gwas</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#detect-confounding"><i class="fa fa-check"></i><b>17.3</b> detect confounding</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#bad-gwas-2"><i class="fa fa-check"></i><b>17.3.1</b> bad gwas</a></li>
<li class="chapter" data-level="17.3.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#varying-levels-of-confounding-1"><i class="fa fa-check"></i><b>17.3.2</b> varying levels of confounding</a></li>
<li class="chapter" data-level="17.3.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#good-gwas-2"><i class="fa fa-check"></i><b>17.3.3</b> good gwas</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#estimate-inflation"><i class="fa fa-check"></i><b>17.4</b> estimate inflation</a></li>
<li class="chapter" data-level="17.5" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#stratified-aver2"><i class="fa fa-check"></i><b>17.5</b> stratified aver2</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#calc-aver2"><i class="fa fa-check"></i><b>17.5.1</b> calc aver2</a></li>
<li class="chapter" data-level="17.5.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#organize-data-8"><i class="fa fa-check"></i><b>17.5.2</b> organize data</a></li>
<li class="chapter" data-level="17.5.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#plot-aver2-of-pairwise-mixture-pops"><i class="fa fa-check"></i><b>17.5.3</b> plot aver2 of pairwise mixture pops</a></li>
<li class="chapter" data-level="17.5.4" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#chisq-1-x-aver2"><i class="fa fa-check"></i><b>17.5.4</b> chisq ~ 1 x aver2</a></li>
<li class="chapter" data-level="17.5.5" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#chisq-multi-aver2"><i class="fa fa-check"></i><b>17.5.5</b> chisq ~ multi-aver2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html"><i class="fa fa-check"></i><b>18</b> Fine-scale population stratification</a>
<ul>
<li class="chapter" data-level="18.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#birth-location-data"><i class="fa fa-check"></i><b>18.1</b> birth location data</a></li>
<li class="chapter" data-level="18.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#pca-of-337k"><i class="fa fa-check"></i><b>18.2</b> pca of 337k</a></li>
<li class="chapter" data-level="18.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#birth-place-gwas"><i class="fa fa-check"></i><b>18.3</b> birth place gwas</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-5"><i class="fa fa-check"></i><b>18.3.1</b> gwas</a></li>
<li class="chapter" data-level="18.3.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#chisq-aver2-1"><i class="fa fa-check"></i><b>18.3.2</b> chisq ~ aver2</a></li>
<li class="chapter" data-level="18.3.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#detect-inflation-using-1kg"><i class="fa fa-check"></i><b>18.3.3</b> detect inflation using 1kg</a></li>
<li class="chapter" data-level="18.3.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-results"><i class="fa fa-check"></i><b>18.3.4</b> gwas results</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-based-on-pc-clusters"><i class="fa fa-check"></i><b>18.4</b> GWAS based on PC clusters</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-lists"><i class="fa fa-check"></i><b>18.4.1</b> id lists</a></li>
<li class="chapter" data-level="18.4.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-list-for-bad-gwas2"><i class="fa fa-check"></i><b>18.4.2</b> id list for bad gwas2</a></li>
<li class="chapter" data-level="18.4.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-list-for-bad-gwas3"><i class="fa fa-check"></i><b>18.4.3</b> id list for bad gwas3</a></li>
<li class="chapter" data-level="18.4.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-3"><i class="fa fa-check"></i><b>18.4.4</b> bad gwas</a></li>
<li class="chapter" data-level="18.4.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2"><i class="fa fa-check"></i><b>18.4.5</b> bad gwas#2</a></li>
<li class="chapter" data-level="18.4.6" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3"><i class="fa fa-check"></i><b>18.4.6</b> bad gwas#3</a></li>
<li class="chapter" data-level="18.4.7" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-3"><i class="fa fa-check"></i><b>18.4.7</b> good gwas</a></li>
<li class="chapter" data-level="18.4.8" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-1"><i class="fa fa-check"></i><b>18.4.8</b> control gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#compute-aver2-1"><i class="fa fa-check"></i><b>18.5</b> compute aver2</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-4"><i class="fa fa-check"></i><b>18.5.1</b> bad-gwas</a></li>
<li class="chapter" data-level="18.5.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2-1"><i class="fa fa-check"></i><b>18.5.2</b> bad-gwas#2</a></li>
<li class="chapter" data-level="18.5.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3-1"><i class="fa fa-check"></i><b>18.5.3</b> bad-gwas#3</a></li>
<li class="chapter" data-level="18.5.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-4"><i class="fa fa-check"></i><b>18.5.4</b> good-gwas</a></li>
<li class="chapter" data-level="18.5.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-2"><i class="fa fa-check"></i><b>18.5.5</b> control-gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#chisq-aver2-2"><i class="fa fa-check"></i><b>18.6</b> chisq ~ aver2</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-5"><i class="fa fa-check"></i><b>18.6.1</b> bad gwas</a></li>
<li class="chapter" data-level="18.6.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2-2"><i class="fa fa-check"></i><b>18.6.2</b> bad gwas#2</a></li>
<li class="chapter" data-level="18.6.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3-2"><i class="fa fa-check"></i><b>18.6.3</b> bad gwas#3</a></li>
<li class="chapter" data-level="18.6.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-5"><i class="fa fa-check"></i><b>18.6.4</b> good gwas</a></li>
<li class="chapter" data-level="18.6.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-3"><i class="fa fa-check"></i><b>18.6.5</b> control gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#inflation-aver2-1"><i class="fa fa-check"></i><b>18.7</b> inflation ~ aver2</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GWAS Quality Control</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="good-vs-bad-gwas" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Good VS Bad GWAS</h1>
<p>Here we investigate the inflation in test statistics from the bad GWASs. We want to find out 1) if the inflation is constant; 2) if it can be predicted in some way.</p>
<div id="test-statistics-ld-score" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> test statistics ~ LD score</h2>
<p>The inflation in GWAS test statistics due to confouding is not always constant, as assumed by LDSC. Below we plotted the chi-square test statistics from the bad (colored in red), good (orange), and control (gray) GWASs as a function of LD score ( Fig <a href="good-vs-bad-gwas.html#fig:good-vs-bad-by-ldscorebin">5.1</a> ). The linear model assumed by LDSC is only appropriate for four traits, namely chron, pulse, quals, and snoring. For these traits, LDSC accounts for the inflation due to confounding (i.e., intercept) and the inflation due to polygenity (i.e., slope). However, LDSC is inadequate for other traits, where the inflation is non-linear. More specifically, for these traits, the test statistics for SNPs with a low LD score are much more inflated than would be expected by LDSC. Thus, although LDSC can detect the inflation in GWAS test statistics due to confounding, it cannot be used to correct the inflation for some traits.</p>
<div class="figure" style="text-align: left"><span style="display:block;" id="fig:good-vs-bad-by-ldscorebin"></span>
<img src="fig-to-insert/gwas-stat-by-ldscbin.png" alt="Test statistics by LD score for good, bad and control GWASs." width="100%" />
<p class="caption">
Figure 5.1: Test statistics by LD score for good, bad and control GWASs.
</p>
</div>
</div>
<div id="new-models" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> New models?</h2>
<ol style="list-style-type: decimal">
<li><ul>
<li><span class="math inline">\(S_{j} = 1 + n_{j}a + n_{j}\sum_{i}^{m}(r_{ji}^2 \ q_{i}/Q) h^2_{snp} + \epsilon_{j}\)</span>
<ul>
<li>under GCTA: <span class="math inline">\(q_{i}=1, Q=\sum_{i}^{m}q_i=m\)</span></li>
<li>under LDAK-thin: <span class="math inline">\(q_{i}=I_{i}[f_{i}(1-f_{i})]^{0.75}\)</span></li>
</ul></li>
</ul></li>
<li><ul>
<li><span class="math inline">\(S_{j} = 1 + n_{j}a + n_{j}\sum_{i}^{k}(r_{ji}^2 \ q_{i}/Q) h^2_{snp} + n_j \sum ()h + \epsilon_{j}\)</span>
<ul>
<li>under GCTA: <span class="math inline">\(q_{i}=1, Q=\sum_{i}^{m}q_i=m\)</span></li>
<li>under LDAK-thin: <span class="math inline">\(q_{i}=I_{i}[f_{i}(1-f_{i})]^{0.75}\)</span></li>
</ul></li>
</ul></li>
</ol>
</div>
<div id="ld-scores-based-on-individual-level-data" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> LD scores based on individual level data</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="good-vs-bad-gwas.html#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="good-vs-bad-gwas.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ldsc/ldscore-individual-data</span>
<span id="cb4-3"><a href="good-vs-bad-gwas.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gen/snps-unrel-inds-by-chrom</span>
<span id="cb4-4"><a href="good-vs-bad-gwas.html#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="good-vs-bad-gwas.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># divide snp list by chrom</span></span>
<span id="cb4-6"><a href="good-vs-bad-gwas.html#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb4-7"><a href="good-vs-bad-gwas.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;{split($0, a , &quot;:&quot;)} (a[1]==i) {print $0}&#39;</span> gen/snps-unrel-inds.use <span class="op">&gt;</span> gen/snps-unrel-inds-by-chrom/snps-unrel-inds-<span class="va">$i</span></span>
<span id="cb4-8"><a href="good-vs-bad-gwas.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb4-9"><a href="good-vs-bad-gwas.html#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="good-vs-bad-gwas.html#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># compute LD scores</span></span>
<span id="cb4-11"><a href="good-vs-bad-gwas.html#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="good-vs-bad-gwas.html#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb4-13"><a href="good-vs-bad-gwas.html#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb4-14"><a href="good-vs-bad-gwas.html#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb4-15"><a href="good-vs-bad-gwas.html#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb4-16"><a href="good-vs-bad-gwas.html#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 80G</span></span>
<span id="cb4-17"><a href="good-vs-bad-gwas.html#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb4-18"><a href="good-vs-bad-gwas.html#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb4-19"><a href="good-vs-bad-gwas.html#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="good-vs-bad-gwas.html#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="st">.././ldsc.py </span><span class="dt">\</span></span>
<span id="cb4-21"><a href="good-vs-bad-gwas.html#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="st">      --bfile ../../gen/geno-mix </span><span class="dt">\</span></span>
<span id="cb4-22"><a href="good-vs-bad-gwas.html#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="st">      --extract ../../gen/snps-unrel-inds-by-chrom/snps-unrel-inds-</span><span class="va">$i</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb4-23"><a href="good-vs-bad-gwas.html#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="st">      --keep ../../mix-pop-gwas.id </span><span class="dt">\</span></span>
<span id="cb4-24"><a href="good-vs-bad-gwas.html#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="st">      --l2 </span><span class="dt">\</span></span>
<span id="cb4-25"><a href="good-vs-bad-gwas.html#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="st">      --ld-wind-cm 1 </span><span class="dt">\</span></span>
<span id="cb4-26"><a href="good-vs-bad-gwas.html#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="st">      --out ../ldscore-individual-data/ldsc-mix-</span><span class="va">$i</span></span>
<span id="cb4-27"><a href="good-vs-bad-gwas.html#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/compute-ldsc-<span class="va">$i</span>.sh</span>
<span id="cb4-28"><a href="good-vs-bad-gwas.html#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb4-29"><a href="good-vs-bad-gwas.html#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="good-vs-bad-gwas.html#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb4-31"><a href="good-vs-bad-gwas.html#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/compute-ldsc-<span class="va">$i</span>.sh</span>
<span id="cb4-32"><a href="good-vs-bad-gwas.html#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span> ../../job-records/compute-ldsc-mix</span>
<span id="cb4-33"><a href="good-vs-bad-gwas.html#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="good-vs-bad-gwas.html#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co"># check job completion</span></span>
<span id="cb4-35"><a href="good-vs-bad-gwas.html#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>job-records/compute-ldsc-mix</span>
<span id="cb4-36"><a href="good-vs-bad-gwas.html#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="va">jobs</span><span class="op">=</span><span class="kw">`</span><span class="fu">awk</span> <span class="st">&#39;{print $4}&#39;</span> <span class="va">$file</span><span class="kw">`</span></span>
<span id="cb4-37"><a href="good-vs-bad-gwas.html#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$file</span>-tmp</span>
<span id="cb4-38"><a href="good-vs-bad-gwas.html#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$jobs</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb4-39"><a href="good-vs-bad-gwas.html#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;$1~/Name/ {print i, $2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/name.tmp </span>
<span id="cb4-40"><a href="good-vs-bad-gwas.html#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/State/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/state.tmp</span>
<span id="cb4-41"><a href="good-vs-bad-gwas.html#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Cores/ {print$2}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/cores.tmp</span>
<span id="cb4-42"><a href="good-vs-bad-gwas.html#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Used walltime/ {print $2 &quot;:&quot; $3 &quot;:&quot; $4}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/time.tmp</span>
<span id="cb4-43"><a href="good-vs-bad-gwas.html#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="ex">jobinfo</span> <span class="va">$i</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">&quot;:&quot;</span> <span class="st">&#39;$1~/Max Mem/ {split($2,a,/[(]/ ); print a[1]}&#39;</span> <span class="op">&gt;&gt;</span> <span class="va">$file</span>-tmp/mem.tmp</span>
<span id="cb4-44"><a href="good-vs-bad-gwas.html#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb4-45"><a href="good-vs-bad-gwas.html#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$file</span>-tmp/name.tmp <span class="dt">\</span></span>
<span id="cb4-46"><a href="good-vs-bad-gwas.html#cb4-46" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/state.tmp <span class="dt">\</span></span>
<span id="cb4-47"><a href="good-vs-bad-gwas.html#cb4-47" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/cores.tmp <span class="dt">\</span></span>
<span id="cb4-48"><a href="good-vs-bad-gwas.html#cb4-48" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/time.tmp <span class="dt">\</span></span>
<span id="cb4-49"><a href="good-vs-bad-gwas.html#cb4-49" aria-hidden="true" tabindex="-1"></a>      <span class="va">$file</span>-tmp/mem.tmp <span class="dt">\</span></span>
<span id="cb4-50"><a href="good-vs-bad-gwas.html#cb4-50" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ID name state cores time mem&quot;}{print $0}&#39;</span> <span class="op">&gt;</span> <span class="va">$file</span>.out</span>
<span id="cb4-51"><a href="good-vs-bad-gwas.html#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> <span class="va">$file</span>-tmp</span></code></pre></div>
</div>
<div id="test-the-new-model" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Test the new model</h2>
<p>Inflation = np^2 (h2-h2local) &lt;=np^2</p>
<ol style="list-style-type: decimal">
<li><p>extract heritability estimates from good GWASs</p></li>
<li><p>n<em>p2</em>h2</p></li>
<li><p><span class="math inline">\(S_{true}\)</span> vs <span class="math inline">\(\hat{S}_{ldsc}\)</span> vs <span class="math inline">\(\hat{S}_{new}\)</span></p></li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="good-vs-bad-gwas.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract heritability estimates</span></span>
<span id="cb5-2"><a href="good-vs-bad-gwas.html#cb5-2" aria-hidden="true" tabindex="-1"></a>h2_gcta<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-gcta-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb5-3"><a href="good-vs-bad-gwas.html#cb5-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb5-4"><a href="good-vs-bad-gwas.html#cb5-4" aria-hidden="true" tabindex="-1"></a>h2_ldak<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-ldak-thin-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb5-5"><a href="good-vs-bad-gwas.html#cb5-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb5-6"><a href="good-vs-bad-gwas.html#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="good-vs-bad-gwas.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># average r_ij^2</span></span>
<span id="cb5-8"><a href="good-vs-bad-gwas.html#cb5-8" aria-hidden="true" tabindex="-1"></a>r2_good<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;inflation/summary/ave-r2-1k-snps-goodgwas&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb5-9"><a href="good-vs-bad-gwas.html#cb5-9" aria-hidden="true" tabindex="-1"></a>r2_bad<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;inflation/summary/ave-r2-1k-snps-badgwas&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb5-10"><a href="good-vs-bad-gwas.html#cb5-10" aria-hidden="true" tabindex="-1"></a>r2_good<span class="ot">=</span><span class="fu">mean</span>(r2_good<span class="sc">$</span>V1)</span>
<span id="cb5-11"><a href="good-vs-bad-gwas.html#cb5-11" aria-hidden="true" tabindex="-1"></a>r2_bad<span class="ot">=</span><span class="fu">mean</span>(r2_bad<span class="sc">$</span>V1)</span>
<span id="cb5-12"><a href="good-vs-bad-gwas.html#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="good-vs-bad-gwas.html#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ldsc intercept estimates</span></span>
<span id="cb5-14"><a href="good-vs-bad-gwas.html#cb5-14" aria-hidden="true" tabindex="-1"></a>ldsc_bad<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;summary/ldsc-mix&quot;</span>, <span class="at">header=</span>F, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb5-15"><a href="good-vs-bad-gwas.html#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="good-vs-bad-gwas.html#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># GWAS test stats &amp; LD scores</span></span>
<span id="cb5-17"><a href="good-vs-bad-gwas.html#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="good-vs-bad-gwas.html#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;vroom&quot;</span>)</span>
<span id="cb5-19"><a href="good-vs-bad-gwas.html#cb5-19" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb5-20"><a href="good-vs-bad-gwas.html#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>,</span>
<span id="cb5-21"><a href="good-vs-bad-gwas.html#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb5-22"><a href="good-vs-bad-gwas.html#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># c(&quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;)</span></span>
<span id="cb5-23"><a href="good-vs-bad-gwas.html#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="good-vs-bad-gwas.html#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/predcited-chisq-by-ldscbin.png&quot;</span>),</span>
<span id="cb5-25"><a href="good-vs-bad-gwas.html#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb5-26"><a href="good-vs-bad-gwas.html#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb5-27"><a href="good-vs-bad-gwas.html#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="good-vs-bad-gwas.html#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb5-29"><a href="good-vs-bad-gwas.html#cb5-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-30"><a href="good-vs-bad-gwas.html#cb5-30" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">100000</span></span>
<span id="cb5-31"><a href="good-vs-bad-gwas.html#cb5-31" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb5-32"><a href="good-vs-bad-gwas.html#cb5-32" aria-hidden="true" tabindex="-1"></a>ldsc_intercept<span class="ot">=</span>ldsc_bad<span class="sc">$</span>V2[ldsc_bad<span class="sc">$</span>V1<span class="sc">==</span>trait]</span>
<span id="cb5-33"><a href="good-vs-bad-gwas.html#cb5-33" aria-hidden="true" tabindex="-1"></a>h2<span class="ot">=</span>h2_ldak<span class="sc">$</span>all_est[h2_ldak<span class="sc">$</span>code<span class="sc">==</span>trait]</span>
<span id="cb5-34"><a href="good-vs-bad-gwas.html#cb5-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-35"><a href="good-vs-bad-gwas.html#cb5-35" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>,trait,<span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb5-36"><a href="good-vs-bad-gwas.html#cb5-36" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>chisq_ldsc<span class="ot">=</span>dat<span class="sc">$</span>good_chisq<span class="sc">+</span>ldsc_intercept<span class="dv">-1</span></span>
<span id="cb5-37"><a href="good-vs-bad-gwas.html#cb5-37" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>chisq_new<span class="ot">=</span>dat<span class="sc">$</span>good_chisq<span class="sc">+</span>n<span class="sc">*</span>r2_bad<span class="sc">*</span>h2</span>
<span id="cb5-38"><a href="good-vs-bad-gwas.html#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="good-vs-bad-gwas.html#cb5-39" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">ave_ldscore=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>ldsc_ref,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb5-40"><a href="good-vs-bad-gwas.html#cb5-40" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_chisq_ldsc=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq_ldsc,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb5-41"><a href="good-vs-bad-gwas.html#cb5-41" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_chisq_new=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq_new,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb5-42"><a href="good-vs-bad-gwas.html#cb5-42" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_good_chisq=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>good_chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean),</span>
<span id="cb5-43"><a href="good-vs-bad-gwas.html#cb5-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">ave_bad_chisq=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>bad_chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>ldsc_ref_bin, mean))</span>
<span id="cb5-44"><a href="good-vs-bad-gwas.html#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="good-vs-bad-gwas.html#cb5-45" aria-hidden="true" tabindex="-1"></a>end<span class="ot">=</span><span class="fu">round</span>(<span class="fu">max</span>(<span class="fu">c</span>(out[,<span class="dv">2</span>], out[,<span class="dv">3</span>], out[,<span class="dv">4</span>]), out[,<span class="dv">5</span>]),<span class="dv">0</span>)</span>
<span id="cb5-46"><a href="good-vs-bad-gwas.html#cb5-46" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="fu">round</span>(<span class="fu">min</span>(<span class="fu">c</span>(out[,<span class="dv">2</span>], out[,<span class="dv">3</span>], out[,<span class="dv">4</span>]), out[,<span class="dv">5</span>]),<span class="dv">0</span>)</span>
<span id="cb5-47"><a href="good-vs-bad-gwas.html#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="good-vs-bad-gwas.html#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>ave_ldscore, out<span class="sc">$</span>ave_bad_chisq,</span>
<span id="cb5-49"><a href="good-vs-bad-gwas.html#cb5-49" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ldscore bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisquare&quot;</span>, </span>
<span id="cb5-50"><a href="good-vs-bad-gwas.html#cb5-50" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb5-51"><a href="good-vs-bad-gwas.html#cb5-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb5-52"><a href="good-vs-bad-gwas.html#cb5-52" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb5-53"><a href="good-vs-bad-gwas.html#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out<span class="sc">$</span>ave_ldscore, out<span class="sc">$</span>ave_chisq_new,</span>
<span id="cb5-54"><a href="good-vs-bad-gwas.html#cb5-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>)</span>
<span id="cb5-55"><a href="good-vs-bad-gwas.html#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out<span class="sc">$</span>ave_ldscore, out<span class="sc">$</span>ave_chisq_ldsc,</span>
<span id="cb5-56"><a href="good-vs-bad-gwas.html#cb5-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">bg=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb5-57"><a href="good-vs-bad-gwas.html#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="co">#points(out$ave_ldscore, out$ave_good_chisq,</span></span>
<span id="cb5-58"><a href="good-vs-bad-gwas.html#cb5-58" aria-hidden="true" tabindex="-1"></a><span class="co">#       cex = 1.5, pch=21, col=&quot;white&quot;, bg=&quot;gray&quot;)</span></span>
<span id="cb5-59"><a href="good-vs-bad-gwas.html#cb5-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-60"><a href="good-vs-bad-gwas.html#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="predictors-of-inflation" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> predictors of inflation?</h2>
<p>Potential predictors considered:
1. MAF
2. ave r^2_ij for each j cross chromsomes [10k SNPs]</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="good-vs-bad-gwas.html#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="good-vs-bad-gwas.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># prep: convert snp labels to rs system</span></span>
<span id="cb6-3"><a href="good-vs-bad-gwas.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1]; b[$1]=$2; next}($1 in a){print b[$1], $2, $3, $5}&#39;</span> doug/ukbb.ldsc gen/geno-unrel.stats <span class="op">&gt;</span> gen/geno-unrel-rs.maf</span>
<span id="cb6-4"><a href="good-vs-bad-gwas.html#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="good-vs-bad-gwas.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span>
<span id="cb6-6"><a href="good-vs-bad-gwas.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="st">&quot;vroom&quot;</span><span class="kw">)</span></span>
<span id="cb6-7"><a href="good-vs-bad-gwas.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># files for maf &amp; ave r2 by snp</span></span>
<span id="cb6-8"><a href="good-vs-bad-gwas.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="va">stat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;gen/geno-unrel-rs.maf&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb6-9"><a href="good-vs-bad-gwas.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="va">r2_good</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;summary/ave-r2-by-snp-goodgwas-rs&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb6-10"><a href="good-vs-bad-gwas.html#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="va">r2_bad</span><span class="op">=</span>vroom<span class="kw">(</span><span class="st">&quot;summary/ave-r2-by-snp-badgwas-rs&quot;</span><span class="ex">,</span> col_names=F<span class="kw">)</span></span>
<span id="cb6-11"><a href="good-vs-bad-gwas.html#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="good-vs-bad-gwas.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># compute inflation in chisq (good vs. bad) by trait</span></span>
<span id="cb6-13"><a href="good-vs-bad-gwas.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb6-14"><a href="good-vs-bad-gwas.html#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb6-15"><a href="good-vs-bad-gwas.html#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb6-16"><a href="good-vs-bad-gwas.html#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="good-vs-bad-gwas.html#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb6-18"><a href="good-vs-bad-gwas.html#cb6-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-19"><a href="good-vs-bad-gwas.html#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb6-20"><a href="good-vs-bad-gwas.html#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb6-21"><a href="good-vs-bad-gwas.html#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="va">inflation</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">snp</span><span class="op">=</span>dat<span class="va">$SNP</span>,</span>
<span id="cb6-22"><a href="good-vs-bad-gwas.html#cb6-22" aria-hidden="true" tabindex="-1"></a>                     <span class="va">inflation</span><span class="op">=</span>dat<span class="va">$bad_chisq</span>-dat<span class="va">$good_chisq</span>,</span>
<span id="cb6-23"><a href="good-vs-bad-gwas.html#cb6-23" aria-hidden="true" tabindex="-1"></a>                     <span class="va">bad_chisq</span><span class="op">=</span>dat<span class="va">$bad_chisq</span>,</span>
<span id="cb6-24"><a href="good-vs-bad-gwas.html#cb6-24" aria-hidden="true" tabindex="-1"></a>                     <span class="va">good_chisq</span><span class="op">=</span>dat<span class="va">$good_chisq</span>,</span>
<span id="cb6-25"><a href="good-vs-bad-gwas.html#cb6-25" aria-hidden="true" tabindex="-1"></a>                     <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb6-26"><a href="good-vs-bad-gwas.html#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="good-vs-bad-gwas.html#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="va">m1</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">inflation</span><span class="va">$snp</span><span class="ex">,</span> stat<span class="va">$X1</span><span class="kw">)</span></span>
<span id="cb6-28"><a href="good-vs-bad-gwas.html#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="va">m2</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">inflation</span><span class="va">$snp</span><span class="ex">,r2_good</span><span class="va">$X1</span><span class="kw">)</span></span>
<span id="cb6-29"><a href="good-vs-bad-gwas.html#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="va">m3</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">inflation</span><span class="va">$snp</span><span class="ex">,r2_bad</span><span class="va">$X1</span><span class="kw">)</span></span>
<span id="cb6-30"><a href="good-vs-bad-gwas.html#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="ex">inflation,</span></span>
<span id="cb6-31"><a href="good-vs-bad-gwas.html#cb6-31" aria-hidden="true" tabindex="-1"></a>               <span class="va">maf</span><span class="op">=</span>stat<span class="va">$X4</span>[m1], </span>
<span id="cb6-32"><a href="good-vs-bad-gwas.html#cb6-32" aria-hidden="true" tabindex="-1"></a>               <span class="va">r2_good</span><span class="op">=</span>r2_good<span class="va">$X2</span>[m2],</span>
<span id="cb6-33"><a href="good-vs-bad-gwas.html#cb6-33" aria-hidden="true" tabindex="-1"></a>               <span class="va">r2_bad</span><span class="op">=</span>r2_bad<span class="va">$X2</span>[m2], <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb6-34"><a href="good-vs-bad-gwas.html#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="good-vs-bad-gwas.html#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co"># bin maf &amp; r2_bad according to quantiles</span></span>
<span id="cb6-36"><a href="good-vs-bad-gwas.html#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="va">cutoff1</span><span class="op">=</span>quantile<span class="kw">(</span><span class="ex">out</span><span class="va">$maf</span><span class="ex">,</span> probs = seq<span class="er">(</span><span class="ex">0,</span> 1, 0.005<span class="kw">)</span><span class="ex">,</span> na.rm=T<span class="kw">)</span></span>
<span id="cb6-37"><a href="good-vs-bad-gwas.html#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="va">cutoff2</span><span class="op">=</span>quantile<span class="kw">(</span><span class="ex">out</span><span class="va">$r2_bad</span><span class="ex">,</span> probs = seq<span class="er">(</span><span class="ex">0,</span> 1, 0.005<span class="kw">)</span><span class="ex">,</span> na.rm=T<span class="kw">)</span></span>
<span id="cb6-38"><a href="good-vs-bad-gwas.html#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="good-vs-bad-gwas.html#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$maf_bin</span><span class="ex">=cut</span><span class="er">(</span><span class="ex">out</span><span class="va">$maf</span><span class="ex">,</span> breaks=cutoff1, labels=1:<span class="er">(</span><span class="ex">length</span><span class="er">(</span><span class="ex">cutoff1</span><span class="kw">)</span><span class="ex">-1</span><span class="kw">))</span></span>
<span id="cb6-40"><a href="good-vs-bad-gwas.html#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$r2_bad_bin</span><span class="ex">=cut</span><span class="er">(</span><span class="ex">out</span><span class="va">$r2_bad</span><span class="ex">,</span> breaks=cutoff2, labels=1:<span class="er">(</span><span class="ex">length</span><span class="er">(</span><span class="ex">cutoff2</span><span class="kw">)</span><span class="ex">-1</span><span class="kw">))</span></span>
<span id="cb6-41"><a href="good-vs-bad-gwas.html#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="good-vs-bad-gwas.html#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;inflation/summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-inflation-by-maf-r2&quot;</span><span class="kw">)</span><span class="ex">,</span> </span>
<span id="cb6-43"><a href="good-vs-bad-gwas.html#cb6-43" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=T,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb6-44"><a href="good-vs-bad-gwas.html#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb6-45"><a href="good-vs-bad-gwas.html#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="good-vs-bad-gwas.html#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co"># plot by maf</span></span>
<span id="cb6-47"><a href="good-vs-bad-gwas.html#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb6-48"><a href="good-vs-bad-gwas.html#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb6-49"><a href="good-vs-bad-gwas.html#cb6-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> </span>
<span id="cb6-50"><a href="good-vs-bad-gwas.html#cb6-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb6-51"><a href="good-vs-bad-gwas.html#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb6-52"><a href="good-vs-bad-gwas.html#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="ex">png</span><span class="er">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;fig/inflation-by-mafbin.png&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb6-53"><a href="good-vs-bad-gwas.html#cb6-53" aria-hidden="true" tabindex="-1"></a>    <span class="ex">width</span> =40, height = 30, units = <span class="st">&quot;cm&quot;</span>, res=600<span class="kw">)</span></span>
<span id="cb6-54"><a href="good-vs-bad-gwas.html#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="ex">par</span><span class="er">(</span><span class="va">mfrow</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">3,4</span><span class="kw">))</span></span>
<span id="cb6-55"><a href="good-vs-bad-gwas.html#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb6-56"><a href="good-vs-bad-gwas.html#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb6-57"><a href="good-vs-bad-gwas.html#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-inflation-by-maf-r2&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb6-58"><a href="good-vs-bad-gwas.html#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>dat[,c<span class="kw">(</span><span class="st">&quot;snp&quot;</span><span class="ex">,</span><span class="st">&quot;inflation&quot;</span><span class="ex">,</span><span class="st">&quot;maf&quot;</span><span class="ex">,</span><span class="st">&quot;maf_bin&quot;</span><span class="kw">)</span><span class="ex">]</span></span>
<span id="cb6-59"><a href="good-vs-bad-gwas.html#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>sel[complete.cases<span class="kw">(</span><span class="ex">sel</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb6-60"><a href="good-vs-bad-gwas.html#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">inflation</span><span class="op">=</span>tapply<span class="kw">(</span><span class="ex">sel</span><span class="va">$inflation</span><span class="ex">,INDEX=sel</span><span class="va">$maf_bin</span><span class="ex">,</span> mean<span class="kw">))</span></span>
<span id="cb6-61"><a href="good-vs-bad-gwas.html#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$maf_bin</span><span class="ex">=1:dim</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">[1]</span></span>
<span id="cb6-62"><a href="good-vs-bad-gwas.html#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$maf_bin_val</span><span class="ex">=tapply</span><span class="er">(</span><span class="ex">sel</span><span class="va">$maf</span><span class="ex">,INDEX=sel</span><span class="va">$maf_bin</span><span class="ex">,</span> mean<span class="kw">)</span></span>
<span id="cb6-63"><a href="good-vs-bad-gwas.html#cb6-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-64"><a href="good-vs-bad-gwas.html#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="ex">plot</span><span class="er">(</span><span class="ex">out</span><span class="va">$maf_bin_val</span><span class="ex">,</span> out<span class="va">$inflation</span>,</span>
<span id="cb6-65"><a href="good-vs-bad-gwas.html#cb6-65" aria-hidden="true" tabindex="-1"></a>     <span class="va">xlab</span><span class="op">=</span><span class="st">&quot;maf bin&quot;</span>, <span class="va">ylab</span><span class="op">=</span><span class="st">&quot;mean inflation&quot;</span>,</span>
<span id="cb6-66"><a href="good-vs-bad-gwas.html#cb6-66" aria-hidden="true" tabindex="-1"></a>     <span class="va">main</span><span class="op">=</span>trait, <span class="va">las</span><span class="op">=</span>1,</span>
<span id="cb6-67"><a href="good-vs-bad-gwas.html#cb6-67" aria-hidden="true" tabindex="-1"></a>     <span class="ex">cex</span> = 1.5, pch=21,  bg=<span class="st">&quot;grey&quot;</span>, col=<span class="st">&quot;white&quot;</span>, lwd=0.5<span class="kw">)</span></span>
<span id="cb6-68"><a href="good-vs-bad-gwas.html#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb6-69"><a href="good-vs-bad-gwas.html#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off()</span></span>
<span id="cb6-70"><a href="good-vs-bad-gwas.html#cb6-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-71"><a href="good-vs-bad-gwas.html#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="co"># plot by r2_bad bin</span></span>
<span id="cb6-72"><a href="good-vs-bad-gwas.html#cb6-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-73"><a href="good-vs-bad-gwas.html#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb6-74"><a href="good-vs-bad-gwas.html#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb6-75"><a href="good-vs-bad-gwas.html#cb6-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> </span>
<span id="cb6-76"><a href="good-vs-bad-gwas.html#cb6-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb6-77"><a href="good-vs-bad-gwas.html#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb6-78"><a href="good-vs-bad-gwas.html#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="ex">png</span><span class="er">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;fig/inflation-by-aver2.png&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb6-79"><a href="good-vs-bad-gwas.html#cb6-79" aria-hidden="true" tabindex="-1"></a>    <span class="ex">width</span> =40, height = 30, units = <span class="st">&quot;cm&quot;</span>, res=600<span class="kw">)</span></span>
<span id="cb6-80"><a href="good-vs-bad-gwas.html#cb6-80" aria-hidden="true" tabindex="-1"></a><span class="ex">par</span><span class="er">(</span><span class="va">mfrow</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">3,4</span><span class="kw">))</span></span>
<span id="cb6-81"><a href="good-vs-bad-gwas.html#cb6-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb6-82"><a href="good-vs-bad-gwas.html#cb6-82" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb6-83"><a href="good-vs-bad-gwas.html#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;inflation/summary/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-inflation-by-maf-r2&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb6-84"><a href="good-vs-bad-gwas.html#cb6-84" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>dat[,c<span class="kw">(</span><span class="st">&quot;snp&quot;</span><span class="ex">,</span><span class="st">&quot;inflation&quot;</span><span class="ex">,</span><span class="st">&quot;r2_bad&quot;</span><span class="ex">,</span><span class="st">&quot;r2_bad_bin&quot;</span><span class="kw">)</span><span class="ex">]</span></span>
<span id="cb6-85"><a href="good-vs-bad-gwas.html#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="va">sel</span><span class="op">=</span>sel[complete.cases<span class="kw">(</span><span class="ex">sel</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb6-86"><a href="good-vs-bad-gwas.html#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">inflation</span><span class="op">=</span>tapply<span class="kw">(</span><span class="ex">sel</span><span class="va">$inflation</span><span class="ex">,INDEX=sel</span><span class="va">$r2_bad_bin</span><span class="ex">,</span> mean<span class="kw">))</span></span>
<span id="cb6-87"><a href="good-vs-bad-gwas.html#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$r2_bad_bin</span><span class="ex">=1:dim</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">[1]</span></span>
<span id="cb6-88"><a href="good-vs-bad-gwas.html#cb6-88" aria-hidden="true" tabindex="-1"></a><span class="ex">out</span><span class="va">$r2_bad_bin_val</span><span class="ex">=tapply</span><span class="er">(</span><span class="ex">sel</span><span class="va">$r2_bad</span><span class="ex">,INDEX=sel</span><span class="va">$r2_bad_bin</span><span class="ex">,</span> mean<span class="kw">)</span></span>
<span id="cb6-89"><a href="good-vs-bad-gwas.html#cb6-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-90"><a href="good-vs-bad-gwas.html#cb6-90" aria-hidden="true" tabindex="-1"></a><span class="ex">plot</span><span class="er">(</span><span class="ex">out</span><span class="va">$r2_bad_bin_val</span><span class="ex">,</span> out<span class="va">$inflation</span>,</span>
<span id="cb6-91"><a href="good-vs-bad-gwas.html#cb6-91" aria-hidden="true" tabindex="-1"></a>     <span class="va">xlab</span><span class="op">=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="va">ylab</span><span class="op">=</span><span class="st">&quot;mean inflation&quot;</span>,</span>
<span id="cb6-92"><a href="good-vs-bad-gwas.html#cb6-92" aria-hidden="true" tabindex="-1"></a>     <span class="va">main</span><span class="op">=</span>trait, <span class="va">las</span><span class="op">=</span>1,</span>
<span id="cb6-93"><a href="good-vs-bad-gwas.html#cb6-93" aria-hidden="true" tabindex="-1"></a>     <span class="ex">cex</span> = 1.5, pch=21,  bg=<span class="st">&quot;grey&quot;</span>, col=<span class="st">&quot;white&quot;</span>, lwd=0.5<span class="kw">)</span></span>
<span id="cb6-94"><a href="good-vs-bad-gwas.html#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb6-95"><a href="good-vs-bad-gwas.html#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off()</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="good-vs-bad-gwas.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we want to include a plot to show that inflation is not constant across the genome. i.e., LDSC is wrong.</span></span>
<span id="cb7-2"><a href="good-vs-bad-gwas.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we plot inflation ~ maf for bmi</span></span>
<span id="cb7-3"><a href="good-vs-bad-gwas.html#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="good-vs-bad-gwas.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb7-5"><a href="good-vs-bad-gwas.html#cb7-5" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb7-6"><a href="good-vs-bad-gwas.html#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, </span>
<span id="cb7-7"><a href="good-vs-bad-gwas.html#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb7-8"><a href="good-vs-bad-gwas.html#cb7-8" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[<span class="dv">2</span>]</span>
<span id="cb7-9"><a href="good-vs-bad-gwas.html#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="good-vs-bad-gwas.html#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-by-mafbin-bmi.png&quot;</span>),</span>
<span id="cb7-11"><a href="good-vs-bad-gwas.html#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">30</span>, <span class="at">height =</span> <span class="dv">20</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb7-12"><a href="good-vs-bad-gwas.html#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>)</span>
<span id="cb7-13"><a href="good-vs-bad-gwas.html#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="good-vs-bad-gwas.html#cb7-14" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb7-15"><a href="good-vs-bad-gwas.html#cb7-15" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;inflation&quot;</span>,<span class="st">&quot;maf&quot;</span>,<span class="st">&quot;maf_bin&quot;</span>)]</span>
<span id="cb7-16"><a href="good-vs-bad-gwas.html#cb7-16" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb7-17"><a href="good-vs-bad-gwas.html#cb7-17" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>inflation,<span class="at">INDEX=</span>sel<span class="sc">$</span>maf_bin, mean))</span>
<span id="cb7-18"><a href="good-vs-bad-gwas.html#cb7-18" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>maf_bin<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(out)[<span class="dv">1</span>]</span>
<span id="cb7-19"><a href="good-vs-bad-gwas.html#cb7-19" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>maf_bin_val<span class="ot">=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>maf,<span class="at">INDEX=</span>sel<span class="sc">$</span>maf_bin, mean)</span>
<span id="cb7-20"><a href="good-vs-bad-gwas.html#cb7-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-21"><a href="good-vs-bad-gwas.html#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>maf_bin_val, out<span class="sc">$</span>inflation,</span>
<span id="cb7-22"><a href="good-vs-bad-gwas.html#cb7-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;maf bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot; est. inflation (confoudned chisq - good chisq)&quot;</span>,</span>
<span id="cb7-23"><a href="good-vs-bad-gwas.html#cb7-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb7-24"><a href="good-vs-bad-gwas.html#cb7-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb7-25"><a href="good-vs-bad-gwas.html#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="good-vs-bad-gwas.html#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="good-vs-bad-gwas.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## inflation by raw ave r2 </span></span>
<span id="cb8-2"><a href="good-vs-bad-gwas.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb8-3"><a href="good-vs-bad-gwas.html#cb8-3" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb8-4"><a href="good-vs-bad-gwas.html#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, </span>
<span id="cb8-5"><a href="good-vs-bad-gwas.html#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb8-6"><a href="good-vs-bad-gwas.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fvc&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb8-7"><a href="good-vs-bad-gwas.html#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-by-aver2-raw.png&quot;</span>),</span>
<span id="cb8-8"><a href="good-vs-bad-gwas.html#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb8-9"><a href="good-vs-bad-gwas.html#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb8-10"><a href="good-vs-bad-gwas.html#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb8-11"><a href="good-vs-bad-gwas.html#cb8-11" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb8-12"><a href="good-vs-bad-gwas.html#cb8-12" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb8-13"><a href="good-vs-bad-gwas.html#cb8-13" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;inflation&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>)]</span>
<span id="cb8-14"><a href="good-vs-bad-gwas.html#cb8-14" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb8-15"><a href="good-vs-bad-gwas.html#cb8-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-16"><a href="good-vs-bad-gwas.html#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_bad, sel<span class="sc">$</span>inflation,</span>
<span id="cb8-17"><a href="good-vs-bad-gwas.html#cb8-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation&quot;</span>,</span>
<span id="cb8-18"><a href="good-vs-bad-gwas.html#cb8-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb8-19"><a href="good-vs-bad-gwas.html#cb8-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb8-20"><a href="good-vs-bad-gwas.html#cb8-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-21"><a href="good-vs-bad-gwas.html#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb8-22"><a href="good-vs-bad-gwas.html#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="good-vs-bad-gwas.html#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="good-vs-bad-gwas.html#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb8-25"><a href="good-vs-bad-gwas.html#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb8-26"><a href="good-vs-bad-gwas.html#cb8-26" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb8-27"><a href="good-vs-bad-gwas.html#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, </span>
<span id="cb8-28"><a href="good-vs-bad-gwas.html#cb8-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb8-29"><a href="good-vs-bad-gwas.html#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb8-30"><a href="good-vs-bad-gwas.html#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-by-aver2-goodgwas-raw.png&quot;</span>),</span>
<span id="cb8-31"><a href="good-vs-bad-gwas.html#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb8-32"><a href="good-vs-bad-gwas.html#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb8-33"><a href="good-vs-bad-gwas.html#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb8-34"><a href="good-vs-bad-gwas.html#cb8-34" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb8-35"><a href="good-vs-bad-gwas.html#cb8-35" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb8-36"><a href="good-vs-bad-gwas.html#cb8-36" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;inflation&quot;</span>,<span class="st">&quot;r2_good&quot;</span>)]</span>
<span id="cb8-37"><a href="good-vs-bad-gwas.html#cb8-37" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb8-38"><a href="good-vs-bad-gwas.html#cb8-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-39"><a href="good-vs-bad-gwas.html#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_good, sel<span class="sc">$</span>inflation,</span>
<span id="cb8-40"><a href="good-vs-bad-gwas.html#cb8-40" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation&quot;</span>,</span>
<span id="cb8-41"><a href="good-vs-bad-gwas.html#cb8-41" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb8-42"><a href="good-vs-bad-gwas.html#cb8-42" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb8-43"><a href="good-vs-bad-gwas.html#cb8-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-44"><a href="good-vs-bad-gwas.html#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb8-45"><a href="good-vs-bad-gwas.html#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="good-vs-bad-gwas.html#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="good-vs-bad-gwas.html#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="do">## histogram</span></span>
<span id="cb8-48"><a href="good-vs-bad-gwas.html#cb8-48" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb8-49"><a href="good-vs-bad-gwas.html#cb8-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, </span>
<span id="cb8-50"><a href="good-vs-bad-gwas.html#cb8-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb8-51"><a href="good-vs-bad-gwas.html#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;fcv&quot;, &quot;height&quot;,&quot;imp&quot;,</span></span>
<span id="cb8-52"><a href="good-vs-bad-gwas.html#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/hist-aver2-goodgwas.png&quot;</span>),</span>
<span id="cb8-53"><a href="good-vs-bad-gwas.html#cb8-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">40</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb8-54"><a href="good-vs-bad-gwas.html#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb8-55"><a href="good-vs-bad-gwas.html#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb8-56"><a href="good-vs-bad-gwas.html#cb8-56" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb8-57"><a href="good-vs-bad-gwas.html#cb8-57" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb8-58"><a href="good-vs-bad-gwas.html#cb8-58" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;inflation&quot;</span>,<span class="st">&quot;r2_good&quot;</span>)]</span>
<span id="cb8-59"><a href="good-vs-bad-gwas.html#cb8-59" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb8-60"><a href="good-vs-bad-gwas.html#cb8-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-61"><a href="good-vs-bad-gwas.html#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(sel<span class="sc">$</span>r2_good, <span class="at">breaks=</span><span class="dv">100</span>, <span class="at">main=</span>trait)</span>
<span id="cb8-62"><a href="good-vs-bad-gwas.html#cb8-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-63"><a href="good-vs-bad-gwas.html#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="regress-chisq-mean-r2_j" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> regress chisq ~ mean r^2_j</h2>
<p>THIS IS NEW</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="good-vs-bad-gwas.html#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="good-vs-bad-gwas.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::</span></span>
<span id="cb9-3"><a href="good-vs-bad-gwas.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># organize data</span></span>
<span id="cb9-4"><a href="good-vs-bad-gwas.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::</span></span>
<span id="cb9-5"><a href="good-vs-bad-gwas.html#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="good-vs-bad-gwas.html#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># bad gwas-----------------------------------------------------------------------</span></span>
<span id="cb9-7"><a href="good-vs-bad-gwas.html#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> gwas-mix-out</span>
<span id="cb9-8"><a href="good-vs-bad-gwas.html#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="good-vs-bad-gwas.html#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-10"><a href="good-vs-bad-gwas.html#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-mix/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb9-11"><a href="good-vs-bad-gwas.html#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-by-snp-badgwas</span>
<span id="cb9-12"><a href="good-vs-bad-gwas.html#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-unrel-inds.ldscore</span>
<span id="cb9-13"><a href="good-vs-bad-gwas.html#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-mix-out/<span class="va">$trait</span>.out</span>
<span id="cb9-14"><a href="good-vs-bad-gwas.html#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="good-vs-bad-gwas.html#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp</span>
<span id="cb9-16"><a href="good-vs-bad-gwas.html#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="good-vs-bad-gwas.html#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb9-18"><a href="good-vs-bad-gwas.html#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb9-19"><a href="good-vs-bad-gwas.html#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb9-20"><a href="good-vs-bad-gwas.html#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="good-vs-bad-gwas.html#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb9-22"><a href="good-vs-bad-gwas.html#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb9-23"><a href="good-vs-bad-gwas.html#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb9-24"><a href="good-vs-bad-gwas.html#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="good-vs-bad-gwas.html#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb9-26"><a href="good-vs-bad-gwas.html#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb9-27"><a href="good-vs-bad-gwas.html#cb9-27" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb9-28"><a href="good-vs-bad-gwas.html#cb9-28" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb9-29"><a href="good-vs-bad-gwas.html#cb9-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb9-30"><a href="good-vs-bad-gwas.html#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb9-31"><a href="good-vs-bad-gwas.html#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb9-32"><a href="good-vs-bad-gwas.html#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-33"><a href="good-vs-bad-gwas.html#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="good-vs-bad-gwas.html#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co"># good gwas-----------------------------------------------------------------------</span></span>
<span id="cb9-35"><a href="good-vs-bad-gwas.html#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> unrelated/gwas-good-out</span>
<span id="cb9-36"><a href="good-vs-bad-gwas.html#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="good-vs-bad-gwas.html#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-38"><a href="good-vs-bad-gwas.html#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>unrelated/gwas-good/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb9-39"><a href="good-vs-bad-gwas.html#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-by-snp-goodgwas</span>
<span id="cb9-40"><a href="good-vs-bad-gwas.html#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>unrelated/gwas-good-out/<span class="va">$trait</span>.out</span>
<span id="cb9-41"><a href="good-vs-bad-gwas.html#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="good-vs-bad-gwas.html#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp </span>
<span id="cb9-43"><a href="good-vs-bad-gwas.html#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="good-vs-bad-gwas.html#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb9-45"><a href="good-vs-bad-gwas.html#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb9-46"><a href="good-vs-bad-gwas.html#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb9-47"><a href="good-vs-bad-gwas.html#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="good-vs-bad-gwas.html#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb9-49"><a href="good-vs-bad-gwas.html#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb9-50"><a href="good-vs-bad-gwas.html#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb9-51"><a href="good-vs-bad-gwas.html#cb9-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-52"><a href="good-vs-bad-gwas.html#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb9-53"><a href="good-vs-bad-gwas.html#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb9-54"><a href="good-vs-bad-gwas.html#cb9-54" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb9-55"><a href="good-vs-bad-gwas.html#cb9-55" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb9-56"><a href="good-vs-bad-gwas.html#cb9-56" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb9-57"><a href="good-vs-bad-gwas.html#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb9-58"><a href="good-vs-bad-gwas.html#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb9-59"><a href="good-vs-bad-gwas.html#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-60"><a href="good-vs-bad-gwas.html#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="good-vs-bad-gwas.html#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="co"># ::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb9-62"><a href="good-vs-bad-gwas.html#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate slope: bad chisq ~ aver2_j &amp; correct the test statistics</span></span>
<span id="cb9-63"><a href="good-vs-bad-gwas.html#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb9-64"><a href="good-vs-bad-gwas.html#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="good-vs-bad-gwas.html#cb9-65" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb9-66"><a href="good-vs-bad-gwas.html#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb9-67"><a href="good-vs-bad-gwas.html#cb9-67" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb9-68"><a href="good-vs-bad-gwas.html#cb9-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb9-69"><a href="good-vs-bad-gwas.html#cb9-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-70"><a href="good-vs-bad-gwas.html#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb9-71"><a href="good-vs-bad-gwas.html#cb9-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-72"><a href="good-vs-bad-gwas.html#cb9-72" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb9-73"><a href="good-vs-bad-gwas.html#cb9-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-74"><a href="good-vs-bad-gwas.html#cb9-74" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span>paste0<span class="kw">(</span><span class="st">&quot;gwas-mix-out/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;.out&quot;</span><span class="kw">)</span></span>
<span id="cb9-75"><a href="good-vs-bad-gwas.html#cb9-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-76"><a href="good-vs-bad-gwas.html#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>vroom<span class="kw">(</span><span class="fu">file</span>, col_names=T, delim=<span class="st">&quot;;&quot;</span><span class="kw">)</span></span>
<span id="cb9-77"><a href="good-vs-bad-gwas.html#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>dat[complete.cases<span class="kw">(</span><span class="ex">dat</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb9-78"><a href="good-vs-bad-gwas.html#cb9-78" aria-hidden="true" tabindex="-1"></a><span class="va">mod</span><span class="op">=</span>lm<span class="kw">(</span><span class="ex">chisq</span> ~ aver2,data=dat<span class="kw">)</span></span>
<span id="cb9-79"><a href="good-vs-bad-gwas.html#cb9-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-80"><a href="good-vs-bad-gwas.html#cb9-80" aria-hidden="true" tabindex="-1"></a><span class="co"># correct inflation</span></span>
<span id="cb9-81"><a href="good-vs-bad-gwas.html#cb9-81" aria-hidden="true" tabindex="-1"></a><span class="va">cor</span><span class="op">=</span>dat<span class="va">$chisq</span>-dat<span class="va">$aver2</span><span class="pp">*</span>coef<span class="kw">(</span><span class="ex">mod</span><span class="kw">)</span><span class="ex">[2]</span></span>
<span id="cb9-82"><a href="good-vs-bad-gwas.html#cb9-82" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>cbind<span class="kw">(</span><span class="ex">dat,cor</span><span class="kw">)</span></span>
<span id="cb9-83"><a href="good-vs-bad-gwas.html#cb9-83" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,paste0</span><span class="er">(</span><span class="st">&quot;gwas-mix-out/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-corrected.out&quot;</span><span class="kw">)</span><span class="ex">,</span> col.names=T,</span>
<span id="cb9-84"><a href="good-vs-bad-gwas.html#cb9-84" aria-hidden="true" tabindex="-1"></a>            <span class="ex">row.names=F,</span> quote=F<span class="kw">)</span></span>
<span id="cb9-85"><a href="good-vs-bad-gwas.html#cb9-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-86"><a href="good-vs-bad-gwas.html#cb9-86" aria-hidden="true" tabindex="-1"></a><span class="co"># collect slope</span></span>
<span id="cb9-87"><a href="good-vs-bad-gwas.html#cb9-87" aria-hidden="true" tabindex="-1"></a><span class="va">slope0</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">trait</span><span class="op">=</span>trait,</span>
<span id="cb9-88"><a href="good-vs-bad-gwas.html#cb9-88" aria-hidden="true" tabindex="-1"></a>                  <span class="va">slope_aver2</span><span class="op">=</span>coef<span class="kw">(</span><span class="ex">mod</span><span class="kw">)</span><span class="ex">[2],</span></span>
<span id="cb9-89"><a href="good-vs-bad-gwas.html#cb9-89" aria-hidden="true" tabindex="-1"></a>                  <span class="va">p_aver2</span><span class="op">=</span>summary<span class="kw">(</span><span class="ex">mod</span><span class="kw">)</span><span class="va">$coefficients</span><span class="ex">[,4][2],</span></span>
<span id="cb9-90"><a href="good-vs-bad-gwas.html#cb9-90" aria-hidden="true" tabindex="-1"></a>                  <span class="ex">stringsAsFactors</span> = F<span class="kw">)</span></span>
<span id="cb9-91"><a href="good-vs-bad-gwas.html#cb9-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-92"><a href="good-vs-bad-gwas.html#cb9-92" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="kw">(</span><span class="va">i</span><span class="op">=</span>=1<span class="kw">)</span><span class="ex">{slope=slope0}</span> else <span class="dt">{slope=rbind(slope</span><span class="op">,</span><span class="dt">slope0)}</span></span>
<span id="cb9-93"><a href="good-vs-bad-gwas.html#cb9-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-94"><a href="good-vs-bad-gwas.html#cb9-94" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb9-95"><a href="good-vs-bad-gwas.html#cb9-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-96"><a href="good-vs-bad-gwas.html#cb9-96" aria-hidden="true" tabindex="-1"></a><span class="co"># ::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb9-97"><a href="good-vs-bad-gwas.html#cb9-97" aria-hidden="true" tabindex="-1"></a><span class="co"># corrected chisq VS good chisq vs. control chisq</span></span>
<span id="cb9-98"><a href="good-vs-bad-gwas.html#cb9-98" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb9-99"><a href="good-vs-bad-gwas.html#cb9-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-100"><a href="good-vs-bad-gwas.html#cb9-100" aria-hidden="true" tabindex="-1"></a><span class="ex">require</span><span class="er">(</span><span class="ex">vroom</span><span class="kw">)</span></span>
<span id="cb9-101"><a href="good-vs-bad-gwas.html#cb9-101" aria-hidden="true" tabindex="-1"></a><span class="va">traits</span><span class="op">=</span>c<span class="kw">(</span><span class="st">&quot;awake&quot;</span><span class="ex">,</span><span class="st">&quot;bmi&quot;</span><span class="ex">,</span><span class="st">&quot;chron&quot;</span><span class="ex">,</span><span class="st">&quot;ever&quot;</span><span class="ex">,</span></span>
<span id="cb9-102"><a href="good-vs-bad-gwas.html#cb9-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span><span class="ex">,</span><span class="st">&quot;pulse&quot;</span><span class="ex">,</span><span class="st">&quot;quals&quot;</span><span class="ex">,</span> <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb9-103"><a href="good-vs-bad-gwas.html#cb9-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span><span class="ex">,</span><span class="st">&quot;sbp&quot;</span><span class="ex">,</span><span class="st">&quot;snoring&quot;</span><span class="ex">,</span><span class="st">&quot;hyper&quot;</span><span class="kw">)</span></span>
<span id="cb9-104"><a href="good-vs-bad-gwas.html#cb9-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-105"><a href="good-vs-bad-gwas.html#cb9-105" aria-hidden="true" tabindex="-1"></a><span class="ex">png</span><span class="er">(</span><span class="st">&quot;fig/good-vs-corrected-chisq.png&quot;</span><span class="ex">,</span> res=600, width=50, height=30, units=<span class="st">&quot;cm&quot;</span><span class="kw">)</span></span>
<span id="cb9-106"><a href="good-vs-bad-gwas.html#cb9-106" aria-hidden="true" tabindex="-1"></a><span class="ex">par</span><span class="er">(</span><span class="va">mfrow</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">3,5</span><span class="kw">)</span><span class="ex">,</span> pty=<span class="st">&quot;s&quot;</span><span class="kw">)</span></span>
<span id="cb9-107"><a href="good-vs-bad-gwas.html#cb9-107" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 1:length<span class="er">(</span><span class="ex">traits</span><span class="kw">)){</span></span>
<span id="cb9-108"><a href="good-vs-bad-gwas.html#cb9-108" aria-hidden="true" tabindex="-1"></a><span class="va">trait</span><span class="op">=</span>traits[i]</span>
<span id="cb9-109"><a href="good-vs-bad-gwas.html#cb9-109" aria-hidden="true" tabindex="-1"></a><span class="va">good</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;unrelated/gwas-good-out/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;.out&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb9-110"><a href="good-vs-bad-gwas.html#cb9-110" aria-hidden="true" tabindex="-1"></a><span class="va">good</span><span class="op">=</span>good[complete.cases<span class="kw">(</span><span class="ex">good</span><span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb9-111"><a href="good-vs-bad-gwas.html#cb9-111" aria-hidden="true" tabindex="-1"></a><span class="va">cor</span><span class="op">=</span>vroom<span class="kw">(</span><span class="ex">paste0</span><span class="er">(</span><span class="st">&quot;gwas-mix-out/&quot;</span><span class="ex">,trait,</span><span class="st">&quot;-corrected.out&quot;</span><span class="kw">)</span><span class="ex">,</span> col_names=T<span class="kw">)</span></span>
<span id="cb9-112"><a href="good-vs-bad-gwas.html#cb9-112" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">good</span><span class="va">$snp</span><span class="ex">,</span> cor<span class="va">$snp</span><span class="kw">)</span></span>
<span id="cb9-113"><a href="good-vs-bad-gwas.html#cb9-113" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="va">snp</span><span class="op">=</span>good<span class="va">$snp</span>,</span>
<span id="cb9-114"><a href="good-vs-bad-gwas.html#cb9-114" aria-hidden="true" tabindex="-1"></a>               <span class="va">good</span><span class="op">=</span>good<span class="va">$chisq</span>,</span>
<span id="cb9-115"><a href="good-vs-bad-gwas.html#cb9-115" aria-hidden="true" tabindex="-1"></a>               <span class="va">cor</span><span class="op">=</span>cor<span class="va">$cor</span>[m]<span class="kw">)</span></span>
<span id="cb9-116"><a href="good-vs-bad-gwas.html#cb9-116" aria-hidden="true" tabindex="-1"></a>               </span>
<span id="cb9-117"><a href="good-vs-bad-gwas.html#cb9-117" aria-hidden="true" tabindex="-1"></a><span class="va">start</span><span class="op">=</span>min<span class="kw">(</span><span class="ex">dat</span><span class="va">$good</span><span class="ex">,dat</span><span class="va">$cor</span><span class="kw">)</span></span>
<span id="cb9-118"><a href="good-vs-bad-gwas.html#cb9-118" aria-hidden="true" tabindex="-1"></a><span class="va">end</span><span class="op">=</span>max<span class="kw">(</span><span class="ex">dat</span><span class="va">$good</span><span class="ex">,dat</span><span class="va">$cor</span><span class="kw">)</span></span>
<span id="cb9-119"><a href="good-vs-bad-gwas.html#cb9-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-120"><a href="good-vs-bad-gwas.html#cb9-120" aria-hidden="true" tabindex="-1"></a><span class="ex">plot</span><span class="er">(</span><span class="ex">dat</span><span class="va">$good</span><span class="ex">,</span> dat<span class="va">$cor</span>,</span>
<span id="cb9-121"><a href="good-vs-bad-gwas.html#cb9-121" aria-hidden="true" tabindex="-1"></a>     <span class="va">xlim</span><span class="op">=</span>c<span class="kw">(</span><span class="ex">start,end</span><span class="kw">)</span><span class="ex">,</span> ylim=c<span class="er">(</span><span class="ex">start,</span> end<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb9-122"><a href="good-vs-bad-gwas.html#cb9-122" aria-hidden="true" tabindex="-1"></a>     <span class="va">xlab</span><span class="op">=</span><span class="st">&quot;good chisq&quot;</span>, <span class="va">ylab</span><span class="op">=</span><span class="st">&quot;corrected chisq&quot;</span>, </span>
<span id="cb9-123"><a href="good-vs-bad-gwas.html#cb9-123" aria-hidden="true" tabindex="-1"></a>     <span class="va">main</span><span class="op">=</span>trait, <span class="va">las</span><span class="op">=</span>1,</span>
<span id="cb9-124"><a href="good-vs-bad-gwas.html#cb9-124" aria-hidden="true" tabindex="-1"></a>     <span class="ex">cex</span> = 1.5, pch=21,  bg=<span class="st">&quot;darkgray&quot;</span>, col=<span class="st">&quot;white&quot;</span>, lwd=0.5<span class="kw">)</span></span>
<span id="cb9-125"><a href="good-vs-bad-gwas.html#cb9-125" aria-hidden="true" tabindex="-1"></a><span class="ex">abline</span><span class="er">(</span><span class="ex">0,</span> 1, col=<span class="st">&quot;darkgray&quot;</span>, lwd=1.5, lty=1<span class="kw">)</span></span>
<span id="cb9-126"><a href="good-vs-bad-gwas.html#cb9-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-127"><a href="good-vs-bad-gwas.html#cb9-127" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb9-128"><a href="good-vs-bad-gwas.html#cb9-128" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off()</span></span></code></pre></div>
<div id="plots" class="section level3" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> plots</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="good-vs-bad-gwas.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::</span></span>
<span id="cb10-2"><a href="good-vs-bad-gwas.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># good gwas</span></span>
<span id="cb10-3"><a href="good-vs-bad-gwas.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::</span></span>
<span id="cb10-4"><a href="good-vs-bad-gwas.html#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="good-vs-bad-gwas.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb10-6"><a href="good-vs-bad-gwas.html#cb10-6" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb10-7"><a href="good-vs-bad-gwas.html#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb10-8"><a href="good-vs-bad-gwas.html#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb10-9"><a href="good-vs-bad-gwas.html#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="good-vs-bad-gwas.html#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-good-gwas.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb10-11"><a href="good-vs-bad-gwas.html#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb10-12"><a href="good-vs-bad-gwas.html#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="good-vs-bad-gwas.html#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb10-14"><a href="good-vs-bad-gwas.html#cb10-14" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb10-15"><a href="good-vs-bad-gwas.html#cb10-15" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;unrelated/gwas-good-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb10-16"><a href="good-vs-bad-gwas.html#cb10-16" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb10-17"><a href="good-vs-bad-gwas.html#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="good-vs-bad-gwas.html#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb10-19"><a href="good-vs-bad-gwas.html#cb10-19" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb10-20"><a href="good-vs-bad-gwas.html#cb10-20" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb10-21"><a href="good-vs-bad-gwas.html#cb10-21" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb10-22"><a href="good-vs-bad-gwas.html#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="good-vs-bad-gwas.html#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb10-24"><a href="good-vs-bad-gwas.html#cb10-24" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb10-25"><a href="good-vs-bad-gwas.html#cb10-25" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb10-26"><a href="good-vs-bad-gwas.html#cb10-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-27"><a href="good-vs-bad-gwas.html#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb10-28"><a href="good-vs-bad-gwas.html#cb10-28" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb10-29"><a href="good-vs-bad-gwas.html#cb10-29" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb10-30"><a href="good-vs-bad-gwas.html#cb10-30" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb10-31"><a href="good-vs-bad-gwas.html#cb10-31" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb10-32"><a href="good-vs-bad-gwas.html#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="good-vs-bad-gwas.html#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb10-34"><a href="good-vs-bad-gwas.html#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#png(&quot;fig/chisq-aver2-bin-good-gwas.png&quot;, res=600, width=50, height=30, units=&quot;cm&quot;)</span></span>
<span id="cb10-35"><a href="good-vs-bad-gwas.html#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">#par(mfrow=c(3,5), cex.lab=1.2, font.lab=2, cex.main=1.5)</span></span>
<span id="cb10-36"><a href="good-vs-bad-gwas.html#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb10-37"><a href="good-vs-bad-gwas.html#cb10-37" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb10-38"><a href="good-vs-bad-gwas.html#cb10-38" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb10-39"><a href="good-vs-bad-gwas.html#cb10-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb10-40"><a href="good-vs-bad-gwas.html#cb10-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb10-41"><a href="good-vs-bad-gwas.html#cb10-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb10-42"><a href="good-vs-bad-gwas.html#cb10-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb10-43"><a href="good-vs-bad-gwas.html#cb10-43" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb10-44"><a href="good-vs-bad-gwas.html#cb10-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb10-45"><a href="good-vs-bad-gwas.html#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dev.off()</span></span>
<span id="cb10-46"><a href="good-vs-bad-gwas.html#cb10-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-47"><a href="good-vs-bad-gwas.html#cb10-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-48"><a href="good-vs-bad-gwas.html#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb10-49"><a href="good-vs-bad-gwas.html#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="good-vs-bad-gwas.html#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::</span></span>
<span id="cb10-51"><a href="good-vs-bad-gwas.html#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="co"># bad gwas</span></span>
<span id="cb10-52"><a href="good-vs-bad-gwas.html#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::</span></span>
<span id="cb10-53"><a href="good-vs-bad-gwas.html#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="good-vs-bad-gwas.html#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb10-55"><a href="good-vs-bad-gwas.html#cb10-55" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb10-56"><a href="good-vs-bad-gwas.html#cb10-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb10-57"><a href="good-vs-bad-gwas.html#cb10-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb10-58"><a href="good-vs-bad-gwas.html#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="good-vs-bad-gwas.html#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-bad-gwas.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb10-60"><a href="good-vs-bad-gwas.html#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb10-61"><a href="good-vs-bad-gwas.html#cb10-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-62"><a href="good-vs-bad-gwas.html#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb10-63"><a href="good-vs-bad-gwas.html#cb10-63" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb10-64"><a href="good-vs-bad-gwas.html#cb10-64" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;gwas-mix-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb10-65"><a href="good-vs-bad-gwas.html#cb10-65" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb10-66"><a href="good-vs-bad-gwas.html#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="good-vs-bad-gwas.html#cb10-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb10-68"><a href="good-vs-bad-gwas.html#cb10-68" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb10-69"><a href="good-vs-bad-gwas.html#cb10-69" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb10-70"><a href="good-vs-bad-gwas.html#cb10-70" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb10-71"><a href="good-vs-bad-gwas.html#cb10-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-72"><a href="good-vs-bad-gwas.html#cb10-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb10-73"><a href="good-vs-bad-gwas.html#cb10-73" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb10-74"><a href="good-vs-bad-gwas.html#cb10-74" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb10-75"><a href="good-vs-bad-gwas.html#cb10-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-76"><a href="good-vs-bad-gwas.html#cb10-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb10-77"><a href="good-vs-bad-gwas.html#cb10-77" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb10-78"><a href="good-vs-bad-gwas.html#cb10-78" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb10-79"><a href="good-vs-bad-gwas.html#cb10-79" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb10-80"><a href="good-vs-bad-gwas.html#cb10-80" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb10-81"><a href="good-vs-bad-gwas.html#cb10-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="good-vs-bad-gwas.html#cb10-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb10-83"><a href="good-vs-bad-gwas.html#cb10-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb10-84"><a href="good-vs-bad-gwas.html#cb10-84" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb10-85"><a href="good-vs-bad-gwas.html#cb10-85" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb10-86"><a href="good-vs-bad-gwas.html#cb10-86" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb10-87"><a href="good-vs-bad-gwas.html#cb10-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 ,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb10-88"><a href="good-vs-bad-gwas.html#cb10-88" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb10-89"><a href="good-vs-bad-gwas.html#cb10-89" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb10-90"><a href="good-vs-bad-gwas.html#cb10-90" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb10-91"><a href="good-vs-bad-gwas.html#cb10-91" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb10-92"><a href="good-vs-bad-gwas.html#cb10-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-93"><a href="good-vs-bad-gwas.html#cb10-93" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-94"><a href="good-vs-bad-gwas.html#cb10-94" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p>Below is the OLD code.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="good-vs-bad-gwas.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::</span></span>
<span id="cb11-2"><a href="good-vs-bad-gwas.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># by binned ave r2</span></span>
<span id="cb11-3"><a href="good-vs-bad-gwas.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::</span></span>
<span id="cb11-4"><a href="good-vs-bad-gwas.html#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="good-vs-bad-gwas.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># bad chisq by binned ave r2 </span></span>
<span id="cb11-6"><a href="good-vs-bad-gwas.html#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb11-7"><a href="good-vs-bad-gwas.html#cb11-7" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb11-8"><a href="good-vs-bad-gwas.html#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb11-9"><a href="good-vs-bad-gwas.html#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb11-10"><a href="good-vs-bad-gwas.html#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/badgwas-chisq-by-aver2-bin.png&quot;</span>),</span>
<span id="cb11-11"><a href="good-vs-bad-gwas.html#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb11-12"><a href="good-vs-bad-gwas.html#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb11-13"><a href="good-vs-bad-gwas.html#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb11-14"><a href="good-vs-bad-gwas.html#cb11-14" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb11-15"><a href="good-vs-bad-gwas.html#cb11-15" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb11-16"><a href="good-vs-bad-gwas.html#cb11-16" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;bad_chisq&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>,<span class="st">&quot;r2_bad_bin&quot;</span>)]</span>
<span id="cb11-17"><a href="good-vs-bad-gwas.html#cb11-17" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb11-18"><a href="good-vs-bad-gwas.html#cb11-18" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">bad_chisq=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>bad_chisq,<span class="at">INDEX=</span>sel<span class="sc">$</span>r2_bad_bin, mean))</span>
<span id="cb11-19"><a href="good-vs-bad-gwas.html#cb11-19" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_bad_bin<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(out)[<span class="dv">1</span>]</span>
<span id="cb11-20"><a href="good-vs-bad-gwas.html#cb11-20" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>r2_bad_bin_val<span class="ot">=</span><span class="fu">tapply</span>(sel<span class="sc">$</span>r2_bad,<span class="at">INDEX=</span>sel<span class="sc">$</span>r2_bad_bin, mean)</span>
<span id="cb11-21"><a href="good-vs-bad-gwas.html#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="good-vs-bad-gwas.html#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>r2_bad_bin_val, out<span class="sc">$</span>bad_chisq,</span>
<span id="cb11-23"><a href="good-vs-bad-gwas.html#cb11-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq test stat&quot;</span>,</span>
<span id="cb11-24"><a href="good-vs-bad-gwas.html#cb11-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb11-25"><a href="good-vs-bad-gwas.html#cb11-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-26"><a href="good-vs-bad-gwas.html#cb11-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-27"><a href="good-vs-bad-gwas.html#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb11-28"><a href="good-vs-bad-gwas.html#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="good-vs-bad-gwas.html#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::</span></span>
<span id="cb11-30"><a href="good-vs-bad-gwas.html#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co"># by raw ave r2</span></span>
<span id="cb11-31"><a href="good-vs-bad-gwas.html#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::</span></span>
<span id="cb11-32"><a href="good-vs-bad-gwas.html#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="good-vs-bad-gwas.html#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co"># bad chisq by raw ave r2 </span></span>
<span id="cb11-34"><a href="good-vs-bad-gwas.html#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb11-35"><a href="good-vs-bad-gwas.html#cb11-35" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb11-36"><a href="good-vs-bad-gwas.html#cb11-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb11-37"><a href="good-vs-bad-gwas.html#cb11-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb11-38"><a href="good-vs-bad-gwas.html#cb11-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-39"><a href="good-vs-bad-gwas.html#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/badgwas-chisq-by-aver2.png&quot;</span>),</span>
<span id="cb11-40"><a href="good-vs-bad-gwas.html#cb11-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb11-41"><a href="good-vs-bad-gwas.html#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb11-42"><a href="good-vs-bad-gwas.html#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb11-43"><a href="good-vs-bad-gwas.html#cb11-43" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb11-44"><a href="good-vs-bad-gwas.html#cb11-44" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb11-45"><a href="good-vs-bad-gwas.html#cb11-45" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;bad_chisq&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>)]</span>
<span id="cb11-46"><a href="good-vs-bad-gwas.html#cb11-46" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb11-47"><a href="good-vs-bad-gwas.html#cb11-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-48"><a href="good-vs-bad-gwas.html#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_bad, sel<span class="sc">$</span>bad_chisq,</span>
<span id="cb11-49"><a href="good-vs-bad-gwas.html#cb11-49" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq test stat&quot;</span>,</span>
<span id="cb11-50"><a href="good-vs-bad-gwas.html#cb11-50" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb11-51"><a href="good-vs-bad-gwas.html#cb11-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-52"><a href="good-vs-bad-gwas.html#cb11-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-53"><a href="good-vs-bad-gwas.html#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb11-54"><a href="good-vs-bad-gwas.html#cb11-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-55"><a href="good-vs-bad-gwas.html#cb11-55" aria-hidden="true" tabindex="-1"></a><span class="co"># good chisq by raw ave r2 </span></span>
<span id="cb11-56"><a href="good-vs-bad-gwas.html#cb11-56" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb11-57"><a href="good-vs-bad-gwas.html#cb11-57" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb11-58"><a href="good-vs-bad-gwas.html#cb11-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb11-59"><a href="good-vs-bad-gwas.html#cb11-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb11-60"><a href="good-vs-bad-gwas.html#cb11-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-61"><a href="good-vs-bad-gwas.html#cb11-61" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/goodgwas-chisq-by-aver2.png&quot;</span>),</span>
<span id="cb11-62"><a href="good-vs-bad-gwas.html#cb11-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span><span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb11-63"><a href="good-vs-bad-gwas.html#cb11-63" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb11-64"><a href="good-vs-bad-gwas.html#cb11-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb11-65"><a href="good-vs-bad-gwas.html#cb11-65" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb11-66"><a href="good-vs-bad-gwas.html#cb11-66" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb11-67"><a href="good-vs-bad-gwas.html#cb11-67" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;good_chisq&quot;</span>,<span class="st">&quot;r2_good&quot;</span>)]</span>
<span id="cb11-68"><a href="good-vs-bad-gwas.html#cb11-68" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb11-69"><a href="good-vs-bad-gwas.html#cb11-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-70"><a href="good-vs-bad-gwas.html#cb11-70" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel<span class="sc">$</span>r2_good, sel<span class="sc">$</span>good_chisq,</span>
<span id="cb11-71"><a href="good-vs-bad-gwas.html#cb11-71" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq test stat&quot;</span>,</span>
<span id="cb11-72"><a href="good-vs-bad-gwas.html#cb11-72" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb11-73"><a href="good-vs-bad-gwas.html#cb11-73" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;grey&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-74"><a href="good-vs-bad-gwas.html#cb11-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-75"><a href="good-vs-bad-gwas.html#cb11-75" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb11-76"><a href="good-vs-bad-gwas.html#cb11-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-77"><a href="good-vs-bad-gwas.html#cb11-77" aria-hidden="true" tabindex="-1"></a><span class="co"># regression: chisq test stats ~ ave r^2_j --------------------------------------</span></span>
<span id="cb11-78"><a href="good-vs-bad-gwas.html#cb11-78" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb11-79"><a href="good-vs-bad-gwas.html#cb11-79" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb11-80"><a href="good-vs-bad-gwas.html#cb11-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>,</span>
<span id="cb11-81"><a href="good-vs-bad-gwas.html#cb11-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb11-82"><a href="good-vs-bad-gwas.html#cb11-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-83"><a href="good-vs-bad-gwas.html#cb11-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb11-84"><a href="good-vs-bad-gwas.html#cb11-84" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[i]</span>
<span id="cb11-85"><a href="good-vs-bad-gwas.html#cb11-85" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb11-86"><a href="good-vs-bad-gwas.html#cb11-86" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;snp&quot;</span>,<span class="st">&quot;bad_chisq&quot;</span>,<span class="st">&quot;good_chisq&quot;</span>,<span class="st">&quot;r2_bad&quot;</span>, <span class="st">&quot;r2_good&quot;</span>, <span class="st">&quot;maf&quot;</span>)]</span>
<span id="cb11-87"><a href="good-vs-bad-gwas.html#cb11-87" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>sel[<span class="fu">complete.cases</span>(sel),]</span>
<span id="cb11-88"><a href="good-vs-bad-gwas.html#cb11-88" aria-hidden="true" tabindex="-1"></a>sel<span class="sc">$</span>maf2<span class="ot">=</span>sel<span class="sc">$</span>maf<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb11-89"><a href="good-vs-bad-gwas.html#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="good-vs-bad-gwas.html#cb11-90" aria-hidden="true" tabindex="-1"></a>mod1<span class="ot">=</span><span class="fu">lm</span>(sel<span class="sc">$</span>bad_chisq<span class="sc">~</span>sel<span class="sc">$</span>r2_bad)</span>
<span id="cb11-91"><a href="good-vs-bad-gwas.html#cb11-91" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.1=lm(sel$bad_chisq~sel$maf)</span></span>
<span id="cb11-92"><a href="good-vs-bad-gwas.html#cb11-92" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.2=lm(sel$bad_chisq~ sel$maf + sel$maf2)</span></span>
<span id="cb11-93"><a href="good-vs-bad-gwas.html#cb11-93" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.3=lm(sel$bad_chisq~sel$r2_bad+sel$maf)</span></span>
<span id="cb11-94"><a href="good-vs-bad-gwas.html#cb11-94" aria-hidden="true" tabindex="-1"></a><span class="co">#mod1.4=lm(sel$bad_chisq~sel$r2_bad+sel$maf+sel$maf2)</span></span>
<span id="cb11-95"><a href="good-vs-bad-gwas.html#cb11-95" aria-hidden="true" tabindex="-1"></a>mod2<span class="ot">=</span><span class="fu">lm</span>(sel<span class="sc">$</span>good_chisq<span class="sc">~</span>sel<span class="sc">$</span>r2_good)</span>
<span id="cb11-96"><a href="good-vs-bad-gwas.html#cb11-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-97"><a href="good-vs-bad-gwas.html#cb11-97" aria-hidden="true" tabindex="-1"></a>slope0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb11-98"><a href="good-vs-bad-gwas.html#cb11-98" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope_bad=</span><span class="fu">coef</span>(mod1)[<span class="dv">2</span>],</span>
<span id="cb11-99"><a href="good-vs-bad-gwas.html#cb11-99" aria-hidden="true" tabindex="-1"></a>                  <span class="at">p_bad=</span><span class="fu">summary</span>(mod1)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb11-100"><a href="good-vs-bad-gwas.html#cb11-100" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope_good=</span><span class="fu">coef</span>(mod2)[<span class="dv">2</span>],</span>
<span id="cb11-101"><a href="good-vs-bad-gwas.html#cb11-101" aria-hidden="true" tabindex="-1"></a>                  <span class="at">p_good=</span><span class="fu">summary</span>(mod2)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>],</span>
<span id="cb11-102"><a href="good-vs-bad-gwas.html#cb11-102" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb11-103"><a href="good-vs-bad-gwas.html#cb11-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-104"><a href="good-vs-bad-gwas.html#cb11-104" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){slope<span class="ot">=</span>slope0} <span class="cf">else</span> {slope<span class="ot">=</span><span class="fu">rbind</span>(slope,slope0)}</span>
<span id="cb11-105"><a href="good-vs-bad-gwas.html#cb11-105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-106"><a href="good-vs-bad-gwas.html#cb11-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-107"><a href="good-vs-bad-gwas.html#cb11-107" aria-hidden="true" tabindex="-1"></a>slope<span class="sc">$</span>good_div_n<span class="ot">=</span>slope<span class="sc">$</span>slope_good<span class="sc">/</span><span class="dv">100000</span></span>
<span id="cb11-108"><a href="good-vs-bad-gwas.html#cb11-108" aria-hidden="true" tabindex="-1"></a>slope<span class="sc">$</span>bad_div_n<span class="ot">=</span>slope<span class="sc">$</span>slope_bad<span class="sc">/</span><span class="dv">100000</span></span>
<span id="cb11-109"><a href="good-vs-bad-gwas.html#cb11-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-110"><a href="good-vs-bad-gwas.html#cb11-110" aria-hidden="true" tabindex="-1"></a><span class="co"># heritability estimates</span></span>
<span id="cb11-111"><a href="good-vs-bad-gwas.html#cb11-111" aria-hidden="true" tabindex="-1"></a>h2_gcta<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-gcta-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb11-112"><a href="good-vs-bad-gwas.html#cb11-112" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb11-113"><a href="good-vs-bad-gwas.html#cb11-113" aria-hidden="true" tabindex="-1"></a>h2_ldak<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&#39;summary/reml-ldak-thin-inflation-good-gwas.txt&#39;</span>, <span class="at">header=</span>T, </span>
<span id="cb11-114"><a href="good-vs-bad-gwas.html#cb11-114" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb11-115"><a href="good-vs-bad-gwas.html#cb11-115" aria-hidden="true" tabindex="-1"></a>h2<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>h2_gcta<span class="sc">$</span>code,<span class="at">gcta=</span>h2_gcta<span class="sc">$</span>all_est, <span class="at">ldak=</span>h2_ldak<span class="sc">$</span>all_est)</span>
<span id="cb11-116"><a href="good-vs-bad-gwas.html#cb11-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-117"><a href="good-vs-bad-gwas.html#cb11-117" aria-hidden="true" tabindex="-1"></a><span class="co"># together</span></span>
<span id="cb11-118"><a href="good-vs-bad-gwas.html#cb11-118" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span><span class="fu">match</span>(slope<span class="sc">$</span>trait,h2<span class="sc">$</span>trait)</span>
<span id="cb11-119"><a href="good-vs-bad-gwas.html#cb11-119" aria-hidden="true" tabindex="-1"></a>all<span class="ot">=</span><span class="fu">cbind</span>(slope,h2[m,<span class="sc">-</span><span class="dv">1</span>])</span></code></pre></div>
</div>
</div>
<div id="predict-inflation-aver2_j" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> predict inflation | aver2_j ?</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="good-vs-bad-gwas.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb12-2"><a href="good-vs-bad-gwas.html#cb12-2" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb12-3"><a href="good-vs-bad-gwas.html#cb12-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb12-4"><a href="good-vs-bad-gwas.html#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb12-5"><a href="good-vs-bad-gwas.html#cb12-5" aria-hidden="true" tabindex="-1"></a>trait<span class="ot">=</span>traits[<span class="dv">2</span>]</span>
<span id="cb12-6"><a href="good-vs-bad-gwas.html#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="good-vs-bad-gwas.html#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># putting info together</span></span>
<span id="cb12-8"><a href="good-vs-bad-gwas.html#cb12-8" aria-hidden="true" tabindex="-1"></a>file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>, trait, <span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>)</span>
<span id="cb12-9"><a href="good-vs-bad-gwas.html#cb12-9" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb12-10"><a href="good-vs-bad-gwas.html#cb12-10" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb12-11"><a href="good-vs-bad-gwas.html#cb12-11" aria-hidden="true" tabindex="-1"></a>r2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb12-12"><a href="good-vs-bad-gwas.html#cb12-12" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span><span class="fu">match</span>(r2<span class="sc">$</span>snp, dat<span class="sc">$</span>SNP)</span>
<span id="cb12-13"><a href="good-vs-bad-gwas.html#cb12-13" aria-hidden="true" tabindex="-1"></a>use<span class="ot">=</span><span class="fu">data.frame</span>(dat[m,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>)], r2[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>)])</span>
<span id="cb12-14"><a href="good-vs-bad-gwas.html#cb12-14" aria-hidden="true" tabindex="-1"></a>use<span class="ot">=</span>use[<span class="fu">complete.cases</span>(use),]</span>
<span id="cb12-15"><a href="good-vs-bad-gwas.html#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="good-vs-bad-gwas.html#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation</span></span>
<span id="cb12-17"><a href="good-vs-bad-gwas.html#cb12-17" aria-hidden="true" tabindex="-1"></a>use<span class="sc">$</span>inflation<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">-</span>use<span class="sc">$</span>good_chisq</span>
<span id="cb12-18"><a href="good-vs-bad-gwas.html#cb12-18" aria-hidden="true" tabindex="-1"></a>good<span class="ot">=</span><span class="fu">lm</span>(good_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb12-19"><a href="good-vs-bad-gwas.html#cb12-19" aria-hidden="true" tabindex="-1"></a>good_hat<span class="ot">=</span><span class="fu">predict</span>(good)</span>
<span id="cb12-20"><a href="good-vs-bad-gwas.html#cb12-20" aria-hidden="true" tabindex="-1"></a>bad<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>r2_bad, <span class="at">data=</span>use)</span>
<span id="cb12-21"><a href="good-vs-bad-gwas.html#cb12-21" aria-hidden="true" tabindex="-1"></a>bad_hat<span class="ot">=</span><span class="fu">predict</span>(bad)</span>
<span id="cb12-22"><a href="good-vs-bad-gwas.html#cb12-22" aria-hidden="true" tabindex="-1"></a>inflation_hat<span class="ot">=</span>bad_hat<span class="sc">-</span>good_hat</span>
<span id="cb12-23"><a href="good-vs-bad-gwas.html#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(inflation_hat,use<span class="sc">$</span>inflation) <span class="co"># 0.89</span></span>
<span id="cb12-24"><a href="good-vs-bad-gwas.html#cb12-24" aria-hidden="true" tabindex="-1"></a>use<span class="sc">$</span>inflation_hat<span class="ot">=</span>inflation_hat</span>
<span id="cb12-25"><a href="good-vs-bad-gwas.html#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="good-vs-bad-gwas.html#cb12-26" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span>use</span>
<span id="cb12-27"><a href="good-vs-bad-gwas.html#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="good-vs-bad-gwas.html#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co"># bin a variable by quantile</span></span>
<span id="cb12-29"><a href="good-vs-bad-gwas.html#cb12-29" aria-hidden="true" tabindex="-1"></a>cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>r2_bad, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb12-30"><a href="good-vs-bad-gwas.html#cb12-30" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>r2_bad, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb12-31"><a href="good-vs-bad-gwas.html#cb12-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-32"><a href="good-vs-bad-gwas.html#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co"># average chisq by bin values</span></span>
<span id="cb12-33"><a href="good-vs-bad-gwas.html#cb12-33" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean),</span>
<span id="cb12-34"><a href="good-vs-bad-gwas.html#cb12-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">inflation_hat_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation_hat,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb12-35"><a href="good-vs-bad-gwas.html#cb12-35" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>r2_bad,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb12-36"><a href="good-vs-bad-gwas.html#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="good-vs-bad-gwas.html#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co"># plot: inflation vs. inflation_hat ~ aver2 bin</span></span>
<span id="cb12-38"><a href="good-vs-bad-gwas.html#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/inflation-vs-predicted-aver2-bin-badgwas-bmi.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-39"><a href="good-vs-bad-gwas.html#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb12-40"><a href="good-vs-bad-gwas.html#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>inflation_ave,</span>
<span id="cb12-41"><a href="good-vs-bad-gwas.html#cb12-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation&quot;</span>,</span>
<span id="cb12-42"><a href="good-vs-bad-gwas.html#cb12-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb12-43"><a href="good-vs-bad-gwas.html#cb12-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-44"><a href="good-vs-bad-gwas.html#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>inflation_hat_ave, <span class="at">cex=</span><span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>)</span>
<span id="cb12-45"><a href="good-vs-bad-gwas.html#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb12-46"><a href="good-vs-bad-gwas.html#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="good-vs-bad-gwas.html#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="co"># plot: inflation vs. inflation_hat ~ aver2 raw</span></span>
<span id="cb12-48"><a href="good-vs-bad-gwas.html#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/inflation-vs-predicted-aver2-raw-badgwas-bmi.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-49"><a href="good-vs-bad-gwas.html#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb12-50"><a href="good-vs-bad-gwas.html#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>r2_bad, dat<span class="sc">$</span>inflation,</span>
<span id="cb12-51"><a href="good-vs-bad-gwas.html#cb12-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2 &quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation&quot;</span>,</span>
<span id="cb12-52"><a href="good-vs-bad-gwas.html#cb12-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb12-53"><a href="good-vs-bad-gwas.html#cb12-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-54"><a href="good-vs-bad-gwas.html#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>r2_bad, dat<span class="sc">$</span>inflation_hat, <span class="at">cex=</span><span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>)</span>
<span id="cb12-55"><a href="good-vs-bad-gwas.html#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb12-56"><a href="good-vs-bad-gwas.html#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="good-vs-bad-gwas.html#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="co"># plot: inflation vs. inflation_hat: ave</span></span>
<span id="cb12-58"><a href="good-vs-bad-gwas.html#cb12-58" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(out<span class="sc">$</span>inflation_ave,out<span class="sc">$</span>inflation_hat_ave))</span>
<span id="cb12-59"><a href="good-vs-bad-gwas.html#cb12-59" aria-hidden="true" tabindex="-1"></a>end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(out<span class="sc">$</span>inflation_ave,out<span class="sc">$</span>inflation_hat_ave))</span>
<span id="cb12-60"><a href="good-vs-bad-gwas.html#cb12-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-61"><a href="good-vs-bad-gwas.html#cb12-61" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/true-vs-predicted-inflation-ave.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-62"><a href="good-vs-bad-gwas.html#cb12-62" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb12-63"><a href="good-vs-bad-gwas.html#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>inflation_ave, out<span class="sc">$</span>inflation_hat_ave,</span>
<span id="cb12-64"><a href="good-vs-bad-gwas.html#cb12-64" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave inflation&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave inflation hat&quot;</span>,</span>
<span id="cb12-65"><a href="good-vs-bad-gwas.html#cb12-65" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot; bmi&quot;</span>, </span>
<span id="cb12-66"><a href="good-vs-bad-gwas.html#cb12-66" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb12-67"><a href="good-vs-bad-gwas.html#cb12-67" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-68"><a href="good-vs-bad-gwas.html#cb12-68" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb12-69"><a href="good-vs-bad-gwas.html#cb12-69" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out<span class="sc">$</span>inflation_ave, out<span class="sc">$</span>inflation_hat_ave,,<span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-70"><a href="good-vs-bad-gwas.html#cb12-70" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb12-71"><a href="good-vs-bad-gwas.html#cb12-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-72"><a href="good-vs-bad-gwas.html#cb12-72" aria-hidden="true" tabindex="-1"></a><span class="co"># plot: inflation vs. inflation_hat</span></span>
<span id="cb12-73"><a href="good-vs-bad-gwas.html#cb12-73" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(dat<span class="sc">$</span>inflation,dat<span class="sc">$</span>inflation_hat))</span>
<span id="cb12-74"><a href="good-vs-bad-gwas.html#cb12-74" aria-hidden="true" tabindex="-1"></a>end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(dat<span class="sc">$</span>inflation,dat<span class="sc">$</span>inflation_hat))</span>
<span id="cb12-75"><a href="good-vs-bad-gwas.html#cb12-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-76"><a href="good-vs-bad-gwas.html#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/true-vs-predicted-inflation.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-77"><a href="good-vs-bad-gwas.html#cb12-77" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb12-78"><a href="good-vs-bad-gwas.html#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>inflation, dat<span class="sc">$</span>inflation_hat,</span>
<span id="cb12-79"><a href="good-vs-bad-gwas.html#cb12-79" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave inflation&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave inflation hat&quot;</span>,</span>
<span id="cb12-80"><a href="good-vs-bad-gwas.html#cb12-80" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot; bmi&quot;</span>, </span>
<span id="cb12-81"><a href="good-vs-bad-gwas.html#cb12-81" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb12-82"><a href="good-vs-bad-gwas.html#cb12-82" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-83"><a href="good-vs-bad-gwas.html#cb12-83" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb12-84"><a href="good-vs-bad-gwas.html#cb12-84" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>inflation, dat<span class="sc">$</span>inflation_hat,<span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-85"><a href="good-vs-bad-gwas.html#cb12-85" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb12-86"><a href="good-vs-bad-gwas.html#cb12-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-87"><a href="good-vs-bad-gwas.html#cb12-87" aria-hidden="true" tabindex="-1"></a><span class="co">#..............</span></span>
<span id="cb12-88"><a href="good-vs-bad-gwas.html#cb12-88" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(use,<span class="st">&quot;summary/bmi-inflation.use&quot;</span>, <span class="at">col.names=</span>T, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span>
<span id="cb12-89"><a href="good-vs-bad-gwas.html#cb12-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-90"><a href="good-vs-bad-gwas.html#cb12-90" aria-hidden="true" tabindex="-1"></a><span class="do">## other things to try &amp; consider</span></span>
<span id="cb12-91"><a href="good-vs-bad-gwas.html#cb12-91" aria-hidden="true" tabindex="-1"></a>use<span class="sc">$</span>inflation<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">-</span>use<span class="sc">$</span>good_chisq</span>
<span id="cb12-92"><a href="good-vs-bad-gwas.html#cb12-92" aria-hidden="true" tabindex="-1"></a>mod1<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb12-93"><a href="good-vs-bad-gwas.html#cb12-93" aria-hidden="true" tabindex="-1"></a>mod2<span class="ot">=</span><span class="fu">lm</span>(good_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb12-94"><a href="good-vs-bad-gwas.html#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="good-vs-bad-gwas.html#cb12-95" aria-hidden="true" tabindex="-1"></a>e1<span class="ot">=</span><span class="fu">resid</span>(mod1)</span>
<span id="cb12-96"><a href="good-vs-bad-gwas.html#cb12-96" aria-hidden="true" tabindex="-1"></a>new_chisq<span class="ot">=</span>e1<span class="fl">+7.778390</span></span>
<span id="cb12-97"><a href="good-vs-bad-gwas.html#cb12-97" aria-hidden="true" tabindex="-1"></a>mod3<span class="ot">=</span><span class="fu">lm</span>(new_chisq <span class="sc">~</span> use<span class="sc">$</span>r2_bad )</span>
<span id="cb12-98"><a href="good-vs-bad-gwas.html#cb12-98" aria-hidden="true" tabindex="-1"></a>mod4<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>r2_bad, <span class="at">data=</span>use)</span>
<span id="cb12-99"><a href="good-vs-bad-gwas.html#cb12-99" aria-hidden="true" tabindex="-1"></a>mod5<span class="ot">=</span><span class="fu">lm</span>(inflation<span class="sc">~</span>r2_bad, <span class="at">data=</span>use)</span>
<span id="cb12-100"><a href="good-vs-bad-gwas.html#cb12-100" aria-hidden="true" tabindex="-1"></a>use<span class="sc">$</span>inflation_hat<span class="ot">=</span><span class="fu">predict</span>(mod3)</span>
<span id="cb12-101"><a href="good-vs-bad-gwas.html#cb12-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-102"><a href="good-vs-bad-gwas.html#cb12-102" aria-hidden="true" tabindex="-1"></a>mod6<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>r2_bad<span class="sc">+</span>ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb12-103"><a href="good-vs-bad-gwas.html#cb12-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-104"><a href="good-vs-bad-gwas.html#cb12-104" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span>use</span>
<span id="cb12-105"><a href="good-vs-bad-gwas.html#cb12-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-106"><a href="good-vs-bad-gwas.html#cb12-106" aria-hidden="true" tabindex="-1"></a><span class="co"># bin a variable by quantile</span></span>
<span id="cb12-107"><a href="good-vs-bad-gwas.html#cb12-107" aria-hidden="true" tabindex="-1"></a>cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>r2_bad, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb12-108"><a href="good-vs-bad-gwas.html#cb12-108" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>r2_bad, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb12-109"><a href="good-vs-bad-gwas.html#cb12-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-110"><a href="good-vs-bad-gwas.html#cb12-110" aria-hidden="true" tabindex="-1"></a><span class="co"># average chisq by bin values</span></span>
<span id="cb12-111"><a href="good-vs-bad-gwas.html#cb12-111" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean),</span>
<span id="cb12-112"><a href="good-vs-bad-gwas.html#cb12-112" aria-hidden="true" tabindex="-1"></a>               <span class="at">inflation_hat_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation_hat,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb12-113"><a href="good-vs-bad-gwas.html#cb12-113" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>r2_bad,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb12-114"><a href="good-vs-bad-gwas.html#cb12-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-115"><a href="good-vs-bad-gwas.html#cb12-115" aria-hidden="true" tabindex="-1"></a><span class="co"># plot: inflation vs. inflation_hat ~ aver2 bin</span></span>
<span id="cb12-116"><a href="good-vs-bad-gwas.html#cb12-116" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/inflation-vs-predicted-aver2-bin-badgwas-bmi.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-117"><a href="good-vs-bad-gwas.html#cb12-117" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb12-118"><a href="good-vs-bad-gwas.html#cb12-118" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>inflation_ave,</span>
<span id="cb12-119"><a href="good-vs-bad-gwas.html#cb12-119" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation&quot;</span>,</span>
<span id="cb12-120"><a href="good-vs-bad-gwas.html#cb12-120" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb12-121"><a href="good-vs-bad-gwas.html#cb12-121" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-122"><a href="good-vs-bad-gwas.html#cb12-122" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>inflation_hat_ave, <span class="at">cex=</span><span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>)</span>
<span id="cb12-123"><a href="good-vs-bad-gwas.html#cb12-123" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb12-124"><a href="good-vs-bad-gwas.html#cb12-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-125"><a href="good-vs-bad-gwas.html#cb12-125" aria-hidden="true" tabindex="-1"></a><span class="co"># plot: inflation vs. inflation_hat ~ aver2 raw</span></span>
<span id="cb12-126"><a href="good-vs-bad-gwas.html#cb12-126" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/inflation-vs-predicted-aver2-raw-badgwas-bmi.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-127"><a href="good-vs-bad-gwas.html#cb12-127" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb12-128"><a href="good-vs-bad-gwas.html#cb12-128" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>r2_bad, dat<span class="sc">$</span>inflation,</span>
<span id="cb12-129"><a href="good-vs-bad-gwas.html#cb12-129" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;ave r2 &quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation&quot;</span>,</span>
<span id="cb12-130"><a href="good-vs-bad-gwas.html#cb12-130" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb12-131"><a href="good-vs-bad-gwas.html#cb12-131" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-132"><a href="good-vs-bad-gwas.html#cb12-132" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>r2_bad, dat<span class="sc">$</span>inflation_hat, <span class="at">cex=</span><span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>)</span>
<span id="cb12-133"><a href="good-vs-bad-gwas.html#cb12-133" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb12-134"><a href="good-vs-bad-gwas.html#cb12-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-135"><a href="good-vs-bad-gwas.html#cb12-135" aria-hidden="true" tabindex="-1"></a><span class="co"># plot: inflation vs. inflation_hat: ave</span></span>
<span id="cb12-136"><a href="good-vs-bad-gwas.html#cb12-136" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(out<span class="sc">$</span>inflation_ave,out<span class="sc">$</span>inflation_hat_ave))</span>
<span id="cb12-137"><a href="good-vs-bad-gwas.html#cb12-137" aria-hidden="true" tabindex="-1"></a>end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(out<span class="sc">$</span>inflation_ave,out<span class="sc">$</span>inflation_hat_ave))</span>
<span id="cb12-138"><a href="good-vs-bad-gwas.html#cb12-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-139"><a href="good-vs-bad-gwas.html#cb12-139" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/true-vs-predicted-inflation-ave.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-140"><a href="good-vs-bad-gwas.html#cb12-140" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb12-141"><a href="good-vs-bad-gwas.html#cb12-141" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out<span class="sc">$</span>inflation_ave, out<span class="sc">$</span>inflation_hat_ave,</span>
<span id="cb12-142"><a href="good-vs-bad-gwas.html#cb12-142" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave inflation&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave inflation hat&quot;</span>,</span>
<span id="cb12-143"><a href="good-vs-bad-gwas.html#cb12-143" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot; bmi&quot;</span>, </span>
<span id="cb12-144"><a href="good-vs-bad-gwas.html#cb12-144" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb12-145"><a href="good-vs-bad-gwas.html#cb12-145" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-146"><a href="good-vs-bad-gwas.html#cb12-146" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb12-147"><a href="good-vs-bad-gwas.html#cb12-147" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out<span class="sc">$</span>inflation_ave, out<span class="sc">$</span>inflation_hat_ave,,<span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-148"><a href="good-vs-bad-gwas.html#cb12-148" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb12-149"><a href="good-vs-bad-gwas.html#cb12-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-150"><a href="good-vs-bad-gwas.html#cb12-150" aria-hidden="true" tabindex="-1"></a><span class="co"># plot: inflation vs. inflation_hat</span></span>
<span id="cb12-151"><a href="good-vs-bad-gwas.html#cb12-151" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(dat<span class="sc">$</span>inflation,dat<span class="sc">$</span>inflation_hat))</span>
<span id="cb12-152"><a href="good-vs-bad-gwas.html#cb12-152" aria-hidden="true" tabindex="-1"></a>end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(dat<span class="sc">$</span>inflation,dat<span class="sc">$</span>inflation_hat))</span>
<span id="cb12-153"><a href="good-vs-bad-gwas.html#cb12-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-154"><a href="good-vs-bad-gwas.html#cb12-154" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/true-vs-predicted-inflation.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-155"><a href="good-vs-bad-gwas.html#cb12-155" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb12-156"><a href="good-vs-bad-gwas.html#cb12-156" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>inflation, dat<span class="sc">$</span>inflation_hat,</span>
<span id="cb12-157"><a href="good-vs-bad-gwas.html#cb12-157" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;ave inflation&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave inflation hat&quot;</span>,</span>
<span id="cb12-158"><a href="good-vs-bad-gwas.html#cb12-158" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot; bmi&quot;</span>, </span>
<span id="cb12-159"><a href="good-vs-bad-gwas.html#cb12-159" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb12-160"><a href="good-vs-bad-gwas.html#cb12-160" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-161"><a href="good-vs-bad-gwas.html#cb12-161" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb12-162"><a href="good-vs-bad-gwas.html#cb12-162" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>inflation, dat<span class="sc">$</span>inflation_hat,<span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb12-163"><a href="good-vs-bad-gwas.html#cb12-163" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<div id="good_chisq-vs.-adj_chisq" class="section level3" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> good_chisq vs. adj_chisq</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="good-vs-bad-gwas.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb13-2"><a href="good-vs-bad-gwas.html#cb13-2" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb13-3"><a href="good-vs-bad-gwas.html#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb13-4"><a href="good-vs-bad-gwas.html#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb13-5"><a href="good-vs-bad-gwas.html#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="good-vs-bad-gwas.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/good_chisq-vs-adj_chisq.png&quot;</span>),</span>
<span id="cb13-7"><a href="good-vs-bad-gwas.html#cb13-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb13-8"><a href="good-vs-bad-gwas.html#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb13-9"><a href="good-vs-bad-gwas.html#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="good-vs-bad-gwas.html#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb13-11"><a href="good-vs-bad-gwas.html#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="good-vs-bad-gwas.html#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># putting info together</span></span>
<span id="cb13-13"><a href="good-vs-bad-gwas.html#cb13-13" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb13-14"><a href="good-vs-bad-gwas.html#cb13-14" aria-hidden="true" tabindex="-1"></a>  file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>, trait, <span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>)</span>
<span id="cb13-15"><a href="good-vs-bad-gwas.html#cb13-15" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb13-16"><a href="good-vs-bad-gwas.html#cb13-16" aria-hidden="true" tabindex="-1"></a>  sel<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb13-17"><a href="good-vs-bad-gwas.html#cb13-17" aria-hidden="true" tabindex="-1"></a>  r2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb13-18"><a href="good-vs-bad-gwas.html#cb13-18" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(r2<span class="sc">$</span>snp, dat<span class="sc">$</span>SNP)</span>
<span id="cb13-19"><a href="good-vs-bad-gwas.html#cb13-19" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span><span class="fu">data.frame</span>(dat[m,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>)], r2[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>)])</span>
<span id="cb13-20"><a href="good-vs-bad-gwas.html#cb13-20" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span>use[<span class="fu">complete.cases</span>(use),]</span>
<span id="cb13-21"><a href="good-vs-bad-gwas.html#cb13-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-22"><a href="good-vs-bad-gwas.html#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjust chisq</span></span>
<span id="cb13-23"><a href="good-vs-bad-gwas.html#cb13-23" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(bad_chisq <span class="sc">~</span> r2_bad, <span class="at">data=</span>use)</span>
<span id="cb13-24"><a href="good-vs-bad-gwas.html#cb13-24" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>adj_chisq<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">-</span>mod<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>use<span class="sc">$</span>r2_bad</span>
<span id="cb13-25"><a href="good-vs-bad-gwas.html#cb13-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-26"><a href="good-vs-bad-gwas.html#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb13-27"><a href="good-vs-bad-gwas.html#cb13-27" aria-hidden="true" tabindex="-1"></a>  start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(use<span class="sc">$</span>good_chisq,use<span class="sc">$</span>adj_chisq))</span>
<span id="cb13-28"><a href="good-vs-bad-gwas.html#cb13-28" aria-hidden="true" tabindex="-1"></a>  end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(use<span class="sc">$</span>good_chisq,use<span class="sc">$</span>adj_chisq))</span>
<span id="cb13-29"><a href="good-vs-bad-gwas.html#cb13-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-30"><a href="good-vs-bad-gwas.html#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(use<span class="sc">$</span>good_chisq, use<span class="sc">$</span>adj_chisq,  </span>
<span id="cb13-31"><a href="good-vs-bad-gwas.html#cb13-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">&quot;good_chisq&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;bad_chisq - b_hat * ave_r2&quot;</span>,</span>
<span id="cb13-32"><a href="good-vs-bad-gwas.html#cb13-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, </span>
<span id="cb13-33"><a href="good-vs-bad-gwas.html#cb13-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb13-34"><a href="good-vs-bad-gwas.html#cb13-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb13-35"><a href="good-vs-bad-gwas.html#cb13-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb13-36"><a href="good-vs-bad-gwas.html#cb13-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(use<span class="sc">$</span>good_chisq, use<span class="sc">$</span>adj_chisq, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb13-37"><a href="good-vs-bad-gwas.html#cb13-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-38"><a href="good-vs-bad-gwas.html#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="good-vs-bad-gwas.html#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="bad-gwas-inf.-vs.-inf._hat-raw" class="section level3" number="5.7.2">
<h3><span class="header-section-number">5.7.2</span> bad gwas: inf. vs. inf._hat: raw</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="good-vs-bad-gwas.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb14-2"><a href="good-vs-bad-gwas.html#cb14-2" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb14-3"><a href="good-vs-bad-gwas.html#cb14-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb14-4"><a href="good-vs-bad-gwas.html#cb14-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb14-5"><a href="good-vs-bad-gwas.html#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="good-vs-bad-gwas.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-vs-inflation-hat.png&quot;</span>),</span>
<span id="cb14-7"><a href="good-vs-bad-gwas.html#cb14-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb14-8"><a href="good-vs-bad-gwas.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb14-9"><a href="good-vs-bad-gwas.html#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="good-vs-bad-gwas.html#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb14-11"><a href="good-vs-bad-gwas.html#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="good-vs-bad-gwas.html#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># putting info together</span></span>
<span id="cb14-13"><a href="good-vs-bad-gwas.html#cb14-13" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb14-14"><a href="good-vs-bad-gwas.html#cb14-14" aria-hidden="true" tabindex="-1"></a>  file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>, trait, <span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>)</span>
<span id="cb14-15"><a href="good-vs-bad-gwas.html#cb14-15" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb14-16"><a href="good-vs-bad-gwas.html#cb14-16" aria-hidden="true" tabindex="-1"></a>  sel<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb14-17"><a href="good-vs-bad-gwas.html#cb14-17" aria-hidden="true" tabindex="-1"></a>  r2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb14-18"><a href="good-vs-bad-gwas.html#cb14-18" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(r2<span class="sc">$</span>snp, dat<span class="sc">$</span>SNP)</span>
<span id="cb14-19"><a href="good-vs-bad-gwas.html#cb14-19" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span><span class="fu">data.frame</span>(dat[m,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>)], r2[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>)])</span>
<span id="cb14-20"><a href="good-vs-bad-gwas.html#cb14-20" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span>use[<span class="fu">complete.cases</span>(use),]</span>
<span id="cb14-21"><a href="good-vs-bad-gwas.html#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="good-vs-bad-gwas.html#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inflation  </span></span>
<span id="cb14-23"><a href="good-vs-bad-gwas.html#cb14-23" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">-</span>use<span class="sc">$</span>good_chisq</span>
<span id="cb14-24"><a href="good-vs-bad-gwas.html#cb14-24" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb14-25"><a href="good-vs-bad-gwas.html#cb14-25" aria-hidden="true" tabindex="-1"></a>  new<span class="ot">=</span><span class="fu">resid</span>(mod1)<span class="sc">+</span>mod1<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb14-26"><a href="good-vs-bad-gwas.html#cb14-26" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(new<span class="sc">~</span>use<span class="sc">$</span>r2_bad)</span>
<span id="cb14-27"><a href="good-vs-bad-gwas.html#cb14-27" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation_hat<span class="ot">=</span><span class="fu">predict</span>(mod2)</span>
<span id="cb14-28"><a href="good-vs-bad-gwas.html#cb14-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-29"><a href="good-vs-bad-gwas.html#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot: inflation vs. inflation_hat</span></span>
<span id="cb14-30"><a href="good-vs-bad-gwas.html#cb14-30" aria-hidden="true" tabindex="-1"></a>  start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(use<span class="sc">$</span>inflation,use<span class="sc">$</span>inflation_hat))</span>
<span id="cb14-31"><a href="good-vs-bad-gwas.html#cb14-31" aria-hidden="true" tabindex="-1"></a>  end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(use<span class="sc">$</span>inflation,use<span class="sc">$</span>inflation_hat))</span>
<span id="cb14-32"><a href="good-vs-bad-gwas.html#cb14-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-33"><a href="good-vs-bad-gwas.html#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(use<span class="sc">$</span>inflation, use<span class="sc">$</span>inflation_hat,</span>
<span id="cb14-34"><a href="good-vs-bad-gwas.html#cb14-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">&quot;inflation&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation hat&quot;</span>,</span>
<span id="cb14-35"><a href="good-vs-bad-gwas.html#cb14-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, </span>
<span id="cb14-36"><a href="good-vs-bad-gwas.html#cb14-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb14-37"><a href="good-vs-bad-gwas.html#cb14-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb14-38"><a href="good-vs-bad-gwas.html#cb14-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb14-39"><a href="good-vs-bad-gwas.html#cb14-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb14-40"><a href="good-vs-bad-gwas.html#cb14-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb14-41"><a href="good-vs-bad-gwas.html#cb14-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(use<span class="sc">$</span>inflation, use<span class="sc">$</span>inflation_hat,<span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb14-42"><a href="good-vs-bad-gwas.html#cb14-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-43"><a href="good-vs-bad-gwas.html#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="good-vs-bad-gwas.html#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="bad-gwas-inf.-vs.-inf._hat-ave" class="section level3" number="5.7.3">
<h3><span class="header-section-number">5.7.3</span> bad gwas: inf. vs. inf._hat: ave</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="good-vs-bad-gwas.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb15-2"><a href="good-vs-bad-gwas.html#cb15-2" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb15-3"><a href="good-vs-bad-gwas.html#cb15-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb15-4"><a href="good-vs-bad-gwas.html#cb15-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb15-5"><a href="good-vs-bad-gwas.html#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="good-vs-bad-gwas.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-vs-inflation-hat-ave.png&quot;</span>),</span>
<span id="cb15-7"><a href="good-vs-bad-gwas.html#cb15-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb15-8"><a href="good-vs-bad-gwas.html#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb15-9"><a href="good-vs-bad-gwas.html#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="good-vs-bad-gwas.html#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb15-11"><a href="good-vs-bad-gwas.html#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="good-vs-bad-gwas.html#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># putting info together</span></span>
<span id="cb15-13"><a href="good-vs-bad-gwas.html#cb15-13" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb15-14"><a href="good-vs-bad-gwas.html#cb15-14" aria-hidden="true" tabindex="-1"></a>  file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>, trait, <span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>)</span>
<span id="cb15-15"><a href="good-vs-bad-gwas.html#cb15-15" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb15-16"><a href="good-vs-bad-gwas.html#cb15-16" aria-hidden="true" tabindex="-1"></a>  sel<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb15-17"><a href="good-vs-bad-gwas.html#cb15-17" aria-hidden="true" tabindex="-1"></a>  r2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb15-18"><a href="good-vs-bad-gwas.html#cb15-18" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(r2<span class="sc">$</span>snp, dat<span class="sc">$</span>SNP)</span>
<span id="cb15-19"><a href="good-vs-bad-gwas.html#cb15-19" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span><span class="fu">data.frame</span>(dat[m,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>)], r2[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>)])</span>
<span id="cb15-20"><a href="good-vs-bad-gwas.html#cb15-20" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span>use[<span class="fu">complete.cases</span>(use),]</span>
<span id="cb15-21"><a href="good-vs-bad-gwas.html#cb15-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-22"><a href="good-vs-bad-gwas.html#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inflation</span></span>
<span id="cb15-23"><a href="good-vs-bad-gwas.html#cb15-23" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">-</span>use<span class="sc">$</span>good_chisq</span>
<span id="cb15-24"><a href="good-vs-bad-gwas.html#cb15-24" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb15-25"><a href="good-vs-bad-gwas.html#cb15-25" aria-hidden="true" tabindex="-1"></a>  new<span class="ot">=</span><span class="fu">resid</span>(mod1)<span class="sc">+</span>mod1<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb15-26"><a href="good-vs-bad-gwas.html#cb15-26" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(new<span class="sc">~</span>use<span class="sc">$</span>r2_bad)</span>
<span id="cb15-27"><a href="good-vs-bad-gwas.html#cb15-27" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation_hat<span class="ot">=</span><span class="fu">predict</span>(mod2)</span>
<span id="cb15-28"><a href="good-vs-bad-gwas.html#cb15-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-29"><a href="good-vs-bad-gwas.html#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb15-30"><a href="good-vs-bad-gwas.html#cb15-30" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(use<span class="sc">$</span>r2_bad, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb15-31"><a href="good-vs-bad-gwas.html#cb15-31" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(use<span class="sc">$</span>r2_bad, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb15-32"><a href="good-vs-bad-gwas.html#cb15-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-33"><a href="good-vs-bad-gwas.html#cb15-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb15-34"><a href="good-vs-bad-gwas.html#cb15-34" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation_ave=</span><span class="fu">tapply</span>(use<span class="sc">$</span>inflation,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean),</span>
<span id="cb15-35"><a href="good-vs-bad-gwas.html#cb15-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inflation_hat_ave=</span><span class="fu">tapply</span>(use<span class="sc">$</span>inflation_hat,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean))</span>
<span id="cb15-36"><a href="good-vs-bad-gwas.html#cb15-36" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(use<span class="sc">$</span>r2_bad,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean)</span>
<span id="cb15-37"><a href="good-vs-bad-gwas.html#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="good-vs-bad-gwas.html#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb15-39"><a href="good-vs-bad-gwas.html#cb15-39" aria-hidden="true" tabindex="-1"></a>  start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(out<span class="sc">$</span>inflation_ave,out<span class="sc">$</span>inflation_hat_ave))</span>
<span id="cb15-40"><a href="good-vs-bad-gwas.html#cb15-40" aria-hidden="true" tabindex="-1"></a>  end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(out<span class="sc">$</span>inflation_ave,out<span class="sc">$</span>inflation_hat_ave))</span>
<span id="cb15-41"><a href="good-vs-bad-gwas.html#cb15-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-42"><a href="good-vs-bad-gwas.html#cb15-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>inflation_ave, out<span class="sc">$</span>inflation_hat_ave,</span>
<span id="cb15-43"><a href="good-vs-bad-gwas.html#cb15-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">&quot;ave inflation&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave inflation hat&quot;</span>,</span>
<span id="cb15-44"><a href="good-vs-bad-gwas.html#cb15-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, </span>
<span id="cb15-45"><a href="good-vs-bad-gwas.html#cb15-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb15-46"><a href="good-vs-bad-gwas.html#cb15-46" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb15-47"><a href="good-vs-bad-gwas.html#cb15-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb15-48"><a href="good-vs-bad-gwas.html#cb15-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb15-49"><a href="good-vs-bad-gwas.html#cb15-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb15-50"><a href="good-vs-bad-gwas.html#cb15-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(out<span class="sc">$</span>inflation_ave, out<span class="sc">$</span>inflation_hat_ave,<span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb15-51"><a href="good-vs-bad-gwas.html#cb15-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-52"><a href="good-vs-bad-gwas.html#cb15-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-53"><a href="good-vs-bad-gwas.html#cb15-53" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="bad-gwas-inf.-from-full-model" class="section level3" number="5.7.4">
<h3><span class="header-section-number">5.7.4</span> bad gwas: inf. from full model</h3>
<p>Here we estimate the inflation due to confounding from a full model. Basically, we added <span class="math inline">\(\overline{r^2_j}\)</span> as a predictor to the LD score regression to allow the inflation term to vary across SNPs by <span class="math inline">\(\overline{r^2_j}\)</span>. Here is the model:</p>
<p><span class="math inline">\(S_j = \beta_0 + \beta_1 \overline{r^2_j} + \beta_2 l_j + \epsilon_j\)</span></p>
<p>In this model, <span class="math inline">\(\hat{\beta_2} l_j\)</span> gives the estimated inflation due to polygenicity, and <span class="math inline">\(\hat{\beta_0} + \hat{\beta_1} \overline{r^2_j} -1\)</span> gives the estimated inflation due to confounding from population stratification. When a GWAS is free from confounding, <span class="math inline">\(\hat{\beta_0} + \hat{\beta_1} \overline{r^2_j} -1\)</span> should be very close to zero.</p>
<p>Using <span class="math inline">\(\hat{\beta_0} + \hat{\beta_1} \overline{r^2_j} -1\)</span> as an estimate of inflation makes sense. Here is the reasoning:
<span class="math inline">\(E(\delta_j) = E(S_j) - E(S&#39;_j)\)</span>, where <span class="math inline">\(S_j\)</span> and <span class="math inline">\(S&#39;_j\)</span> are chisq from bad and good gwas, respectively. Based on LDSC, <span class="math inline">\(E(S&#39;_j)= 1 + \beta&#39;_1l\)</span>, and <span class="math inline">\(E(S_j)\)</span> is based on the proposed method. But in real situations, we do not have <span class="math inline">\(S&#39;_j\)</span> to regress on <span class="math inline">\(l\)</span>. However, we noted that $S’_j= ’_0+ ’_1 l + ’_j $ and <span class="math inline">\(S_j= \beta_0+ \beta_1 l + \epsilon_j\)</span> have similar intercept estimate (i.e., <span class="math inline">\(\beta&#39;_1\)</span> and <span class="math inline">\(\beta_1\)</span> estimates are similar), and <span class="math inline">\(\beta&#39;_0\)</span> is close to 1. So we can basically get <span class="math inline">\(S&#39;_j\)</span> estimate by regressing <span class="math inline">\(S_j\)</span> on ldscore.</p>
<p>For traits where confounding is detected (i.e., all but snoring), the correlations between predicted inflation (from the model) and estimated inflation (chisq from bad gwas - chisq from good gwas) are moderate to high, ranging between 0.16 (pulse) to 0.93 (reaction). This indicates that the model is doing a good job of predicting inflation due to confounding when there is confounding. The predicted inflation given aver2 for each trait is summarized in the figure below.</p>
<p>We also adjusted the chisq from bad gwas by taking out the estimated inflation. The cor(adjusted chisq, good chisq) is low in general. The correlation is essentially the correlation between residuals from the model <span class="math inline">\(S_j = \beta_0 + \beta_1 \overline{r^2_j} + \beta_2 l_j + \epsilon_j\)</span> and the residuals from the model <span class="math inline">\(S&#39;_j = \beta&#39;_0 + \beta&#39;_1 l_j + \epsilon&#39;_j\)</span> (where <span class="math inline">\(S_j\)</span> and <span class="math inline">\(S&#39;_j\)</span> are chisq from bad and good GWASs, respectively). See table below.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="good-vs-bad-gwas.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb16-2"><a href="good-vs-bad-gwas.html#cb16-2" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb16-3"><a href="good-vs-bad-gwas.html#cb16-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb16-4"><a href="good-vs-bad-gwas.html#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb16-5"><a href="good-vs-bad-gwas.html#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="good-vs-bad-gwas.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-vs-inflation-hat-full-mod.png&quot;</span>),</span>
<span id="cb16-7"><a href="good-vs-bad-gwas.html#cb16-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb16-8"><a href="good-vs-bad-gwas.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb16-9"><a href="good-vs-bad-gwas.html#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="good-vs-bad-gwas.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb16-11"><a href="good-vs-bad-gwas.html#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="good-vs-bad-gwas.html#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># putting info together</span></span>
<span id="cb16-13"><a href="good-vs-bad-gwas.html#cb16-13" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb16-14"><a href="good-vs-bad-gwas.html#cb16-14" aria-hidden="true" tabindex="-1"></a>  file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>, trait, <span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>)</span>
<span id="cb16-15"><a href="good-vs-bad-gwas.html#cb16-15" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb16-16"><a href="good-vs-bad-gwas.html#cb16-16" aria-hidden="true" tabindex="-1"></a>  sel<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-17"><a href="good-vs-bad-gwas.html#cb16-17" aria-hidden="true" tabindex="-1"></a>  r2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb16-18"><a href="good-vs-bad-gwas.html#cb16-18" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(r2<span class="sc">$</span>snp, dat<span class="sc">$</span>SNP)</span>
<span id="cb16-19"><a href="good-vs-bad-gwas.html#cb16-19" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span><span class="fu">data.frame</span>(dat[m,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>)], r2[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>)])</span>
<span id="cb16-20"><a href="good-vs-bad-gwas.html#cb16-20" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span>use[<span class="fu">complete.cases</span>(use),]</span>
<span id="cb16-21"><a href="good-vs-bad-gwas.html#cb16-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-22"><a href="good-vs-bad-gwas.html#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inflation</span></span>
<span id="cb16-23"><a href="good-vs-bad-gwas.html#cb16-23" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">-</span>use<span class="sc">$</span>good_chisq</span>
<span id="cb16-24"><a href="good-vs-bad-gwas.html#cb16-24" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>r2_bad <span class="sc">+</span> ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb16-25"><a href="good-vs-bad-gwas.html#cb16-25" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation_hat <span class="ot">=</span> mod<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>use<span class="sc">$</span>r2_bad<span class="dv">-1</span></span>
<span id="cb16-26"><a href="good-vs-bad-gwas.html#cb16-26" aria-hidden="true" tabindex="-1"></a>  r<span class="ot">=</span><span class="fu">round</span>(<span class="fu">cor</span>(use<span class="sc">$</span>inflation, use<span class="sc">$</span>inflation_hat),<span class="dv">2</span>)</span>
<span id="cb16-27"><a href="good-vs-bad-gwas.html#cb16-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-28"><a href="good-vs-bad-gwas.html#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot inflation vs. inflation hat</span></span>
<span id="cb16-29"><a href="good-vs-bad-gwas.html#cb16-29" aria-hidden="true" tabindex="-1"></a>  start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(use<span class="sc">$</span>inflation,use<span class="sc">$</span>inflation_hat))</span>
<span id="cb16-30"><a href="good-vs-bad-gwas.html#cb16-30" aria-hidden="true" tabindex="-1"></a>  end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(use<span class="sc">$</span>inflation,use<span class="sc">$</span>inflation_hat))</span>
<span id="cb16-31"><a href="good-vs-bad-gwas.html#cb16-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-32"><a href="good-vs-bad-gwas.html#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(use<span class="sc">$</span>inflation, use<span class="sc">$</span>inflation_hat,</span>
<span id="cb16-33"><a href="good-vs-bad-gwas.html#cb16-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">&quot;inflation (= bad-good chisq)&quot;</span>, </span>
<span id="cb16-34"><a href="good-vs-bad-gwas.html#cb16-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab=</span><span class="st">&quot;inflation_hat (from the full model)&quot;</span>,</span>
<span id="cb16-35"><a href="good-vs-bad-gwas.html#cb16-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, </span>
<span id="cb16-36"><a href="good-vs-bad-gwas.html#cb16-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb16-37"><a href="good-vs-bad-gwas.html#cb16-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb16-38"><a href="good-vs-bad-gwas.html#cb16-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb16-39"><a href="good-vs-bad-gwas.html#cb16-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb16-40"><a href="good-vs-bad-gwas.html#cb16-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb16-41"><a href="good-vs-bad-gwas.html#cb16-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(start, end, <span class="fu">paste0</span>(<span class="st">&quot;r = &quot;</span>, r), <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb16-42"><a href="good-vs-bad-gwas.html#cb16-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-43"><a href="good-vs-bad-gwas.html#cb16-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-44"><a href="good-vs-bad-gwas.html#cb16-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-45"><a href="good-vs-bad-gwas.html#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb16-46"><a href="good-vs-bad-gwas.html#cb16-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-47"><a href="good-vs-bad-gwas.html#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="co"># ave inflation ~ aver2 --------------------------------------------------------</span></span>
<span id="cb16-48"><a href="good-vs-bad-gwas.html#cb16-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-49"><a href="good-vs-bad-gwas.html#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb16-50"><a href="good-vs-bad-gwas.html#cb16-50" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb16-51"><a href="good-vs-bad-gwas.html#cb16-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb16-52"><a href="good-vs-bad-gwas.html#cb16-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb16-53"><a href="good-vs-bad-gwas.html#cb16-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-54"><a href="good-vs-bad-gwas.html#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-hat-by-aver2-bin.png&quot;</span>),</span>
<span id="cb16-55"><a href="good-vs-bad-gwas.html#cb16-55" aria-hidden="true" tabindex="-1"></a>     <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb16-56"><a href="good-vs-bad-gwas.html#cb16-56" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb16-57"><a href="good-vs-bad-gwas.html#cb16-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-58"><a href="good-vs-bad-gwas.html#cb16-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb16-59"><a href="good-vs-bad-gwas.html#cb16-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-60"><a href="good-vs-bad-gwas.html#cb16-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># putting info together</span></span>
<span id="cb16-61"><a href="good-vs-bad-gwas.html#cb16-61" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb16-62"><a href="good-vs-bad-gwas.html#cb16-62" aria-hidden="true" tabindex="-1"></a>  file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>, trait, <span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>)</span>
<span id="cb16-63"><a href="good-vs-bad-gwas.html#cb16-63" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb16-64"><a href="good-vs-bad-gwas.html#cb16-64" aria-hidden="true" tabindex="-1"></a>  sel<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-65"><a href="good-vs-bad-gwas.html#cb16-65" aria-hidden="true" tabindex="-1"></a>  r2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb16-66"><a href="good-vs-bad-gwas.html#cb16-66" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(r2<span class="sc">$</span>snp, dat<span class="sc">$</span>SNP)</span>
<span id="cb16-67"><a href="good-vs-bad-gwas.html#cb16-67" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span><span class="fu">data.frame</span>(dat[m,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>)], r2[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>)])</span>
<span id="cb16-68"><a href="good-vs-bad-gwas.html#cb16-68" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span>use[<span class="fu">complete.cases</span>(use),]</span>
<span id="cb16-69"><a href="good-vs-bad-gwas.html#cb16-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-70"><a href="good-vs-bad-gwas.html#cb16-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inflation</span></span>
<span id="cb16-71"><a href="good-vs-bad-gwas.html#cb16-71" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">-</span>use<span class="sc">$</span>good_chisq</span>
<span id="cb16-72"><a href="good-vs-bad-gwas.html#cb16-72" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>r2_bad <span class="sc">+</span> ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb16-73"><a href="good-vs-bad-gwas.html#cb16-73" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation_hat <span class="ot">=</span> mod<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>use<span class="sc">$</span>r2_bad<span class="dv">-1</span></span>
<span id="cb16-74"><a href="good-vs-bad-gwas.html#cb16-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-75"><a href="good-vs-bad-gwas.html#cb16-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb16-76"><a href="good-vs-bad-gwas.html#cb16-76" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(use<span class="sc">$</span>r2_bad, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb16-77"><a href="good-vs-bad-gwas.html#cb16-77" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(use<span class="sc">$</span>r2_bad, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb16-78"><a href="good-vs-bad-gwas.html#cb16-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-79"><a href="good-vs-bad-gwas.html#cb16-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb16-80"><a href="good-vs-bad-gwas.html#cb16-80" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation_ave=</span><span class="fu">tapply</span>(use<span class="sc">$</span>inflation,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean),</span>
<span id="cb16-81"><a href="good-vs-bad-gwas.html#cb16-81" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inflation_hat_ave=</span><span class="fu">tapply</span>(use<span class="sc">$</span>inflation_hat,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean))</span>
<span id="cb16-82"><a href="good-vs-bad-gwas.html#cb16-82" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(use<span class="sc">$</span>r2_bad,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean)</span>
<span id="cb16-83"><a href="good-vs-bad-gwas.html#cb16-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-84"><a href="good-vs-bad-gwas.html#cb16-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb16-85"><a href="good-vs-bad-gwas.html#cb16-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>inflation_ave,</span>
<span id="cb16-86"><a href="good-vs-bad-gwas.html#cb16-86" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab=</span><span class="st">&quot;mean inflation&quot;</span>, <span class="at">xlab=</span><span class="st">&quot; aver2 bin&quot;</span>,</span>
<span id="cb16-87"><a href="good-vs-bad-gwas.html#cb16-87" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb16-88"><a href="good-vs-bad-gwas.html#cb16-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>inflation_hat_ave, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb16-89"><a href="good-vs-bad-gwas.html#cb16-89" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-90"><a href="good-vs-bad-gwas.html#cb16-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-91"><a href="good-vs-bad-gwas.html#cb16-91" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb16-92"><a href="good-vs-bad-gwas.html#cb16-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-93"><a href="good-vs-bad-gwas.html#cb16-93" aria-hidden="true" tabindex="-1"></a><span class="co"># extract relevant output----------------------------------------------------------------</span></span>
<span id="cb16-94"><a href="good-vs-bad-gwas.html#cb16-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-95"><a href="good-vs-bad-gwas.html#cb16-95" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb16-96"><a href="good-vs-bad-gwas.html#cb16-96" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb16-97"><a href="good-vs-bad-gwas.html#cb16-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb16-98"><a href="good-vs-bad-gwas.html#cb16-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb16-99"><a href="good-vs-bad-gwas.html#cb16-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-100"><a href="good-vs-bad-gwas.html#cb16-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-101"><a href="good-vs-bad-gwas.html#cb16-101" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb16-102"><a href="good-vs-bad-gwas.html#cb16-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-103"><a href="good-vs-bad-gwas.html#cb16-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># putting info together</span></span>
<span id="cb16-104"><a href="good-vs-bad-gwas.html#cb16-104" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb16-105"><a href="good-vs-bad-gwas.html#cb16-105" aria-hidden="true" tabindex="-1"></a>  file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>, trait, <span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>)</span>
<span id="cb16-106"><a href="good-vs-bad-gwas.html#cb16-106" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb16-107"><a href="good-vs-bad-gwas.html#cb16-107" aria-hidden="true" tabindex="-1"></a>  sel<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-108"><a href="good-vs-bad-gwas.html#cb16-108" aria-hidden="true" tabindex="-1"></a>  r2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb16-109"><a href="good-vs-bad-gwas.html#cb16-109" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(r2<span class="sc">$</span>snp, dat<span class="sc">$</span>SNP)</span>
<span id="cb16-110"><a href="good-vs-bad-gwas.html#cb16-110" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span><span class="fu">data.frame</span>(dat[m,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>)], r2[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>)])</span>
<span id="cb16-111"><a href="good-vs-bad-gwas.html#cb16-111" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span>use[<span class="fu">complete.cases</span>(use),]</span>
<span id="cb16-112"><a href="good-vs-bad-gwas.html#cb16-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-113"><a href="good-vs-bad-gwas.html#cb16-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inflation</span></span>
<span id="cb16-114"><a href="good-vs-bad-gwas.html#cb16-114" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>r2_bad <span class="sc">+</span> ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb16-115"><a href="good-vs-bad-gwas.html#cb16-115" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>chisq_adj <span class="ot">=</span> use<span class="sc">$</span>bad_chisq<span class="sc">-</span>(mod<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>use<span class="sc">$</span>r2_bad<span class="dv">-1</span>)</span>
<span id="cb16-116"><a href="good-vs-bad-gwas.html#cb16-116" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>chisq_adj2<span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>(mod<span class="sc">$</span>coefficients[<span class="dv">3</span>]<span class="sc">*</span>use<span class="sc">$</span>ldsc_ref)</span>
<span id="cb16-117"><a href="good-vs-bad-gwas.html#cb16-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-118"><a href="good-vs-bad-gwas.html#cb16-118" aria-hidden="true" tabindex="-1"></a>  r<span class="ot">=</span><span class="fu">round</span>(<span class="fu">cor</span>(use<span class="sc">$</span>good_chisq, use<span class="sc">$</span>chisq_adj),<span class="dv">3</span>)</span>
<span id="cb16-119"><a href="good-vs-bad-gwas.html#cb16-119" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>p_bad<span class="ot">=</span><span class="fu">pchisq</span>(use<span class="sc">$</span>bad_chisq,<span class="dv">1</span>, <span class="at">lower.tail=</span>F)</span>
<span id="cb16-120"><a href="good-vs-bad-gwas.html#cb16-120" aria-hidden="true" tabindex="-1"></a>  threshold<span class="ot">=</span><span class="dv">5</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span></span>
<span id="cb16-121"><a href="good-vs-bad-gwas.html#cb16-121" aria-hidden="true" tabindex="-1"></a>  sel<span class="ot">=</span>use[use<span class="sc">$</span>p_bad<span class="sc">&lt;=</span>threshold,] <span class="co"># significant gwas chisq only</span></span>
<span id="cb16-122"><a href="good-vs-bad-gwas.html#cb16-122" aria-hidden="true" tabindex="-1"></a>  r2<span class="ot">=</span><span class="fu">round</span>(<span class="fu">cor</span>(sel<span class="sc">$</span>good_chisq, sel<span class="sc">$</span>chisq_adj),<span class="dv">3</span>)</span>
<span id="cb16-123"><a href="good-vs-bad-gwas.html#cb16-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-124"><a href="good-vs-bad-gwas.html#cb16-124" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot inflation vs. inflation hat</span></span>
<span id="cb16-125"><a href="good-vs-bad-gwas.html#cb16-125" aria-hidden="true" tabindex="-1"></a>  start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(use<span class="sc">$</span>good_chisq,use<span class="sc">$</span>chisq_adj))</span>
<span id="cb16-126"><a href="good-vs-bad-gwas.html#cb16-126" aria-hidden="true" tabindex="-1"></a>  end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(use<span class="sc">$</span>good_chisq,use<span class="sc">$</span>chisq_adj))</span>
<span id="cb16-127"><a href="good-vs-bad-gwas.html#cb16-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-128"><a href="good-vs-bad-gwas.html#cb16-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(use<span class="sc">$</span>good_chisq,use<span class="sc">$</span>chisq_adj,</span>
<span id="cb16-129"><a href="good-vs-bad-gwas.html#cb16-129" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">&quot;chisq from good gwas&quot;</span>, </span>
<span id="cb16-130"><a href="good-vs-bad-gwas.html#cb16-130" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab=</span><span class="st">&quot;adjusted chisq from bad gwas&quot;</span>,</span>
<span id="cb16-131"><a href="good-vs-bad-gwas.html#cb16-131" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, </span>
<span id="cb16-132"><a href="good-vs-bad-gwas.html#cb16-132" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb16-133"><a href="good-vs-bad-gwas.html#cb16-133" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb16-134"><a href="good-vs-bad-gwas.html#cb16-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;gray&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb16-135"><a href="good-vs-bad-gwas.html#cb16-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(start, end, <span class="fu">paste0</span>(<span class="st">&quot;r = &quot;</span>, r), <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb16-136"><a href="good-vs-bad-gwas.html#cb16-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(sel<span class="sc">$</span>good_chisq,sel<span class="sc">$</span>chisq_adj,</span>
<span id="cb16-137"><a href="good-vs-bad-gwas.html#cb16-137" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;orange&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb16-138"><a href="good-vs-bad-gwas.html#cb16-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-139"><a href="good-vs-bad-gwas.html#cb16-139" aria-hidden="true" tabindex="-1"></a>  <span class="co"># collect output</span></span>
<span id="cb16-140"><a href="good-vs-bad-gwas.html#cb16-140" aria-hidden="true" tabindex="-1"></a>  out0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,<span class="at">r_all=</span>r, <span class="at">r_sig=</span>r2)</span>
<span id="cb16-141"><a href="good-vs-bad-gwas.html#cb16-141" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){out<span class="ot">=</span>out0} <span class="cf">else</span> {out<span class="ot">=</span><span class="fu">rbind</span>(out,out0)}</span>
<span id="cb16-142"><a href="good-vs-bad-gwas.html#cb16-142" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-143"><a href="good-vs-bad-gwas.html#cb16-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-144"><a href="good-vs-bad-gwas.html#cb16-144" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="to-explore-change" class="section level3" number="5.7.5">
<h3><span class="header-section-number">5.7.5</span> To Explore: change??</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="good-vs-bad-gwas.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb17-2"><a href="good-vs-bad-gwas.html#cb17-2" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb17-3"><a href="good-vs-bad-gwas.html#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb17-4"><a href="good-vs-bad-gwas.html#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb17-5"><a href="good-vs-bad-gwas.html#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="good-vs-bad-gwas.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#png(paste0(&quot;fig/inflation-vs-inflation-hat-ave-full-mod.png&quot;),</span></span>
<span id="cb17-7"><a href="good-vs-bad-gwas.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     width = 50, height = 30, units = &quot;cm&quot;, res=600)</span></span>
<span id="cb17-8"><a href="good-vs-bad-gwas.html#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#par(mfrow=c(3,5), cex.lab=1.2, font.lab=2, cex.main=1.5, pty=&quot;s&quot;)</span></span>
<span id="cb17-9"><a href="good-vs-bad-gwas.html#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="good-vs-bad-gwas.html#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb17-11"><a href="good-vs-bad-gwas.html#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="good-vs-bad-gwas.html#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># putting info together</span></span>
<span id="cb17-13"><a href="good-vs-bad-gwas.html#cb17-13" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb17-14"><a href="good-vs-bad-gwas.html#cb17-14" aria-hidden="true" tabindex="-1"></a>  file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>, trait, <span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>)</span>
<span id="cb17-15"><a href="good-vs-bad-gwas.html#cb17-15" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb17-16"><a href="good-vs-bad-gwas.html#cb17-16" aria-hidden="true" tabindex="-1"></a>  sel<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb17-17"><a href="good-vs-bad-gwas.html#cb17-17" aria-hidden="true" tabindex="-1"></a>  r2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb17-18"><a href="good-vs-bad-gwas.html#cb17-18" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(r2<span class="sc">$</span>snp, dat<span class="sc">$</span>SNP)</span>
<span id="cb17-19"><a href="good-vs-bad-gwas.html#cb17-19" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span><span class="fu">data.frame</span>(dat[m,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>)], r2[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>)])</span>
<span id="cb17-20"><a href="good-vs-bad-gwas.html#cb17-20" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span>use[<span class="fu">complete.cases</span>(use),]</span>
<span id="cb17-21"><a href="good-vs-bad-gwas.html#cb17-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-22"><a href="good-vs-bad-gwas.html#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inflation</span></span>
<span id="cb17-23"><a href="good-vs-bad-gwas.html#cb17-23" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">-</span>use<span class="sc">$</span>good_chisq</span>
<span id="cb17-24"><a href="good-vs-bad-gwas.html#cb17-24" aria-hidden="true" tabindex="-1"></a>  mod0<span class="ot">=</span><span class="fu">lm</span>(good_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb17-25"><a href="good-vs-bad-gwas.html#cb17-25" aria-hidden="true" tabindex="-1"></a>  adj_chisq0<span class="ot">=</span>use<span class="sc">$</span>good_chisq<span class="sc">-</span>(mod0<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb17-26"><a href="good-vs-bad-gwas.html#cb17-26" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb17-27"><a href="good-vs-bad-gwas.html#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjustment by ldsc</span></span>
<span id="cb17-28"><a href="good-vs-bad-gwas.html#cb17-28" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb17-29"><a href="good-vs-bad-gwas.html#cb17-29" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(good_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb17-30"><a href="good-vs-bad-gwas.html#cb17-30" aria-hidden="true" tabindex="-1"></a>  chisq1<span class="ot">=</span><span class="dv">1</span><span class="sc">+</span>mod1<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>use<span class="sc">$</span>ldsc</span>
<span id="cb17-31"><a href="good-vs-bad-gwas.html#cb17-31" aria-hidden="true" tabindex="-1"></a>  chisq2<span class="ot">=</span>mod2<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod2<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>use<span class="sc">$</span>ldsc</span>
<span id="cb17-32"><a href="good-vs-bad-gwas.html#cb17-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(chisq1,chisq2)</span>
<span id="cb17-33"><a href="good-vs-bad-gwas.html#cb17-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-34"><a href="good-vs-bad-gwas.html#cb17-34" aria-hidden="true" tabindex="-1"></a>  adj_chisq1<span class="ot">=</span><span class="dv">1</span><span class="sc">+</span>mod1<span class="sc">$</span>coefficients[<span class="dv">1</span>]</span>
<span id="cb17-35"><a href="good-vs-bad-gwas.html#cb17-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-36"><a href="good-vs-bad-gwas.html#cb17-36" aria-hidden="true" tabindex="-1"></a>  adj_chisq1<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">-</span>(mod1<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb17-37"><a href="good-vs-bad-gwas.html#cb17-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(use<span class="sc">$</span>good_chisq, adj_chisq1)</span>
<span id="cb17-38"><a href="good-vs-bad-gwas.html#cb17-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-39"><a href="good-vs-bad-gwas.html#cb17-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjustment by new method</span></span>
<span id="cb17-40"><a href="good-vs-bad-gwas.html#cb17-40" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>r2_bad <span class="sc">+</span> ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb17-41"><a href="good-vs-bad-gwas.html#cb17-41" aria-hidden="true" tabindex="-1"></a>  adj_chisq2<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">-</span>(mod2<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod2<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>use<span class="sc">$</span>r2_bad<span class="dv">-1</span>)</span>
<span id="cb17-42"><a href="good-vs-bad-gwas.html#cb17-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(use<span class="sc">$</span>good_chisq, adj_chisq2)</span>
<span id="cb17-43"><a href="good-vs-bad-gwas.html#cb17-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-44"><a href="good-vs-bad-gwas.html#cb17-44" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">-</span>use<span class="sc">$</span>good_chisq</span>
<span id="cb17-45"><a href="good-vs-bad-gwas.html#cb17-45" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(use<span class="sc">$</span>inflation <span class="sc">~</span> <span class="fu">poly</span>(use<span class="sc">$</span>ldsc_ref,<span class="dv">2</span>) )</span>
<span id="cb17-46"><a href="good-vs-bad-gwas.html#cb17-46" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(use<span class="sc">$</span>inflation <span class="sc">~</span> use<span class="sc">$</span>ldsc_ref <span class="sc">+</span> <span class="fu">poly</span>(use<span class="sc">$</span>r2_bad,<span class="dv">2</span>) <span class="sc">+</span> use<span class="sc">$</span>ldsc_ref <span class="sc">*</span> <span class="fu">poly</span>(use<span class="sc">$</span>r2_bad,<span class="dv">2</span>) <span class="sc">+</span> <span class="fu">poly</span>(use<span class="sc">$</span>maf,<span class="dv">2</span>)<span class="sc">*</span>use<span class="sc">$</span>r2_bad )</span>
<span id="cb17-47"><a href="good-vs-bad-gwas.html#cb17-47" aria-hidden="true" tabindex="-1"></a>  mod3<span class="ot">=</span><span class="fu">lm</span>(use<span class="sc">$</span>inflation <span class="sc">~</span> use<span class="sc">$</span>ldsc_ref <span class="sc">+</span> use<span class="sc">$</span>r2_bad <span class="sc">+</span> use<span class="sc">$</span>maf)</span>
<span id="cb17-48"><a href="good-vs-bad-gwas.html#cb17-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-49"><a href="good-vs-bad-gwas.html#cb17-49" aria-hidden="true" tabindex="-1"></a>  mod5<span class="ot">=</span><span class="fu">lm</span>(use<span class="sc">$</span>good_chisq <span class="sc">~</span> use<span class="sc">$</span>r2_bad)</span>
<span id="cb17-50"><a href="good-vs-bad-gwas.html#cb17-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-51"><a href="good-vs-bad-gwas.html#cb17-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># quantiles</span></span>
<span id="cb17-52"><a href="good-vs-bad-gwas.html#cb17-52" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">good=</span>use<span class="sc">$</span>good_chisq,</span>
<span id="cb17-53"><a href="good-vs-bad-gwas.html#cb17-53" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bad=</span>use<span class="sc">$</span>bad_chisq,</span>
<span id="cb17-54"><a href="good-vs-bad-gwas.html#cb17-54" aria-hidden="true" tabindex="-1"></a>                 <span class="at">adj_ldsc=</span>adj_chisq1,</span>
<span id="cb17-55"><a href="good-vs-bad-gwas.html#cb17-55" aria-hidden="true" tabindex="-1"></a>                 <span class="at">adj_aver2=</span>adj_chisq2)</span>
<span id="cb17-56"><a href="good-vs-bad-gwas.html#cb17-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-57"><a href="good-vs-bad-gwas.html#cb17-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># false positives</span></span>
<span id="cb17-58"><a href="good-vs-bad-gwas.html#cb17-58" aria-hidden="true" tabindex="-1"></a>  sel<span class="ot">=</span>use<span class="sc">$</span>bad_chisq<span class="sc">&gt;</span><span class="fu">qchisq</span>(<span class="dv">1-5</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span>,<span class="dv">1</span>,<span class="at">lower.tail=</span>T) <span class="sc">&amp;</span> use<span class="sc">$</span>good_chisq<span class="sc">&lt;</span><span class="fu">qchisq</span>(<span class="dv">1-5</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span>,<span class="dv">1</span>,<span class="at">lower.tail=</span>T)</span>
<span id="cb17-59"><a href="good-vs-bad-gwas.html#cb17-59" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span>out[sel,]</span>
<span id="cb17-60"><a href="good-vs-bad-gwas.html#cb17-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(out<span class="sc">$</span>good, out<span class="sc">$</span>adj_aver2)</span>
<span id="cb17-61"><a href="good-vs-bad-gwas.html#cb17-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(out<span class="sc">$</span>good, out<span class="sc">$</span>adj_ldsc)</span>
<span id="cb17-62"><a href="good-vs-bad-gwas.html#cb17-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-63"><a href="good-vs-bad-gwas.html#cb17-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-64"><a href="good-vs-bad-gwas.html#cb17-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb17-65"><a href="good-vs-bad-gwas.html#cb17-65" aria-hidden="true" tabindex="-1"></a>  qq<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">good=</span><span class="fu">quantile</span>(out<span class="sc">$</span>good, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>), <span class="at">na.rm=</span>T),</span>
<span id="cb17-66"><a href="good-vs-bad-gwas.html#cb17-66" aria-hidden="true" tabindex="-1"></a>                <span class="at">bad=</span><span class="fu">quantile</span>(out<span class="sc">$</span>bad, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>), <span class="at">na.rm=</span>T),</span>
<span id="cb17-67"><a href="good-vs-bad-gwas.html#cb17-67" aria-hidden="true" tabindex="-1"></a>                <span class="at">adj_ldsc=</span><span class="fu">quantile</span>(out<span class="sc">$</span>adj_ldsc, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>), <span class="at">na.rm=</span>T),</span>
<span id="cb17-68"><a href="good-vs-bad-gwas.html#cb17-68" aria-hidden="true" tabindex="-1"></a>                <span class="at">adj_aver2=</span><span class="fu">quantile</span>(out<span class="sc">$</span>adj_aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>), <span class="at">na.rm=</span>T))</span>
<span id="cb17-69"><a href="good-vs-bad-gwas.html#cb17-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-70"><a href="good-vs-bad-gwas.html#cb17-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-71"><a href="good-vs-bad-gwas.html#cb17-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-72"><a href="good-vs-bad-gwas.html#cb17-72" aria-hidden="true" tabindex="-1"></a>  mod0_pred<span class="ot">=</span>mod0<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod0<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>use<span class="sc">$</span>ldsc_ref</span>
<span id="cb17-73"><a href="good-vs-bad-gwas.html#cb17-73" aria-hidden="true" tabindex="-1"></a>  mod1_pred<span class="ot">=</span>mod1<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod1<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>use<span class="sc">$</span>ldsc_ref</span>
<span id="cb17-74"><a href="good-vs-bad-gwas.html#cb17-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-75"><a href="good-vs-bad-gwas.html#cb17-75" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>r2_bad <span class="sc">+</span> ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb17-76"><a href="good-vs-bad-gwas.html#cb17-76" aria-hidden="true" tabindex="-1"></a>  new_chisq<span class="ot">=</span>mod<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod<span class="sc">$</span>coefficients[<span class="dv">3</span>]<span class="sc">*</span>use<span class="sc">$</span>ldsc_ref</span>
<span id="cb17-77"><a href="good-vs-bad-gwas.html#cb17-77" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">cbind</span>(use<span class="sc">$</span>good_chisq, new_chisq)</span>
<span id="cb17-78"><a href="good-vs-bad-gwas.html#cb17-78" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation_hat <span class="ot">=</span> mod<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>use<span class="sc">$</span>r2_bad<span class="dv">-1</span></span>
<span id="cb17-79"><a href="good-vs-bad-gwas.html#cb17-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-80"><a href="good-vs-bad-gwas.html#cb17-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb17-81"><a href="good-vs-bad-gwas.html#cb17-81" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(use<span class="sc">$</span>r2_bad, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb17-82"><a href="good-vs-bad-gwas.html#cb17-82" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(use<span class="sc">$</span>r2_bad, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb17-83"><a href="good-vs-bad-gwas.html#cb17-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-84"><a href="good-vs-bad-gwas.html#cb17-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb17-85"><a href="good-vs-bad-gwas.html#cb17-85" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation_ave=</span><span class="fu">tapply</span>(use<span class="sc">$</span>inflation,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean),</span>
<span id="cb17-86"><a href="good-vs-bad-gwas.html#cb17-86" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inflation_hat_ave=</span><span class="fu">tapply</span>(use<span class="sc">$</span>inflation_hat,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean))</span>
<span id="cb17-87"><a href="good-vs-bad-gwas.html#cb17-87" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(use<span class="sc">$</span>r2_bad,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean)</span>
<span id="cb17-88"><a href="good-vs-bad-gwas.html#cb17-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-89"><a href="good-vs-bad-gwas.html#cb17-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb17-90"><a href="good-vs-bad-gwas.html#cb17-90" aria-hidden="true" tabindex="-1"></a>  start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(out<span class="sc">$</span>inflation_ave,out<span class="sc">$</span>inflation_hat_ave))</span>
<span id="cb17-91"><a href="good-vs-bad-gwas.html#cb17-91" aria-hidden="true" tabindex="-1"></a>  end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(out<span class="sc">$</span>inflation_ave,out<span class="sc">$</span>inflation_hat_ave))</span>
<span id="cb17-92"><a href="good-vs-bad-gwas.html#cb17-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-93"><a href="good-vs-bad-gwas.html#cb17-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>inflation_ave, out<span class="sc">$</span>inflation_hat_ave,</span>
<span id="cb17-94"><a href="good-vs-bad-gwas.html#cb17-94" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">&quot;ave inflation&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave inflation hat&quot;</span>,</span>
<span id="cb17-95"><a href="good-vs-bad-gwas.html#cb17-95" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, </span>
<span id="cb17-96"><a href="good-vs-bad-gwas.html#cb17-96" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb17-97"><a href="good-vs-bad-gwas.html#cb17-97" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb17-98"><a href="good-vs-bad-gwas.html#cb17-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb17-99"><a href="good-vs-bad-gwas.html#cb17-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h=</span><span class="fu">lm</span>(bad_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb17-100"><a href="good-vs-bad-gwas.html#cb17-100" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb17-101"><a href="good-vs-bad-gwas.html#cb17-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(out<span class="sc">$</span>inflation_ave, out<span class="sc">$</span>inflation_hat_ave,<span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb17-102"><a href="good-vs-bad-gwas.html#cb17-102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-103"><a href="good-vs-bad-gwas.html#cb17-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-104"><a href="good-vs-bad-gwas.html#cb17-104" aria-hidden="true" tabindex="-1"></a><span class="co">#dev.off()</span></span></code></pre></div>
</div>
<div id="good-gwas-inf.-vs.-inf._hat-raw" class="section level3" number="5.7.6">
<h3><span class="header-section-number">5.7.6</span> good gwas: inf. vs. inf._hat: raw</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="good-vs-bad-gwas.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb18-2"><a href="good-vs-bad-gwas.html#cb18-2" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb18-3"><a href="good-vs-bad-gwas.html#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb18-4"><a href="good-vs-bad-gwas.html#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb18-5"><a href="good-vs-bad-gwas.html#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="good-vs-bad-gwas.html#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-vs-inflation-hat-goodgwas.png&quot;</span>),</span>
<span id="cb18-7"><a href="good-vs-bad-gwas.html#cb18-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb18-8"><a href="good-vs-bad-gwas.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb18-9"><a href="good-vs-bad-gwas.html#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="good-vs-bad-gwas.html#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb18-11"><a href="good-vs-bad-gwas.html#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="good-vs-bad-gwas.html#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># putting info together</span></span>
<span id="cb18-13"><a href="good-vs-bad-gwas.html#cb18-13" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb18-14"><a href="good-vs-bad-gwas.html#cb18-14" aria-hidden="true" tabindex="-1"></a>  file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>, trait, <span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>)</span>
<span id="cb18-15"><a href="good-vs-bad-gwas.html#cb18-15" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb18-16"><a href="good-vs-bad-gwas.html#cb18-16" aria-hidden="true" tabindex="-1"></a>  r2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb18-17"><a href="good-vs-bad-gwas.html#cb18-17" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(r2<span class="sc">$</span>snp, dat<span class="sc">$</span>SNP)</span>
<span id="cb18-18"><a href="good-vs-bad-gwas.html#cb18-18" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span><span class="fu">data.frame</span>(dat[m,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>)], r2[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>)])</span>
<span id="cb18-19"><a href="good-vs-bad-gwas.html#cb18-19" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span>use[<span class="fu">complete.cases</span>(use),]</span>
<span id="cb18-20"><a href="good-vs-bad-gwas.html#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="good-vs-bad-gwas.html#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inflation  </span></span>
<span id="cb18-22"><a href="good-vs-bad-gwas.html#cb18-22" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation<span class="ot">=</span>use<span class="sc">$</span>control_chisq<span class="sc">-</span>use<span class="sc">$</span>good_chisq</span>
<span id="cb18-23"><a href="good-vs-bad-gwas.html#cb18-23" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(good_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb18-24"><a href="good-vs-bad-gwas.html#cb18-24" aria-hidden="true" tabindex="-1"></a>  new<span class="ot">=</span><span class="fu">resid</span>(mod1)<span class="sc">+</span>mod1<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb18-25"><a href="good-vs-bad-gwas.html#cb18-25" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(new<span class="sc">~</span>use<span class="sc">$</span>r2_good)</span>
<span id="cb18-26"><a href="good-vs-bad-gwas.html#cb18-26" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation_hat<span class="ot">=</span><span class="fu">predict</span>(mod2)</span>
<span id="cb18-27"><a href="good-vs-bad-gwas.html#cb18-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-28"><a href="good-vs-bad-gwas.html#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot: inflation vs. inflation_hat</span></span>
<span id="cb18-29"><a href="good-vs-bad-gwas.html#cb18-29" aria-hidden="true" tabindex="-1"></a>  start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(use<span class="sc">$</span>inflation,use<span class="sc">$</span>inflation_hat))</span>
<span id="cb18-30"><a href="good-vs-bad-gwas.html#cb18-30" aria-hidden="true" tabindex="-1"></a>  end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(use<span class="sc">$</span>inflation,use<span class="sc">$</span>inflation_hat))</span>
<span id="cb18-31"><a href="good-vs-bad-gwas.html#cb18-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-32"><a href="good-vs-bad-gwas.html#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(use<span class="sc">$</span>inflation, use<span class="sc">$</span>inflation_hat,</span>
<span id="cb18-33"><a href="good-vs-bad-gwas.html#cb18-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">&quot;inflation&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation hat&quot;</span>,</span>
<span id="cb18-34"><a href="good-vs-bad-gwas.html#cb18-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, </span>
<span id="cb18-35"><a href="good-vs-bad-gwas.html#cb18-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb18-36"><a href="good-vs-bad-gwas.html#cb18-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb18-37"><a href="good-vs-bad-gwas.html#cb18-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb18-38"><a href="good-vs-bad-gwas.html#cb18-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h=</span><span class="fu">lm</span>(good_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb18-39"><a href="good-vs-bad-gwas.html#cb18-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb18-40"><a href="good-vs-bad-gwas.html#cb18-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(use<span class="sc">$</span>inflation, use<span class="sc">$</span>inflation_hat,<span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb18-41"><a href="good-vs-bad-gwas.html#cb18-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-42"><a href="good-vs-bad-gwas.html#cb18-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-43"><a href="good-vs-bad-gwas.html#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="good-gwas-inf.-vs.-inf._hat-ave" class="section level3" number="5.7.7">
<h3><span class="header-section-number">5.7.7</span> good gwas: inf. vs. inf._hat: ave</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="good-vs-bad-gwas.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb19-2"><a href="good-vs-bad-gwas.html#cb19-2" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb19-3"><a href="good-vs-bad-gwas.html#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb19-4"><a href="good-vs-bad-gwas.html#cb19-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb19-5"><a href="good-vs-bad-gwas.html#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="good-vs-bad-gwas.html#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-vs-inflation-hat-ave-goodgwas.png&quot;</span>),</span>
<span id="cb19-7"><a href="good-vs-bad-gwas.html#cb19-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb19-8"><a href="good-vs-bad-gwas.html#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb19-9"><a href="good-vs-bad-gwas.html#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="good-vs-bad-gwas.html#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb19-11"><a href="good-vs-bad-gwas.html#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="good-vs-bad-gwas.html#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># putting info together</span></span>
<span id="cb19-13"><a href="good-vs-bad-gwas.html#cb19-13" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb19-14"><a href="good-vs-bad-gwas.html#cb19-14" aria-hidden="true" tabindex="-1"></a>  file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;summary/&quot;</span>, trait, <span class="st">&quot;-gwas-test-stats-compare2.txt&quot;</span>)</span>
<span id="cb19-15"><a href="good-vs-bad-gwas.html#cb19-15" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(file, <span class="at">col_names=</span>T)</span>
<span id="cb19-16"><a href="good-vs-bad-gwas.html#cb19-16" aria-hidden="true" tabindex="-1"></a>  r2<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;inflation/summary/&quot;</span>,trait,<span class="st">&quot;-inflation-by-maf-r2&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb19-17"><a href="good-vs-bad-gwas.html#cb19-17" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(r2<span class="sc">$</span>snp, dat<span class="sc">$</span>SNP)</span>
<span id="cb19-18"><a href="good-vs-bad-gwas.html#cb19-18" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span><span class="fu">data.frame</span>(dat[m,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>)], r2[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>)])</span>
<span id="cb19-19"><a href="good-vs-bad-gwas.html#cb19-19" aria-hidden="true" tabindex="-1"></a>  use<span class="ot">=</span>use[<span class="fu">complete.cases</span>(use),]</span>
<span id="cb19-20"><a href="good-vs-bad-gwas.html#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="good-vs-bad-gwas.html#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inflation  </span></span>
<span id="cb19-22"><a href="good-vs-bad-gwas.html#cb19-22" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation<span class="ot">=</span>use<span class="sc">$</span>control_chisq<span class="sc">-</span>use<span class="sc">$</span>good_chisq</span>
<span id="cb19-23"><a href="good-vs-bad-gwas.html#cb19-23" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(good_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)</span>
<span id="cb19-24"><a href="good-vs-bad-gwas.html#cb19-24" aria-hidden="true" tabindex="-1"></a>  new<span class="ot">=</span><span class="fu">resid</span>(mod1)<span class="sc">+</span>mod1<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb19-25"><a href="good-vs-bad-gwas.html#cb19-25" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(new<span class="sc">~</span>use<span class="sc">$</span>r2_good)</span>
<span id="cb19-26"><a href="good-vs-bad-gwas.html#cb19-26" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>inflation_hat<span class="ot">=</span><span class="fu">predict</span>(mod2)</span>
<span id="cb19-27"><a href="good-vs-bad-gwas.html#cb19-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-28"><a href="good-vs-bad-gwas.html#cb19-28" aria-hidden="true" tabindex="-1"></a> <span class="co"># bin a variable by quantile</span></span>
<span id="cb19-29"><a href="good-vs-bad-gwas.html#cb19-29" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(use<span class="sc">$</span>r2_good, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb19-30"><a href="good-vs-bad-gwas.html#cb19-30" aria-hidden="true" tabindex="-1"></a>  use<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(use<span class="sc">$</span>r2_good, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb19-31"><a href="good-vs-bad-gwas.html#cb19-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-32"><a href="good-vs-bad-gwas.html#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb19-33"><a href="good-vs-bad-gwas.html#cb19-33" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation_ave=</span><span class="fu">tapply</span>(use<span class="sc">$</span>inflation,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean),</span>
<span id="cb19-34"><a href="good-vs-bad-gwas.html#cb19-34" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inflation_hat_ave=</span><span class="fu">tapply</span>(use<span class="sc">$</span>inflation_hat,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean))</span>
<span id="cb19-35"><a href="good-vs-bad-gwas.html#cb19-35" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(use<span class="sc">$</span>r2_good,<span class="at">INDEX=</span>use<span class="sc">$</span>bin, mean)</span>
<span id="cb19-36"><a href="good-vs-bad-gwas.html#cb19-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-37"><a href="good-vs-bad-gwas.html#cb19-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb19-38"><a href="good-vs-bad-gwas.html#cb19-38" aria-hidden="true" tabindex="-1"></a>  start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(out<span class="sc">$</span>inflation_ave,out<span class="sc">$</span>inflation_hat_ave))</span>
<span id="cb19-39"><a href="good-vs-bad-gwas.html#cb19-39" aria-hidden="true" tabindex="-1"></a>  end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(out<span class="sc">$</span>inflation_ave,out<span class="sc">$</span>inflation_hat_ave))</span>
<span id="cb19-40"><a href="good-vs-bad-gwas.html#cb19-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-41"><a href="good-vs-bad-gwas.html#cb19-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>inflation_ave, out<span class="sc">$</span>inflation_hat_ave,</span>
<span id="cb19-42"><a href="good-vs-bad-gwas.html#cb19-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">&quot;ave inflation&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave inflation hat&quot;</span>,</span>
<span id="cb19-43"><a href="good-vs-bad-gwas.html#cb19-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, </span>
<span id="cb19-44"><a href="good-vs-bad-gwas.html#cb19-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb19-45"><a href="good-vs-bad-gwas.html#cb19-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb19-46"><a href="good-vs-bad-gwas.html#cb19-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb19-47"><a href="good-vs-bad-gwas.html#cb19-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h=</span><span class="fu">lm</span>(good_chisq<span class="sc">~</span>ldsc_ref, <span class="at">data=</span>use)<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb19-48"><a href="good-vs-bad-gwas.html#cb19-48" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb19-49"><a href="good-vs-bad-gwas.html#cb19-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(out<span class="sc">$</span>inflation_ave, out<span class="sc">$</span>inflation_hat_ave,<span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb19-50"><a href="good-vs-bad-gwas.html#cb19-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-51"><a href="good-vs-bad-gwas.html#cb19-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-52"><a href="good-vs-bad-gwas.html#cb19-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-53"><a href="good-vs-bad-gwas.html#cb19-53" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
</div>
<div id="ukbb_337k_inflation" class="section level2" number="5.8">
<h2><span class="header-section-number">5.8</span> UKBB N = 337k</h2>
<p>From the above, we know that by assuming constant inflation, ldsc underestimates inflation. Then why for N = 337k, ldsc shows inflation in the absence of confouding?
Here we want to estimate inflation for the recommended 337k UKBB (inflation is estimated using the full model).</p>
<p>Note: previously we tested if the slope of the regression chisq ~ aver2 greater than 0 or not. Here we want to get the estimated inflation from the full model, i.e., chisq ~ aver2 + ldsc. So we need to reorganize information.</p>
<div id="organize-data" class="section level3" number="5.8.1">
<h3><span class="header-section-number">5.8.1</span> organize data</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="good-vs-bad-gwas.html#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="good-vs-bad-gwas.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb20-3"><a href="good-vs-bad-gwas.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract LD score</span></span>
<span id="cb20-4"><a href="good-vs-bad-gwas.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb20-5"><a href="good-vs-bad-gwas.html#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="good-vs-bad-gwas.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert snp list to rs system ------------------------------------------------</span></span>
<span id="cb20-7"><a href="good-vs-bad-gwas.html#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>gen/snps-norm.use</span>
<span id="cb20-8"><a href="good-vs-bad-gwas.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>gen/snps-norm.use-rs</span>
<span id="cb20-9"><a href="good-vs-bad-gwas.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$1]; next}</span></span>
<span id="cb20-10"><a href="good-vs-bad-gwas.html#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="st">     ($1 in a){print $1, $2}&#39;</span> <span class="va">$infile</span> doug/ukbb.ldsc  <span class="op">&gt;</span> <span class="va">$outfile</span></span>
<span id="cb20-11"><a href="good-vs-bad-gwas.html#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="good-vs-bad-gwas.html#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  extract ld scores -----------------------------------------------------------</span></span>
<span id="cb20-13"><a href="good-vs-bad-gwas.html#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>ldsc/eur_w_ld_chr</span>
<span id="cb20-14"><a href="good-vs-bad-gwas.html#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chrom <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb20-15"><a href="good-vs-bad-gwas.html#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="fu">zcat</span> <span class="va">$dir</span>/<span class="va">$chrom</span>.l2.ldscore.gz <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $2, $6}&#39;</span> <span class="op">&gt;</span> ldscore</span>
<span id="cb20-16"><a href="good-vs-bad-gwas.html#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;(NR==FNR){a[$2]; b[$2]=$1; next}($1 in a){print b[$1], $2}&#39;</span> gen/snps-norm.use-rs ldscore <span class="op">&gt;</span> temp</span>
<span id="cb20-17"><a href="good-vs-bad-gwas.html#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$chrom</span> <span class="ot">-eq</span> 1 <span class="bu">]</span></span>
<span id="cb20-18"><a href="good-vs-bad-gwas.html#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="cf">then</span> </span>
<span id="cb20-19"><a href="good-vs-bad-gwas.html#cb20-19" aria-hidden="true" tabindex="-1"></a> <span class="fu">mv</span> temp snps-norm.ldscore</span>
<span id="cb20-20"><a href="good-vs-bad-gwas.html#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb20-21"><a href="good-vs-bad-gwas.html#cb20-21" aria-hidden="true" tabindex="-1"></a> <span class="fu">cat</span> snps-norm.ldscore temp <span class="op">&gt;</span> temp2</span>
<span id="cb20-22"><a href="good-vs-bad-gwas.html#cb20-22" aria-hidden="true" tabindex="-1"></a> <span class="fu">mv</span> temp2 snps-norm.ldscore</span>
<span id="cb20-23"><a href="good-vs-bad-gwas.html#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb20-24"><a href="good-vs-bad-gwas.html#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$chrom</span></span>
<span id="cb20-25"><a href="good-vs-bad-gwas.html#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb20-26"><a href="good-vs-bad-gwas.html#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="good-vs-bad-gwas.html#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb20-28"><a href="good-vs-bad-gwas.html#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># putting information together</span></span>
<span id="cb20-29"><a href="good-vs-bad-gwas.html#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::</span></span>
<span id="cb20-30"><a href="good-vs-bad-gwas.html#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="good-vs-bad-gwas.html#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb20-32"><a href="good-vs-bad-gwas.html#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="good-vs-bad-gwas.html#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-norm-337k/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb20-34"><a href="good-vs-bad-gwas.html#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-ukbb-norm</span>
<span id="cb20-35"><a href="good-vs-bad-gwas.html#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-norm.ldscore</span>
<span id="cb20-36"><a href="good-vs-bad-gwas.html#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>gwas-norm-337k-out/<span class="va">$trait</span>.out</span>
<span id="cb20-37"><a href="good-vs-bad-gwas.html#cb20-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-38"><a href="good-vs-bad-gwas.html#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp</span>
<span id="cb20-39"><a href="good-vs-bad-gwas.html#cb20-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-40"><a href="good-vs-bad-gwas.html#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb20-41"><a href="good-vs-bad-gwas.html#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb20-42"><a href="good-vs-bad-gwas.html#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb20-43"><a href="good-vs-bad-gwas.html#cb20-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-44"><a href="good-vs-bad-gwas.html#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb20-45"><a href="good-vs-bad-gwas.html#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb20-46"><a href="good-vs-bad-gwas.html#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb20-47"><a href="good-vs-bad-gwas.html#cb20-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-48"><a href="good-vs-bad-gwas.html#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb20-49"><a href="good-vs-bad-gwas.html#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb20-50"><a href="good-vs-bad-gwas.html#cb20-50" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb20-51"><a href="good-vs-bad-gwas.html#cb20-51" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb20-52"><a href="good-vs-bad-gwas.html#cb20-52" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb20-53"><a href="good-vs-bad-gwas.html#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb20-54"><a href="good-vs-bad-gwas.html#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb20-55"><a href="good-vs-bad-gwas.html#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="plot" class="section level3" number="5.8.2">
<h3><span class="header-section-number">5.8.2</span> plot</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="good-vs-bad-gwas.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb21-2"><a href="good-vs-bad-gwas.html#cb21-2" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb21-3"><a href="good-vs-bad-gwas.html#cb21-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb21-4"><a href="good-vs-bad-gwas.html#cb21-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb21-5"><a href="good-vs-bad-gwas.html#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="good-vs-bad-gwas.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;fig/inflation-hat-aver2-bin-ukbb-recommended.png&quot;</span>),</span>
<span id="cb21-7"><a href="good-vs-bad-gwas.html#cb21-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">width =</span> <span class="dv">50</span>, <span class="at">height =</span> <span class="dv">30</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">600</span>)</span>
<span id="cb21-8"><a href="good-vs-bad-gwas.html#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb21-9"><a href="good-vs-bad-gwas.html#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="good-vs-bad-gwas.html#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb21-11"><a href="good-vs-bad-gwas.html#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="good-vs-bad-gwas.html#cb21-12" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb21-13"><a href="good-vs-bad-gwas.html#cb21-13" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;gwas-norm-337k-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb21-14"><a href="good-vs-bad-gwas.html#cb21-14" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb21-15"><a href="good-vs-bad-gwas.html#cb21-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-16"><a href="good-vs-bad-gwas.html#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># predicted inflation</span></span>
<span id="cb21-17"><a href="good-vs-bad-gwas.html#cb21-17" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq<span class="sc">~</span>aver2 <span class="sc">+</span> ldsc, <span class="at">data=</span>dat)</span>
<span id="cb21-18"><a href="good-vs-bad-gwas.html#cb21-18" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(chisq<span class="sc">~</span> ldsc, <span class="at">data=</span>dat)</span>
<span id="cb21-19"><a href="good-vs-bad-gwas.html#cb21-19" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(chisq<span class="sc">~</span> aver2, <span class="at">data=</span>dat)</span>
<span id="cb21-20"><a href="good-vs-bad-gwas.html#cb21-20" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>inflation_hat <span class="ot">=</span> mod<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dat<span class="sc">$</span>aver2<span class="dv">-1</span></span>
<span id="cb21-21"><a href="good-vs-bad-gwas.html#cb21-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-22"><a href="good-vs-bad-gwas.html#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb21-23"><a href="good-vs-bad-gwas.html#cb21-23" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb21-24"><a href="good-vs-bad-gwas.html#cb21-24" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb21-25"><a href="good-vs-bad-gwas.html#cb21-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-26"><a href="good-vs-bad-gwas.html#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb21-27"><a href="good-vs-bad-gwas.html#cb21-27" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation_hat_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation_hat,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb21-28"><a href="good-vs-bad-gwas.html#cb21-28" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb21-29"><a href="good-vs-bad-gwas.html#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="good-vs-bad-gwas.html#cb21-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb21-31"><a href="good-vs-bad-gwas.html#cb21-31" aria-hidden="true" tabindex="-1"></a>  start<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>inflation_hat_ave)</span>
<span id="cb21-32"><a href="good-vs-bad-gwas.html#cb21-32" aria-hidden="true" tabindex="-1"></a>  end<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>inflation_hat_ave)</span>
<span id="cb21-33"><a href="good-vs-bad-gwas.html#cb21-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-34"><a href="good-vs-bad-gwas.html#cb21-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>inflation_hat_ave,</span>
<span id="cb21-35"><a href="good-vs-bad-gwas.html#cb21-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ave inflation hat&quot;</span>,</span>
<span id="cb21-36"><a href="good-vs-bad-gwas.html#cb21-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait,  <span class="at">ylim=</span><span class="fu">c</span>(start, end),</span>
<span id="cb21-37"><a href="good-vs-bad-gwas.html#cb21-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb21-38"><a href="good-vs-bad-gwas.html#cb21-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-39"><a href="good-vs-bad-gwas.html#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="good-vs-bad-gwas.html#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb21-41"><a href="good-vs-bad-gwas.html#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="good-vs-bad-gwas.html#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Detection of inflation-------------------------------------------------------</span></span>
<span id="cb21-43"><a href="good-vs-bad-gwas.html#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb21-44"><a href="good-vs-bad-gwas.html#cb21-44" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb21-45"><a href="good-vs-bad-gwas.html#cb21-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb21-46"><a href="good-vs-bad-gwas.html#cb21-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb21-47"><a href="good-vs-bad-gwas.html#cb21-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-48"><a href="good-vs-bad-gwas.html#cb21-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb21-49"><a href="good-vs-bad-gwas.html#cb21-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-50"><a href="good-vs-bad-gwas.html#cb21-50" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb21-51"><a href="good-vs-bad-gwas.html#cb21-51" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;gwas-norm-337k-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb21-52"><a href="good-vs-bad-gwas.html#cb21-52" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb21-53"><a href="good-vs-bad-gwas.html#cb21-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-54"><a href="good-vs-bad-gwas.html#cb21-54" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq<span class="sc">~</span>aver2 <span class="sc">+</span> ldsc, <span class="at">data=</span>dat)</span>
<span id="cb21-55"><a href="good-vs-bad-gwas.html#cb21-55" aria-hidden="true" tabindex="-1"></a>  p0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,<span class="at">p_aver2=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>])</span>
<span id="cb21-56"><a href="good-vs-bad-gwas.html#cb21-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-57"><a href="good-vs-bad-gwas.html#cb21-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){p<span class="ot">=</span>p0} <span class="cf">else</span> {p<span class="ot">=</span><span class="fu">rbind</span>(p,p0)}</span>
<span id="cb21-58"><a href="good-vs-bad-gwas.html#cb21-58" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="summary-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mathematical-details.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-inflation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
