<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>18 Fine-scale population stratification | GWAS Quality Control</title>
  <meta name="description" content="18 Fine-scale population stratification | GWAS Quality Control" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="18 Fine-scale population stratification | GWAS Quality Control" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="18 Fine-scale population stratification | GWAS Quality Control" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reference-panel-1k-genome.html"/>
<link rel="next" href="genotyping-errors.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Quality Control Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> General Info</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#topic"><i class="fa fa-check"></i><b>1.1</b> Topic</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#frequently-used-commands"><i class="fa fa-check"></i><b>1.2</b> Frequently used commands</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>2</b> summary</a></li>
<li class="chapter" data-level="3" data-path="summaries.html"><a href="summaries.html"><i class="fa fa-check"></i><b>3</b> Summaries</a>
<ul>
<li class="chapter" data-level="3.1" data-path="summaries.html"><a href="summaries.html#good-gwas"><i class="fa fa-check"></i><b>3.1</b> Good GWAS</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher"><i class="fa fa-check"></i><b>3.1.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.1.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression"><i class="fa fa-check"></i><b>3.1.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="summaries.html"><a href="summaries.html#bad-gwas"><i class="fa fa-check"></i><b>3.2</b> Bad GWAS</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-1"><i class="fa fa-check"></i><b>3.2.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.2.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-1"><i class="fa fa-check"></i><b>3.2.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="summaries.html"><a href="summaries.html#ukbb-recommended"><i class="fa fa-check"></i><b>3.3</b> UKBB recommended</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-2"><i class="fa fa-check"></i><b>3.3.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.3.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-2"><i class="fa fa-check"></i><b>3.3.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="summaries.html"><a href="summaries.html#control-gwas"><i class="fa fa-check"></i><b>3.4</b> Control GWAS</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-3"><i class="fa fa-check"></i><b>3.4.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.4.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-3"><i class="fa fa-check"></i><b>3.4.2</b> Haseman Elston Regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="summary-1.html"><a href="summary-1.html"><i class="fa fa-check"></i><b>4</b> summary</a></li>
<li class="chapter" data-level="5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html"><i class="fa fa-check"></i><b>5</b> Good VS Bad GWAS</a>
<ul>
<li class="chapter" data-level="5.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#test-statistics-ld-score"><i class="fa fa-check"></i><b>5.1</b> test statistics ~ LD score</a></li>
<li class="chapter" data-level="5.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#new-models"><i class="fa fa-check"></i><b>5.2</b> New models?</a></li>
<li class="chapter" data-level="5.3" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#ld-scores-based-on-individual-level-data"><i class="fa fa-check"></i><b>5.3</b> LD scores based on individual level data</a></li>
<li class="chapter" data-level="5.4" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#test-the-new-model"><i class="fa fa-check"></i><b>5.4</b> Test the new model</a></li>
<li class="chapter" data-level="5.5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#predictors-of-inflation"><i class="fa fa-check"></i><b>5.5</b> predictors of inflation?</a></li>
<li class="chapter" data-level="5.6" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#regress-chisq-mean-r2_j"><i class="fa fa-check"></i><b>5.6</b> regress chisq ~ mean r^2_j</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#plots"><i class="fa fa-check"></i><b>5.6.1</b> plots</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#predict-inflation-aver2_j"><i class="fa fa-check"></i><b>5.7</b> predict inflation | aver2_j ?</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good_chisq-vs.-adj_chisq"><i class="fa fa-check"></i><b>5.7.1</b> good_chisq vs. adj_chisq</a></li>
<li class="chapter" data-level="5.7.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-vs.-inf._hat-raw"><i class="fa fa-check"></i><b>5.7.2</b> bad gwas: inf. vs. inf._hat: raw</a></li>
<li class="chapter" data-level="5.7.3" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-vs.-inf._hat-ave"><i class="fa fa-check"></i><b>5.7.3</b> bad gwas: inf. vs. inf._hat: ave</a></li>
<li class="chapter" data-level="5.7.4" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-from-full-model"><i class="fa fa-check"></i><b>5.7.4</b> bad gwas: inf. from full model</a></li>
<li class="chapter" data-level="5.7.5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#to-explore-change"><i class="fa fa-check"></i><b>5.7.5</b> To Explore: change??</a></li>
<li class="chapter" data-level="5.7.6" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good-gwas-inf.-vs.-inf._hat-raw"><i class="fa fa-check"></i><b>5.7.6</b> good gwas: inf. vs. inf._hat: raw</a></li>
<li class="chapter" data-level="5.7.7" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good-gwas-inf.-vs.-inf._hat-ave"><i class="fa fa-check"></i><b>5.7.7</b> good gwas: inf. vs. inf._hat: ave</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#ukbb_337k_inflation"><i class="fa fa-check"></i><b>5.8</b> UKBB N = 337k</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#organize-data"><i class="fa fa-check"></i><b>5.8.1</b> organize data</a></li>
<li class="chapter" data-level="5.8.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#plot"><i class="fa fa-check"></i><b>5.8.2</b> plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mathematical-details.html"><a href="mathematical-details.html"><i class="fa fa-check"></i><b>6</b> Mathematical Details</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mathematical-details.html"><a href="mathematical-details.html#trk_rightk_left"><i class="fa fa-check"></i><b>6.1</b> <span class="math inline">\(tr(K_{right}K_{left})\)</span></a></li>
<li class="chapter" data-level="6.2" data-path="mathematical-details.html"><a href="mathematical-details.html#verification"><i class="fa fa-check"></i><b>6.2</b> verification</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html"><i class="fa fa-check"></i><b>7</b> chi square ~ <span class="math inline">\(\overline{r^2_j}\)</span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#overliner2_j-choice-of-snps"><i class="fa fa-check"></i><b>7.1</b> <span class="math inline">\(\overline{r^2_j}\)</span> &amp; choice of SNPs</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#number-of-snps"><i class="fa fa-check"></i><b>7.1.1</b> number of SNPs</a></li>
<li class="chapter" data-level="7.1.2" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#maf"><i class="fa fa-check"></i><b>7.1.2</b> maf</a></li>
<li class="chapter" data-level="7.1.3" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#summary-2"><i class="fa fa-check"></i><b>7.1.3</b> summary</a></li>
<li class="chapter" data-level="7.1.4" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#final-plots"><i class="fa fa-check"></i><b>7.1.4</b> Final plots</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#varying-levels-of-confouding"><i class="fa fa-check"></i><b>7.2</b> varying levels of confouding</a></li>
<li class="chapter" data-level="7.3" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#results-summary"><i class="fa fa-check"></i><b>7.3</b> results summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="good.html"><a href="good.html"><i class="fa fa-check"></i><b>8</b> Good GWAS</a>
<ul>
<li class="chapter" data-level="8.1" data-path="good.html"><a href="good.html#goodid"><i class="fa fa-check"></i><b>8.1</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="8.2" data-path="good.html"><a href="good.html#extract-covariates"><i class="fa fa-check"></i><b>8.2</b> extract covariates</a></li>
<li class="chapter" data-level="8.3" data-path="good.html"><a href="good.html#gwas"><i class="fa fa-check"></i><b>8.3</b> GWAS</a></li>
<li class="chapter" data-level="8.4" data-path="good.html"><a href="good.html#chisq-aver2_j"><i class="fa fa-check"></i><b>8.4</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="8.5" data-path="good.html"><a href="good.html#correct-genotypes"><i class="fa fa-check"></i><b>8.5</b> correct genotypes</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="good.html"><a href="good.html#organize-covariate-files"><i class="fa fa-check"></i><b>8.5.1</b> organize covariate files</a></li>
<li class="chapter" data-level="8.5.2" data-path="good.html"><a href="good.html#compute-aver2"><i class="fa fa-check"></i><b>8.5.2</b> compute aver2</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="good.html"><a href="good.html#ldsc-intercept"><i class="fa fa-check"></i><b>8.6</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="good.html"><a href="good.html#under-gcta"><i class="fa fa-check"></i><b>8.6.1</b> under gcta</a></li>
<li class="chapter" data-level="8.6.2" data-path="good.html"><a href="good.html#under-ldak-thin"><i class="fa fa-check"></i><b>8.6.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="8.6.3" data-path="good.html"><a href="good.html#summary-3"><i class="fa fa-check"></i><b>8.6.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="good.html"><a href="good.html#reml"><i class="fa fa-check"></i><b>8.7</b> REML</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="good.html"><a href="good.html#making-grms"><i class="fa fa-check"></i><b>8.7.1</b> making grms</a></li>
<li class="chapter" data-level="8.7.2" data-path="good.html"><a href="good.html#fast-reml"><i class="fa fa-check"></i><b>8.7.2</b> fast-reml</a></li>
<li class="chapter" data-level="8.7.3" data-path="good.html"><a href="good.html#inflation-test"><i class="fa fa-check"></i><b>8.7.3</b> inflation test</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="good.html"><a href="good.html#he"><i class="fa fa-check"></i><b>8.8</b> HE</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="good.html"><a href="good.html#estimation"><i class="fa fa-check"></i><b>8.8.1</b> estimation</a></li>
<li class="chapter" data-level="8.8.2" data-path="good.html"><a href="good.html#summary-4"><i class="fa fa-check"></i><b>8.8.2</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bad.html"><a href="bad.html"><i class="fa fa-check"></i><b>9</b> Bad GWAS</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bad.html"><a href="bad.html#badid"><i class="fa fa-check"></i><b>9.1</b> ID list</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="bad.html"><a href="bad.html#initial-selection"><i class="fa fa-check"></i><b>9.1.1</b> initial selection</a></li>
<li class="chapter" data-level="9.1.2" data-path="bad.html"><a href="bad.html#relatedness-filtering"><i class="fa fa-check"></i><b>9.1.2</b> relatedness filtering</a></li>
<li class="chapter" data-level="9.1.3" data-path="bad.html"><a href="bad.html#final-list"><i class="fa fa-check"></i><b>9.1.3</b> final list</a></li>
<li class="chapter" data-level="9.1.4" data-path="bad.html"><a href="bad.html#pc-plot"><i class="fa fa-check"></i><b>9.1.4</b> PC plot</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="bad.html"><a href="bad.html#gwas-lm"><i class="fa fa-check"></i><b>9.2</b> GWAS-lm</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="bad.html"><a href="bad.html#basic-cov"><i class="fa fa-check"></i><b>9.2.1</b> basic cov</a></li>
<li class="chapter" data-level="9.2.2" data-path="bad.html"><a href="bad.html#basic-cov-pc"><i class="fa fa-check"></i><b>9.2.2</b> basic cov + PC</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="bad.html"><a href="bad.html#gwas-bolt-lmm"><i class="fa fa-check"></i><b>9.3</b> GWAS-bolt-lmm</a></li>
<li class="chapter" data-level="9.4" data-path="bad.html"><a href="bad.html#correct-genotypes-1"><i class="fa fa-check"></i><b>9.4</b> correct genotypes</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="bad.html"><a href="bad.html#cal-aver2"><i class="fa fa-check"></i><b>9.4.1</b> cal-aver2</a></li>
<li class="chapter" data-level="9.4.2" data-path="bad.html"><a href="bad.html#compare-changes-in-aver2"><i class="fa fa-check"></i><b>9.4.2</b> compare changes in aver2</a></li>
<li class="chapter" data-level="9.4.3" data-path="bad.html"><a href="bad.html#chisq-aver2"><i class="fa fa-check"></i><b>9.4.3</b> chisq ~ aver2</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="bad.html"><a href="bad.html#chisq-aver2_j-1"><i class="fa fa-check"></i><b>9.5</b> chisq ~ aver2_j</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="bad.html"><a href="bad.html#calc-aver2_j"><i class="fa fa-check"></i><b>9.5.1</b> calc aver2_j</a></li>
<li class="chapter" data-level="9.5.2" data-path="bad.html"><a href="bad.html#bolt-lmm"><i class="fa fa-check"></i><b>9.5.2</b> bolt-lmm</a></li>
<li class="chapter" data-level="9.5.3" data-path="bad.html"><a href="bad.html#basic-cov-pc-1"><i class="fa fa-check"></i><b>9.5.3</b> basic cov + PC</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="bad.html"><a href="bad.html#ldsc-intercept-1"><i class="fa fa-check"></i><b>9.6</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="bad.html"><a href="bad.html#under-gcta-1"><i class="fa fa-check"></i><b>9.6.1</b> under gcta</a></li>
<li class="chapter" data-level="9.6.2" data-path="bad.html"><a href="bad.html#under-ldak-thin-1"><i class="fa fa-check"></i><b>9.6.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="9.6.3" data-path="bad.html"><a href="bad.html#summary-5"><i class="fa fa-check"></i><b>9.6.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="bad.html"><a href="bad.html#reml-1"><i class="fa fa-check"></i><b>9.7</b> REML</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="bad.html"><a href="bad.html#making-grms-1"><i class="fa fa-check"></i><b>9.7.1</b> making grms</a></li>
<li class="chapter" data-level="9.7.2" data-path="bad.html"><a href="bad.html#fast-reml-1"><i class="fa fa-check"></i><b>9.7.2</b> fast-reml</a></li>
<li class="chapter" data-level="9.7.3" data-path="bad.html"><a href="bad.html#inflation-test-1"><i class="fa fa-check"></i><b>9.7.3</b> inflation test</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="bad.html"><a href="bad.html#he-1"><i class="fa fa-check"></i><b>9.8</b> HE</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="bad.html"><a href="bad.html#estimation-1"><i class="fa fa-check"></i><b>9.8.1</b> estimation</a></li>
<li class="chapter" data-level="9.8.2" data-path="bad.html"><a href="bad.html#summary-6"><i class="fa fa-check"></i><b>9.8.2</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ukbb.html"><a href="ukbb.html"><i class="fa fa-check"></i><b>10</b> UKBB recommended</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ukbb.html"><a href="ukbb.html#total-n-337k"><i class="fa fa-check"></i><b>10.1</b> total N = 337k</a></li>
<li class="chapter" data-level="10.2" data-path="ukbb.html"><a href="ukbb.html#qc-of-hp3-snps"><i class="fa fa-check"></i><b>10.2</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="10.3" data-path="ukbb.html"><a href="ukbb.html#gwas-100k"><i class="fa fa-check"></i><b>10.3</b> GWAS-100k</a></li>
<li class="chapter" data-level="10.4" data-path="ukbb.html"><a href="ukbb.html#gwas-337k"><i class="fa fa-check"></i><b>10.4</b> GWAS-337k</a></li>
<li class="chapter" data-level="10.5" data-path="ukbb.html"><a href="ukbb.html#ldsc-100k"><i class="fa fa-check"></i><b>10.5</b> ldsc-100k</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="ukbb.html"><a href="ukbb.html#under-gcta-2"><i class="fa fa-check"></i><b>10.5.1</b> under gcta</a></li>
<li class="chapter" data-level="10.5.2" data-path="ukbb.html"><a href="ukbb.html#under-ldak-thin-2"><i class="fa fa-check"></i><b>10.5.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="10.5.3" data-path="ukbb.html"><a href="ukbb.html#summary-7"><i class="fa fa-check"></i><b>10.5.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="ukbb.html"><a href="ukbb.html#ldsc-337k"><i class="fa fa-check"></i><b>10.6</b> ldsc-337k</a></li>
<li class="chapter" data-level="10.7" data-path="ukbb.html"><a href="ukbb.html#aver2_j-337k"><i class="fa fa-check"></i><b>10.7</b> aver2_j-337k</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="ukbb.html"><a href="ukbb.html#calc"><i class="fa fa-check"></i><b>10.7.1</b> calc</a></li>
<li class="chapter" data-level="10.7.2" data-path="ukbb.html"><a href="ukbb.html#organize-data-1"><i class="fa fa-check"></i><b>10.7.2</b> organize data</a></li>
<li class="chapter" data-level="10.7.3" data-path="ukbb.html"><a href="ukbb.html#chisq-aver2_j-2"><i class="fa fa-check"></i><b>10.7.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="ukbb.html"><a href="ukbb.html#he-2"><i class="fa fa-check"></i><b>10.8</b> HE</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="ukbb.html"><a href="ukbb.html#making-grms-2"><i class="fa fa-check"></i><b>10.8.1</b> making grms</a></li>
<li class="chapter" data-level="10.8.2" data-path="ukbb.html"><a href="ukbb.html#estimation-2"><i class="fa fa-check"></i><b>10.8.2</b> estimation</a></li>
<li class="chapter" data-level="10.8.3" data-path="ukbb.html"><a href="ukbb.html#summary-8"><i class="fa fa-check"></i><b>10.8.3</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="control.html"><a href="control.html"><i class="fa fa-check"></i><b>11</b> control GWAS</a>
<ul>
<li class="chapter" data-level="11.1" data-path="control.html"><a href="control.html#id-list"><i class="fa fa-check"></i><b>11.1</b> ID list</a></li>
<li class="chapter" data-level="11.2" data-path="control.html"><a href="control.html#qc-of-hp3-snps-1"><i class="fa fa-check"></i><b>11.2</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="11.3" data-path="control.html"><a href="control.html#gwas-1"><i class="fa fa-check"></i><b>11.3</b> GWAS</a></li>
<li class="chapter" data-level="11.4" data-path="control.html"><a href="control.html#ldsc-intercept-2"><i class="fa fa-check"></i><b>11.4</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="control.html"><a href="control.html#under-gcta-3"><i class="fa fa-check"></i><b>11.4.1</b> under gcta</a></li>
<li class="chapter" data-level="11.4.2" data-path="control.html"><a href="control.html#under-ldak-thin-3"><i class="fa fa-check"></i><b>11.4.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="11.4.3" data-path="control.html"><a href="control.html#summary-9"><i class="fa fa-check"></i><b>11.4.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="control.html"><a href="control.html#he-3"><i class="fa fa-check"></i><b>11.5</b> HE</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="control.html"><a href="control.html#making-grms-3"><i class="fa fa-check"></i><b>11.5.1</b> making grms</a></li>
<li class="chapter" data-level="11.5.2" data-path="control.html"><a href="control.html#estimation-3"><i class="fa fa-check"></i><b>11.5.2</b> estimation</a></li>
<li class="chapter" data-level="11.5.3" data-path="control.html"><a href="control.html#summary-10"><i class="fa fa-check"></i><b>11.5.3</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="previous-gwas.html"><a href="previous-gwas.html"><i class="fa fa-check"></i><b>12</b> previous GWAS</a>
<ul>
<li class="chapter" data-level="12.1" data-path="previous-gwas.html"><a href="previous-gwas.html#qc"><i class="fa fa-check"></i><b>12.1</b> QC</a></li>
<li class="chapter" data-level="12.2" data-path="previous-gwas.html"><a href="previous-gwas.html#gwas-telomere-length"><i class="fa fa-check"></i><b>12.2</b> gwas-telomere length</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="previous-gwas.html"><a href="previous-gwas.html#aver2_j"><i class="fa fa-check"></i><b>12.2.1</b> aver2_j</a></li>
<li class="chapter" data-level="12.2.2" data-path="previous-gwas.html"><a href="previous-gwas.html#organize-data-2"><i class="fa fa-check"></i><b>12.2.2</b> organize data</a></li>
<li class="chapter" data-level="12.2.3" data-path="previous-gwas.html"><a href="previous-gwas.html#chisq-aver2_j-3"><i class="fa fa-check"></i><b>12.2.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="previous-gwas.html"><a href="previous-gwas.html#pr-interval-gwas"><i class="fa fa-check"></i><b>12.3</b> PR interval GWAS</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="previous-gwas.html"><a href="previous-gwas.html#aver2_j-1"><i class="fa fa-check"></i><b>12.3.1</b> aver2_j</a></li>
<li class="chapter" data-level="12.3.2" data-path="previous-gwas.html"><a href="previous-gwas.html#organize-data-3"><i class="fa fa-check"></i><b>12.3.2</b> organize data</a></li>
<li class="chapter" data-level="12.3.3" data-path="previous-gwas.html"><a href="previous-gwas.html#chisq-aver2_j-4"><i class="fa fa-check"></i><b>12.3.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="previous-gwas.html"><a href="previous-gwas.html#ben-neale-pan-ukbb"><i class="fa fa-check"></i><b>12.4</b> Ben Neale Pan-UKBB</a></li>
<li class="chapter" data-level="12.5" data-path="previous-gwas.html"><a href="previous-gwas.html#notesconcerns"><i class="fa fa-check"></i><b>12.5</b> notes/concerns</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html"><i class="fa fa-check"></i><b>13</b> GWAS: White British + Irish</a>
<ul>
<li class="chapter" data-level="13.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#id-list-1"><i class="fa fa-check"></i><b>13.1</b> ID list</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#ids-who-have-no-missing-data"><i class="fa fa-check"></i><b>13.1.1</b> Ids who have no missing data</a></li>
<li class="chapter" data-level="13.1.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#relatedness-filtering-1"><i class="fa fa-check"></i><b>13.1.2</b> relatedness filtering</a></li>
<li class="chapter" data-level="13.1.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#pc-plot-1"><i class="fa fa-check"></i><b>13.1.3</b> PC plot</a></li>
<li class="chapter" data-level="13.1.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#phenotypic-differences"><i class="fa fa-check"></i><b>13.1.4</b> phenotypic differences</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#gwas-lm-1"><i class="fa fa-check"></i><b>13.2</b> GWAS-lm</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#basic-covariates"><i class="fa fa-check"></i><b>13.2.1</b> basic covariates</a></li>
<li class="chapter" data-level="13.2.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#basic-covariates-pcs"><i class="fa fa-check"></i><b>13.2.2</b> basic covariates + PCs</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#chisq-aver2_j-5"><i class="fa fa-check"></i><b>13.3</b> chisq ~ aver2_j</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#calc-aver2_j-1"><i class="fa fa-check"></i><b>13.3.1</b> calc aver2_j</a></li>
<li class="chapter" data-level="13.3.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#organize-data-4"><i class="fa fa-check"></i><b>13.3.2</b> organize data</a></li>
<li class="chapter" data-level="13.3.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#detect-confounding-wt-pcs"><i class="fa fa-check"></i><b>13.3.3</b> detect confounding: w/t PCs</a></li>
<li class="chapter" data-level="13.3.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#detect-confounding-with-pcs"><i class="fa fa-check"></i><b>13.3.4</b> detect confounding: with PCs</a></li>
<li class="chapter" data-level="13.3.5" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#inflation-good-gwas-vs.-control-vs.-british-irish"><i class="fa fa-check"></i><b>13.3.5</b> inflation: good gwas vs. control vs. british-irish</a></li>
<li class="chapter" data-level="13.3.6" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#inflation-aver2"><i class="fa fa-check"></i><b>13.3.6</b> inflation | aver2</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#ideas-to-explore-to-do-list"><i class="fa fa-check"></i><b>13.4</b> Ideas to explore/ to do list:</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="related-individuals.html"><a href="related-individuals.html"><i class="fa fa-check"></i><b>14</b> related individuals</a>
<ul>
<li class="chapter" data-level="14.1" data-path="related-individuals.html"><a href="related-individuals.html#genotyped-snps"><i class="fa fa-check"></i><b>14.1</b> genotyped SNPs</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-2"><i class="fa fa-check"></i><b>14.1.1</b> aver2_j</a></li>
<li class="chapter" data-level="14.1.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-2"><i class="fa fa-check"></i><b>14.1.2</b> gwas</a></li>
<li class="chapter" data-level="14.1.3" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-5"><i class="fa fa-check"></i><b>14.1.3</b> organize data</a></li>
<li class="chapter" data-level="14.1.4" data-path="related-individuals.html"><a href="related-individuals.html#summary-11"><i class="fa fa-check"></i><b>14.1.4</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="related-individuals.html"><a href="related-individuals.html#hapmap3-snps"><i class="fa fa-check"></i><b>14.2</b> hapmap3 SNPs</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="related-individuals.html"><a href="related-individuals.html#genotype-data"><i class="fa fa-check"></i><b>14.2.1</b> genotype data</a></li>
<li class="chapter" data-level="14.2.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-3"><i class="fa fa-check"></i><b>14.2.2</b> gwas</a></li>
<li class="chapter" data-level="14.2.3" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-3"><i class="fa fa-check"></i><b>14.2.3</b> aver2_j</a></li>
<li class="chapter" data-level="14.2.4" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-6"><i class="fa fa-check"></i><b>14.2.4</b> organize data</a></li>
<li class="chapter" data-level="14.2.5" data-path="related-individuals.html"><a href="related-individuals.html#chisq-aver2_j-6"><i class="fa fa-check"></i><b>14.2.5</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="14.2.6" data-path="related-individuals.html"><a href="related-individuals.html#inflation-aver2_j"><i class="fa fa-check"></i><b>14.2.6</b> inflation ~ aver2_j</a></li>
<li class="chapter" data-level="14.2.7" data-path="related-individuals.html"><a href="related-individuals.html#chisq-test-statistics"><i class="fa fa-check"></i><b>14.2.7</b> chisq test statistics</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="related-individuals.html"><a href="related-individuals.html#mix-unrel-rel"><i class="fa fa-check"></i><b>14.3</b> mix unrel &amp; rel</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="related-individuals.html"><a href="related-individuals.html#genotype"><i class="fa fa-check"></i><b>14.3.1</b> genotype</a></li>
<li class="chapter" data-level="14.3.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-4"><i class="fa fa-check"></i><b>14.3.2</b> gwas</a></li>
<li class="chapter" data-level="14.3.3" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-4"><i class="fa fa-check"></i><b>14.3.3</b> aver2_j</a></li>
<li class="chapter" data-level="14.3.4" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-7"><i class="fa fa-check"></i><b>14.3.4</b> organize data</a></li>
<li class="chapter" data-level="14.3.5" data-path="related-individuals.html"><a href="related-individuals.html#chisq-aver2_j-7"><i class="fa fa-check"></i><b>14.3.5</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="14.3.6" data-path="related-individuals.html"><a href="related-individuals.html#inflation-aver2_j-1"><i class="fa fa-check"></i><b>14.3.6</b> inflation ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="related-individuals.html"><a href="related-individuals.html#fake-quintuplets"><i class="fa fa-check"></i><b>14.4</b> fake quintuplets</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="related-individuals.html"><a href="related-individuals.html#id-lists"><i class="fa fa-check"></i><b>14.4.1</b> id lists</a></li>
<li class="chapter" data-level="14.4.2" data-path="related-individuals.html"><a href="related-individuals.html#make-bfiles"><i class="fa fa-check"></i><b>14.4.2</b> make bfiles</a></li>
<li class="chapter" data-level="14.4.3" data-path="related-individuals.html"><a href="related-individuals.html#simulate-phenotypes"><i class="fa fa-check"></i><b>14.4.3</b> simulate phenotypes</a></li>
<li class="chapter" data-level="14.4.4" data-path="related-individuals.html"><a href="related-individuals.html#gwas-5"><i class="fa fa-check"></i><b>14.4.4</b> gwas</a></li>
<li class="chapter" data-level="14.4.5" data-path="related-individuals.html"><a href="related-individuals.html#compute-aver2-1"><i class="fa fa-check"></i><b>14.4.5</b> compute aver2</a></li>
<li class="chapter" data-level="14.4.6" data-path="related-individuals.html"><a href="related-individuals.html#chisq-aver2-1"><i class="fa fa-check"></i><b>14.4.6</b> chisq ~ aver2</a></li>
<li class="chapter" data-level="14.4.7" data-path="related-individuals.html"><a href="related-individuals.html#intercept-slope-estimates"><i class="fa fa-check"></i><b>14.4.7</b> intercept &amp; slope estimates</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="related-individuals.html"><a href="related-individuals.html#unrelated-controls"><i class="fa fa-check"></i><b>14.5</b> unrelated controls</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="related-individuals.html"><a href="related-individuals.html#id-lists-1"><i class="fa fa-check"></i><b>14.5.1</b> id lists</a></li>
<li class="chapter" data-level="14.5.2" data-path="related-individuals.html"><a href="related-individuals.html#make-bfiles-1"><i class="fa fa-check"></i><b>14.5.2</b> make bfiles</a></li>
<li class="chapter" data-level="14.5.3" data-path="related-individuals.html"><a href="related-individuals.html#simulate-phenotypes-1"><i class="fa fa-check"></i><b>14.5.3</b> simulate phenotypes</a></li>
<li class="chapter" data-level="14.5.4" data-path="related-individuals.html"><a href="related-individuals.html#gwas-6"><i class="fa fa-check"></i><b>14.5.4</b> gwas</a></li>
<li class="chapter" data-level="14.5.5" data-path="related-individuals.html"><a href="related-individuals.html#compute-aver2-2"><i class="fa fa-check"></i><b>14.5.5</b> compute aver2</a></li>
<li class="chapter" data-level="14.5.6" data-path="related-individuals.html"><a href="related-individuals.html#chisq-aver2-2"><i class="fa fa-check"></i><b>14.5.6</b> chisq ~ aver2</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="related-individuals.html"><a href="related-individuals.html#related-vs.-unrelated"><i class="fa fa-check"></i><b>14.6</b> related vs. unrelated</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="related-individuals.html"><a href="related-individuals.html#chisq-test-statistics-1"><i class="fa fa-check"></i><b>14.6.1</b> chisq test statistics</a></li>
<li class="chapter" data-level="14.6.2" data-path="related-individuals.html"><a href="related-individuals.html#aver2"><i class="fa fa-check"></i><b>14.6.2</b> aver2</a></li>
<li class="chapter" data-level="14.6.3" data-path="related-individuals.html"><a href="related-individuals.html#inflation-aver2-1"><i class="fa fa-check"></i><b>14.6.3</b> inflation ~ aver2</a></li>
<li class="chapter" data-level="14.6.4" data-path="related-individuals.html"><a href="related-individuals.html#chisq-ldscore"><i class="fa fa-check"></i><b>14.6.4</b> chisq ~ ldscore</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html"><i class="fa fa-check"></i><b>15</b> compute <span class="math inline">\(\sum_{i,j}^{m_1, m_2}r^2_{i,j}\)</span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#good-gwas-all-qced-snps"><i class="fa fa-check"></i><b>15.1</b> good GWAS-all qced snps</a></li>
<li class="chapter" data-level="15.2" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#good-gwass--ldak-thin-snps"><i class="fa fa-check"></i><b>15.2</b> good GWASs- ldak-thin snps</a></li>
<li class="chapter" data-level="15.3" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#bad-gwass-all-qced-snps"><i class="fa fa-check"></i><b>15.3</b> bad GWASs-all qced snps</a></li>
<li class="chapter" data-level="15.4" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#summary-12"><i class="fa fa-check"></i><b>15.4</b> summary</a></li>
<li class="chapter" data-level="15.5" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#aver2j"><i class="fa fa-check"></i><b>15.5</b> compute aver2_j</a></li>
<li class="chapter" data-level="15.6" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#mixed-pop-gwas-with-pc-as-covariates"><i class="fa fa-check"></i><b>15.6</b> mixed pop GWAS with PC as covariates</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="assortative-mating.html"><a href="assortative-mating.html"><i class="fa fa-check"></i><b>16</b> Assortative mating</a>
<ul>
<li class="chapter" data-level="16.1" data-path="assortative-mating.html"><a href="assortative-mating.html#test-the-idea"><i class="fa fa-check"></i><b>16.1</b> Test the idea</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="assortative-mating.html"><a href="assortative-mating.html#st-try"><i class="fa fa-check"></i><b>16.1.1</b> 1st try</a></li>
<li class="chapter" data-level="16.1.2" data-path="assortative-mating.html"><a href="assortative-mating.html#nd-try"><i class="fa fa-check"></i><b>16.1.2</b> 2nd try</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html"><i class="fa fa-check"></i><b>17</b> Reference Panel: 1k Genome</a>
<ul>
<li class="chapter" data-level="17.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#common-snplist"><i class="fa fa-check"></i><b>17.1</b> common snplist</a></li>
<li class="chapter" data-level="17.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#compute-aver2-3"><i class="fa fa-check"></i><b>17.2</b> compute aver2</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#bad-gwas-1"><i class="fa fa-check"></i><b>17.2.1</b> bad gwas</a></li>
<li class="chapter" data-level="17.2.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#varying-levels-of-confounding"><i class="fa fa-check"></i><b>17.2.2</b> varying levels of confounding</a></li>
<li class="chapter" data-level="17.2.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#good-gwas-1"><i class="fa fa-check"></i><b>17.2.3</b> good gwas</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#detect-confounding"><i class="fa fa-check"></i><b>17.3</b> detect confounding</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#bad-gwas-2"><i class="fa fa-check"></i><b>17.3.1</b> bad gwas</a></li>
<li class="chapter" data-level="17.3.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#varying-levels-of-confounding-1"><i class="fa fa-check"></i><b>17.3.2</b> varying levels of confounding</a></li>
<li class="chapter" data-level="17.3.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#good-gwas-2"><i class="fa fa-check"></i><b>17.3.3</b> good gwas</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#estimate-inflation"><i class="fa fa-check"></i><b>17.4</b> estimate inflation</a></li>
<li class="chapter" data-level="17.5" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#stratified-aver2"><i class="fa fa-check"></i><b>17.5</b> stratified aver2</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#calc-aver2"><i class="fa fa-check"></i><b>17.5.1</b> calc aver2</a></li>
<li class="chapter" data-level="17.5.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#organize-data-8"><i class="fa fa-check"></i><b>17.5.2</b> organize data</a></li>
<li class="chapter" data-level="17.5.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#plot-aver2-of-pairwise-mixture-pops"><i class="fa fa-check"></i><b>17.5.3</b> plot aver2 of pairwise mixture pops</a></li>
<li class="chapter" data-level="17.5.4" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#chisq-1-x-aver2"><i class="fa fa-check"></i><b>17.5.4</b> chisq ~ 1 x aver2</a></li>
<li class="chapter" data-level="17.5.5" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#chisq-multi-aver2"><i class="fa fa-check"></i><b>17.5.5</b> chisq ~ multi-aver2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html"><i class="fa fa-check"></i><b>18</b> Fine-scale population stratification</a>
<ul>
<li class="chapter" data-level="18.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#birth-location-data"><i class="fa fa-check"></i><b>18.1</b> birth location data</a></li>
<li class="chapter" data-level="18.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#pca-of-337k"><i class="fa fa-check"></i><b>18.2</b> pca of 337k</a></li>
<li class="chapter" data-level="18.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#birth-place-gwas"><i class="fa fa-check"></i><b>18.3</b> birth place gwas</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-7"><i class="fa fa-check"></i><b>18.3.1</b> gwas</a></li>
<li class="chapter" data-level="18.3.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#chisq-aver2-3"><i class="fa fa-check"></i><b>18.3.2</b> chisq ~ aver2</a></li>
<li class="chapter" data-level="18.3.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#detect-inflation-using-1kg"><i class="fa fa-check"></i><b>18.3.3</b> detect inflation using 1kg</a></li>
<li class="chapter" data-level="18.3.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-results"><i class="fa fa-check"></i><b>18.3.4</b> gwas results</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-based-on-pc-clusters"><i class="fa fa-check"></i><b>18.4</b> GWAS based on PC clusters</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-lists-2"><i class="fa fa-check"></i><b>18.4.1</b> id lists</a></li>
<li class="chapter" data-level="18.4.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-list-for-bad-gwas2"><i class="fa fa-check"></i><b>18.4.2</b> id list for bad gwas2</a></li>
<li class="chapter" data-level="18.4.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-list-for-bad-gwas3"><i class="fa fa-check"></i><b>18.4.3</b> id list for bad gwas3</a></li>
<li class="chapter" data-level="18.4.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-3"><i class="fa fa-check"></i><b>18.4.4</b> bad gwas</a></li>
<li class="chapter" data-level="18.4.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2"><i class="fa fa-check"></i><b>18.4.5</b> bad gwas#2</a></li>
<li class="chapter" data-level="18.4.6" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3"><i class="fa fa-check"></i><b>18.4.6</b> bad gwas#3</a></li>
<li class="chapter" data-level="18.4.7" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-3"><i class="fa fa-check"></i><b>18.4.7</b> good gwas</a></li>
<li class="chapter" data-level="18.4.8" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-1"><i class="fa fa-check"></i><b>18.4.8</b> control gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#compute-aver2-4"><i class="fa fa-check"></i><b>18.5</b> compute aver2</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-4"><i class="fa fa-check"></i><b>18.5.1</b> bad-gwas</a></li>
<li class="chapter" data-level="18.5.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2-1"><i class="fa fa-check"></i><b>18.5.2</b> bad-gwas#2</a></li>
<li class="chapter" data-level="18.5.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3-1"><i class="fa fa-check"></i><b>18.5.3</b> bad-gwas#3</a></li>
<li class="chapter" data-level="18.5.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-4"><i class="fa fa-check"></i><b>18.5.4</b> good-gwas</a></li>
<li class="chapter" data-level="18.5.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-2"><i class="fa fa-check"></i><b>18.5.5</b> control-gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#chisq-aver2-4"><i class="fa fa-check"></i><b>18.6</b> chisq ~ aver2</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-5"><i class="fa fa-check"></i><b>18.6.1</b> bad gwas</a></li>
<li class="chapter" data-level="18.6.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2-2"><i class="fa fa-check"></i><b>18.6.2</b> bad gwas#2</a></li>
<li class="chapter" data-level="18.6.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3-2"><i class="fa fa-check"></i><b>18.6.3</b> bad gwas#3</a></li>
<li class="chapter" data-level="18.6.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-5"><i class="fa fa-check"></i><b>18.6.4</b> good gwas</a></li>
<li class="chapter" data-level="18.6.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-3"><i class="fa fa-check"></i><b>18.6.5</b> control gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#inflation-aver2-2"><i class="fa fa-check"></i><b>18.7</b> inflation ~ aver2</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="genotyping-errors.html"><a href="genotyping-errors.html"><i class="fa fa-check"></i><b>19</b> genotyping errors</a>
<ul>
<li class="chapter" data-level="19.1" data-path="genotyping-errors.html"><a href="genotyping-errors.html#id-list-phenotypes"><i class="fa fa-check"></i><b>19.1</b> id list &amp; phenotypes</a></li>
<li class="chapter" data-level="19.2" data-path="genotyping-errors.html"><a href="genotyping-errors.html#gwas-8"><i class="fa fa-check"></i><b>19.2</b> gwas</a></li>
<li class="chapter" data-level="19.3" data-path="genotyping-errors.html"><a href="genotyping-errors.html#compute-aver2-5"><i class="fa fa-check"></i><b>19.3</b> compute aver2</a></li>
<li class="chapter" data-level="19.4" data-path="genotyping-errors.html"><a href="genotyping-errors.html#chisq-aver2-5"><i class="fa fa-check"></i><b>19.4</b> chisq ~ aver2</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="genome-wide-aver2.html"><a href="genome-wide-aver2.html"><i class="fa fa-check"></i><b>20</b> genome-wide aver2</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GWAS Quality Control</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fine-scale-population-stratification" class="section level1" number="18">
<h1><span class="header-section-number">18</span> Fine-scale population stratification</h1>
<div id="birth-location-data" class="section level2" number="18.1">
<h2><span class="header-section-number">18.1</span> birth location data</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="fine-scale-population-stratification.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract raw phenotype data ----------------------------------------------------</span></span>
<span id="cb1-2"><a href="fine-scale-population-stratification.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">options</span><span class="er">(</span><span class="ex">scipen</span> = 100<span class="kw">)</span></span>
<span id="cb1-3"><a href="fine-scale-population-stratification.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="va">head</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;phen/ukb45861.header&quot;</span><span class="ex">,</span> sep=<span class="st">&quot;,&quot;</span>, header=F, stringsAsFactors = F<span class="kw">)</span></span>
<span id="cb1-4"><a href="fine-scale-population-stratification.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># function to get the variables</span></span>
<span id="cb1-5"><a href="fine-scale-population-stratification.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="va">get</span><span class="op">=</span>function<span class="kw">(</span><span class="fu">nm</span><span class="kw">){</span></span>
<span id="cb1-6"><a href="fine-scale-population-stratification.html#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">colnum</span><span class="op">=</span>grep<span class="kw">(</span><span class="fu">nm</span>,head,fixed=TRUE<span class="kw">)</span></span>
<span id="cb1-7"><a href="fine-scale-population-stratification.html#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">out</span><span class="op">=</span>data.frame<span class="kw">(</span><span class="ex">t</span><span class="er">(</span><span class="ex">rbind</span><span class="er">(</span><span class="ex">colnum,</span> head[,colnum]<span class="kw">)))</span></span>
<span id="cb1-8"><a href="fine-scale-population-stratification.html#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">names</span><span class="er">(</span><span class="ex">out</span><span class="kw">)</span><span class="ex">=c</span><span class="er">(</span><span class="st">&quot;column&quot;</span><span class="ex">,</span> <span class="st">&quot;field&quot;</span><span class="kw">)</span></span>
<span id="cb1-9"><a href="fine-scale-population-stratification.html#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">(</span><span class="ex">out</span><span class="kw">)</span></span>
<span id="cb1-10"><a href="fine-scale-population-stratification.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb1-11"><a href="fine-scale-population-stratification.html#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="fine-scale-population-stratification.html#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># get the variables</span></span>
<span id="cb1-13"><a href="fine-scale-population-stratification.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>rbind<span class="kw">(</span><span class="ex">get</span><span class="er">(</span><span class="st">&#39;129-&#39;</span><span class="kw">)</span><span class="ex">,</span> <span class="co"># east co-ordinate: birth place in UK</span></span>
<span id="cb1-14"><a href="fine-scale-population-stratification.html#cb1-14" aria-hidden="true" tabindex="-1"></a>          <span class="ex">get</span><span class="er">(</span><span class="st">&#39;130-&#39;</span><span class="kw">))</span> <span class="co"># north co-ordinate: birth place in UK</span></span>
<span id="cb1-15"><a href="fine-scale-population-stratification.html#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="fine-scale-population-stratification.html#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># only select the right variables</span></span>
<span id="cb1-17"><a href="fine-scale-population-stratification.html#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>out[c<span class="kw">(</span><span class="ex">1:3,</span> 20:22<span class="kw">)</span><span class="ex">,]</span></span>
<span id="cb1-18"><a href="fine-scale-population-stratification.html#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="fine-scale-population-stratification.html#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">out,</span><span class="st">&quot;phen/birth-place.colnum&quot;</span><span class="ex">,</span> col.names=F, row.names=F, sep=<span class="st">&quot;\t&quot;</span>, quote=F<span class="kw">)</span></span>
<span id="cb1-20"><a href="fine-scale-population-stratification.html#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="fine-scale-population-stratification.html#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># extract dat-------------------------------------------------------------------</span></span>
<span id="cb1-22"><a href="fine-scale-population-stratification.html#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-F</span> <span class="st">&#39;&quot;,&quot;&#39;</span> <span class="st">&#39;(NR==FNR){a[$1];next}</span></span>
<span id="cb1-23"><a href="fine-scale-population-stratification.html#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="st">              {printf &quot;%s\&quot;&quot;, $1;</span></span>
<span id="cb1-24"><a href="fine-scale-population-stratification.html#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="st">               for(i in a){printf &quot; \&quot;%s\&quot;&quot;, $i};</span></span>
<span id="cb1-25"><a href="fine-scale-population-stratification.html#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="st">               printf &quot;\n&quot;}&#39;</span> phen/birth-place.colnum phen/ukb45861.csv <span class="op">&gt;</span> phen/birth-place.dat</span>
<span id="cb1-26"><a href="fine-scale-population-stratification.html#cb1-26" aria-hidden="true" tabindex="-1"></a>               </span>
<span id="cb1-27"><a href="fine-scale-population-stratification.html#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># organize dat------------------------------------------------------------------</span></span>
<span id="cb1-28"><a href="fine-scale-population-stratification.html#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> phen/other-traits</span>
<span id="cb1-29"><a href="fine-scale-population-stratification.html#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="va">dat</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;phen/birth-place.dat&quot;</span><span class="ex">,</span> header=T, stringsAsFactors=F<span class="kw">)</span></span>
<span id="cb1-30"><a href="fine-scale-population-stratification.html#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>read.table<span class="kw">(</span><span class="st">&quot;phen/covariates.phen&quot;</span><span class="ex">,</span> header=T, stringsAsFactors=F<span class="kw">)</span></span>
<span id="cb1-31"><a href="fine-scale-population-stratification.html#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="va">m</span><span class="op">=</span>match<span class="kw">(</span><span class="ex">dat</span><span class="va">$eid</span><span class="ex">,cov</span><span class="va">$eid</span><span class="kw">)</span></span>
<span id="cb1-32"><a href="fine-scale-population-stratification.html#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span><span class="op">=</span>cov[m,]</span>
<span id="cb1-33"><a href="fine-scale-population-stratification.html#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="fine-scale-population-stratification.html#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># -1 = unknown location</span></span>
<span id="cb1-35"><a href="fine-scale-population-stratification.html#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="va">dat1</span><span class="op">=</span>dat</span>
<span id="cb1-36"><a href="fine-scale-population-stratification.html#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="kw">(</span><span class="ex">i</span> in 2:7<span class="kw">){</span></span>
<span id="cb1-37"><a href="fine-scale-population-stratification.html#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="va">dat1</span><span class="op">[</span>dat[,i<span class="op">]=</span>=-1 <span class="kw">&amp;</span> <span class="ex">!is.na</span><span class="er">(</span><span class="va">dat</span><span class="op">[</span>,i<span class="op">]</span><span class="kw">)</span><span class="ex">,i]=</span><span class="st">&quot;NA&quot;</span></span>
<span id="cb1-38"><a href="fine-scale-population-stratification.html#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb1-39"><a href="fine-scale-population-stratification.html#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="fine-scale-population-stratification.html#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># note: Cook 2020 p.2804 mentioned that </span></span>
<span id="cb1-41"><a href="fine-scale-population-stratification.html#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;We excluded individuals with missing birth location and </span></span>
<span id="cb1-42"><a href="fine-scale-population-stratification.html#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># those from the pilot study at the Stockport recruitment (centre code10003) </span></span>
<span id="cb1-43"><a href="fine-scale-population-stratification.html#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co"># center for which the Cartesian coordinates were incorrect. </span></span>
<span id="cb1-44"><a href="fine-scale-population-stratification.html#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="fine-scale-population-stratification.html#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># exclude stockport centre</span></span>
<span id="cb1-46"><a href="fine-scale-population-stratification.html#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="va">dat1</span><span class="op">[</span>cov<span class="va">$centre</span>==10003 &amp; !is.na(cov<span class="va">$centre</span>),<span class="st">&quot;X130.0.0&quot;</span><span class="op">]=</span><span class="st">&quot;NA&quot;</span></span>
<span id="cb1-47"><a href="fine-scale-population-stratification.html#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="va">dat1</span><span class="op">[</span>cov<span class="va">$centre</span>==10003 &amp; !is.na(cov<span class="va">$centre</span>),<span class="st">&quot;X129.0.0&quot;</span><span class="op">]=</span><span class="st">&quot;NA&quot;</span></span>
<span id="cb1-48"><a href="fine-scale-population-stratification.html#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="fine-scale-population-stratification.html#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co"># note: we only use the baseline data</span></span>
<span id="cb1-50"><a href="fine-scale-population-stratification.html#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">cbind</span><span class="er">(</span><span class="va">dat1</span><span class="op">[</span>,1<span class="op">]</span><span class="ex">,dat[,1],</span> dat[,7]<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb1-51"><a href="fine-scale-population-stratification.html#cb1-51" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;phen/other-traits/east-coord-birth-place.raw.pheno&quot;</span><span class="ex">,</span> </span>
<span id="cb1-52"><a href="fine-scale-population-stratification.html#cb1-52" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=F,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb1-53"><a href="fine-scale-population-stratification.html#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="ex">write.table</span><span class="er">(</span><span class="ex">cbind</span><span class="er">(</span><span class="va">dat1</span><span class="op">[</span>,1<span class="op">]</span><span class="ex">,dat[,1],</span> dat[,6]<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb1-54"><a href="fine-scale-population-stratification.html#cb1-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;phen/other-traits/north-coord-birth-place.raw.pheno&quot;</span><span class="ex">,</span> </span>
<span id="cb1-55"><a href="fine-scale-population-stratification.html#cb1-55" aria-hidden="true" tabindex="-1"></a>            <span class="ex">col.names=F,</span> row.names=F, quote=F<span class="kw">)</span></span>
<span id="cb1-56"><a href="fine-scale-population-stratification.html#cb1-56" aria-hidden="true" tabindex="-1"></a>            </span></code></pre></div>
</div>
<div id="pca-of-337k" class="section level2" number="18.2">
<h2><span class="header-section-number">18.2</span> pca of 337k</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="fine-scale-population-stratification.html#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="fine-scale-population-stratification.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune snps</span></span>
<span id="cb2-3"><a href="fine-scale-population-stratification.html#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="fine-scale-population-stratification.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb2-5"><a href="fine-scale-population-stratification.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb2-6"><a href="fine-scale-population-stratification.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb2-7"><a href="fine-scale-population-stratification.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 4</span></span>
<span id="cb2-8"><a href="fine-scale-population-stratification.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb2-9"><a href="fine-scale-population-stratification.html#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb2-10"><a href="fine-scale-population-stratification.html#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --max-threads 4 </span><span class="dt">\</span></span>
<span id="cb2-11"><a href="fine-scale-population-stratification.html#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-prune 0.05 </span><span class="dt">\</span></span>
<span id="cb2-12"><a href="fine-scale-population-stratification.html#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="st">          --window-kb 1000 </span><span class="dt">\</span></span>
<span id="cb2-13"><a href="fine-scale-population-stratification.html#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-norm.use </span><span class="dt">\</span></span>
<span id="cb2-14"><a href="fine-scale-population-stratification.html#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm </span><span class="dt">\</span></span>
<span id="cb2-15"><a href="fine-scale-population-stratification.html#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../ukbb-recommend.id </span><span class="dt">\</span></span>
<span id="cb2-16"><a href="fine-scale-population-stratification.html#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --thin ../thin/thin-geno-norm</span></span>
<span id="cb2-17"><a href="fine-scale-population-stratification.html#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>  <span class="op">&gt;</span> sh_script/thin-geno-norm</span>
<span id="cb2-18"><a href="fine-scale-population-stratification.html#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="fine-scale-population-stratification.html#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/thin-geno-norm-chr<span class="va">$j</span> <span class="op">&gt;</span>../job-records/thin-geno-norm</span>
<span id="cb2-20"><a href="fine-scale-population-stratification.html#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="fine-scale-population-stratification.html#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># pca using thinned snps</span></span>
<span id="cb2-22"><a href="fine-scale-population-stratification.html#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb2-23"><a href="fine-scale-population-stratification.html#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 50G</span></span>
<span id="cb2-24"><a href="fine-scale-population-stratification.html#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 10</span></span>
<span id="cb2-25"><a href="fine-scale-population-stratification.html#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 6:0:0</span></span>
<span id="cb2-26"><a href="fine-scale-population-stratification.html#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="fine-scale-population-stratification.html#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="st">./plink2 --threads 15 </span><span class="dt">\</span></span>
<span id="cb2-28"><a href="fine-scale-population-stratification.html#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="st">         --pca approx </span><span class="dt">\</span></span>
<span id="cb2-29"><a href="fine-scale-population-stratification.html#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="st">         --bfile ../gen/geno-norm </span><span class="dt">\</span></span>
<span id="cb2-30"><a href="fine-scale-population-stratification.html#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="st">         --memory 100000 </span><span class="dt">\</span></span>
<span id="cb2-31"><a href="fine-scale-population-stratification.html#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="st">         --extract ../thin/thin-geno-norm.in </span><span class="dt">\</span></span>
<span id="cb2-32"><a href="fine-scale-population-stratification.html#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="st">         --keep ../ukbb-recommend.id </span><span class="dt">\</span></span>
<span id="cb2-33"><a href="fine-scale-population-stratification.html#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="st">         --out ../gen/pca-337k-ukbb</span></span>
<span id="cb2-34"><a href="fine-scale-population-stratification.html#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/pca-337k-white-british.sh</span>
<span id="cb2-35"><a href="fine-scale-population-stratification.html#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="fine-scale-population-stratification.html#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/pca-337k-white-british.sh <span class="op">&gt;</span>../job-records/pca</span></code></pre></div>
<p>Here we want to find out the correlation between PC and birth place.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="fine-scale-population-stratification.html#cb3-1" aria-hidden="true" tabindex="-1"></a>east<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;phen/other-traits/east-coord-birth-place.raw.pheno&quot;</span>)</span>
<span id="cb3-2"><a href="fine-scale-population-stratification.html#cb3-2" aria-hidden="true" tabindex="-1"></a>north<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;phen/other-traits/north-coord-birth-place.raw.pheno&quot;</span>)</span>
<span id="cb3-3"><a href="fine-scale-population-stratification.html#cb3-3" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;ukbb-recommend.id&quot;</span>)</span>
<span id="cb3-4"><a href="fine-scale-population-stratification.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pcs of 337k recommended individuals</span></span>
<span id="cb3-5"><a href="fine-scale-population-stratification.html#cb3-5" aria-hidden="true" tabindex="-1"></a>pc<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;gen/pca-337k-ukbb.eigenvec&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb3-6"><a href="fine-scale-population-stratification.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pcs provided by ukbb</span></span>
<span id="cb3-7"><a href="fine-scale-population-stratification.html#cb3-7" aria-hidden="true" tabindex="-1"></a>pc_ukbb<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;phen/PC-10.use&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb3-8"><a href="fine-scale-population-stratification.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-9"><a href="fine-scale-population-stratification.html#cb3-9" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">=</span><span class="fu">match</span>(id<span class="sc">$</span>V1,pc<span class="sc">$</span>V1)</span>
<span id="cb3-10"><a href="fine-scale-population-stratification.html#cb3-10" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">=</span><span class="fu">match</span>(id<span class="sc">$</span>V1,east<span class="sc">$</span>V1)</span>
<span id="cb3-11"><a href="fine-scale-population-stratification.html#cb3-11" aria-hidden="true" tabindex="-1"></a>m3<span class="ot">=</span><span class="fu">match</span>(id<span class="sc">$</span>V1,north<span class="sc">$</span>V1)</span>
<span id="cb3-12"><a href="fine-scale-population-stratification.html#cb3-12" aria-hidden="true" tabindex="-1"></a>m4<span class="ot">=</span><span class="fu">match</span>(id<span class="sc">$</span>V1,pc_ukbb<span class="sc">$</span>V1)</span>
<span id="cb3-13"><a href="fine-scale-population-stratification.html#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="fine-scale-population-stratification.html#cb3-14" aria-hidden="true" tabindex="-1"></a>pc_ukbb<span class="ot">=</span>pc_ukbb[m4,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb3-15"><a href="fine-scale-population-stratification.html#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pc_ukbb)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;pc&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb3-16"><a href="fine-scale-population-stratification.html#cb3-16" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">id=</span>id<span class="sc">$</span>V1,</span>
<span id="cb3-17"><a href="fine-scale-population-stratification.html#cb3-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">east=</span>east<span class="sc">$</span>V3[m2],</span>
<span id="cb3-18"><a href="fine-scale-population-stratification.html#cb3-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">north=</span>north<span class="sc">$</span>V3[m3],</span>
<span id="cb3-19"><a href="fine-scale-population-stratification.html#cb3-19" aria-hidden="true" tabindex="-1"></a>               pc[m1,<span class="dv">3</span><span class="sc">:</span><span class="dv">12</span>])</span>
<span id="cb3-20"><a href="fine-scale-population-stratification.html#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dat)[<span class="dv">4</span><span class="sc">:</span><span class="dv">13</span>]<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;PC&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb3-21"><a href="fine-scale-population-stratification.html#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="fine-scale-population-stratification.html#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dat<span class="sc">$</span>east,dat[,<span class="dv">4</span><span class="sc">:</span><span class="dv">13</span>], <span class="at">use=</span><span class="st">&quot;pair&quot;</span>)</span>
<span id="cb3-23"><a href="fine-scale-population-stratification.html#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dat<span class="sc">$</span>north,dat[,<span class="dv">4</span><span class="sc">:</span><span class="dv">13</span>], <span class="at">use=</span><span class="st">&quot;pair&quot;</span>)</span>
<span id="cb3-24"><a href="fine-scale-population-stratification.html#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="fine-scale-population-stratification.html#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dat[,<span class="dv">4</span><span class="sc">:</span><span class="dv">13</span>],pc_ukbb[,<span class="dv">2</span><span class="sc">:</span><span class="dv">11</span>])</span>
<span id="cb3-26"><a href="fine-scale-population-stratification.html#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="fine-scale-population-stratification.html#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># plot pc1 vs. pc2</span></span>
<span id="cb3-28"><a href="fine-scale-population-stratification.html#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-inhouse-pc1-vs-pc2.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb3-29"><a href="fine-scale-population-stratification.html#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb3-30"><a href="fine-scale-population-stratification.html#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>PC1, dat<span class="sc">$</span>PC2,</span>
<span id="cb3-31"><a href="fine-scale-population-stratification.html#cb3-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;1st PC&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;2nd PC&quot;</span>,</span>
<span id="cb3-32"><a href="fine-scale-population-stratification.html#cb3-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span><span class="st">&quot;ukbb 337k unrelated white British&quot;</span>, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb3-33"><a href="fine-scale-population-stratification.html#cb3-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb3-34"><a href="fine-scale-population-stratification.html#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="fine-scale-population-stratification.html#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb3-36"><a href="fine-scale-population-stratification.html#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="fine-scale-population-stratification.html#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co"># plot pc1 vs. pc2 col-coded by birth location</span></span>
<span id="cb3-38"><a href="fine-scale-population-stratification.html#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="fine-scale-population-stratification.html#cb3-39" aria-hidden="true" tabindex="-1"></a>cutoff1<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>east, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb3-40"><a href="fine-scale-population-stratification.html#cb3-40" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>bin_east<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>east, <span class="at">breaks=</span>cutoff1, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff1)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb3-41"><a href="fine-scale-population-stratification.html#cb3-41" aria-hidden="true" tabindex="-1"></a>cutoff2<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>north, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb3-42"><a href="fine-scale-population-stratification.html#cb3-42" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>bin_north<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>north, <span class="at">breaks=</span>cutoff2, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff2)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb3-43"><a href="fine-scale-population-stratification.html#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="fine-scale-population-stratification.html#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;RColorBrewer&quot;</span>)</span>
<span id="cb3-45"><a href="fine-scale-population-stratification.html#cb3-45" aria-hidden="true" tabindex="-1"></a>pallete1<span class="ot">=</span><span class="fu">brewer.pal</span>(<span class="dv">10</span>, <span class="at">name=</span><span class="st">&quot;Spectral&quot;</span>)</span>
<span id="cb3-46"><a href="fine-scale-population-stratification.html#cb3-46" aria-hidden="true" tabindex="-1"></a>mycol1<span class="ot">=</span><span class="fu">apply</span>(<span class="fu">col2rgb</span>(pallete1), <span class="dv">2</span>, </span>
<span id="cb3-47"><a href="fine-scale-population-stratification.html#cb3-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(X) <span class="fu">rgb</span>(X[<span class="dv">1</span>], X[<span class="dv">2</span>], X[<span class="dv">3</span>], <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">220</span>))</span>
<span id="cb3-48"><a href="fine-scale-population-stratification.html#cb3-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-49"><a href="fine-scale-population-stratification.html#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co">#pallete2=brewer.pal(10, name=&quot;Purples&quot;)</span></span>
<span id="cb3-50"><a href="fine-scale-population-stratification.html#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co">#mycol2=apply(col2rgb(pallete2), 2, </span></span>
<span id="cb3-51"><a href="fine-scale-population-stratification.html#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co">#            function(X) rgb(X[1], X[2], X[3], max=255, alpha=220))</span></span>
<span id="cb3-52"><a href="fine-scale-population-stratification.html#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="fine-scale-population-stratification.html#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-inhouse-pc1-vs-pc2-by-birth-location.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">40</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb3-54"><a href="fine-scale-population-stratification.html#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="fine-scale-population-stratification.html#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb3-56"><a href="fine-scale-population-stratification.html#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co"># east</span></span>
<span id="cb3-57"><a href="fine-scale-population-stratification.html#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlab=</span><span class="st">&quot;1st PC&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;2nd PC&quot;</span>,</span>
<span id="cb3-58"><a href="fine-scale-population-stratification.html#cb3-58" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>PC1), <span class="fu">max</span>(dat<span class="sc">$</span>PC1)), </span>
<span id="cb3-59"><a href="fine-scale-population-stratification.html#cb3-59" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>PC2), <span class="fu">max</span>(dat<span class="sc">$</span>PC2)),</span>
<span id="cb3-60"><a href="fine-scale-population-stratification.html#cb3-60" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;by east coord bin&quot;</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb3-61"><a href="fine-scale-population-stratification.html#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb3-62"><a href="fine-scale-population-stratification.html#cb3-62" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>dat[dat<span class="sc">$</span>bin_east<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>bin_east),]</span>
<span id="cb3-63"><a href="fine-scale-population-stratification.html#cb3-63" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>PC1, sel<span class="sc">$</span>PC2, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb3-64"><a href="fine-scale-population-stratification.html#cb3-64" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol1[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) </span>
<span id="cb3-65"><a href="fine-scale-population-stratification.html#cb3-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-66"><a href="fine-scale-population-stratification.html#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="fine-scale-population-stratification.html#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="co"># north</span></span>
<span id="cb3-68"><a href="fine-scale-population-stratification.html#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlab=</span><span class="st">&quot;1st PC&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;2nd PC&quot;</span>,</span>
<span id="cb3-69"><a href="fine-scale-population-stratification.html#cb3-69" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>PC1), <span class="fu">max</span>(dat<span class="sc">$</span>PC1)), </span>
<span id="cb3-70"><a href="fine-scale-population-stratification.html#cb3-70" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>PC2), <span class="fu">max</span>(dat<span class="sc">$</span>PC2)),</span>
<span id="cb3-71"><a href="fine-scale-population-stratification.html#cb3-71" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;by north coord bin&quot;</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb3-72"><a href="fine-scale-population-stratification.html#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb3-73"><a href="fine-scale-population-stratification.html#cb3-73" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>dat[dat<span class="sc">$</span>bin_north<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>bin_north),]</span>
<span id="cb3-74"><a href="fine-scale-population-stratification.html#cb3-74" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>PC1, sel<span class="sc">$</span>PC2, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb3-75"><a href="fine-scale-population-stratification.html#cb3-75" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol2[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) </span>
<span id="cb3-76"><a href="fine-scale-population-stratification.html#cb3-76" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-77"><a href="fine-scale-population-stratification.html#cb3-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-78"><a href="fine-scale-population-stratification.html#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb3-79"><a href="fine-scale-population-stratification.html#cb3-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-80"><a href="fine-scale-population-stratification.html#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="co"># seperate plots by location bin</span></span>
<span id="cb3-81"><a href="fine-scale-population-stratification.html#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;RColorBrewer&quot;</span>)</span>
<span id="cb3-82"><a href="fine-scale-population-stratification.html#cb3-82" aria-hidden="true" tabindex="-1"></a>pallete<span class="ot">=</span><span class="fu">brewer.pal</span>(<span class="dv">10</span>, <span class="at">name=</span><span class="st">&quot;Spectral&quot;</span>)</span>
<span id="cb3-83"><a href="fine-scale-population-stratification.html#cb3-83" aria-hidden="true" tabindex="-1"></a>mycol<span class="ot">=</span><span class="fu">apply</span>(<span class="fu">col2rgb</span>(pallete), <span class="dv">2</span>, </span>
<span id="cb3-84"><a href="fine-scale-population-stratification.html#cb3-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(X) <span class="fu">rgb</span>(X[<span class="dv">1</span>], X[<span class="dv">2</span>], X[<span class="dv">3</span>], <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">220</span>))</span>
<span id="cb3-85"><a href="fine-scale-population-stratification.html#cb3-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-86"><a href="fine-scale-population-stratification.html#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-inhouse-pc1-vs-pc2-by-east-bin-panel.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb3-87"><a href="fine-scale-population-stratification.html#cb3-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-88"><a href="fine-scale-population-stratification.html#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb3-89"><a href="fine-scale-population-stratification.html#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="co"># east</span></span>
<span id="cb3-90"><a href="fine-scale-population-stratification.html#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb3-91"><a href="fine-scale-population-stratification.html#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>PC1, dat<span class="sc">$</span>PC2, <span class="at">xlab=</span><span class="st">&quot;1st PC&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;2nd PC&quot;</span>,</span>
<span id="cb3-92"><a href="fine-scale-population-stratification.html#cb3-92" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>PC1), <span class="fu">max</span>(dat<span class="sc">$</span>PC1)), </span>
<span id="cb3-93"><a href="fine-scale-population-stratification.html#cb3-93" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>PC2), <span class="fu">max</span>(dat<span class="sc">$</span>PC2)),</span>
<span id="cb3-94"><a href="fine-scale-population-stratification.html#cb3-94" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">211</span>,<span class="dv">211</span>,<span class="dv">211</span>,<span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">150</span>), </span>
<span id="cb3-95"><a href="fine-scale-population-stratification.html#cb3-95" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&quot;east coord bin &quot;</span>, i), <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb3-96"><a href="fine-scale-population-stratification.html#cb3-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-97"><a href="fine-scale-population-stratification.html#cb3-97" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>dat[dat<span class="sc">$</span>bin_east<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>bin_east),]</span>
<span id="cb3-98"><a href="fine-scale-population-stratification.html#cb3-98" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>PC1, sel<span class="sc">$</span>PC2, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb3-99"><a href="fine-scale-population-stratification.html#cb3-99" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) </span>
<span id="cb3-100"><a href="fine-scale-population-stratification.html#cb3-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-101"><a href="fine-scale-population-stratification.html#cb3-101" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb3-102"><a href="fine-scale-population-stratification.html#cb3-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-103"><a href="fine-scale-population-stratification.html#cb3-103" aria-hidden="true" tabindex="-1"></a><span class="co"># north</span></span>
<span id="cb3-104"><a href="fine-scale-population-stratification.html#cb3-104" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-inhouse-pc1-vs-pc2-by-north-bin-panel.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb3-105"><a href="fine-scale-population-stratification.html#cb3-105" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb3-106"><a href="fine-scale-population-stratification.html#cb3-106" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb3-107"><a href="fine-scale-population-stratification.html#cb3-107" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>PC1, dat<span class="sc">$</span>PC2, <span class="at">xlab=</span><span class="st">&quot;1st PC&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;2nd PC&quot;</span>,</span>
<span id="cb3-108"><a href="fine-scale-population-stratification.html#cb3-108" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>PC1), <span class="fu">max</span>(dat<span class="sc">$</span>PC1)), </span>
<span id="cb3-109"><a href="fine-scale-population-stratification.html#cb3-109" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>PC2), <span class="fu">max</span>(dat<span class="sc">$</span>PC2)),</span>
<span id="cb3-110"><a href="fine-scale-population-stratification.html#cb3-110" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">211</span>,<span class="dv">211</span>,<span class="dv">211</span>,<span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">150</span>),</span>
<span id="cb3-111"><a href="fine-scale-population-stratification.html#cb3-111" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&quot;east coord bin &quot;</span>, i), <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb3-112"><a href="fine-scale-population-stratification.html#cb3-112" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>dat[dat<span class="sc">$</span>bin_north<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>bin_north),]</span>
<span id="cb3-113"><a href="fine-scale-population-stratification.html#cb3-113" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>PC1, sel<span class="sc">$</span>PC2, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb3-114"><a href="fine-scale-population-stratification.html#cb3-114" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) </span>
<span id="cb3-115"><a href="fine-scale-population-stratification.html#cb3-115" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-116"><a href="fine-scale-population-stratification.html#cb3-116" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="fine-scale-population-stratification.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot birth location east vs. north</span></span>
<span id="cb4-2"><a href="fine-scale-population-stratification.html#cb4-2" aria-hidden="true" tabindex="-1"></a>east<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;phen/other-traits/east-coord-birth-place.raw.pheno&quot;</span>)</span>
<span id="cb4-3"><a href="fine-scale-population-stratification.html#cb4-3" aria-hidden="true" tabindex="-1"></a>north<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;phen/other-traits/north-coord-birth-place.raw.pheno&quot;</span>)</span>
<span id="cb4-4"><a href="fine-scale-population-stratification.html#cb4-4" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;ukbb-recommend.id&quot;</span>)</span>
<span id="cb4-5"><a href="fine-scale-population-stratification.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pcs of 337k recommended individuals</span></span>
<span id="cb4-6"><a href="fine-scale-population-stratification.html#cb4-6" aria-hidden="true" tabindex="-1"></a>pc<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;gen/pca-337k-ukbb.eigenvec&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb4-7"><a href="fine-scale-population-stratification.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># pcs provided by ukbb</span></span>
<span id="cb4-8"><a href="fine-scale-population-stratification.html#cb4-8" aria-hidden="true" tabindex="-1"></a>pc_ukbb<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;phen/PC-10.use&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb4-9"><a href="fine-scale-population-stratification.html#cb4-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-10"><a href="fine-scale-population-stratification.html#cb4-10" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">=</span><span class="fu">match</span>(id<span class="sc">$</span>V1,pc<span class="sc">$</span>V1)</span>
<span id="cb4-11"><a href="fine-scale-population-stratification.html#cb4-11" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">=</span><span class="fu">match</span>(id<span class="sc">$</span>V1,east<span class="sc">$</span>V1)</span>
<span id="cb4-12"><a href="fine-scale-population-stratification.html#cb4-12" aria-hidden="true" tabindex="-1"></a>m3<span class="ot">=</span><span class="fu">match</span>(id<span class="sc">$</span>V1,north<span class="sc">$</span>V1)</span>
<span id="cb4-13"><a href="fine-scale-population-stratification.html#cb4-13" aria-hidden="true" tabindex="-1"></a>m4<span class="ot">=</span><span class="fu">match</span>(id<span class="sc">$</span>V1,pc_ukbb<span class="sc">$</span>V1)</span>
<span id="cb4-14"><a href="fine-scale-population-stratification.html#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="fine-scale-population-stratification.html#cb4-15" aria-hidden="true" tabindex="-1"></a>pc_ukbb<span class="ot">=</span>pc_ukbb[m4,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb4-16"><a href="fine-scale-population-stratification.html#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pc_ukbb)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;pc&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb4-17"><a href="fine-scale-population-stratification.html#cb4-17" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">id=</span>id<span class="sc">$</span>V1,</span>
<span id="cb4-18"><a href="fine-scale-population-stratification.html#cb4-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">east=</span>east<span class="sc">$</span>V3[m2],</span>
<span id="cb4-19"><a href="fine-scale-population-stratification.html#cb4-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">north=</span>north<span class="sc">$</span>V3[m3],</span>
<span id="cb4-20"><a href="fine-scale-population-stratification.html#cb4-20" aria-hidden="true" tabindex="-1"></a>               pc[m1,<span class="dv">3</span><span class="sc">:</span><span class="dv">12</span>])</span>
<span id="cb4-21"><a href="fine-scale-population-stratification.html#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dat)[<span class="dv">4</span><span class="sc">:</span><span class="dv">13</span>]<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;PC&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb4-22"><a href="fine-scale-population-stratification.html#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="fine-scale-population-stratification.html#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># plot birth location</span></span>
<span id="cb4-24"><a href="fine-scale-population-stratification.html#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-birth-location.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb4-25"><a href="fine-scale-population-stratification.html#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb4-26"><a href="fine-scale-population-stratification.html#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>north, dat<span class="sc">$</span>east,</span>
<span id="cb4-27"><a href="fine-scale-population-stratification.html#cb4-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;north coord&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;east coordinate&quot;</span>,</span>
<span id="cb4-28"><a href="fine-scale-population-stratification.html#cb4-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">main=</span><span class="st">&quot;ukbb 337k unrelated white British&quot;</span>, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb4-29"><a href="fine-scale-population-stratification.html#cb4-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb4-30"><a href="fine-scale-population-stratification.html#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="fine-scale-population-stratification.html#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb4-32"><a href="fine-scale-population-stratification.html#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="fine-scale-population-stratification.html#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># plot birth location col-coded by PC1</span></span>
<span id="cb4-34"><a href="fine-scale-population-stratification.html#cb4-34" aria-hidden="true" tabindex="-1"></a>cutoff1<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>PC1, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb4-35"><a href="fine-scale-population-stratification.html#cb4-35" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>bin_PC1<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>PC1, <span class="at">breaks=</span>cutoff1, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff1)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb4-36"><a href="fine-scale-population-stratification.html#cb4-36" aria-hidden="true" tabindex="-1"></a>cutoff2<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>PC2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb4-37"><a href="fine-scale-population-stratification.html#cb4-37" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>bin_PC2<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>PC2, <span class="at">breaks=</span>cutoff2, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff2)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb4-38"><a href="fine-scale-population-stratification.html#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="fine-scale-population-stratification.html#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;RColorBrewer&quot;</span>)</span>
<span id="cb4-40"><a href="fine-scale-population-stratification.html#cb4-40" aria-hidden="true" tabindex="-1"></a>pallete<span class="ot">=</span><span class="fu">brewer.pal</span>(<span class="dv">10</span>, <span class="at">name=</span><span class="st">&quot;Spectral&quot;</span>)</span>
<span id="cb4-41"><a href="fine-scale-population-stratification.html#cb4-41" aria-hidden="true" tabindex="-1"></a>mycol<span class="ot">=</span><span class="fu">apply</span>(<span class="fu">col2rgb</span>(pallete), <span class="dv">2</span>, </span>
<span id="cb4-42"><a href="fine-scale-population-stratification.html#cb4-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(X) <span class="fu">rgb</span>(X[<span class="dv">1</span>], X[<span class="dv">2</span>], X[<span class="dv">3</span>], <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">150</span>))</span>
<span id="cb4-43"><a href="fine-scale-population-stratification.html#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="fine-scale-population-stratification.html#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-birth-location-by-pc.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">40</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb4-45"><a href="fine-scale-population-stratification.html#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="fine-scale-population-stratification.html#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>,<span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb4-47"><a href="fine-scale-population-stratification.html#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co"># PC1</span></span>
<span id="cb4-48"><a href="fine-scale-population-stratification.html#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlab=</span><span class="st">&quot;north&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;east&quot;</span>,</span>
<span id="cb4-49"><a href="fine-scale-population-stratification.html#cb4-49" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T)), </span>
<span id="cb4-50"><a href="fine-scale-population-stratification.html#cb4-50" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T)),</span>
<span id="cb4-51"><a href="fine-scale-population-stratification.html#cb4-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;by PC1 bin&quot;</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb4-52"><a href="fine-scale-population-stratification.html#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb4-53"><a href="fine-scale-population-stratification.html#cb4-53" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>dat[dat<span class="sc">$</span>bin_PC1<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>bin_PC1),]</span>
<span id="cb4-54"><a href="fine-scale-population-stratification.html#cb4-54" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>north, sel<span class="sc">$</span>east, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb4-55"><a href="fine-scale-population-stratification.html#cb4-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) </span>
<span id="cb4-56"><a href="fine-scale-population-stratification.html#cb4-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-57"><a href="fine-scale-population-stratification.html#cb4-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-58"><a href="fine-scale-population-stratification.html#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="co"># PC2</span></span>
<span id="cb4-59"><a href="fine-scale-population-stratification.html#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlab=</span><span class="st">&quot;north&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;east&quot;</span>,</span>
<span id="cb4-60"><a href="fine-scale-population-stratification.html#cb4-60" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T)), </span>
<span id="cb4-61"><a href="fine-scale-population-stratification.html#cb4-61" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T)),</span>
<span id="cb4-62"><a href="fine-scale-population-stratification.html#cb4-62" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;by PC2 bin&quot;</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb4-63"><a href="fine-scale-population-stratification.html#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb4-64"><a href="fine-scale-population-stratification.html#cb4-64" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>dat[dat<span class="sc">$</span>bin_PC2<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>bin_PC2),]</span>
<span id="cb4-65"><a href="fine-scale-population-stratification.html#cb4-65" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>north, sel<span class="sc">$</span>east, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb4-66"><a href="fine-scale-population-stratification.html#cb4-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) </span>
<span id="cb4-67"><a href="fine-scale-population-stratification.html#cb4-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-68"><a href="fine-scale-population-stratification.html#cb4-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-69"><a href="fine-scale-population-stratification.html#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb4-70"><a href="fine-scale-population-stratification.html#cb4-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-71"><a href="fine-scale-population-stratification.html#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="co"># seperate plots -----------------------------------------------------------------</span></span>
<span id="cb4-72"><a href="fine-scale-population-stratification.html#cb4-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-73"><a href="fine-scale-population-stratification.html#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-birth-location-by-pc1-bin-panel.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb4-74"><a href="fine-scale-population-stratification.html#cb4-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-75"><a href="fine-scale-population-stratification.html#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb4-76"><a href="fine-scale-population-stratification.html#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="co"># PC1</span></span>
<span id="cb4-77"><a href="fine-scale-population-stratification.html#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb4-78"><a href="fine-scale-population-stratification.html#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlab=</span><span class="st">&quot;north&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;east&quot;</span>,</span>
<span id="cb4-79"><a href="fine-scale-population-stratification.html#cb4-79" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">21</span>, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">211</span>,<span class="dv">211</span>,<span class="dv">211</span>,<span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">150</span>), </span>
<span id="cb4-80"><a href="fine-scale-population-stratification.html#cb4-80" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T)), </span>
<span id="cb4-81"><a href="fine-scale-population-stratification.html#cb4-81" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T)),</span>
<span id="cb4-82"><a href="fine-scale-population-stratification.html#cb4-82" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&quot;PC1 bin &quot;</span>, i), <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb4-83"><a href="fine-scale-population-stratification.html#cb4-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-84"><a href="fine-scale-population-stratification.html#cb4-84" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>dat[dat<span class="sc">$</span>bin_PC1<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>bin_PC1),]</span>
<span id="cb4-85"><a href="fine-scale-population-stratification.html#cb4-85" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>north, sel<span class="sc">$</span>east, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb4-86"><a href="fine-scale-population-stratification.html#cb4-86" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) </span>
<span id="cb4-87"><a href="fine-scale-population-stratification.html#cb4-87" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-88"><a href="fine-scale-population-stratification.html#cb4-88" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb4-89"><a href="fine-scale-population-stratification.html#cb4-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-90"><a href="fine-scale-population-stratification.html#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="co"># PC2</span></span>
<span id="cb4-91"><a href="fine-scale-population-stratification.html#cb4-91" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-birth-location-by-pc2-bin-panel.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb4-92"><a href="fine-scale-population-stratification.html#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb4-93"><a href="fine-scale-population-stratification.html#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb4-94"><a href="fine-scale-population-stratification.html#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlab=</span><span class="st">&quot;north&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;east&quot;</span>,</span>
<span id="cb4-95"><a href="fine-scale-population-stratification.html#cb4-95" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">21</span>, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">211</span>,<span class="dv">211</span>,<span class="dv">211</span>,<span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">150</span>), </span>
<span id="cb4-96"><a href="fine-scale-population-stratification.html#cb4-96" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T)), </span>
<span id="cb4-97"><a href="fine-scale-population-stratification.html#cb4-97" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T)),</span>
<span id="cb4-98"><a href="fine-scale-population-stratification.html#cb4-98" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&quot;PC2 bin &quot;</span>, i), <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb4-99"><a href="fine-scale-population-stratification.html#cb4-99" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>dat[dat<span class="sc">$</span>bin_PC2<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>bin_PC2),]</span>
<span id="cb4-100"><a href="fine-scale-population-stratification.html#cb4-100" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>north, sel<span class="sc">$</span>east, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb4-101"><a href="fine-scale-population-stratification.html#cb4-101" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) </span>
<span id="cb4-102"><a href="fine-scale-population-stratification.html#cb4-102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-103"><a href="fine-scale-population-stratification.html#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb4-104"><a href="fine-scale-population-stratification.html#cb4-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-105"><a href="fine-scale-population-stratification.html#cb4-105" aria-hidden="true" tabindex="-1"></a><span class="co"># seperate plots 5 bins --------------------------------------------------------</span></span>
<span id="cb4-106"><a href="fine-scale-population-stratification.html#cb4-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-107"><a href="fine-scale-population-stratification.html#cb4-107" aria-hidden="true" tabindex="-1"></a><span class="co"># plot birth location col-coded by PC1</span></span>
<span id="cb4-108"><a href="fine-scale-population-stratification.html#cb4-108" aria-hidden="true" tabindex="-1"></a>cutoff1<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>PC1, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb4-109"><a href="fine-scale-population-stratification.html#cb4-109" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>bin_PC1<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>PC1, <span class="at">breaks=</span>cutoff1, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff1)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb4-110"><a href="fine-scale-population-stratification.html#cb4-110" aria-hidden="true" tabindex="-1"></a>cutoff2<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>PC2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb4-111"><a href="fine-scale-population-stratification.html#cb4-111" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>bin_PC2<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>PC2, <span class="at">breaks=</span>cutoff2, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff2)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb4-112"><a href="fine-scale-population-stratification.html#cb4-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-113"><a href="fine-scale-population-stratification.html#cb4-113" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;RColorBrewer&quot;</span>)</span>
<span id="cb4-114"><a href="fine-scale-population-stratification.html#cb4-114" aria-hidden="true" tabindex="-1"></a>pallete<span class="ot">=</span><span class="fu">brewer.pal</span>(<span class="dv">5</span>, <span class="at">name=</span><span class="st">&quot;Spectral&quot;</span>)</span>
<span id="cb4-115"><a href="fine-scale-population-stratification.html#cb4-115" aria-hidden="true" tabindex="-1"></a>mycol<span class="ot">=</span><span class="fu">apply</span>(<span class="fu">col2rgb</span>(pallete), <span class="dv">2</span>, </span>
<span id="cb4-116"><a href="fine-scale-population-stratification.html#cb4-116" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(X) <span class="fu">rgb</span>(X[<span class="dv">1</span>], X[<span class="dv">2</span>], X[<span class="dv">3</span>], <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">218</span>))</span>
<span id="cb4-117"><a href="fine-scale-population-stratification.html#cb4-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-118"><a href="fine-scale-population-stratification.html#cb4-118" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-birth-location-by-pc1-bin-5panel.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">10</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb4-119"><a href="fine-scale-population-stratification.html#cb4-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-120"><a href="fine-scale-population-stratification.html#cb4-120" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb4-121"><a href="fine-scale-population-stratification.html#cb4-121" aria-hidden="true" tabindex="-1"></a><span class="co"># PC1</span></span>
<span id="cb4-122"><a href="fine-scale-population-stratification.html#cb4-122" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb4-123"><a href="fine-scale-population-stratification.html#cb4-123" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlab=</span><span class="st">&quot;north&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;east&quot;</span>,</span>
<span id="cb4-124"><a href="fine-scale-population-stratification.html#cb4-124" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">21</span>, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">211</span>,<span class="dv">211</span>,<span class="dv">211</span>,<span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">150</span>), </span>
<span id="cb4-125"><a href="fine-scale-population-stratification.html#cb4-125" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T)), </span>
<span id="cb4-126"><a href="fine-scale-population-stratification.html#cb4-126" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T)),</span>
<span id="cb4-127"><a href="fine-scale-population-stratification.html#cb4-127" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&quot;PC1 bin &quot;</span>, i), <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb4-128"><a href="fine-scale-population-stratification.html#cb4-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-129"><a href="fine-scale-population-stratification.html#cb4-129" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>dat[dat<span class="sc">$</span>bin_PC1<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>bin_PC1),]</span>
<span id="cb4-130"><a href="fine-scale-population-stratification.html#cb4-130" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>north, sel<span class="sc">$</span>east, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb4-131"><a href="fine-scale-population-stratification.html#cb4-131" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) </span>
<span id="cb4-132"><a href="fine-scale-population-stratification.html#cb4-132" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-133"><a href="fine-scale-population-stratification.html#cb4-133" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb4-134"><a href="fine-scale-population-stratification.html#cb4-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-135"><a href="fine-scale-population-stratification.html#cb4-135" aria-hidden="true" tabindex="-1"></a><span class="co"># PC2</span></span>
<span id="cb4-136"><a href="fine-scale-population-stratification.html#cb4-136" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-birth-location-by-pc2-bin-5panel.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">10</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb4-137"><a href="fine-scale-population-stratification.html#cb4-137" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb4-138"><a href="fine-scale-population-stratification.html#cb4-138" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb4-139"><a href="fine-scale-population-stratification.html#cb4-139" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlab=</span><span class="st">&quot;north&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;east&quot;</span>,</span>
<span id="cb4-140"><a href="fine-scale-population-stratification.html#cb4-140" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">21</span>, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">211</span>,<span class="dv">211</span>,<span class="dv">211</span>,<span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">150</span>), </span>
<span id="cb4-141"><a href="fine-scale-population-stratification.html#cb4-141" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>north, <span class="at">na.rm=</span>T)), </span>
<span id="cb4-142"><a href="fine-scale-population-stratification.html#cb4-142" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T), <span class="fu">max</span>(dat<span class="sc">$</span>east, <span class="at">na.rm=</span>T)),</span>
<span id="cb4-143"><a href="fine-scale-population-stratification.html#cb4-143" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&quot;PC2 bin &quot;</span>, i), <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb4-144"><a href="fine-scale-population-stratification.html#cb4-144" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>dat[dat<span class="sc">$</span>bin_PC2<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>bin_PC2),]</span>
<span id="cb4-145"><a href="fine-scale-population-stratification.html#cb4-145" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>north, sel<span class="sc">$</span>east, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb4-146"><a href="fine-scale-population-stratification.html#cb4-146" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) </span>
<span id="cb4-147"><a href="fine-scale-population-stratification.html#cb4-147" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-148"><a href="fine-scale-population-stratification.html#cb4-148" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="birth-place-gwas" class="section level2" number="18.3">
<h2><span class="header-section-number">18.3</span> birth place gwas</h2>
<p>We want to replicate results by Cook et al. (2020), where they found that the GWAS for the east and north coordinates of birth place is confounded. Note: Cook used 8.8 M well-imputed SNPs with MAF &gt; 0.5%, but we used 1.1 Hapmap3 SNPs with MAF &gt; 0.01 (this is because ldsc provide ldscores for these SNPs).</p>
<p>We want to find out if chisq varies with aver2, and if ldsc intercept indicates inflation.</p>
<div id="gwas-7" class="section level3" number="18.3.1">
<h3><span class="header-section-number">18.3.1</span> gwas</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="fine-scale-population-stratification.html#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="fine-scale-population-stratification.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> birth-place-gwas</span>
<span id="cb5-3"><a href="fine-scale-population-stratification.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="fine-scale-population-stratification.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{east-coord-birth-place</span><span class="op">,</span><span class="dt">north-coord-birth-place}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb5-5"><a href="fine-scale-population-stratification.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb5-6"><a href="fine-scale-population-stratification.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb5-7"><a href="fine-scale-population-stratification.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb5-8"><a href="fine-scale-population-stratification.html#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 20G</span></span>
<span id="cb5-9"><a href="fine-scale-population-stratification.html#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb5-10"><a href="fine-scale-population-stratification.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb5-11"><a href="fine-scale-population-stratification.html#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="fine-scale-population-stratification.html#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../birth-place-gwas/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb5-13"><a href="fine-scale-population-stratification.html#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/other-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb5-14"><a href="fine-scale-population-stratification.html#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm </span><span class="dt">\</span></span>
<span id="cb5-15"><a href="fine-scale-population-stratification.html#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../ukbb-recommend.id </span><span class="dt">\</span></span>
<span id="cb5-16"><a href="fine-scale-population-stratification.html#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-norm.use </span><span class="dt">\</span></span>
<span id="cb5-17"><a href="fine-scale-population-stratification.html#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb5-18"><a href="fine-scale-population-stratification.html#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb5-19"><a href="fine-scale-population-stratification.html#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb5-20"><a href="fine-scale-population-stratification.html#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb5-21"><a href="fine-scale-population-stratification.html#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="fine-scale-population-stratification.html#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files</span></span>
<span id="cb5-23"><a href="fine-scale-population-stratification.html#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{east-coord-birth-place</span><span class="op">,</span><span class="dt">north-coord-birth-place}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb5-24"><a href="fine-scale-population-stratification.html#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb5-25"><a href="fine-scale-population-stratification.html#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/gwas-birth-place</span></code></pre></div>
</div>
<div id="chisq-aver2-3" class="section level3" number="18.3.2">
<h3><span class="header-section-number">18.3.2</span> chisq ~ aver2</h3>
<p>Using our method, we found evidence of confounding in the birth place GWASs. That is, some genetic differences between sub-populations drive the test statistics. This is somewhat surprising for two reasons: 1) using the same aver2 (i.e., for the 337k ukbb white British), our method finds no evidence of confounding for the other 14 traits. 2). genetic variation in birth location was not evident in PCs [no correlation between PCs and coordiantes of birth place]. That is, geographic location of birth place did not systematically vary in genotype data. This suggests that aver2 can pick up fine-scale population structure that is not even evident in the PCs.</p>
<p>This suggests that:
1) despite the best efforts of controlling for confounding bias, a post-gwas check for confounding bias is necessary.
2) aver2 can catch subtle systematic genetic variation (i.e., is sensitive to fine-scale population structure), but the fine-scale population structure does not necessarily cause inflation in test statistics (or confound GWAS).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="fine-scale-population-stratification.html#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="fine-scale-population-stratification.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># organize data ----------------------------------------------------------------</span></span>
<span id="cb6-3"><a href="fine-scale-population-stratification.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> birth-place-gwas-out</span>
<span id="cb6-4"><a href="fine-scale-population-stratification.html#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="fine-scale-population-stratification.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{east-coord-birth-place</span><span class="op">,</span><span class="dt">north-coord-birth-place}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb6-6"><a href="fine-scale-population-stratification.html#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="fine-scale-population-stratification.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>birth-place-gwas/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb6-8"><a href="fine-scale-population-stratification.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>summary/ave-r2-10k-snps-ukbb-norm</span>
<span id="cb6-9"><a href="fine-scale-population-stratification.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-norm.ldscore</span>
<span id="cb6-10"><a href="fine-scale-population-stratification.html#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>birth-place-gwas-out/<span class="va">$trait</span>.out</span>
<span id="cb6-11"><a href="fine-scale-population-stratification.html#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="fine-scale-population-stratification.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp</span>
<span id="cb6-13"><a href="fine-scale-population-stratification.html#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="fine-scale-population-stratification.html#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb6-15"><a href="fine-scale-population-stratification.html#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb6-16"><a href="fine-scale-population-stratification.html#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb6-17"><a href="fine-scale-population-stratification.html#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="fine-scale-population-stratification.html#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb6-19"><a href="fine-scale-population-stratification.html#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb6-20"><a href="fine-scale-population-stratification.html#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb6-21"><a href="fine-scale-population-stratification.html#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="fine-scale-population-stratification.html#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb6-23"><a href="fine-scale-population-stratification.html#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb6-24"><a href="fine-scale-population-stratification.html#cb6-24" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb6-25"><a href="fine-scale-population-stratification.html#cb6-25" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb6-26"><a href="fine-scale-population-stratification.html#cb6-26" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb6-27"><a href="fine-scale-population-stratification.html#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb6-28"><a href="fine-scale-population-stratification.html#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb6-29"><a href="fine-scale-population-stratification.html#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="fine-scale-population-stratification.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb7-2"><a href="fine-scale-population-stratification.html#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="fine-scale-population-stratification.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb7-4"><a href="fine-scale-population-stratification.html#cb7-4" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;east-coord-birth-place&quot;</span>,<span class="st">&quot;north-coord-birth-place&quot;</span>)</span>
<span id="cb7-5"><a href="fine-scale-population-stratification.html#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="fine-scale-population-stratification.html#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-ukbb-recommend-337k-birth-place.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">20</span>, <span class="at">height=</span><span class="dv">10</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb7-7"><a href="fine-scale-population-stratification.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb7-8"><a href="fine-scale-population-stratification.html#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="fine-scale-population-stratification.html#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb7-10"><a href="fine-scale-population-stratification.html#cb7-10" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb7-11"><a href="fine-scale-population-stratification.html#cb7-11" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;birth-place-gwas-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb7-12"><a href="fine-scale-population-stratification.html#cb7-12" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb7-13"><a href="fine-scale-population-stratification.html#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="fine-scale-population-stratification.html#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb7-15"><a href="fine-scale-population-stratification.html#cb7-15" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb7-16"><a href="fine-scale-population-stratification.html#cb7-16" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb7-17"><a href="fine-scale-population-stratification.html#cb7-17" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb7-18"><a href="fine-scale-population-stratification.html#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="fine-scale-population-stratification.html#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb7-20"><a href="fine-scale-population-stratification.html#cb7-20" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb7-21"><a href="fine-scale-population-stratification.html#cb7-21" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb7-22"><a href="fine-scale-population-stratification.html#cb7-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-23"><a href="fine-scale-population-stratification.html#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb7-24"><a href="fine-scale-population-stratification.html#cb7-24" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb7-25"><a href="fine-scale-population-stratification.html#cb7-25" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb7-26"><a href="fine-scale-population-stratification.html#cb7-26" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb7-27"><a href="fine-scale-population-stratification.html#cb7-27" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb7-28"><a href="fine-scale-population-stratification.html#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="fine-scale-population-stratification.html#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb7-30"><a href="fine-scale-population-stratification.html#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb7-31"><a href="fine-scale-population-stratification.html#cb7-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb7-32"><a href="fine-scale-population-stratification.html#cb7-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb7-33"><a href="fine-scale-population-stratification.html#cb7-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb7-34"><a href="fine-scale-population-stratification.html#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb7-35"><a href="fine-scale-population-stratification.html#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb7-36"><a href="fine-scale-population-stratification.html#cb7-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb7-37"><a href="fine-scale-population-stratification.html#cb7-37" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb7-38"><a href="fine-scale-population-stratification.html#cb7-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb7-39"><a href="fine-scale-population-stratification.html#cb7-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-40"><a href="fine-scale-population-stratification.html#cb7-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-41"><a href="fine-scale-population-stratification.html#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="detect-inflation-using-1kg" class="section level3" number="18.3.3">
<h3><span class="header-section-number">18.3.3</span> detect inflation using 1kg</h3>
<pre class="bas"><code>
# combine gwas results with aver2 from 1kg--------------------------------------

for trait in {east-coord-birth-place,north-coord-birth-place}; do
gwas=birth-place-gwas/$trait-linear.summaries
aver2=ref-1kg/aver2/1kg-ukbb.aver2
tmp=birth-place-gwas-out/$trait.tmp
ldsc=snps-norm.ldscore
out=birth-place-gwas-out/$trait-1kg-ref.out

awk &#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb chisq&quot; }
     NR==FNR &amp;&amp; NR &gt; 1 {a[$1]; b[$1]=$5; next} 
     {if ($1 in a) print $0, b[$1]}&#39; $gwas $aver2&gt; $tmp

awk &#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb chisq ldsc&quot; }
     NR==FNR {a[$1]; b[$1]=$2; next} 
     {if ($1 in a) print $0, b[$1]}&#39; $ldsc $tmp &gt; $out
     
done
</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="fine-scale-population-stratification.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2 1kg  ------------------------------------------------------</span></span>
<span id="cb9-2"><a href="fine-scale-population-stratification.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb9-3"><a href="fine-scale-population-stratification.html#cb9-3" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;east-coord-birth-place&quot;</span>,<span class="st">&quot;north-coord-birth-place&quot;</span>)</span>
<span id="cb9-4"><a href="fine-scale-population-stratification.html#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="fine-scale-population-stratification.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-ukbb-recommend-337k-birth-place-1kg-ref.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">20</span>, <span class="at">height=</span><span class="dv">10</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb9-6"><a href="fine-scale-population-stratification.html#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb9-7"><a href="fine-scale-population-stratification.html#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="fine-scale-population-stratification.html#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb9-9"><a href="fine-scale-population-stratification.html#cb9-9" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb9-10"><a href="fine-scale-population-stratification.html#cb9-10" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;birth-place-gwas-out/&quot;</span>,trait,<span class="st">&quot;-1kg-ref.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb9-11"><a href="fine-scale-population-stratification.html#cb9-11" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;ref&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)]</span>
<span id="cb9-12"><a href="fine-scale-population-stratification.html#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;aver2&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)</span>
<span id="cb9-13"><a href="fine-scale-population-stratification.html#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="fine-scale-population-stratification.html#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb9-15"><a href="fine-scale-population-stratification.html#cb9-15" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb9-16"><a href="fine-scale-population-stratification.html#cb9-16" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb9-17"><a href="fine-scale-population-stratification.html#cb9-17" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb9-18"><a href="fine-scale-population-stratification.html#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="fine-scale-population-stratification.html#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb9-20"><a href="fine-scale-population-stratification.html#cb9-20" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb9-21"><a href="fine-scale-population-stratification.html#cb9-21" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb9-22"><a href="fine-scale-population-stratification.html#cb9-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-23"><a href="fine-scale-population-stratification.html#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb9-24"><a href="fine-scale-population-stratification.html#cb9-24" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb9-25"><a href="fine-scale-population-stratification.html#cb9-25" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb9-26"><a href="fine-scale-population-stratification.html#cb9-26" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb9-27"><a href="fine-scale-population-stratification.html#cb9-27" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb9-28"><a href="fine-scale-population-stratification.html#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="fine-scale-population-stratification.html#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb9-30"><a href="fine-scale-population-stratification.html#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb9-31"><a href="fine-scale-population-stratification.html#cb9-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb9-32"><a href="fine-scale-population-stratification.html#cb9-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb9-33"><a href="fine-scale-population-stratification.html#cb9-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb9-34"><a href="fine-scale-population-stratification.html#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 ,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb9-35"><a href="fine-scale-population-stratification.html#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb9-36"><a href="fine-scale-population-stratification.html#cb9-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb9-37"><a href="fine-scale-population-stratification.html#cb9-37" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb9-38"><a href="fine-scale-population-stratification.html#cb9-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb9-39"><a href="fine-scale-population-stratification.html#cb9-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-40"><a href="fine-scale-population-stratification.html#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="gwas-results" class="section level3" number="18.3.4">
<h3><span class="header-section-number">18.3.4</span> gwas results</h3>
<p>Here we use Manhattan plots to check if there is any genome-wide significant results of birth place location.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="fine-scale-population-stratification.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a plotting function</span></span>
<span id="cb10-2"><a href="fine-scale-population-stratification.html#cb10-2" aria-hidden="true" tabindex="-1"></a>Manhattan<span class="ot">=</span><span class="cf">function</span>(var){</span>
<span id="cb10-3"><a href="fine-scale-population-stratification.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># organize data</span></span>
<span id="cb10-4"><a href="fine-scale-population-stratification.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(vroom)</span>
<span id="cb10-5"><a href="fine-scale-population-stratification.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  p0<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;birth-place-gwas/&quot;</span>,var,<span class="st">&quot;-linear.assoc&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb10-6"><a href="fine-scale-population-stratification.html#cb10-6" aria-hidden="true" tabindex="-1"></a>  p1<span class="ot">=</span>p0[p0<span class="sc">$</span>Wald_P<span class="sc">&lt;=</span>sel <span class="sc">&amp;</span> p0<span class="sc">$</span>Wald_P<span class="sc">!=</span><span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(p0<span class="sc">$</span>Wald_P),] <span class="co"># only plot &lt;= 0.01 &amp; &gt; 0</span></span>
<span id="cb10-7"><a href="fine-scale-population-stratification.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  p1<span class="ot">=</span>p1[<span class="fu">order</span>(p1<span class="sc">$</span>Chromosome, p1<span class="sc">$</span>Basepair, <span class="at">decreasing=</span>F),] <span class="co"># sort data frame</span></span>
<span id="cb10-8"><a href="fine-scale-population-stratification.html#cb10-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-9"><a href="fine-scale-population-stratification.html#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x coordinate based on base pair</span></span>
<span id="cb10-10"><a href="fine-scale-population-stratification.html#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>){</span>
<span id="cb10-11"><a href="fine-scale-population-stratification.html#cb10-11" aria-hidden="true" tabindex="-1"></a>    maxbp0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chr=</span>i,<span class="at">maxbp=</span><span class="fu">max</span>(p1<span class="sc">$</span>Basepair[p1<span class="sc">$</span>Chromosome<span class="sc">==</span>i]))</span>
<span id="cb10-12"><a href="fine-scale-population-stratification.html#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep track of maxbp of each chr for later use</span></span>
<span id="cb10-13"><a href="fine-scale-population-stratification.html#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb10-14"><a href="fine-scale-population-stratification.html#cb10-14" aria-hidden="true" tabindex="-1"></a>      cummaxbp<span class="ot">=</span><span class="fu">max</span>(p1<span class="sc">$</span>Basepair[p1<span class="sc">$</span>Chromosome<span class="sc">==</span>i])</span>
<span id="cb10-15"><a href="fine-scale-population-stratification.html#cb10-15" aria-hidden="true" tabindex="-1"></a>      pos<span class="ot">=</span>p1<span class="sc">$</span>Basepair[p1<span class="sc">$</span>Chromosome<span class="sc">==</span>i]</span>
<span id="cb10-16"><a href="fine-scale-population-stratification.html#cb10-16" aria-hidden="true" tabindex="-1"></a>      maxbp<span class="ot">=</span>maxbp0</span>
<span id="cb10-17"><a href="fine-scale-population-stratification.html#cb10-17" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb10-18"><a href="fine-scale-population-stratification.html#cb10-18" aria-hidden="true" tabindex="-1"></a>      pos<span class="ot">=</span><span class="fu">c</span>(pos,p1<span class="sc">$</span>Basepair[p1<span class="sc">$</span>Chromosome<span class="sc">==</span>i]<span class="sc">+</span>cummaxbp)</span>
<span id="cb10-19"><a href="fine-scale-population-stratification.html#cb10-19" aria-hidden="true" tabindex="-1"></a>      cummaxbp<span class="ot">=</span>cummaxbp<span class="sc">+</span><span class="fu">max</span>(p1<span class="sc">$</span>Basepair[p1<span class="sc">$</span>Chromosome<span class="sc">==</span>i])</span>
<span id="cb10-20"><a href="fine-scale-population-stratification.html#cb10-20" aria-hidden="true" tabindex="-1"></a>      maxbp<span class="ot">=</span><span class="fu">rbind</span>(maxbp, maxbp0)</span>
<span id="cb10-21"><a href="fine-scale-population-stratification.html#cb10-21" aria-hidden="true" tabindex="-1"></a>    } <span class="co"># add for i &gt; 1, the pos or the x-coordinate of a current snp is the sum </span></span>
<span id="cb10-22"><a href="fine-scale-population-stratification.html#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># of its basepair &amp; the cumulative max basepair from previous chromosomes. </span></span>
<span id="cb10-23"><a href="fine-scale-population-stratification.html#cb10-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-24"><a href="fine-scale-population-stratification.html#cb10-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-25"><a href="fine-scale-population-stratification.html#cb10-25" aria-hidden="true" tabindex="-1"></a>  p2<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chr=</span>p1<span class="sc">$</span>Chromosome,</span>
<span id="cb10-26"><a href="fine-scale-population-stratification.html#cb10-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">Predictor=</span>p1<span class="sc">$</span>Predictor,</span>
<span id="cb10-27"><a href="fine-scale-population-stratification.html#cb10-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">x=</span>pos,</span>
<span id="cb10-28"><a href="fine-scale-population-stratification.html#cb10-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">neglog10p=</span><span class="sc">-</span><span class="fu">log10</span>(p1<span class="sc">$</span>Wald_P), <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb10-29"><a href="fine-scale-population-stratification.html#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">sum</span>(p2<span class="sc">$</span>neglog10p<span class="sc">&gt;=-</span><span class="fu">log10</span>(<span class="dv">5</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span>))<span class="sc">&gt;</span><span class="dv">0</span>) sig<span class="ot">=</span>p2[p2<span class="sc">$</span>neglog10p<span class="sc">&gt;=-</span><span class="fu">log10</span>(<span class="dv">5</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span>),]</span>
<span id="cb10-30"><a href="fine-scale-population-stratification.html#cb10-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-31"><a href="fine-scale-population-stratification.html#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define objects</span></span>
<span id="cb10-32"><a href="fine-scale-population-stratification.html#cb10-32" aria-hidden="true" tabindex="-1"></a>  mycol<span class="ot">=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;darkgray&quot;</span>, <span class="st">&quot;gray&quot;</span>), <span class="dv">11</span>)</span>
<span id="cb10-33"><a href="fine-scale-population-stratification.html#cb10-33" aria-hidden="true" tabindex="-1"></a>  xtick<span class="ot">=</span><span class="fu">c</span>(<span class="fu">min</span>(p2<span class="sc">$</span>x), <span class="fu">cumsum</span>(maxbp<span class="sc">$</span>maxbp))</span>
<span id="cb10-34"><a href="fine-scale-population-stratification.html#cb10-34" aria-hidden="true" tabindex="-1"></a>  lab.pos<span class="ot">=</span>(xtick[<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>]<span class="sc">+</span>xtick[<span class="dv">2</span><span class="sc">:</span><span class="dv">23</span>])<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb10-35"><a href="fine-scale-population-stratification.html#cb10-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-36"><a href="fine-scale-population-stratification.html#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plotting</span></span>
<span id="cb10-37"><a href="fine-scale-population-stratification.html#cb10-37" aria-hidden="true" tabindex="-1"></a>  nm<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;fig/&quot;</span>,var,<span class="st">&quot;-manhattan-plot.png&quot;</span>)</span>
<span id="cb10-38"><a href="fine-scale-population-stratification.html#cb10-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(nm, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">10</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">res=</span><span class="dv">100</span>)</span>
<span id="cb10-39"><a href="fine-scale-population-stratification.html#cb10-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlab=</span><span class="st">&quot;chromosome&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;-log10(p)&quot;</span>,</span>
<span id="cb10-40"><a href="fine-scale-population-stratification.html#cb10-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(p2<span class="sc">$</span>x),<span class="fu">max</span>(p2<span class="sc">$</span>x)), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.01</span>),<span class="sc">-</span><span class="fu">log10</span>(<span class="dv">5</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span>)<span class="sc">+</span><span class="dv">2</span>),</span>
<span id="cb10-41"><a href="fine-scale-population-stratification.html#cb10-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">xaxt=</span><span class="st">&#39;n&#39;</span>, <span class="at">main=</span>var,</span>
<span id="cb10-42"><a href="fine-scale-population-stratification.html#cb10-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">las=</span><span class="dv">2</span> )</span>
<span id="cb10-43"><a href="fine-scale-population-stratification.html#cb10-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>){</span>
<span id="cb10-44"><a href="fine-scale-population-stratification.html#cb10-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(p2<span class="sc">$</span>x[p2<span class="sc">$</span>chr<span class="sc">==</span>i], p2<span class="sc">$</span>neglog10p[p2<span class="sc">$</span>chr<span class="sc">==</span>i], </span>
<span id="cb10-45"><a href="fine-scale-population-stratification.html#cb10-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">0.3</span>, <span class="at">pch=</span><span class="dv">16</span>,  <span class="at">col=</span>mycol[i])</span>
<span id="cb10-46"><a href="fine-scale-population-stratification.html#cb10-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-47"><a href="fine-scale-population-stratification.html#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h=</span><span class="sc">-</span><span class="fu">log10</span>(<span class="dv">5</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span>), <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb10-48"><a href="fine-scale-population-stratification.html#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">sum</span>(p2<span class="sc">$</span>neglog10p<span class="sc">&gt;=-</span><span class="fu">log10</span>(<span class="dv">5</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span>))<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb10-49"><a href="fine-scale-population-stratification.html#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(sig<span class="sc">$</span>x, sig<span class="sc">$</span>neglog10p, </span>
<span id="cb10-50"><a href="fine-scale-population-stratification.html#cb10-50" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)}</span>
<span id="cb10-51"><a href="fine-scale-population-stratification.html#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span>xtick, <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-52"><a href="fine-scale-population-stratification.html#cb10-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(<span class="at">x=</span>lab.pos, <span class="at">y=</span> <span class="fu">par</span>(<span class="st">&quot;usr&quot;</span>)[<span class="dv">3</span>] <span class="sc">-</span> <span class="fl">1.5</span>, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>, <span class="at">xpd=</span>T, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb10-53"><a href="fine-scale-population-stratification.html#cb10-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb10-54"><a href="fine-scale-population-stratification.html#cb10-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-55"><a href="fine-scale-population-stratification.html#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="fine-scale-population-stratification.html#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="co"># call the function</span></span>
<span id="cb10-57"><a href="fine-scale-population-stratification.html#cb10-57" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;east-coord-birth-place&quot;</span>,<span class="st">&quot;north-coord-birth-place&quot;</span>)</span>
<span id="cb10-58"><a href="fine-scale-population-stratification.html#cb10-58" aria-hidden="true" tabindex="-1"></a>cutoff<span class="ot">=</span><span class="dv">5</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span></span>
<span id="cb10-59"><a href="fine-scale-population-stratification.html#cb10-59" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span><span class="fl">0.01</span></span>
<span id="cb10-60"><a href="fine-scale-population-stratification.html#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb10-61"><a href="fine-scale-population-stratification.html#cb10-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Manhattan</span>(traits[i])</span>
<span id="cb10-62"><a href="fine-scale-population-stratification.html#cb10-62" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="gwas-based-on-pc-clusters" class="section level2" number="18.4">
<h2><span class="header-section-number">18.4</span> GWAS based on PC clusters</h2>
<p>Here we investigate if fine-scale population structure within unrelated white British (337k) can inflate gwas test statistics. To this end, we performed good &amp; bad GWASs that vary in the heterogeneity of pop. structure, as assessed by PCs (see plot). The good GWAS contains individuals with an average PC1 xx, wheareas the bad GWAS contains individuals with PC1 and PC2 xx.</p>
<div id="id-lists-2" class="section level3" number="18.4.1">
<h3><span class="header-section-number">18.4.1</span> id lists</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="fine-scale-population-stratification.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># k-mean clustering of PC1 &amp; PC2------------------------------------------------</span></span>
<span id="cb11-2"><a href="fine-scale-population-stratification.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pcs of 337k recommended individuals</span></span>
<span id="cb11-3"><a href="fine-scale-population-stratification.html#cb11-3" aria-hidden="true" tabindex="-1"></a>pc<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;gen/pca-337k-ukbb.eigenvec&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb11-4"><a href="fine-scale-population-stratification.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pc)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;eid&quot;</span>, <span class="st">&quot;eid&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;PC&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb11-5"><a href="fine-scale-population-stratification.html#cb11-5" aria-hidden="true" tabindex="-1"></a>pc1pc2<span class="ot">=</span>pc[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb11-6"><a href="fine-scale-population-stratification.html#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb11-7"><a href="fine-scale-population-stratification.html#cb11-7" aria-hidden="true" tabindex="-1"></a>cluster<span class="ot">=</span><span class="fu">kmeans</span>(pc1pc2, <span class="at">centers=</span><span class="dv">3</span>, <span class="at">nstart=</span><span class="dv">50</span>)</span>
<span id="cb11-8"><a href="fine-scale-population-stratification.html#cb11-8" aria-hidden="true" tabindex="-1"></a>pc<span class="sc">$</span>cluster<span class="ot">=</span>cluster<span class="sc">$</span>cluster</span>
<span id="cb11-9"><a href="fine-scale-population-stratification.html#cb11-9" aria-hidden="true" tabindex="-1"></a>centroid<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">PC1=</span><span class="fu">tapply</span>(pc<span class="sc">$</span>PC1,<span class="at">INDEX=</span>pc<span class="sc">$</span>cluster, mean),</span>
<span id="cb11-10"><a href="fine-scale-population-stratification.html#cb11-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">PC2=</span><span class="fu">tapply</span>(pc<span class="sc">$</span>PC2,<span class="at">INDEX=</span>pc<span class="sc">$</span>cluster, mean))</span>
<span id="cb11-11"><a href="fine-scale-population-stratification.html#cb11-11" aria-hidden="true" tabindex="-1"></a>centroid<span class="sc">$</span>n<span class="ot">=</span><span class="fu">table</span>(pc<span class="sc">$</span>cluster)</span>
<span id="cb11-12"><a href="fine-scale-population-stratification.html#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="fine-scale-population-stratification.html#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># plot pc1 vs. pc3 by the clusters----------------------------------------------</span></span>
<span id="cb11-14"><a href="fine-scale-population-stratification.html#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;RColorBrewer&quot;</span>)</span>
<span id="cb11-15"><a href="fine-scale-population-stratification.html#cb11-15" aria-hidden="true" tabindex="-1"></a>pallete<span class="ot">=</span><span class="fu">brewer.pal</span>(<span class="dv">3</span>, <span class="at">name=</span><span class="st">&quot;Spectral&quot;</span>)</span>
<span id="cb11-16"><a href="fine-scale-population-stratification.html#cb11-16" aria-hidden="true" tabindex="-1"></a>mycol<span class="ot">=</span><span class="fu">apply</span>(<span class="fu">col2rgb</span>(pallete), <span class="dv">2</span>, </span>
<span id="cb11-17"><a href="fine-scale-population-stratification.html#cb11-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(X) <span class="fu">rgb</span>(X[<span class="dv">1</span>], X[<span class="dv">2</span>], X[<span class="dv">3</span>], <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">150</span>))</span>
<span id="cb11-18"><a href="fine-scale-population-stratification.html#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="fine-scale-population-stratification.html#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-inhouse-pc1-vs-pc2.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb11-20"><a href="fine-scale-population-stratification.html#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb11-21"><a href="fine-scale-population-stratification.html#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlab=</span><span class="st">&quot;1st PC&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;2nd PC&quot;</span>,</span>
<span id="cb11-22"><a href="fine-scale-population-stratification.html#cb11-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(pc<span class="sc">$</span>PC1), <span class="fu">max</span>(pc<span class="sc">$</span>PC1)), </span>
<span id="cb11-23"><a href="fine-scale-population-stratification.html#cb11-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(pc<span class="sc">$</span>PC2), <span class="fu">max</span>(pc<span class="sc">$</span>PC2)),</span>
<span id="cb11-24"><a href="fine-scale-population-stratification.html#cb11-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;ukbb 337k unrelated white British&quot;</span>, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb11-25"><a href="fine-scale-population-stratification.html#cb11-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-26"><a href="fine-scale-population-stratification.html#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="fine-scale-population-stratification.html#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb11-28"><a href="fine-scale-population-stratification.html#cb11-28" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>pc[pc<span class="sc">$</span>cluster<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(pc<span class="sc">$</span>cluster),]</span>
<span id="cb11-29"><a href="fine-scale-population-stratification.html#cb11-29" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>PC1, sel<span class="sc">$</span>PC2, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb11-30"><a href="fine-scale-population-stratification.html#cb11-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-31"><a href="fine-scale-population-stratification.html#cb11-31" aria-hidden="true" tabindex="-1"></a> <span class="co"># centroid</span></span>
<span id="cb11-32"><a href="fine-scale-population-stratification.html#cb11-32" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(centroid[i,<span class="dv">1</span>], centroid[i,<span class="dv">2</span>], <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb11-33"><a href="fine-scale-population-stratification.html#cb11-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-34"><a href="fine-scale-population-stratification.html#cb11-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-35"><a href="fine-scale-population-stratification.html#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="fine-scale-population-stratification.html#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb11-37"><a href="fine-scale-population-stratification.html#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="fine-scale-population-stratification.html#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="co"># plot location by PC clusters--------------------------------------------------</span></span>
<span id="cb11-39"><a href="fine-scale-population-stratification.html#cb11-39" aria-hidden="true" tabindex="-1"></a>east<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;phen/other-traits/east-coord-birth-place.raw.pheno&quot;</span>)</span>
<span id="cb11-40"><a href="fine-scale-population-stratification.html#cb11-40" aria-hidden="true" tabindex="-1"></a>north<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;phen/other-traits/north-coord-birth-place.raw.pheno&quot;</span>)</span>
<span id="cb11-41"><a href="fine-scale-population-stratification.html#cb11-41" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">=</span><span class="fu">match</span>(pc<span class="sc">$</span>eid,east<span class="sc">$</span>V1)</span>
<span id="cb11-42"><a href="fine-scale-population-stratification.html#cb11-42" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">=</span><span class="fu">match</span>(pc<span class="sc">$</span>eid,north<span class="sc">$</span>V1)</span>
<span id="cb11-43"><a href="fine-scale-population-stratification.html#cb11-43" aria-hidden="true" tabindex="-1"></a>pc<span class="sc">$</span>east<span class="ot">=</span>east<span class="sc">$</span>V3[m1]</span>
<span id="cb11-44"><a href="fine-scale-population-stratification.html#cb11-44" aria-hidden="true" tabindex="-1"></a>pc<span class="sc">$</span>north<span class="ot">=</span>north<span class="sc">$</span>V3[m2]</span>
<span id="cb11-45"><a href="fine-scale-population-stratification.html#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="fine-scale-population-stratification.html#cb11-46" aria-hidden="true" tabindex="-1"></a>loc_mean<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">east=</span><span class="fu">tapply</span>(pc<span class="sc">$</span>east,<span class="at">INDEX=</span>pc<span class="sc">$</span>cluster, <span class="cf">function</span>(X) <span class="fu">mean</span>(X, <span class="at">na.rm=</span>T)),</span>
<span id="cb11-47"><a href="fine-scale-population-stratification.html#cb11-47" aria-hidden="true" tabindex="-1"></a>                    <span class="at">north=</span><span class="fu">tapply</span>(pc<span class="sc">$</span>north,<span class="at">INDEX=</span>pc<span class="sc">$</span>cluster, <span class="cf">function</span>(X) <span class="fu">mean</span>(X, <span class="at">na.rm=</span>T)))</span>
<span id="cb11-48"><a href="fine-scale-population-stratification.html#cb11-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-49"><a href="fine-scale-population-stratification.html#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;RColorBrewer&quot;</span>)</span>
<span id="cb11-50"><a href="fine-scale-population-stratification.html#cb11-50" aria-hidden="true" tabindex="-1"></a>pallete<span class="ot">=</span><span class="fu">brewer.pal</span>(<span class="dv">4</span>, <span class="at">name=</span><span class="st">&quot;Spectral&quot;</span>)</span>
<span id="cb11-51"><a href="fine-scale-population-stratification.html#cb11-51" aria-hidden="true" tabindex="-1"></a>mycol<span class="ot">=</span><span class="fu">apply</span>(<span class="fu">col2rgb</span>(pallete[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>)]), <span class="dv">2</span>, </span>
<span id="cb11-52"><a href="fine-scale-population-stratification.html#cb11-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(X) <span class="fu">rgb</span>(X[<span class="dv">1</span>], X[<span class="dv">2</span>], X[<span class="dv">3</span>], <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">150</span>))</span>
<span id="cb11-53"><a href="fine-scale-population-stratification.html#cb11-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-54"><a href="fine-scale-population-stratification.html#cb11-54" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/ukbb-337k-birth-location-by-pc-cluster.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">10</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb11-55"><a href="fine-scale-population-stratification.html#cb11-55" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb11-56"><a href="fine-scale-population-stratification.html#cb11-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb11-57"><a href="fine-scale-population-stratification.html#cb11-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="cn">NULL</span>,</span>
<span id="cb11-58"><a href="fine-scale-population-stratification.html#cb11-58" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(pc<span class="sc">$</span>north, <span class="at">na.rm=</span>T), <span class="fu">max</span>(pc<span class="sc">$</span>north, <span class="at">na.rm=</span>T)), </span>
<span id="cb11-59"><a href="fine-scale-population-stratification.html#cb11-59" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(pc<span class="sc">$</span>east, <span class="at">na.rm=</span>T), <span class="fu">max</span>(pc<span class="sc">$</span>east, <span class="at">na.rm=</span>T)),</span>
<span id="cb11-60"><a href="fine-scale-population-stratification.html#cb11-60" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;north coord&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;east coordinate&quot;</span>,</span>
<span id="cb11-61"><a href="fine-scale-population-stratification.html#cb11-61" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&quot;cluster &quot;</span>, i ), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb11-62"><a href="fine-scale-population-stratification.html#cb11-62" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-63"><a href="fine-scale-population-stratification.html#cb11-63" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb11-64"><a href="fine-scale-population-stratification.html#cb11-64" aria-hidden="true" tabindex="-1"></a>   sel<span class="ot">=</span>pc[pc<span class="sc">$</span>cluster<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(pc<span class="sc">$</span>cluster),]</span>
<span id="cb11-65"><a href="fine-scale-population-stratification.html#cb11-65" aria-hidden="true" tabindex="-1"></a>   <span class="fu">points</span>(sel<span class="sc">$</span>north, sel<span class="sc">$</span>east, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb11-66"><a href="fine-scale-population-stratification.html#cb11-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-67"><a href="fine-scale-population-stratification.html#cb11-67" aria-hidden="true" tabindex="-1"></a>   <span class="co"># centre</span></span>
<span id="cb11-68"><a href="fine-scale-population-stratification.html#cb11-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(loc_mean[i,<span class="st">&quot;north&quot;</span>], loc_mean[i,<span class="st">&quot;east&quot;</span>], <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb11-69"><a href="fine-scale-population-stratification.html#cb11-69" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span><span class="st">&quot;slategrey&quot;</span>, <span class="at">col=</span><span class="st">&quot;slategrey&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb11-70"><a href="fine-scale-population-stratification.html#cb11-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-71"><a href="fine-scale-population-stratification.html#cb11-71" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb11-72"><a href="fine-scale-population-stratification.html#cb11-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-73"><a href="fine-scale-population-stratification.html#cb11-73" aria-hidden="true" tabindex="-1"></a><span class="co"># id lists----------------------------------------------------------------------</span></span>
<span id="cb11-74"><a href="fine-scale-population-stratification.html#cb11-74" aria-hidden="true" tabindex="-1"></a><span class="co"># cluster 1. c1=100k; </span></span>
<span id="cb11-75"><a href="fine-scale-population-stratification.html#cb11-75" aria-hidden="true" tabindex="-1"></a><span class="co"># c1a=50k for bad gwas, c1b=50k for control gwas non-overlapping ids.</span></span>
<span id="cb11-76"><a href="fine-scale-population-stratification.html#cb11-76" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">100</span>)</span>
<span id="cb11-77"><a href="fine-scale-population-stratification.html#cb11-77" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>pc<span class="sc">$</span>eid[pc<span class="sc">$</span>cluster<span class="sc">==</span><span class="dv">1</span>]</span>
<span id="cb11-78"><a href="fine-scale-population-stratification.html#cb11-78" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb11-79"><a href="fine-scale-population-stratification.html#cb11-79" aria-hidden="true" tabindex="-1"></a>c1<span class="ot">=</span><span class="fu">sample</span>(sel,<span class="dv">100000</span>,<span class="at">replace=</span>F) <span class="co"># good gwas: 100k</span></span>
<span id="cb11-80"><a href="fine-scale-population-stratification.html#cb11-80" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb11-81"><a href="fine-scale-population-stratification.html#cb11-81" aria-hidden="true" tabindex="-1"></a>c1a<span class="ot">=</span><span class="fu">sample</span>(c1,<span class="dv">50000</span>,<span class="at">replace=</span>F) <span class="co"># for bad gwas: 50k</span></span>
<span id="cb11-82"><a href="fine-scale-population-stratification.html#cb11-82" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">114</span>)</span>
<span id="cb11-83"><a href="fine-scale-population-stratification.html#cb11-83" aria-hidden="true" tabindex="-1"></a>c1b<span class="ot">=</span><span class="fu">sample</span>(sel[<span class="sc">!</span>sel<span class="sc">%in%</span>c1],<span class="dv">50000</span>,<span class="at">replace=</span>F) <span class="co"># for control gwas: 50k</span></span>
<span id="cb11-84"><a href="fine-scale-population-stratification.html#cb11-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-85"><a href="fine-scale-population-stratification.html#cb11-85" aria-hidden="true" tabindex="-1"></a><span class="co"># cluster 2 &amp; 3 -&gt; each 1 list = 25k</span></span>
<span id="cb11-86"><a href="fine-scale-population-stratification.html#cb11-86" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>pc<span class="sc">$</span>eid[pc<span class="sc">$</span>cluster<span class="sc">==</span><span class="dv">2</span>]</span>
<span id="cb11-87"><a href="fine-scale-population-stratification.html#cb11-87" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb11-88"><a href="fine-scale-population-stratification.html#cb11-88" aria-hidden="true" tabindex="-1"></a>c2<span class="ot">=</span><span class="fu">sample</span>(sel,<span class="dv">25000</span>,<span class="at">replace=</span>F)</span>
<span id="cb11-89"><a href="fine-scale-population-stratification.html#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="fine-scale-population-stratification.html#cb11-90" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>pc<span class="sc">$</span>eid[pc<span class="sc">$</span>cluster<span class="sc">==</span><span class="dv">3</span>]</span>
<span id="cb11-91"><a href="fine-scale-population-stratification.html#cb11-91" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">56</span>)</span>
<span id="cb11-92"><a href="fine-scale-population-stratification.html#cb11-92" aria-hidden="true" tabindex="-1"></a>c3<span class="ot">=</span><span class="fu">sample</span>(sel,<span class="dv">25000</span>,<span class="at">replace=</span>F)</span>
<span id="cb11-93"><a href="fine-scale-population-stratification.html#cb11-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-94"><a href="fine-scale-population-stratification.html#cb11-94" aria-hidden="true" tabindex="-1"></a><span class="co"># final list</span></span>
<span id="cb11-95"><a href="fine-scale-population-stratification.html#cb11-95" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(<span class="fu">cbind</span>(c1,c1), </span>
<span id="cb11-96"><a href="fine-scale-population-stratification.html#cb11-96" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;ukbb-recommended-good-gwas.id&quot;</span>, </span>
<span id="cb11-97"><a href="fine-scale-population-stratification.html#cb11-97" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span>F, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span>
<span id="cb11-98"><a href="fine-scale-population-stratification.html#cb11-98" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(c1a,c2,c3),<span class="fu">c</span>(c1a,c2,c3)), </span>
<span id="cb11-99"><a href="fine-scale-population-stratification.html#cb11-99" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;ukbb-recommended-bad-gwas.id&quot;</span>, <span class="at">col.names=</span>F, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span>
<span id="cb11-100"><a href="fine-scale-population-stratification.html#cb11-100" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(c1a,c1b),<span class="fu">c</span>(c1a,c1b)), </span>
<span id="cb11-101"><a href="fine-scale-population-stratification.html#cb11-101" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;ukbb-recommended-control-gwas.id&quot;</span>, <span class="at">col.names=</span>F, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span></code></pre></div>
</div>
<div id="id-list-for-bad-gwas2" class="section level3" number="18.4.2">
<h3><span class="header-section-number">18.4.2</span> id list for bad gwas2</h3>
<p>Here we want to do a GWAS based on the mixture of cluster 1 &amp; cluster 2 only.
So that pop structure mostly come from PC1.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="fine-scale-population-stratification.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">100</span>)</span>
<span id="cb12-2"><a href="fine-scale-population-stratification.html#cb12-2" aria-hidden="true" tabindex="-1"></a>pc<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;gen/pca-337k-ukbb.eigenvec&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb12-3"><a href="fine-scale-population-stratification.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pc)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;eid&quot;</span>, <span class="st">&quot;eid&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;PC&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb12-4"><a href="fine-scale-population-stratification.html#cb12-4" aria-hidden="true" tabindex="-1"></a>pc1pc2<span class="ot">=</span>pc[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb12-5"><a href="fine-scale-population-stratification.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb12-6"><a href="fine-scale-population-stratification.html#cb12-6" aria-hidden="true" tabindex="-1"></a>cluster<span class="ot">=</span><span class="fu">kmeans</span>(pc1pc2, <span class="at">centers=</span><span class="dv">3</span>, <span class="at">nstart=</span><span class="dv">50</span>)</span>
<span id="cb12-7"><a href="fine-scale-population-stratification.html#cb12-7" aria-hidden="true" tabindex="-1"></a>centroid<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">PC1=</span><span class="fu">tapply</span>(pc<span class="sc">$</span>PC1,<span class="at">INDEX=</span>pc<span class="sc">$</span>cluster, mean),</span>
<span id="cb12-8"><a href="fine-scale-population-stratification.html#cb12-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">PC2=</span><span class="fu">tapply</span>(pc<span class="sc">$</span>PC2,<span class="at">INDEX=</span>pc<span class="sc">$</span>cluster, mean))</span>
<span id="cb12-9"><a href="fine-scale-population-stratification.html#cb12-9" aria-hidden="true" tabindex="-1"></a>centroid<span class="sc">$</span>n<span class="ot">=</span><span class="fu">table</span>(pc<span class="sc">$</span>cluster)</span>
<span id="cb12-10"><a href="fine-scale-population-stratification.html#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="fine-scale-population-stratification.html#cb12-11" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>pc<span class="sc">$</span>eid[pc<span class="sc">$</span>cluster<span class="sc">==</span><span class="dv">1</span>]</span>
<span id="cb12-12"><a href="fine-scale-population-stratification.html#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb12-13"><a href="fine-scale-population-stratification.html#cb12-13" aria-hidden="true" tabindex="-1"></a>c1<span class="ot">=</span><span class="fu">sample</span>(sel,<span class="dv">100000</span>,<span class="at">replace=</span>F) <span class="co"># good gwas: 100k</span></span>
<span id="cb12-14"><a href="fine-scale-population-stratification.html#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb12-15"><a href="fine-scale-population-stratification.html#cb12-15" aria-hidden="true" tabindex="-1"></a>c1a<span class="ot">=</span><span class="fu">sample</span>(c1,<span class="dv">50000</span>,<span class="at">replace=</span>F) <span class="co"># for bad gwas: 50k</span></span>
<span id="cb12-16"><a href="fine-scale-population-stratification.html#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="fine-scale-population-stratification.html#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># cluster 2  -&gt; each 1 list = 50k</span></span>
<span id="cb12-18"><a href="fine-scale-population-stratification.html#cb12-18" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span>pc<span class="sc">$</span>eid[pc<span class="sc">$</span>cluster<span class="sc">==</span><span class="dv">2</span>]</span>
<span id="cb12-19"><a href="fine-scale-population-stratification.html#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb12-20"><a href="fine-scale-population-stratification.html#cb12-20" aria-hidden="true" tabindex="-1"></a>c2<span class="ot">=</span><span class="fu">sample</span>(sel,<span class="dv">50000</span>,<span class="at">replace=</span>F)</span>
<span id="cb12-21"><a href="fine-scale-population-stratification.html#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="fine-scale-population-stratification.html#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># final list</span></span>
<span id="cb12-23"><a href="fine-scale-population-stratification.html#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(c1a,c2),<span class="fu">c</span>(c1a,c2)), </span>
<span id="cb12-24"><a href="fine-scale-population-stratification.html#cb12-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;ukbb-recommended-bad-gwas-2.id&quot;</span>, <span class="at">col.names=</span>F, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span></code></pre></div>
</div>
<div id="id-list-for-bad-gwas3" class="section level3" number="18.4.3">
<h3><span class="header-section-number">18.4.3</span> id list for bad gwas3</h3>
<p>Here we use mix individuals of the bottom and top PC1 only without considering PC2.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="fine-scale-population-stratification.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">100</span>)</span>
<span id="cb13-2"><a href="fine-scale-population-stratification.html#cb13-2" aria-hidden="true" tabindex="-1"></a>pc<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">&quot;gen/pca-337k-ukbb.eigenvec&quot;</span>, <span class="at">header=</span>F)</span>
<span id="cb13-3"><a href="fine-scale-population-stratification.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pc)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;eid&quot;</span>, <span class="st">&quot;eid&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;PC&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb13-4"><a href="fine-scale-population-stratification.html#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="fine-scale-population-stratification.html#cb13-5" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span>pc[<span class="fu">order</span>(pc<span class="sc">$</span>PC1),]</span>
<span id="cb13-6"><a href="fine-scale-population-stratification.html#cb13-6" aria-hidden="true" tabindex="-1"></a>out<span class="ot">=</span><span class="fu">rbind</span>(dat[<span class="dv">1</span><span class="sc">:</span><span class="dv">50000</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], </span>
<span id="cb13-7"><a href="fine-scale-population-stratification.html#cb13-7" aria-hidden="true" tabindex="-1"></a>          dat[(<span class="fu">dim</span>(dat)[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">50000</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">dim</span>(dat)[<span class="dv">1</span>],<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb13-8"><a href="fine-scale-population-stratification.html#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="fine-scale-population-stratification.html#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># final list</span></span>
<span id="cb13-10"><a href="fine-scale-population-stratification.html#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(out, <span class="st">&quot;ukbb-recommended-bad-gwas-3.id&quot;</span>, <span class="at">col.names=</span>F, <span class="at">row.names=</span>F, <span class="at">quote=</span>F)</span></code></pre></div>
</div>
<div id="bad-gwas-3" class="section level3" number="18.4.4">
<h3><span class="header-section-number">18.4.4</span> bad gwas</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="fine-scale-population-stratification.html#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="fine-scale-population-stratification.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct</span>
<span id="cb14-3"><a href="fine-scale-population-stratification.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct/bad-gwas</span>
<span id="cb14-4"><a href="fine-scale-population-stratification.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="fine-scale-population-stratification.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>fine-scale-pop-struct/bad-gwas</span>
<span id="cb14-6"><a href="fine-scale-population-stratification.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb14-7"><a href="fine-scale-population-stratification.html#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb14-8"><a href="fine-scale-population-stratification.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb14-9"><a href="fine-scale-population-stratification.html#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb14-10"><a href="fine-scale-population-stratification.html#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb14-11"><a href="fine-scale-population-stratification.html#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb14-12"><a href="fine-scale-population-stratification.html#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb14-13"><a href="fine-scale-population-stratification.html#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="fine-scale-population-stratification.html#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../</span><span class="va">$dir</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb14-15"><a href="fine-scale-population-stratification.html#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb14-16"><a href="fine-scale-population-stratification.html#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm </span><span class="dt">\</span></span>
<span id="cb14-17"><a href="fine-scale-population-stratification.html#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../ukbb-recommended-bad-gwas.id </span><span class="dt">\</span></span>
<span id="cb14-18"><a href="fine-scale-population-stratification.html#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-norm.use </span><span class="dt">\</span></span>
<span id="cb14-19"><a href="fine-scale-population-stratification.html#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb14-20"><a href="fine-scale-population-stratification.html#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb14-21"><a href="fine-scale-population-stratification.html#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb14-22"><a href="fine-scale-population-stratification.html#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb14-23"><a href="fine-scale-population-stratification.html#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="fine-scale-population-stratification.html#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files</span></span>
<span id="cb14-25"><a href="fine-scale-population-stratification.html#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb14-26"><a href="fine-scale-population-stratification.html#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb14-27"><a href="fine-scale-population-stratification.html#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/bad-gwas-fine-scale</span></code></pre></div>
</div>
<div id="bad-gwas2" class="section level3" number="18.4.5">
<h3><span class="header-section-number">18.4.5</span> bad gwas#2</h3>
<p>For mixing cluster 1 &amp; cluster 2 only.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="fine-scale-population-stratification.html#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="fine-scale-population-stratification.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct/bad-gwas-2</span>
<span id="cb15-3"><a href="fine-scale-population-stratification.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="fine-scale-population-stratification.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>fine-scale-pop-struct/bad-gwas-2</span>
<span id="cb15-5"><a href="fine-scale-population-stratification.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>ukbb-recommended-bad-gwas-2.id</span>
<span id="cb15-6"><a href="fine-scale-population-stratification.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb15-7"><a href="fine-scale-population-stratification.html#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb15-8"><a href="fine-scale-population-stratification.html#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb15-9"><a href="fine-scale-population-stratification.html#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb15-10"><a href="fine-scale-population-stratification.html#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb15-11"><a href="fine-scale-population-stratification.html#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb15-12"><a href="fine-scale-population-stratification.html#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb15-13"><a href="fine-scale-population-stratification.html#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="fine-scale-population-stratification.html#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../</span><span class="va">$dir</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb15-15"><a href="fine-scale-population-stratification.html#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb15-16"><a href="fine-scale-population-stratification.html#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm </span><span class="dt">\</span></span>
<span id="cb15-17"><a href="fine-scale-population-stratification.html#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../</span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb15-18"><a href="fine-scale-population-stratification.html#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-norm.use </span><span class="dt">\</span></span>
<span id="cb15-19"><a href="fine-scale-population-stratification.html#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb15-20"><a href="fine-scale-population-stratification.html#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb15-21"><a href="fine-scale-population-stratification.html#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb15-22"><a href="fine-scale-population-stratification.html#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb15-23"><a href="fine-scale-population-stratification.html#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="fine-scale-population-stratification.html#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files</span></span>
<span id="cb15-25"><a href="fine-scale-population-stratification.html#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb15-26"><a href="fine-scale-population-stratification.html#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb15-27"><a href="fine-scale-population-stratification.html#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/bad-gwas-2-fine-scale</span></code></pre></div>
</div>
<div id="bad-gwas3" class="section level3" number="18.4.6">
<h3><span class="header-section-number">18.4.6</span> bad gwas#3</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="fine-scale-population-stratification.html#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="fine-scale-population-stratification.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct/bad-gwas-3</span>
<span id="cb16-3"><a href="fine-scale-population-stratification.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="fine-scale-population-stratification.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>fine-scale-pop-struct/bad-gwas-3</span>
<span id="cb16-5"><a href="fine-scale-population-stratification.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>ukbb-recommended-bad-gwas-3.id</span>
<span id="cb16-6"><a href="fine-scale-population-stratification.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb16-7"><a href="fine-scale-population-stratification.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb16-8"><a href="fine-scale-population-stratification.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb16-9"><a href="fine-scale-population-stratification.html#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb16-10"><a href="fine-scale-population-stratification.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb16-11"><a href="fine-scale-population-stratification.html#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb16-12"><a href="fine-scale-population-stratification.html#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb16-13"><a href="fine-scale-population-stratification.html#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="fine-scale-population-stratification.html#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../</span><span class="va">$dir</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb16-15"><a href="fine-scale-population-stratification.html#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb16-16"><a href="fine-scale-population-stratification.html#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm </span><span class="dt">\</span></span>
<span id="cb16-17"><a href="fine-scale-population-stratification.html#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../</span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb16-18"><a href="fine-scale-population-stratification.html#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-norm.use </span><span class="dt">\</span></span>
<span id="cb16-19"><a href="fine-scale-population-stratification.html#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/basic-covariates.use </span><span class="dt">\</span></span>
<span id="cb16-20"><a href="fine-scale-population-stratification.html#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb16-21"><a href="fine-scale-population-stratification.html#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb16-22"><a href="fine-scale-population-stratification.html#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb16-23"><a href="fine-scale-population-stratification.html#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="fine-scale-population-stratification.html#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files</span></span>
<span id="cb16-25"><a href="fine-scale-population-stratification.html#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb16-26"><a href="fine-scale-population-stratification.html#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb16-27"><a href="fine-scale-population-stratification.html#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/bad-gwas-3-fine-scale</span></code></pre></div>
</div>
<div id="good-gwas-3" class="section level3" number="18.4.7">
<h3><span class="header-section-number">18.4.7</span> good gwas</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="fine-scale-population-stratification.html#cb17-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-2"><a href="fine-scale-population-stratification.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct/good-gwas</span>
<span id="cb17-3"><a href="fine-scale-population-stratification.html#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="fine-scale-population-stratification.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>fine-scale-pop-struct/good-gwas</span>
<span id="cb17-5"><a href="fine-scale-population-stratification.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>ukbb-recommended-good-gwas.id</span>
<span id="cb17-6"><a href="fine-scale-population-stratification.html#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="fine-scale-population-stratification.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb17-8"><a href="fine-scale-population-stratification.html#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb17-9"><a href="fine-scale-population-stratification.html#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb17-10"><a href="fine-scale-population-stratification.html#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb17-11"><a href="fine-scale-population-stratification.html#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb17-12"><a href="fine-scale-population-stratification.html#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb17-13"><a href="fine-scale-population-stratification.html#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb17-14"><a href="fine-scale-population-stratification.html#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="fine-scale-population-stratification.html#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../</span><span class="va">$dir</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb17-16"><a href="fine-scale-population-stratification.html#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb17-17"><a href="fine-scale-population-stratification.html#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm </span><span class="dt">\</span></span>
<span id="cb17-18"><a href="fine-scale-population-stratification.html#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../</span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb17-19"><a href="fine-scale-population-stratification.html#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-norm.use </span><span class="dt">\</span></span>
<span id="cb17-20"><a href="fine-scale-population-stratification.html#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb17-21"><a href="fine-scale-population-stratification.html#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb17-22"><a href="fine-scale-population-stratification.html#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb17-23"><a href="fine-scale-population-stratification.html#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb17-24"><a href="fine-scale-population-stratification.html#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="fine-scale-population-stratification.html#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files</span></span>
<span id="cb17-26"><a href="fine-scale-population-stratification.html#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb17-27"><a href="fine-scale-population-stratification.html#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb17-28"><a href="fine-scale-population-stratification.html#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/good-gwas-fine-scale</span></code></pre></div>
</div>
<div id="control-gwas-1" class="section level3" number="18.4.8">
<h3><span class="header-section-number">18.4.8</span> control gwas</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="fine-scale-population-stratification.html#cb18-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-2"><a href="fine-scale-population-stratification.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct/control-gwas</span>
<span id="cb18-3"><a href="fine-scale-population-stratification.html#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="fine-scale-population-stratification.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>fine-scale-pop-struct/control-gwas</span>
<span id="cb18-5"><a href="fine-scale-population-stratification.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>ukbb-recommended-control-gwas.id</span>
<span id="cb18-6"><a href="fine-scale-population-stratification.html#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="fine-scale-population-stratification.html#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb18-8"><a href="fine-scale-population-stratification.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb18-9"><a href="fine-scale-population-stratification.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb18-10"><a href="fine-scale-population-stratification.html#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb18-11"><a href="fine-scale-population-stratification.html#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 8G</span></span>
<span id="cb18-12"><a href="fine-scale-population-stratification.html#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 3</span></span>
<span id="cb18-13"><a href="fine-scale-population-stratification.html#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 10:0:0</span></span>
<span id="cb18-14"><a href="fine-scale-population-stratification.html#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="fine-scale-population-stratification.html#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.1 --linear ../</span><span class="va">$dir</span><span class="st">/</span><span class="va">$i</span><span class="st">-linear </span><span class="dt">\</span></span>
<span id="cb18-16"><a href="fine-scale-population-stratification.html#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --pheno ../phen/continuous-traits/</span><span class="va">$i</span><span class="st">.raw.pheno </span><span class="dt">\</span></span>
<span id="cb18-17"><a href="fine-scale-population-stratification.html#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile ../gen/geno-norm </span><span class="dt">\</span></span>
<span id="cb18-18"><a href="fine-scale-population-stratification.html#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep ../</span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb18-19"><a href="fine-scale-population-stratification.html#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --extract ../gen/snps-norm.use </span><span class="dt">\</span></span>
<span id="cb18-20"><a href="fine-scale-population-stratification.html#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --covar ../phen/covariates.use </span><span class="dt">\</span></span>
<span id="cb18-21"><a href="fine-scale-population-stratification.html#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --max-threads 3 </span><span class="dt">\</span></span>
<span id="cb18-22"><a href="fine-scale-population-stratification.html#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span> sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb18-23"><a href="fine-scale-population-stratification.html#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb18-24"><a href="fine-scale-population-stratification.html#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="fine-scale-population-stratification.html#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co"># submit files</span></span>
<span id="cb18-26"><a href="fine-scale-population-stratification.html#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb18-27"><a href="fine-scale-population-stratification.html#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/<span class="va">$i</span>-linear.sh</span>
<span id="cb18-28"><a href="fine-scale-population-stratification.html#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span><span class="op">&gt;</span>../job-records/control-gwas-fine-scale</span></code></pre></div>
</div>
</div>
<div id="compute-aver2-4" class="section level2" number="18.5">
<h2><span class="header-section-number">18.5</span> compute aver2</h2>
<div id="bad-gwas-4" class="section level3" number="18.5.1">
<h3><span class="header-section-number">18.5.1</span> bad-gwas</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="fine-scale-population-stratification.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new directory</span></span>
<span id="cb19-2"><a href="fine-scale-population-stratification.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> inflation/fine-scale-pop-struct/bad-gwas</span>
<span id="cb19-3"><a href="fine-scale-population-stratification.html#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="fine-scale-population-stratification.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to calc aver2 for lista-------------------------------------------------------</span></span>
<span id="cb19-5"><a href="fine-scale-population-stratification.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb19-6"><a href="fine-scale-population-stratification.html#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb19-7"><a href="fine-scale-population-stratification.html#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../ukbb-recommended-bad-gwas.id</span>
<span id="cb19-8"><a href="fine-scale-population-stratification.html#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-norm</span>
<span id="cb19-9"><a href="fine-scale-population-stratification.html#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/fine-scale-pop-struct/bad-gwas/aver2-lista</span>
<span id="cb19-10"><a href="fine-scale-population-stratification.html#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="fine-scale-population-stratification.html#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb19-12"><a href="fine-scale-population-stratification.html#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb19-13"><a href="fine-scale-population-stratification.html#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb19-14"><a href="fine-scale-population-stratification.html#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb19-15"><a href="fine-scale-population-stratification.html#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb19-16"><a href="fine-scale-population-stratification.html#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb19-17"><a href="fine-scale-population-stratification.html#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb19-18"><a href="fine-scale-population-stratification.html#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-19"><a href="fine-scale-population-stratification.html#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-20"><a href="fine-scale-population-stratification.html#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-21"><a href="fine-scale-population-stratification.html#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-22"><a href="fine-scale-population-stratification.html#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb19-23"><a href="fine-scale-population-stratification.html#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-lista</span>
<span id="cb19-24"><a href="fine-scale-population-stratification.html#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="fine-scale-population-stratification.html#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb19-26"><a href="fine-scale-population-stratification.html#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-lista <span class="op">&gt;</span>../job-records/calc-aver2-fine-pop-bad-gwas</span>
<span id="cb19-27"><a href="fine-scale-population-stratification.html#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="fine-scale-population-stratification.html#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co"># to calc aver2 for listb-------------------------------------------------------</span></span>
<span id="cb19-29"><a href="fine-scale-population-stratification.html#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb19-30"><a href="fine-scale-population-stratification.html#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb19-31"><a href="fine-scale-population-stratification.html#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../ukbb-recommended-bad-gwas.id</span>
<span id="cb19-32"><a href="fine-scale-population-stratification.html#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-norm</span>
<span id="cb19-33"><a href="fine-scale-population-stratification.html#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/fine-scale-pop-struct/bad-gwas/aver2-listb</span>
<span id="cb19-34"><a href="fine-scale-population-stratification.html#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="fine-scale-population-stratification.html#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb19-36"><a href="fine-scale-population-stratification.html#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb19-37"><a href="fine-scale-population-stratification.html#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb19-38"><a href="fine-scale-population-stratification.html#cb19-38" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb19-39"><a href="fine-scale-population-stratification.html#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb19-40"><a href="fine-scale-population-stratification.html#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb19-41"><a href="fine-scale-population-stratification.html#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb19-42"><a href="fine-scale-population-stratification.html#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-43"><a href="fine-scale-population-stratification.html#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-44"><a href="fine-scale-population-stratification.html#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-45"><a href="fine-scale-population-stratification.html#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$listb</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb19-46"><a href="fine-scale-population-stratification.html#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$lista</span></span>
<span id="cb19-47"><a href="fine-scale-population-stratification.html#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-listb</span>
<span id="cb19-48"><a href="fine-scale-population-stratification.html#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="fine-scale-population-stratification.html#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb19-50"><a href="fine-scale-population-stratification.html#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-listb <span class="op">&gt;</span>../job-records/calc-aver2-fine-pop-bad-gwas</span>
<span id="cb19-51"><a href="fine-scale-population-stratification.html#cb19-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-52"><a href="fine-scale-population-stratification.html#cb19-52" aria-hidden="true" tabindex="-1"></a><span class="co"># merge aver2 of the two lists--------------------------------------------------</span></span>
<span id="cb19-53"><a href="fine-scale-population-stratification.html#cb19-53" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>inflation/fine-scale-pop-struct/bad-gwas</span>
<span id="cb19-54"><a href="fine-scale-population-stratification.html#cb19-54" aria-hidden="true" tabindex="-1"></a><span class="va">a</span><span class="op">=</span><span class="va">$dir</span>/aver2-lista.rjk2.average</span>
<span id="cb19-55"><a href="fine-scale-population-stratification.html#cb19-55" aria-hidden="true" tabindex="-1"></a><span class="va">b</span><span class="op">=</span><span class="va">$dir</span>/aver2-listb.rjk2.average</span>
<span id="cb19-56"><a href="fine-scale-population-stratification.html#cb19-56" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$dir</span>/bad-gwas.aver2</span>
<span id="cb19-57"><a href="fine-scale-population-stratification.html#cb19-57" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;FNR &gt; 1 {print $1, $2}&#39;</span>  <span class="va">$a</span> <span class="va">$b</span> <span class="op">&gt;</span> <span class="va">$out</span></span></code></pre></div>
</div>
<div id="bad-gwas2-1" class="section level3" number="18.5.2">
<h3><span class="header-section-number">18.5.2</span> bad-gwas#2</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="fine-scale-population-stratification.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new directory</span></span>
<span id="cb20-2"><a href="fine-scale-population-stratification.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> inflation/fine-scale-pop-struct/bad-gwas-2</span>
<span id="cb20-3"><a href="fine-scale-population-stratification.html#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="fine-scale-population-stratification.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to calc aver2 for lista-------------------------------------------------------</span></span>
<span id="cb20-5"><a href="fine-scale-population-stratification.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb20-6"><a href="fine-scale-population-stratification.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb20-7"><a href="fine-scale-population-stratification.html#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../ukbb-recommended-bad-gwas-2.id</span>
<span id="cb20-8"><a href="fine-scale-population-stratification.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-norm</span>
<span id="cb20-9"><a href="fine-scale-population-stratification.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/fine-scale-pop-struct/bad-gwas-2/aver2-lista</span>
<span id="cb20-10"><a href="fine-scale-population-stratification.html#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="fine-scale-population-stratification.html#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb20-12"><a href="fine-scale-population-stratification.html#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb20-13"><a href="fine-scale-population-stratification.html#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb20-14"><a href="fine-scale-population-stratification.html#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb20-15"><a href="fine-scale-population-stratification.html#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb20-16"><a href="fine-scale-population-stratification.html#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb20-17"><a href="fine-scale-population-stratification.html#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb20-18"><a href="fine-scale-population-stratification.html#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb20-19"><a href="fine-scale-population-stratification.html#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb20-20"><a href="fine-scale-population-stratification.html#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb20-21"><a href="fine-scale-population-stratification.html#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb20-22"><a href="fine-scale-population-stratification.html#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb20-23"><a href="fine-scale-population-stratification.html#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-lista</span>
<span id="cb20-24"><a href="fine-scale-population-stratification.html#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="fine-scale-population-stratification.html#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb20-26"><a href="fine-scale-population-stratification.html#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-lista <span class="op">&gt;</span>../job-records/calc-aver2-fine-pop-bad-gwas-2</span>
<span id="cb20-27"><a href="fine-scale-population-stratification.html#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="fine-scale-population-stratification.html#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># to calc aver2 for listb-------------------------------------------------------</span></span>
<span id="cb20-29"><a href="fine-scale-population-stratification.html#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb20-30"><a href="fine-scale-population-stratification.html#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb20-31"><a href="fine-scale-population-stratification.html#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../ukbb-recommended-bad-gwas-2.id</span>
<span id="cb20-32"><a href="fine-scale-population-stratification.html#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-norm</span>
<span id="cb20-33"><a href="fine-scale-population-stratification.html#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/fine-scale-pop-struct/bad-gwas-2/aver2-listb</span>
<span id="cb20-34"><a href="fine-scale-population-stratification.html#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="fine-scale-population-stratification.html#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb20-36"><a href="fine-scale-population-stratification.html#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb20-37"><a href="fine-scale-population-stratification.html#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb20-38"><a href="fine-scale-population-stratification.html#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb20-39"><a href="fine-scale-population-stratification.html#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb20-40"><a href="fine-scale-population-stratification.html#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb20-41"><a href="fine-scale-population-stratification.html#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb20-42"><a href="fine-scale-population-stratification.html#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb20-43"><a href="fine-scale-population-stratification.html#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb20-44"><a href="fine-scale-population-stratification.html#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb20-45"><a href="fine-scale-population-stratification.html#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$listb</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb20-46"><a href="fine-scale-population-stratification.html#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$lista</span></span>
<span id="cb20-47"><a href="fine-scale-population-stratification.html#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-listb</span>
<span id="cb20-48"><a href="fine-scale-population-stratification.html#cb20-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-49"><a href="fine-scale-population-stratification.html#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb20-50"><a href="fine-scale-population-stratification.html#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-listb <span class="op">&gt;</span>../job-records/calc-aver2-fine-pop-bad-gwas-2</span>
<span id="cb20-51"><a href="fine-scale-population-stratification.html#cb20-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-52"><a href="fine-scale-population-stratification.html#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="co"># merge aver2 of the two lists--------------------------------------------------</span></span>
<span id="cb20-53"><a href="fine-scale-population-stratification.html#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>inflation/fine-scale-pop-struct/bad-gwas-2</span>
<span id="cb20-54"><a href="fine-scale-population-stratification.html#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="va">a</span><span class="op">=</span><span class="va">$dir</span>/aver2-lista.rjk2.average</span>
<span id="cb20-55"><a href="fine-scale-population-stratification.html#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="va">b</span><span class="op">=</span><span class="va">$dir</span>/aver2-listb.rjk2.average</span>
<span id="cb20-56"><a href="fine-scale-population-stratification.html#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$dir</span>/bad-gwas-2.aver2</span>
<span id="cb20-57"><a href="fine-scale-population-stratification.html#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;FNR &gt; 1 {print $1, $2}&#39;</span>  <span class="va">$a</span> <span class="va">$b</span> <span class="op">&gt;</span> <span class="va">$out</span></span></code></pre></div>
</div>
<div id="bad-gwas3-1" class="section level3" number="18.5.3">
<h3><span class="header-section-number">18.5.3</span> bad-gwas#3</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="fine-scale-population-stratification.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new directory</span></span>
<span id="cb21-2"><a href="fine-scale-population-stratification.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> inflation/fine-scale-pop-struct/bad-gwas-3</span>
<span id="cb21-3"><a href="fine-scale-population-stratification.html#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="fine-scale-population-stratification.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to calc aver2 for lista-------------------------------------------------------</span></span>
<span id="cb21-5"><a href="fine-scale-population-stratification.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb21-6"><a href="fine-scale-population-stratification.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb21-7"><a href="fine-scale-population-stratification.html#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../ukbb-recommended-bad-gwas-3.id</span>
<span id="cb21-8"><a href="fine-scale-population-stratification.html#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-norm</span>
<span id="cb21-9"><a href="fine-scale-population-stratification.html#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/fine-scale-pop-struct/bad-gwas-3/aver2-lista</span>
<span id="cb21-10"><a href="fine-scale-population-stratification.html#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="fine-scale-population-stratification.html#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb21-12"><a href="fine-scale-population-stratification.html#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb21-13"><a href="fine-scale-population-stratification.html#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb21-14"><a href="fine-scale-population-stratification.html#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb21-15"><a href="fine-scale-population-stratification.html#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb21-16"><a href="fine-scale-population-stratification.html#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb21-17"><a href="fine-scale-population-stratification.html#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb21-18"><a href="fine-scale-population-stratification.html#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb21-19"><a href="fine-scale-population-stratification.html#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb21-20"><a href="fine-scale-population-stratification.html#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb21-21"><a href="fine-scale-population-stratification.html#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb21-22"><a href="fine-scale-population-stratification.html#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb21-23"><a href="fine-scale-population-stratification.html#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-lista</span>
<span id="cb21-24"><a href="fine-scale-population-stratification.html#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="fine-scale-population-stratification.html#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb21-26"><a href="fine-scale-population-stratification.html#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-lista <span class="op">&gt;</span>../job-records/calc-aver2-fine-pop-bad-gwas-3</span>
<span id="cb21-27"><a href="fine-scale-population-stratification.html#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="fine-scale-population-stratification.html#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co"># to calc aver2 for listb-------------------------------------------------------</span></span>
<span id="cb21-29"><a href="fine-scale-population-stratification.html#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb21-30"><a href="fine-scale-population-stratification.html#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb21-31"><a href="fine-scale-population-stratification.html#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../ukbb-recommended-bad-gwas-3.id</span>
<span id="cb21-32"><a href="fine-scale-population-stratification.html#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-norm</span>
<span id="cb21-33"><a href="fine-scale-population-stratification.html#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/fine-scale-pop-struct/bad-gwas-3/aver2-listb</span>
<span id="cb21-34"><a href="fine-scale-population-stratification.html#cb21-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-35"><a href="fine-scale-population-stratification.html#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb21-36"><a href="fine-scale-population-stratification.html#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb21-37"><a href="fine-scale-population-stratification.html#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb21-38"><a href="fine-scale-population-stratification.html#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb21-39"><a href="fine-scale-population-stratification.html#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb21-40"><a href="fine-scale-population-stratification.html#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb21-41"><a href="fine-scale-population-stratification.html#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb21-42"><a href="fine-scale-population-stratification.html#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb21-43"><a href="fine-scale-population-stratification.html#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb21-44"><a href="fine-scale-population-stratification.html#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb21-45"><a href="fine-scale-population-stratification.html#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$listb</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb21-46"><a href="fine-scale-population-stratification.html#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$lista</span></span>
<span id="cb21-47"><a href="fine-scale-population-stratification.html#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-listb</span>
<span id="cb21-48"><a href="fine-scale-population-stratification.html#cb21-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-49"><a href="fine-scale-population-stratification.html#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb21-50"><a href="fine-scale-population-stratification.html#cb21-50" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-listb <span class="op">&gt;</span>../job-records/calc-aver2-fine-pop-bad-gwas-3</span>
<span id="cb21-51"><a href="fine-scale-population-stratification.html#cb21-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-52"><a href="fine-scale-population-stratification.html#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="co"># merge aver2 of the two lists--------------------------------------------------</span></span>
<span id="cb21-53"><a href="fine-scale-population-stratification.html#cb21-53" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>inflation/fine-scale-pop-struct/bad-gwas-3</span>
<span id="cb21-54"><a href="fine-scale-population-stratification.html#cb21-54" aria-hidden="true" tabindex="-1"></a><span class="va">a</span><span class="op">=</span><span class="va">$dir</span>/aver2-lista.rjk2.average</span>
<span id="cb21-55"><a href="fine-scale-population-stratification.html#cb21-55" aria-hidden="true" tabindex="-1"></a><span class="va">b</span><span class="op">=</span><span class="va">$dir</span>/aver2-listb.rjk2.average</span>
<span id="cb21-56"><a href="fine-scale-population-stratification.html#cb21-56" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$dir</span>/bad-gwas-3.aver2</span>
<span id="cb21-57"><a href="fine-scale-population-stratification.html#cb21-57" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;FNR &gt; 1 {print $1, $2}&#39;</span>  <span class="va">$a</span> <span class="va">$b</span> <span class="op">&gt;</span> <span class="va">$out</span></span></code></pre></div>
</div>
<div id="good-gwas-4" class="section level3" number="18.5.4">
<h3><span class="header-section-number">18.5.4</span> good-gwas</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="fine-scale-population-stratification.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new directory</span></span>
<span id="cb22-2"><a href="fine-scale-population-stratification.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> inflation/fine-scale-pop-struct/good-gwas</span>
<span id="cb22-3"><a href="fine-scale-population-stratification.html#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="fine-scale-population-stratification.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to calc aver2 for lista-------------------------------------------------------</span></span>
<span id="cb22-5"><a href="fine-scale-population-stratification.html#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb22-6"><a href="fine-scale-population-stratification.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb22-7"><a href="fine-scale-population-stratification.html#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../ukbb-recommended-good-gwas.id</span>
<span id="cb22-8"><a href="fine-scale-population-stratification.html#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-norm</span>
<span id="cb22-9"><a href="fine-scale-population-stratification.html#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/fine-scale-pop-struct/good-gwas/aver2-lista</span>
<span id="cb22-10"><a href="fine-scale-population-stratification.html#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="fine-scale-population-stratification.html#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb22-12"><a href="fine-scale-population-stratification.html#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb22-13"><a href="fine-scale-population-stratification.html#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb22-14"><a href="fine-scale-population-stratification.html#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb22-15"><a href="fine-scale-population-stratification.html#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb22-16"><a href="fine-scale-population-stratification.html#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb22-17"><a href="fine-scale-population-stratification.html#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb22-18"><a href="fine-scale-population-stratification.html#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb22-19"><a href="fine-scale-population-stratification.html#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb22-20"><a href="fine-scale-population-stratification.html#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb22-21"><a href="fine-scale-population-stratification.html#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb22-22"><a href="fine-scale-population-stratification.html#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb22-23"><a href="fine-scale-population-stratification.html#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-lista</span>
<span id="cb22-24"><a href="fine-scale-population-stratification.html#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="fine-scale-population-stratification.html#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb22-26"><a href="fine-scale-population-stratification.html#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-lista <span class="op">&gt;</span>../job-records/calc-aver2-fine-pop-good-gwas</span>
<span id="cb22-27"><a href="fine-scale-population-stratification.html#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="fine-scale-population-stratification.html#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co"># to calc aver2 for listb-------------------------------------------------------</span></span>
<span id="cb22-29"><a href="fine-scale-population-stratification.html#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb22-30"><a href="fine-scale-population-stratification.html#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb22-31"><a href="fine-scale-population-stratification.html#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../ukbb-recommended-good-gwas.id</span>
<span id="cb22-32"><a href="fine-scale-population-stratification.html#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-norm</span>
<span id="cb22-33"><a href="fine-scale-population-stratification.html#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/fine-scale-pop-struct/good-gwas/aver2-listb</span>
<span id="cb22-34"><a href="fine-scale-population-stratification.html#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="fine-scale-population-stratification.html#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb22-36"><a href="fine-scale-population-stratification.html#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb22-37"><a href="fine-scale-population-stratification.html#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb22-38"><a href="fine-scale-population-stratification.html#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb22-39"><a href="fine-scale-population-stratification.html#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb22-40"><a href="fine-scale-population-stratification.html#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb22-41"><a href="fine-scale-population-stratification.html#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb22-42"><a href="fine-scale-population-stratification.html#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb22-43"><a href="fine-scale-population-stratification.html#cb22-43" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb22-44"><a href="fine-scale-population-stratification.html#cb22-44" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb22-45"><a href="fine-scale-population-stratification.html#cb22-45" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$listb</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb22-46"><a href="fine-scale-population-stratification.html#cb22-46" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$lista</span></span>
<span id="cb22-47"><a href="fine-scale-population-stratification.html#cb22-47" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-listb</span>
<span id="cb22-48"><a href="fine-scale-population-stratification.html#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="fine-scale-population-stratification.html#cb22-49" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb22-50"><a href="fine-scale-population-stratification.html#cb22-50" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-listb <span class="op">&gt;</span>../job-records/calc-aver2-fine-pop-good-gwas</span>
<span id="cb22-51"><a href="fine-scale-population-stratification.html#cb22-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-52"><a href="fine-scale-population-stratification.html#cb22-52" aria-hidden="true" tabindex="-1"></a><span class="co"># merge aver2 of the two lists--------------------------------------------------</span></span>
<span id="cb22-53"><a href="fine-scale-population-stratification.html#cb22-53" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>inflation/fine-scale-pop-struct/good-gwas</span>
<span id="cb22-54"><a href="fine-scale-population-stratification.html#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="va">a</span><span class="op">=</span><span class="va">$dir</span>/aver2-lista.rjk2.average</span>
<span id="cb22-55"><a href="fine-scale-population-stratification.html#cb22-55" aria-hidden="true" tabindex="-1"></a><span class="va">b</span><span class="op">=</span><span class="va">$dir</span>/aver2-listb.rjk2.average</span>
<span id="cb22-56"><a href="fine-scale-population-stratification.html#cb22-56" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$dir</span>/good-gwas.aver2</span>
<span id="cb22-57"><a href="fine-scale-population-stratification.html#cb22-57" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;FNR &gt; 1 {print $1, $2}&#39;</span>  <span class="va">$a</span> <span class="va">$b</span> <span class="op">&gt;</span> <span class="va">$out</span></span></code></pre></div>
</div>
<div id="control-gwas-2" class="section level3" number="18.5.5">
<h3><span class="header-section-number">18.5.5</span> control-gwas</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="fine-scale-population-stratification.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new directory</span></span>
<span id="cb23-2"><a href="fine-scale-population-stratification.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> inflation/fine-scale-pop-struct/control-gwas</span>
<span id="cb23-3"><a href="fine-scale-population-stratification.html#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="fine-scale-population-stratification.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to calc aver2 for lista-------------------------------------------------------</span></span>
<span id="cb23-5"><a href="fine-scale-population-stratification.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb23-6"><a href="fine-scale-population-stratification.html#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb23-7"><a href="fine-scale-population-stratification.html#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../ukbb-recommended-control-gwas.id</span>
<span id="cb23-8"><a href="fine-scale-population-stratification.html#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-norm</span>
<span id="cb23-9"><a href="fine-scale-population-stratification.html#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/fine-scale-pop-struct/control-gwas/aver2-lista</span>
<span id="cb23-10"><a href="fine-scale-population-stratification.html#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="fine-scale-population-stratification.html#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb23-12"><a href="fine-scale-population-stratification.html#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb23-13"><a href="fine-scale-population-stratification.html#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb23-14"><a href="fine-scale-population-stratification.html#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb23-15"><a href="fine-scale-population-stratification.html#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb23-16"><a href="fine-scale-population-stratification.html#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb23-17"><a href="fine-scale-population-stratification.html#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb23-18"><a href="fine-scale-population-stratification.html#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb23-19"><a href="fine-scale-population-stratification.html#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb23-20"><a href="fine-scale-population-stratification.html#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb23-21"><a href="fine-scale-population-stratification.html#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$lista</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb23-22"><a href="fine-scale-population-stratification.html#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$listb</span></span>
<span id="cb23-23"><a href="fine-scale-population-stratification.html#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-lista</span>
<span id="cb23-24"><a href="fine-scale-population-stratification.html#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="fine-scale-population-stratification.html#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb23-26"><a href="fine-scale-population-stratification.html#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-lista <span class="op">&gt;</span>../job-records/calc-aver2-fine-pop-control-gwas</span>
<span id="cb23-27"><a href="fine-scale-population-stratification.html#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="fine-scale-population-stratification.html#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co"># to calc aver2 for listb-------------------------------------------------------</span></span>
<span id="cb23-29"><a href="fine-scale-population-stratification.html#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="va">lista</span><span class="op">=</span>../inflation/left-snps-unrel-inds-10k</span>
<span id="cb23-30"><a href="fine-scale-population-stratification.html#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="va">listb</span><span class="op">=</span>../inflation/right-snps-unrel-inds-10k</span>
<span id="cb23-31"><a href="fine-scale-population-stratification.html#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../ukbb-recommended-control-gwas.id</span>
<span id="cb23-32"><a href="fine-scale-population-stratification.html#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-norm</span>
<span id="cb23-33"><a href="fine-scale-population-stratification.html#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../inflation/fine-scale-pop-struct/control-gwas/aver2-listb</span>
<span id="cb23-34"><a href="fine-scale-population-stratification.html#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="fine-scale-population-stratification.html#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb23-36"><a href="fine-scale-population-stratification.html#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb23-37"><a href="fine-scale-population-stratification.html#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb23-38"><a href="fine-scale-population-stratification.html#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb23-39"><a href="fine-scale-population-stratification.html#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb23-40"><a href="fine-scale-population-stratification.html#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb23-41"><a href="fine-scale-population-stratification.html#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb23-42"><a href="fine-scale-population-stratification.html#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb23-43"><a href="fine-scale-population-stratification.html#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb23-44"><a href="fine-scale-population-stratification.html#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb23-45"><a href="fine-scale-population-stratification.html#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$listb</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb23-46"><a href="fine-scale-population-stratification.html#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$lista</span></span>
<span id="cb23-47"><a href="fine-scale-population-stratification.html#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-listb</span>
<span id="cb23-48"><a href="fine-scale-population-stratification.html#cb23-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-49"><a href="fine-scale-population-stratification.html#cb23-49" aria-hidden="true" tabindex="-1"></a><span class="co"># job submission</span></span>
<span id="cb23-50"><a href="fine-scale-population-stratification.html#cb23-50" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-listb <span class="op">&gt;</span>../job-records/calc-aver2-fine-pop-control-gwas</span>
<span id="cb23-51"><a href="fine-scale-population-stratification.html#cb23-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-52"><a href="fine-scale-population-stratification.html#cb23-52" aria-hidden="true" tabindex="-1"></a><span class="co"># merge aver2 of the two lists--------------------------------------------------</span></span>
<span id="cb23-53"><a href="fine-scale-population-stratification.html#cb23-53" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>inflation/fine-scale-pop-struct/control-gwas</span>
<span id="cb23-54"><a href="fine-scale-population-stratification.html#cb23-54" aria-hidden="true" tabindex="-1"></a><span class="va">a</span><span class="op">=</span><span class="va">$dir</span>/aver2-lista.rjk2.average</span>
<span id="cb23-55"><a href="fine-scale-population-stratification.html#cb23-55" aria-hidden="true" tabindex="-1"></a><span class="va">b</span><span class="op">=</span><span class="va">$dir</span>/aver2-listb.rjk2.average</span>
<span id="cb23-56"><a href="fine-scale-population-stratification.html#cb23-56" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$dir</span>/control-gwas.aver2</span>
<span id="cb23-57"><a href="fine-scale-population-stratification.html#cb23-57" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;FNR &gt; 1 {print $1, $2}&#39;</span>  <span class="va">$a</span> <span class="va">$b</span> <span class="op">&gt;</span> <span class="va">$out</span></span></code></pre></div>
</div>
</div>
<div id="chisq-aver2-4" class="section level2" number="18.6">
<h2><span class="header-section-number">18.6</span> chisq ~ aver2</h2>
<div id="bad-gwas-5" class="section level3" number="18.6.1">
<h3><span class="header-section-number">18.6.1</span> bad gwas</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="fine-scale-population-stratification.html#cb24-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2"><a href="fine-scale-population-stratification.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># organize information----------------------------------------------------------</span></span>
<span id="cb24-3"><a href="fine-scale-population-stratification.html#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="fine-scale-population-stratification.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct/bad-gwas-out</span>
<span id="cb24-5"><a href="fine-scale-population-stratification.html#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="fine-scale-population-stratification.html#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb24-7"><a href="fine-scale-population-stratification.html#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="fine-scale-population-stratification.html#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>fine-scale-pop-struct/bad-gwas/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb24-9"><a href="fine-scale-population-stratification.html#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>inflation/fine-scale-pop-struct/bad-gwas/bad-gwas.aver2</span>
<span id="cb24-10"><a href="fine-scale-population-stratification.html#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-norm.ldscore</span>
<span id="cb24-11"><a href="fine-scale-population-stratification.html#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>fine-scale-pop-struct/bad-gwas-out/<span class="va">$trait</span>.out</span>
<span id="cb24-12"><a href="fine-scale-population-stratification.html#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="fine-scale-population-stratification.html#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp</span>
<span id="cb24-14"><a href="fine-scale-population-stratification.html#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="fine-scale-population-stratification.html#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb24-16"><a href="fine-scale-population-stratification.html#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb24-17"><a href="fine-scale-population-stratification.html#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb24-18"><a href="fine-scale-population-stratification.html#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="fine-scale-population-stratification.html#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb24-20"><a href="fine-scale-population-stratification.html#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb24-21"><a href="fine-scale-population-stratification.html#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb24-22"><a href="fine-scale-population-stratification.html#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="fine-scale-population-stratification.html#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb24-24"><a href="fine-scale-population-stratification.html#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb24-25"><a href="fine-scale-population-stratification.html#cb24-25" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb24-26"><a href="fine-scale-population-stratification.html#cb24-26" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb24-27"><a href="fine-scale-population-stratification.html#cb24-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb24-28"><a href="fine-scale-population-stratification.html#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb24-29"><a href="fine-scale-population-stratification.html#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb24-30"><a href="fine-scale-population-stratification.html#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="fine-scale-population-stratification.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2------------------------------------------------------------</span></span>
<span id="cb25-2"><a href="fine-scale-population-stratification.html#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="fine-scale-population-stratification.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb25-4"><a href="fine-scale-population-stratification.html#cb25-4" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb25-5"><a href="fine-scale-population-stratification.html#cb25-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb25-6"><a href="fine-scale-population-stratification.html#cb25-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb25-7"><a href="fine-scale-population-stratification.html#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="fine-scale-population-stratification.html#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-fine-pop-bad-gwas.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb25-9"><a href="fine-scale-population-stratification.html#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb25-10"><a href="fine-scale-population-stratification.html#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="fine-scale-population-stratification.html#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb25-12"><a href="fine-scale-population-stratification.html#cb25-12" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb25-13"><a href="fine-scale-population-stratification.html#cb25-13" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;fine-scale-pop-struct/bad-gwas-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb25-14"><a href="fine-scale-population-stratification.html#cb25-14" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb25-15"><a href="fine-scale-population-stratification.html#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="fine-scale-population-stratification.html#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb25-17"><a href="fine-scale-population-stratification.html#cb25-17" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb25-18"><a href="fine-scale-population-stratification.html#cb25-18" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb25-19"><a href="fine-scale-population-stratification.html#cb25-19" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb25-20"><a href="fine-scale-population-stratification.html#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="fine-scale-population-stratification.html#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb25-22"><a href="fine-scale-population-stratification.html#cb25-22" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb25-23"><a href="fine-scale-population-stratification.html#cb25-23" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb25-24"><a href="fine-scale-population-stratification.html#cb25-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-25"><a href="fine-scale-population-stratification.html#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb25-26"><a href="fine-scale-population-stratification.html#cb25-26" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb25-27"><a href="fine-scale-population-stratification.html#cb25-27" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb25-28"><a href="fine-scale-population-stratification.html#cb25-28" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb25-29"><a href="fine-scale-population-stratification.html#cb25-29" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb25-30"><a href="fine-scale-population-stratification.html#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="fine-scale-population-stratification.html#cb25-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb25-32"><a href="fine-scale-population-stratification.html#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb25-33"><a href="fine-scale-population-stratification.html#cb25-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb25-34"><a href="fine-scale-population-stratification.html#cb25-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb25-35"><a href="fine-scale-population-stratification.html#cb25-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb25-36"><a href="fine-scale-population-stratification.html#cb25-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb25-37"><a href="fine-scale-population-stratification.html#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb25-38"><a href="fine-scale-population-stratification.html#cb25-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb25-39"><a href="fine-scale-population-stratification.html#cb25-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb25-40"><a href="fine-scale-population-stratification.html#cb25-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb25-41"><a href="fine-scale-population-stratification.html#cb25-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-42"><a href="fine-scale-population-stratification.html#cb25-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-43"><a href="fine-scale-population-stratification.html#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="bad-gwas2-2" class="section level3" number="18.6.2">
<h3><span class="header-section-number">18.6.2</span> bad gwas#2</h3>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="fine-scale-population-stratification.html#cb26-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-2"><a href="fine-scale-population-stratification.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># organize information----------------------------------------------------------</span></span>
<span id="cb26-3"><a href="fine-scale-population-stratification.html#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="fine-scale-population-stratification.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct/bad-gwas-2-out</span>
<span id="cb26-5"><a href="fine-scale-population-stratification.html#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="fine-scale-population-stratification.html#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb26-7"><a href="fine-scale-population-stratification.html#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="fine-scale-population-stratification.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>fine-scale-pop-struct/bad-gwas-2/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb26-9"><a href="fine-scale-population-stratification.html#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>inflation/fine-scale-pop-struct/bad-gwas-2/bad-gwas-2.aver2</span>
<span id="cb26-10"><a href="fine-scale-population-stratification.html#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-norm.ldscore</span>
<span id="cb26-11"><a href="fine-scale-population-stratification.html#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>fine-scale-pop-struct/bad-gwas-2-out/<span class="va">$trait</span>.out</span>
<span id="cb26-12"><a href="fine-scale-population-stratification.html#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="fine-scale-population-stratification.html#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp</span>
<span id="cb26-14"><a href="fine-scale-population-stratification.html#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="fine-scale-population-stratification.html#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb26-16"><a href="fine-scale-population-stratification.html#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb26-17"><a href="fine-scale-population-stratification.html#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb26-18"><a href="fine-scale-population-stratification.html#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="fine-scale-population-stratification.html#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb26-20"><a href="fine-scale-population-stratification.html#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb26-21"><a href="fine-scale-population-stratification.html#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb26-22"><a href="fine-scale-population-stratification.html#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="fine-scale-population-stratification.html#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb26-24"><a href="fine-scale-population-stratification.html#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb26-25"><a href="fine-scale-population-stratification.html#cb26-25" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb26-26"><a href="fine-scale-population-stratification.html#cb26-26" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb26-27"><a href="fine-scale-population-stratification.html#cb26-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb26-28"><a href="fine-scale-population-stratification.html#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb26-29"><a href="fine-scale-population-stratification.html#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb26-30"><a href="fine-scale-population-stratification.html#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="fine-scale-population-stratification.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2------------------------------------------------------------</span></span>
<span id="cb27-2"><a href="fine-scale-population-stratification.html#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="fine-scale-population-stratification.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb27-4"><a href="fine-scale-population-stratification.html#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="fine-scale-population-stratification.html#cb27-5" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb27-6"><a href="fine-scale-population-stratification.html#cb27-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb27-7"><a href="fine-scale-population-stratification.html#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb27-8"><a href="fine-scale-population-stratification.html#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="fine-scale-population-stratification.html#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-fine-pop-bad-gwas-2.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb27-10"><a href="fine-scale-population-stratification.html#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb27-11"><a href="fine-scale-population-stratification.html#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="fine-scale-population-stratification.html#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb27-13"><a href="fine-scale-population-stratification.html#cb27-13" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb27-14"><a href="fine-scale-population-stratification.html#cb27-14" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;fine-scale-pop-struct/bad-gwas-2-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb27-15"><a href="fine-scale-population-stratification.html#cb27-15" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb27-16"><a href="fine-scale-population-stratification.html#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="fine-scale-population-stratification.html#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb27-18"><a href="fine-scale-population-stratification.html#cb27-18" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb27-19"><a href="fine-scale-population-stratification.html#cb27-19" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb27-20"><a href="fine-scale-population-stratification.html#cb27-20" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb27-21"><a href="fine-scale-population-stratification.html#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="fine-scale-population-stratification.html#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb27-23"><a href="fine-scale-population-stratification.html#cb27-23" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb27-24"><a href="fine-scale-population-stratification.html#cb27-24" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb27-25"><a href="fine-scale-population-stratification.html#cb27-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-26"><a href="fine-scale-population-stratification.html#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb27-27"><a href="fine-scale-population-stratification.html#cb27-27" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb27-28"><a href="fine-scale-population-stratification.html#cb27-28" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb27-29"><a href="fine-scale-population-stratification.html#cb27-29" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb27-30"><a href="fine-scale-population-stratification.html#cb27-30" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb27-31"><a href="fine-scale-population-stratification.html#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="fine-scale-population-stratification.html#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb27-33"><a href="fine-scale-population-stratification.html#cb27-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb27-34"><a href="fine-scale-population-stratification.html#cb27-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb27-35"><a href="fine-scale-population-stratification.html#cb27-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb27-36"><a href="fine-scale-population-stratification.html#cb27-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb27-37"><a href="fine-scale-population-stratification.html#cb27-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb27-38"><a href="fine-scale-population-stratification.html#cb27-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb27-39"><a href="fine-scale-population-stratification.html#cb27-39" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb27-40"><a href="fine-scale-population-stratification.html#cb27-40" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb27-41"><a href="fine-scale-population-stratification.html#cb27-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb27-42"><a href="fine-scale-population-stratification.html#cb27-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-43"><a href="fine-scale-population-stratification.html#cb27-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-44"><a href="fine-scale-population-stratification.html#cb27-44" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="bad-gwas3-2" class="section level3" number="18.6.3">
<h3><span class="header-section-number">18.6.3</span> bad gwas#3</h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="fine-scale-population-stratification.html#cb28-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-2"><a href="fine-scale-population-stratification.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># organize information----------------------------------------------------------</span></span>
<span id="cb28-3"><a href="fine-scale-population-stratification.html#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="fine-scale-population-stratification.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct/bad-gwas-3-out</span>
<span id="cb28-5"><a href="fine-scale-population-stratification.html#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="fine-scale-population-stratification.html#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb28-7"><a href="fine-scale-population-stratification.html#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="fine-scale-population-stratification.html#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>fine-scale-pop-struct/bad-gwas-3/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb28-9"><a href="fine-scale-population-stratification.html#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>inflation/fine-scale-pop-struct/bad-gwas-3/bad-gwas-3.aver2</span>
<span id="cb28-10"><a href="fine-scale-population-stratification.html#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-norm.ldscore</span>
<span id="cb28-11"><a href="fine-scale-population-stratification.html#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>fine-scale-pop-struct/bad-gwas-3-out/<span class="va">$trait</span>.out</span>
<span id="cb28-12"><a href="fine-scale-population-stratification.html#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="fine-scale-population-stratification.html#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp</span>
<span id="cb28-14"><a href="fine-scale-population-stratification.html#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="fine-scale-population-stratification.html#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb28-16"><a href="fine-scale-population-stratification.html#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb28-17"><a href="fine-scale-population-stratification.html#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb28-18"><a href="fine-scale-population-stratification.html#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="fine-scale-population-stratification.html#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb28-20"><a href="fine-scale-population-stratification.html#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb28-21"><a href="fine-scale-population-stratification.html#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb28-22"><a href="fine-scale-population-stratification.html#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="fine-scale-population-stratification.html#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb28-24"><a href="fine-scale-population-stratification.html#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb28-25"><a href="fine-scale-population-stratification.html#cb28-25" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb28-26"><a href="fine-scale-population-stratification.html#cb28-26" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb28-27"><a href="fine-scale-population-stratification.html#cb28-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb28-28"><a href="fine-scale-population-stratification.html#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb28-29"><a href="fine-scale-population-stratification.html#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb28-30"><a href="fine-scale-population-stratification.html#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="fine-scale-population-stratification.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2------------------------------------------------------------</span></span>
<span id="cb29-2"><a href="fine-scale-population-stratification.html#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="fine-scale-population-stratification.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb29-4"><a href="fine-scale-population-stratification.html#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="fine-scale-population-stratification.html#cb29-5" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb29-6"><a href="fine-scale-population-stratification.html#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb29-7"><a href="fine-scale-population-stratification.html#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb29-8"><a href="fine-scale-population-stratification.html#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="fine-scale-population-stratification.html#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-fine-pop-bad-gwas-3.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb29-10"><a href="fine-scale-population-stratification.html#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb29-11"><a href="fine-scale-population-stratification.html#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="fine-scale-population-stratification.html#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb29-13"><a href="fine-scale-population-stratification.html#cb29-13" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb29-14"><a href="fine-scale-population-stratification.html#cb29-14" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;fine-scale-pop-struct/bad-gwas-3-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb29-15"><a href="fine-scale-population-stratification.html#cb29-15" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb29-16"><a href="fine-scale-population-stratification.html#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="fine-scale-population-stratification.html#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb29-18"><a href="fine-scale-population-stratification.html#cb29-18" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb29-19"><a href="fine-scale-population-stratification.html#cb29-19" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb29-20"><a href="fine-scale-population-stratification.html#cb29-20" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb29-21"><a href="fine-scale-population-stratification.html#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="fine-scale-population-stratification.html#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb29-23"><a href="fine-scale-population-stratification.html#cb29-23" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb29-24"><a href="fine-scale-population-stratification.html#cb29-24" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb29-25"><a href="fine-scale-population-stratification.html#cb29-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-26"><a href="fine-scale-population-stratification.html#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb29-27"><a href="fine-scale-population-stratification.html#cb29-27" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb29-28"><a href="fine-scale-population-stratification.html#cb29-28" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb29-29"><a href="fine-scale-population-stratification.html#cb29-29" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb29-30"><a href="fine-scale-population-stratification.html#cb29-30" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb29-31"><a href="fine-scale-population-stratification.html#cb29-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-32"><a href="fine-scale-population-stratification.html#cb29-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb29-33"><a href="fine-scale-population-stratification.html#cb29-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb29-34"><a href="fine-scale-population-stratification.html#cb29-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb29-35"><a href="fine-scale-population-stratification.html#cb29-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb29-36"><a href="fine-scale-population-stratification.html#cb29-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb29-37"><a href="fine-scale-population-stratification.html#cb29-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb29-38"><a href="fine-scale-population-stratification.html#cb29-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb29-39"><a href="fine-scale-population-stratification.html#cb29-39" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb29-40"><a href="fine-scale-population-stratification.html#cb29-40" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb29-41"><a href="fine-scale-population-stratification.html#cb29-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb29-42"><a href="fine-scale-population-stratification.html#cb29-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-43"><a href="fine-scale-population-stratification.html#cb29-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-44"><a href="fine-scale-population-stratification.html#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="good-gwas-5" class="section level3" number="18.6.4">
<h3><span class="header-section-number">18.6.4</span> good gwas</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="fine-scale-population-stratification.html#cb30-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2"><a href="fine-scale-population-stratification.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># organize information----------------------------------------------------------</span></span>
<span id="cb30-3"><a href="fine-scale-population-stratification.html#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="fine-scale-population-stratification.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct/good-gwas-out</span>
<span id="cb30-5"><a href="fine-scale-population-stratification.html#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="fine-scale-population-stratification.html#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb30-7"><a href="fine-scale-population-stratification.html#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="fine-scale-population-stratification.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>fine-scale-pop-struct/good-gwas/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb30-9"><a href="fine-scale-population-stratification.html#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>inflation/fine-scale-pop-struct/good-gwas/good-gwas.aver2</span>
<span id="cb30-10"><a href="fine-scale-population-stratification.html#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-norm.ldscore</span>
<span id="cb30-11"><a href="fine-scale-population-stratification.html#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>fine-scale-pop-struct/good-gwas-out/<span class="va">$trait</span>.out</span>
<span id="cb30-12"><a href="fine-scale-population-stratification.html#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="fine-scale-population-stratification.html#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp</span>
<span id="cb30-14"><a href="fine-scale-population-stratification.html#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="fine-scale-population-stratification.html#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb30-16"><a href="fine-scale-population-stratification.html#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb30-17"><a href="fine-scale-population-stratification.html#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb30-18"><a href="fine-scale-population-stratification.html#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="fine-scale-population-stratification.html#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb30-20"><a href="fine-scale-population-stratification.html#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb30-21"><a href="fine-scale-population-stratification.html#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb30-22"><a href="fine-scale-population-stratification.html#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="fine-scale-population-stratification.html#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb30-24"><a href="fine-scale-population-stratification.html#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb30-25"><a href="fine-scale-population-stratification.html#cb30-25" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb30-26"><a href="fine-scale-population-stratification.html#cb30-26" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb30-27"><a href="fine-scale-population-stratification.html#cb30-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb30-28"><a href="fine-scale-population-stratification.html#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb30-29"><a href="fine-scale-population-stratification.html#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb30-30"><a href="fine-scale-population-stratification.html#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="fine-scale-population-stratification.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2------------------------------------------------------------</span></span>
<span id="cb31-2"><a href="fine-scale-population-stratification.html#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="fine-scale-population-stratification.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb31-4"><a href="fine-scale-population-stratification.html#cb31-4" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb31-5"><a href="fine-scale-population-stratification.html#cb31-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb31-6"><a href="fine-scale-population-stratification.html#cb31-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb31-7"><a href="fine-scale-population-stratification.html#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="fine-scale-population-stratification.html#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-fine-pop-good-gwas.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb31-9"><a href="fine-scale-population-stratification.html#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb31-10"><a href="fine-scale-population-stratification.html#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="fine-scale-population-stratification.html#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb31-12"><a href="fine-scale-population-stratification.html#cb31-12" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb31-13"><a href="fine-scale-population-stratification.html#cb31-13" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;fine-scale-pop-struct/good-gwas-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb31-14"><a href="fine-scale-population-stratification.html#cb31-14" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb31-15"><a href="fine-scale-population-stratification.html#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="fine-scale-population-stratification.html#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb31-17"><a href="fine-scale-population-stratification.html#cb31-17" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb31-18"><a href="fine-scale-population-stratification.html#cb31-18" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb31-19"><a href="fine-scale-population-stratification.html#cb31-19" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb31-20"><a href="fine-scale-population-stratification.html#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="fine-scale-population-stratification.html#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb31-22"><a href="fine-scale-population-stratification.html#cb31-22" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb31-23"><a href="fine-scale-population-stratification.html#cb31-23" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb31-24"><a href="fine-scale-population-stratification.html#cb31-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-25"><a href="fine-scale-population-stratification.html#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb31-26"><a href="fine-scale-population-stratification.html#cb31-26" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb31-27"><a href="fine-scale-population-stratification.html#cb31-27" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb31-28"><a href="fine-scale-population-stratification.html#cb31-28" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb31-29"><a href="fine-scale-population-stratification.html#cb31-29" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb31-30"><a href="fine-scale-population-stratification.html#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="fine-scale-population-stratification.html#cb31-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb31-32"><a href="fine-scale-population-stratification.html#cb31-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb31-33"><a href="fine-scale-population-stratification.html#cb31-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb31-34"><a href="fine-scale-population-stratification.html#cb31-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb31-35"><a href="fine-scale-population-stratification.html#cb31-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb31-36"><a href="fine-scale-population-stratification.html#cb31-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb31-37"><a href="fine-scale-population-stratification.html#cb31-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb31-38"><a href="fine-scale-population-stratification.html#cb31-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb31-39"><a href="fine-scale-population-stratification.html#cb31-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb31-40"><a href="fine-scale-population-stratification.html#cb31-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb31-41"><a href="fine-scale-population-stratification.html#cb31-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-42"><a href="fine-scale-population-stratification.html#cb31-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-43"><a href="fine-scale-population-stratification.html#cb31-43" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="control-gwas-3" class="section level3" number="18.6.5">
<h3><span class="header-section-number">18.6.5</span> control gwas</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="fine-scale-population-stratification.html#cb32-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-2"><a href="fine-scale-population-stratification.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># organize information----------------------------------------------------------</span></span>
<span id="cb32-3"><a href="fine-scale-population-stratification.html#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="fine-scale-population-stratification.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct/control-gwas-out</span>
<span id="cb32-5"><a href="fine-scale-population-stratification.html#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="fine-scale-population-stratification.html#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb32-7"><a href="fine-scale-population-stratification.html#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="fine-scale-population-stratification.html#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>fine-scale-pop-struct/control-gwas/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb32-9"><a href="fine-scale-population-stratification.html#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>inflation/fine-scale-pop-struct/control-gwas/control-gwas.aver2</span>
<span id="cb32-10"><a href="fine-scale-population-stratification.html#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-norm.ldscore</span>
<span id="cb32-11"><a href="fine-scale-population-stratification.html#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>fine-scale-pop-struct/control-gwas-out/<span class="va">$trait</span>.out</span>
<span id="cb32-12"><a href="fine-scale-population-stratification.html#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="fine-scale-population-stratification.html#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5}&#39;</span> <span class="va">$gwas</span> <span class="op">&gt;</span> tmp/gwas.tmp</span>
<span id="cb32-14"><a href="fine-scale-population-stratification.html#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="fine-scale-population-stratification.html#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb32-16"><a href="fine-scale-population-stratification.html#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb32-17"><a href="fine-scale-population-stratification.html#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$ldsc</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/ldsc.tmp</span>
<span id="cb32-18"><a href="fine-scale-population-stratification.html#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="fine-scale-population-stratification.html#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb32-20"><a href="fine-scale-population-stratification.html#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1]; </span></span>
<span id="cb32-21"><a href="fine-scale-population-stratification.html#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="st">     else print &quot;NA&quot; }&#39;</span> <span class="va">$aver2</span> tmp/gwas.tmp <span class="op">&gt;</span> tmp/aver2.tmp</span>
<span id="cb32-22"><a href="fine-scale-population-stratification.html#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="fine-scale-population-stratification.html#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co"># put info together</span></span>
<span id="cb32-24"><a href="fine-scale-population-stratification.html#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> tmp/gwas.tmp <span class="dt">\</span></span>
<span id="cb32-25"><a href="fine-scale-population-stratification.html#cb32-25" aria-hidden="true" tabindex="-1"></a>      tmp/aver2.tmp <span class="dt">\</span></span>
<span id="cb32-26"><a href="fine-scale-population-stratification.html#cb32-26" aria-hidden="true" tabindex="-1"></a>      tmp/ldsc.tmp <span class="dt">\</span></span>
<span id="cb32-27"><a href="fine-scale-population-stratification.html#cb32-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb32-28"><a href="fine-scale-population-stratification.html#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;snp;chisq;aver2;ldsc&quot;}</span></span>
<span id="cb32-29"><a href="fine-scale-population-stratification.html#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb32-30"><a href="fine-scale-population-stratification.html#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="fine-scale-population-stratification.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2------------------------------------------------------------</span></span>
<span id="cb33-2"><a href="fine-scale-population-stratification.html#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="fine-scale-population-stratification.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb33-4"><a href="fine-scale-population-stratification.html#cb33-4" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb33-5"><a href="fine-scale-population-stratification.html#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb33-6"><a href="fine-scale-population-stratification.html#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb33-7"><a href="fine-scale-population-stratification.html#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="fine-scale-population-stratification.html#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-fine-pop-control-gwas.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb33-9"><a href="fine-scale-population-stratification.html#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb33-10"><a href="fine-scale-population-stratification.html#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="fine-scale-population-stratification.html#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb33-12"><a href="fine-scale-population-stratification.html#cb33-12" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb33-13"><a href="fine-scale-population-stratification.html#cb33-13" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;fine-scale-pop-struct/control-gwas-out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb33-14"><a href="fine-scale-population-stratification.html#cb33-14" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb33-15"><a href="fine-scale-population-stratification.html#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="fine-scale-population-stratification.html#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb33-17"><a href="fine-scale-population-stratification.html#cb33-17" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb33-18"><a href="fine-scale-population-stratification.html#cb33-18" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb33-19"><a href="fine-scale-population-stratification.html#cb33-19" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb33-20"><a href="fine-scale-population-stratification.html#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="fine-scale-population-stratification.html#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb33-22"><a href="fine-scale-population-stratification.html#cb33-22" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb33-23"><a href="fine-scale-population-stratification.html#cb33-23" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb33-24"><a href="fine-scale-population-stratification.html#cb33-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-25"><a href="fine-scale-population-stratification.html#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb33-26"><a href="fine-scale-population-stratification.html#cb33-26" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb33-27"><a href="fine-scale-population-stratification.html#cb33-27" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb33-28"><a href="fine-scale-population-stratification.html#cb33-28" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb33-29"><a href="fine-scale-population-stratification.html#cb33-29" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb33-30"><a href="fine-scale-population-stratification.html#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="fine-scale-population-stratification.html#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb33-32"><a href="fine-scale-population-stratification.html#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb33-33"><a href="fine-scale-population-stratification.html#cb33-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb33-34"><a href="fine-scale-population-stratification.html#cb33-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb33-35"><a href="fine-scale-population-stratification.html#cb33-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb33-36"><a href="fine-scale-population-stratification.html#cb33-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb33-37"><a href="fine-scale-population-stratification.html#cb33-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb33-38"><a href="fine-scale-population-stratification.html#cb33-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb33-39"><a href="fine-scale-population-stratification.html#cb33-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb33-40"><a href="fine-scale-population-stratification.html#cb33-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb33-41"><a href="fine-scale-population-stratification.html#cb33-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-42"><a href="fine-scale-population-stratification.html#cb33-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-43"><a href="fine-scale-population-stratification.html#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
</div>
<div id="inflation-aver2-2" class="section level2" number="18.7">
<h2><span class="header-section-number">18.7</span> inflation ~ aver2</h2>
<p>In the above, we showed that bad GWAS that mixes individuals of bottom 50k and top 50k based on PC1 is confounded. Here we want to show that the inflation varies with respect to aver2.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="fine-scale-population-stratification.html#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="fine-scale-population-stratification.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># organize data</span></span>
<span id="cb34-3"><a href="fine-scale-population-stratification.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fine-scale-pop-struct/inflation-good-dad-gwas-3</span>
<span id="cb34-4"><a href="fine-scale-population-stratification.html#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="fine-scale-population-stratification.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb34-6"><a href="fine-scale-population-stratification.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="va">good</span><span class="op">=</span>fine-scale-pop-struct/good-gwas-out/<span class="va">$trait</span>.out</span>
<span id="cb34-7"><a href="fine-scale-population-stratification.html#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="va">bad</span><span class="op">=</span>fine-scale-pop-struct/bad-gwas-3-out/<span class="va">$trait</span>.out</span>
<span id="cb34-8"><a href="fine-scale-population-stratification.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>fine-scale-pop-struct/inflation-good-dad-gwas-3/<span class="va">$trait</span>.out</span>
<span id="cb34-9"><a href="fine-scale-population-stratification.html#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="fine-scale-population-stratification.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-F</span><span class="st">&#39;;&#39;</span> <span class="st">&#39;BEGIN{print&quot;snp inflation aver2 ldsc&quot;}</span></span>
<span id="cb34-11"><a href="fine-scale-population-stratification.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="st">     (NR==FNR &amp;&amp; NR&gt;1) {a[$1]; b[$1]=$2; next}</span></span>
<span id="cb34-12"><a href="fine-scale-population-stratification.html#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="st">     (NR&gt;1){if ($1 in a) print $1, $2-b[$1], $3, $4}&#39;</span> <span class="va">$good</span> <span class="va">$bad</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb34-13"><a href="fine-scale-population-stratification.html#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="fine-scale-population-stratification.html#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="fine-scale-population-stratification.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot inflation ~ aver2------------------------------------------------------------</span></span>
<span id="cb35-2"><a href="fine-scale-population-stratification.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="fine-scale-population-stratification.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb35-4"><a href="fine-scale-population-stratification.html#cb35-4" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb35-5"><a href="fine-scale-population-stratification.html#cb35-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb35-6"><a href="fine-scale-population-stratification.html#cb35-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb35-7"><a href="fine-scale-population-stratification.html#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="fine-scale-population-stratification.html#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/inflation-aver2-bin-fine-pop-good-bad-gwas-3.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb35-9"><a href="fine-scale-population-stratification.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb35-10"><a href="fine-scale-population-stratification.html#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="fine-scale-population-stratification.html#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb35-12"><a href="fine-scale-population-stratification.html#cb35-12" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb35-13"><a href="fine-scale-population-stratification.html#cb35-13" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;fine-scale-pop-struct/inflation-good-dad-gwas-3/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb35-14"><a href="fine-scale-population-stratification.html#cb35-14" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb35-15"><a href="fine-scale-population-stratification.html#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="fine-scale-population-stratification.html#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb35-17"><a href="fine-scale-population-stratification.html#cb35-17" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(inflation <span class="sc">~</span> aver2 ,<span class="at">data=</span>dat)</span>
<span id="cb35-18"><a href="fine-scale-population-stratification.html#cb35-18" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb35-19"><a href="fine-scale-population-stratification.html#cb35-19" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb35-20"><a href="fine-scale-population-stratification.html#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="fine-scale-population-stratification.html#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb35-22"><a href="fine-scale-population-stratification.html#cb35-22" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb35-23"><a href="fine-scale-population-stratification.html#cb35-23" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb35-24"><a href="fine-scale-population-stratification.html#cb35-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-25"><a href="fine-scale-population-stratification.html#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb35-26"><a href="fine-scale-population-stratification.html#cb35-26" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb35-27"><a href="fine-scale-population-stratification.html#cb35-27" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb35-28"><a href="fine-scale-population-stratification.html#cb35-28" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb35-29"><a href="fine-scale-population-stratification.html#cb35-29" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>inflation_ave)</span>
<span id="cb35-30"><a href="fine-scale-population-stratification.html#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="fine-scale-population-stratification.html#cb35-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb35-32"><a href="fine-scale-population-stratification.html#cb35-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>inflation_ave,</span>
<span id="cb35-33"><a href="fine-scale-population-stratification.html#cb35-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean inflation&quot;</span>,</span>
<span id="cb35-34"><a href="fine-scale-population-stratification.html#cb35-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb35-35"><a href="fine-scale-population-stratification.html#cb35-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb35-36"><a href="fine-scale-population-stratification.html#cb35-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(inflation <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb35-37"><a href="fine-scale-population-stratification.html#cb35-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb35-38"><a href="fine-scale-population-stratification.html#cb35-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb35-39"><a href="fine-scale-population-stratification.html#cb35-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb35-40"><a href="fine-scale-population-stratification.html#cb35-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb35-41"><a href="fine-scale-population-stratification.html#cb35-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-42"><a href="fine-scale-population-stratification.html#cb35-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-43"><a href="fine-scale-population-stratification.html#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reference-panel-1k-genome.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="genotyping-errors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/09.0-fine-scale-pop-structure.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
