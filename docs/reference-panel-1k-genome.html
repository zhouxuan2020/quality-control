<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>17 Reference Panel: 1k Genome | GWAS Quality Control</title>
  <meta name="description" content="17 Reference Panel: 1k Genome | GWAS Quality Control" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="17 Reference Panel: 1k Genome | GWAS Quality Control" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="17 Reference Panel: 1k Genome | GWAS Quality Control" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="assortative-mating.html"/>
<link rel="next" href="fine-scale-population-stratification.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Quality Control Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> General Info</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#topic"><i class="fa fa-check"></i><b>1.1</b> Topic</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#frequently-used-commands"><i class="fa fa-check"></i><b>1.2</b> Frequently used commands</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>2</b> summary</a></li>
<li class="chapter" data-level="3" data-path="summaries.html"><a href="summaries.html"><i class="fa fa-check"></i><b>3</b> Summaries</a>
<ul>
<li class="chapter" data-level="3.1" data-path="summaries.html"><a href="summaries.html#good-gwas"><i class="fa fa-check"></i><b>3.1</b> Good GWAS</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher"><i class="fa fa-check"></i><b>3.1.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.1.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression"><i class="fa fa-check"></i><b>3.1.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="summaries.html"><a href="summaries.html#bad-gwas"><i class="fa fa-check"></i><b>3.2</b> Bad GWAS</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-1"><i class="fa fa-check"></i><b>3.2.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.2.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-1"><i class="fa fa-check"></i><b>3.2.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="summaries.html"><a href="summaries.html#ukbb-recommended"><i class="fa fa-check"></i><b>3.3</b> UKBB recommended</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-2"><i class="fa fa-check"></i><b>3.3.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.3.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-2"><i class="fa fa-check"></i><b>3.3.2</b> Haseman Elston Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="summaries.html"><a href="summaries.html#control-gwas"><i class="fa fa-check"></i><b>3.4</b> Control GWAS</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="summaries.html"><a href="summaries.html#ldsc-sumher-3"><i class="fa fa-check"></i><b>3.4.1</b> ldsc &amp; sumher</a></li>
<li class="chapter" data-level="3.4.2" data-path="summaries.html"><a href="summaries.html#haseman-elston-regression-3"><i class="fa fa-check"></i><b>3.4.2</b> Haseman Elston Regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="summary-1.html"><a href="summary-1.html"><i class="fa fa-check"></i><b>4</b> summary</a></li>
<li class="chapter" data-level="5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html"><i class="fa fa-check"></i><b>5</b> Good VS Bad GWAS</a>
<ul>
<li class="chapter" data-level="5.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#test-statistics-ld-score"><i class="fa fa-check"></i><b>5.1</b> test statistics ~ LD score</a></li>
<li class="chapter" data-level="5.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#new-models"><i class="fa fa-check"></i><b>5.2</b> New models?</a></li>
<li class="chapter" data-level="5.3" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#ld-scores-based-on-individual-level-data"><i class="fa fa-check"></i><b>5.3</b> LD scores based on individual level data</a></li>
<li class="chapter" data-level="5.4" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#test-the-new-model"><i class="fa fa-check"></i><b>5.4</b> Test the new model</a></li>
<li class="chapter" data-level="5.5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#predictors-of-inflation"><i class="fa fa-check"></i><b>5.5</b> predictors of inflation?</a></li>
<li class="chapter" data-level="5.6" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#regress-chisq-mean-r2_j"><i class="fa fa-check"></i><b>5.6</b> regress chisq ~ mean r^2_j</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#plots"><i class="fa fa-check"></i><b>5.6.1</b> plots</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#predict-inflation-aver2_j"><i class="fa fa-check"></i><b>5.7</b> predict inflation | aver2_j ?</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good_chisq-vs.-adj_chisq"><i class="fa fa-check"></i><b>5.7.1</b> good_chisq vs. adj_chisq</a></li>
<li class="chapter" data-level="5.7.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-vs.-inf._hat-raw"><i class="fa fa-check"></i><b>5.7.2</b> bad gwas: inf. vs. inf._hat: raw</a></li>
<li class="chapter" data-level="5.7.3" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-vs.-inf._hat-ave"><i class="fa fa-check"></i><b>5.7.3</b> bad gwas: inf. vs. inf._hat: ave</a></li>
<li class="chapter" data-level="5.7.4" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#bad-gwas-inf.-from-full-model"><i class="fa fa-check"></i><b>5.7.4</b> bad gwas: inf. from full model</a></li>
<li class="chapter" data-level="5.7.5" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#to-explore-change"><i class="fa fa-check"></i><b>5.7.5</b> To Explore: change??</a></li>
<li class="chapter" data-level="5.7.6" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good-gwas-inf.-vs.-inf._hat-raw"><i class="fa fa-check"></i><b>5.7.6</b> good gwas: inf. vs. inf._hat: raw</a></li>
<li class="chapter" data-level="5.7.7" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#good-gwas-inf.-vs.-inf._hat-ave"><i class="fa fa-check"></i><b>5.7.7</b> good gwas: inf. vs. inf._hat: ave</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#ukbb_337k_inflation"><i class="fa fa-check"></i><b>5.8</b> UKBB N = 337k</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#organize-data"><i class="fa fa-check"></i><b>5.8.1</b> organize data</a></li>
<li class="chapter" data-level="5.8.2" data-path="good-vs-bad-gwas.html"><a href="good-vs-bad-gwas.html#plot"><i class="fa fa-check"></i><b>5.8.2</b> plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mathematical-details.html"><a href="mathematical-details.html"><i class="fa fa-check"></i><b>6</b> Mathematical Details</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mathematical-details.html"><a href="mathematical-details.html#trk_rightk_left"><i class="fa fa-check"></i><b>6.1</b> <span class="math inline">\(tr(K_{right}K_{left})\)</span></a></li>
<li class="chapter" data-level="6.2" data-path="mathematical-details.html"><a href="mathematical-details.html#verification"><i class="fa fa-check"></i><b>6.2</b> verification</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html"><i class="fa fa-check"></i><b>7</b> chi square ~ <span class="math inline">\(\overline{r^2_j}\)</span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#overliner2_j-choice-of-snps"><i class="fa fa-check"></i><b>7.1</b> <span class="math inline">\(\overline{r^2_j}\)</span> &amp; choice of SNPs</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#number-of-snps"><i class="fa fa-check"></i><b>7.1.1</b> number of SNPs</a></li>
<li class="chapter" data-level="7.1.2" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#maf"><i class="fa fa-check"></i><b>7.1.2</b> maf</a></li>
<li class="chapter" data-level="7.1.3" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#summary-2"><i class="fa fa-check"></i><b>7.1.3</b> summary</a></li>
<li class="chapter" data-level="7.1.4" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#final-plots"><i class="fa fa-check"></i><b>7.1.4</b> Final plots</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#varying-levels-of-confouding"><i class="fa fa-check"></i><b>7.2</b> varying levels of confouding</a></li>
<li class="chapter" data-level="7.3" data-path="chi-square-overliner2_j.html"><a href="chi-square-overliner2_j.html#results-summary"><i class="fa fa-check"></i><b>7.3</b> results summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="good.html"><a href="good.html"><i class="fa fa-check"></i><b>8</b> Good GWAS</a>
<ul>
<li class="chapter" data-level="8.1" data-path="good.html"><a href="good.html#goodid"><i class="fa fa-check"></i><b>8.1</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="8.2" data-path="good.html"><a href="good.html#extract-covariates"><i class="fa fa-check"></i><b>8.2</b> extract covariates</a></li>
<li class="chapter" data-level="8.3" data-path="good.html"><a href="good.html#gwas"><i class="fa fa-check"></i><b>8.3</b> GWAS</a></li>
<li class="chapter" data-level="8.4" data-path="good.html"><a href="good.html#chisq-aver2_j"><i class="fa fa-check"></i><b>8.4</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="8.5" data-path="good.html"><a href="good.html#ldsc-interce"><i class="fa fa-check"></i><b>8.5</b> ldsc interce</a></li>
<li class="chapter" data-level="8.6" data-path="good.html"><a href="good.html#ldsc-intercept"><i class="fa fa-check"></i><b>8.6</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="good.html"><a href="good.html#under-gcta"><i class="fa fa-check"></i><b>8.6.1</b> under gcta</a></li>
<li class="chapter" data-level="8.6.2" data-path="good.html"><a href="good.html#under-ldak-thin"><i class="fa fa-check"></i><b>8.6.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="8.6.3" data-path="good.html"><a href="good.html#summary-3"><i class="fa fa-check"></i><b>8.6.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="good.html"><a href="good.html#reml"><i class="fa fa-check"></i><b>8.7</b> REML</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="good.html"><a href="good.html#making-grms"><i class="fa fa-check"></i><b>8.7.1</b> making grms</a></li>
<li class="chapter" data-level="8.7.2" data-path="good.html"><a href="good.html#fast-reml"><i class="fa fa-check"></i><b>8.7.2</b> fast-reml</a></li>
<li class="chapter" data-level="8.7.3" data-path="good.html"><a href="good.html#inflation-test"><i class="fa fa-check"></i><b>8.7.3</b> inflation test</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="good.html"><a href="good.html#he"><i class="fa fa-check"></i><b>8.8</b> HE</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="good.html"><a href="good.html#estimation"><i class="fa fa-check"></i><b>8.8.1</b> estimation</a></li>
<li class="chapter" data-level="8.8.2" data-path="good.html"><a href="good.html#summary-4"><i class="fa fa-check"></i><b>8.8.2</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bad.html"><a href="bad.html"><i class="fa fa-check"></i><b>9</b> Bad GWAS</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bad.html"><a href="bad.html#badid"><i class="fa fa-check"></i><b>9.1</b> ID list</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="bad.html"><a href="bad.html#initial-selection"><i class="fa fa-check"></i><b>9.1.1</b> initial selection</a></li>
<li class="chapter" data-level="9.1.2" data-path="bad.html"><a href="bad.html#relatedness-filtering"><i class="fa fa-check"></i><b>9.1.2</b> relatedness filtering</a></li>
<li class="chapter" data-level="9.1.3" data-path="bad.html"><a href="bad.html#final-list"><i class="fa fa-check"></i><b>9.1.3</b> final list</a></li>
<li class="chapter" data-level="9.1.4" data-path="bad.html"><a href="bad.html#pc-plot"><i class="fa fa-check"></i><b>9.1.4</b> PC plot</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="bad.html"><a href="bad.html#gwas-lm"><i class="fa fa-check"></i><b>9.2</b> GWAS-lm</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="bad.html"><a href="bad.html#basic-cov"><i class="fa fa-check"></i><b>9.2.1</b> basic cov</a></li>
<li class="chapter" data-level="9.2.2" data-path="bad.html"><a href="bad.html#basic-cov-pc"><i class="fa fa-check"></i><b>9.2.2</b> basic cov + PC</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="bad.html"><a href="bad.html#gwas-bolt-lmm"><i class="fa fa-check"></i><b>9.3</b> GWAS-bolt-lmm</a></li>
<li class="chapter" data-level="9.4" data-path="bad.html"><a href="bad.html#correct-genotypes"><i class="fa fa-check"></i><b>9.4</b> correct genotypes</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="bad.html"><a href="bad.html#cal-aver2"><i class="fa fa-check"></i><b>9.4.1</b> cal-aver2</a></li>
<li class="chapter" data-level="9.4.2" data-path="bad.html"><a href="bad.html#compare-changes-in-aver2"><i class="fa fa-check"></i><b>9.4.2</b> compare changes in aver2</a></li>
<li class="chapter" data-level="9.4.3" data-path="bad.html"><a href="bad.html#chisq-aver2"><i class="fa fa-check"></i><b>9.4.3</b> chisq ~ aver2</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="bad.html"><a href="bad.html#chisq-aver2_j-1"><i class="fa fa-check"></i><b>9.5</b> chisq ~ aver2_j</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="bad.html"><a href="bad.html#calc-aver2_j"><i class="fa fa-check"></i><b>9.5.1</b> calc aver2_j</a></li>
<li class="chapter" data-level="9.5.2" data-path="bad.html"><a href="bad.html#bolt-lmm"><i class="fa fa-check"></i><b>9.5.2</b> bolt-lmm</a></li>
<li class="chapter" data-level="9.5.3" data-path="bad.html"><a href="bad.html#basic-cov-pc-1"><i class="fa fa-check"></i><b>9.5.3</b> basic cov + PC</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="bad.html"><a href="bad.html#ldsc-intercept-1"><i class="fa fa-check"></i><b>9.6</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="bad.html"><a href="bad.html#under-gcta-1"><i class="fa fa-check"></i><b>9.6.1</b> under gcta</a></li>
<li class="chapter" data-level="9.6.2" data-path="bad.html"><a href="bad.html#under-ldak-thin-1"><i class="fa fa-check"></i><b>9.6.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="9.6.3" data-path="bad.html"><a href="bad.html#summary-5"><i class="fa fa-check"></i><b>9.6.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="bad.html"><a href="bad.html#reml-1"><i class="fa fa-check"></i><b>9.7</b> REML</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="bad.html"><a href="bad.html#making-grms-1"><i class="fa fa-check"></i><b>9.7.1</b> making grms</a></li>
<li class="chapter" data-level="9.7.2" data-path="bad.html"><a href="bad.html#fast-reml-1"><i class="fa fa-check"></i><b>9.7.2</b> fast-reml</a></li>
<li class="chapter" data-level="9.7.3" data-path="bad.html"><a href="bad.html#inflation-test-1"><i class="fa fa-check"></i><b>9.7.3</b> inflation test</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="bad.html"><a href="bad.html#he-1"><i class="fa fa-check"></i><b>9.8</b> HE</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="bad.html"><a href="bad.html#estimation-1"><i class="fa fa-check"></i><b>9.8.1</b> estimation</a></li>
<li class="chapter" data-level="9.8.2" data-path="bad.html"><a href="bad.html#summary-6"><i class="fa fa-check"></i><b>9.8.2</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ukbb.html"><a href="ukbb.html"><i class="fa fa-check"></i><b>10</b> UKBB recommended</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ukbb.html"><a href="ukbb.html#total-n-337k"><i class="fa fa-check"></i><b>10.1</b> total N = 337k</a></li>
<li class="chapter" data-level="10.2" data-path="ukbb.html"><a href="ukbb.html#qc-of-hp3-snps"><i class="fa fa-check"></i><b>10.2</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="10.3" data-path="ukbb.html"><a href="ukbb.html#gwas-100k"><i class="fa fa-check"></i><b>10.3</b> GWAS-100k</a></li>
<li class="chapter" data-level="10.4" data-path="ukbb.html"><a href="ukbb.html#gwas-337k"><i class="fa fa-check"></i><b>10.4</b> GWAS-337k</a></li>
<li class="chapter" data-level="10.5" data-path="ukbb.html"><a href="ukbb.html#ldsc-100k"><i class="fa fa-check"></i><b>10.5</b> ldsc-100k</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="ukbb.html"><a href="ukbb.html#under-gcta-2"><i class="fa fa-check"></i><b>10.5.1</b> under gcta</a></li>
<li class="chapter" data-level="10.5.2" data-path="ukbb.html"><a href="ukbb.html#under-ldak-thin-2"><i class="fa fa-check"></i><b>10.5.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="10.5.3" data-path="ukbb.html"><a href="ukbb.html#summary-7"><i class="fa fa-check"></i><b>10.5.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="ukbb.html"><a href="ukbb.html#ldsc-337k"><i class="fa fa-check"></i><b>10.6</b> ldsc-337k</a></li>
<li class="chapter" data-level="10.7" data-path="ukbb.html"><a href="ukbb.html#aver2_j-337k"><i class="fa fa-check"></i><b>10.7</b> aver2_j-337k</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="ukbb.html"><a href="ukbb.html#calc"><i class="fa fa-check"></i><b>10.7.1</b> calc</a></li>
<li class="chapter" data-level="10.7.2" data-path="ukbb.html"><a href="ukbb.html#organize-data-1"><i class="fa fa-check"></i><b>10.7.2</b> organize data</a></li>
<li class="chapter" data-level="10.7.3" data-path="ukbb.html"><a href="ukbb.html#chisq-aver2_j-2"><i class="fa fa-check"></i><b>10.7.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="ukbb.html"><a href="ukbb.html#he-2"><i class="fa fa-check"></i><b>10.8</b> HE</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="ukbb.html"><a href="ukbb.html#making-grms-2"><i class="fa fa-check"></i><b>10.8.1</b> making grms</a></li>
<li class="chapter" data-level="10.8.2" data-path="ukbb.html"><a href="ukbb.html#estimation-2"><i class="fa fa-check"></i><b>10.8.2</b> estimation</a></li>
<li class="chapter" data-level="10.8.3" data-path="ukbb.html"><a href="ukbb.html#summary-8"><i class="fa fa-check"></i><b>10.8.3</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="control.html"><a href="control.html"><i class="fa fa-check"></i><b>11</b> control GWAS</a>
<ul>
<li class="chapter" data-level="11.1" data-path="control.html"><a href="control.html#id-list"><i class="fa fa-check"></i><b>11.1</b> ID list</a></li>
<li class="chapter" data-level="11.2" data-path="control.html"><a href="control.html#qc-of-hp3-snps-1"><i class="fa fa-check"></i><b>11.2</b> QC of hp3 SNPs</a></li>
<li class="chapter" data-level="11.3" data-path="control.html"><a href="control.html#gwas-1"><i class="fa fa-check"></i><b>11.3</b> GWAS</a></li>
<li class="chapter" data-level="11.4" data-path="control.html"><a href="control.html#ldsc-intercept-2"><i class="fa fa-check"></i><b>11.4</b> ldsc intercept</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="control.html"><a href="control.html#under-gcta-3"><i class="fa fa-check"></i><b>11.4.1</b> under gcta</a></li>
<li class="chapter" data-level="11.4.2" data-path="control.html"><a href="control.html#under-ldak-thin-3"><i class="fa fa-check"></i><b>11.4.2</b> under ldak-thin</a></li>
<li class="chapter" data-level="11.4.3" data-path="control.html"><a href="control.html#summary-9"><i class="fa fa-check"></i><b>11.4.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="control.html"><a href="control.html#he-3"><i class="fa fa-check"></i><b>11.5</b> HE</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="control.html"><a href="control.html#making-grms-3"><i class="fa fa-check"></i><b>11.5.1</b> making grms</a></li>
<li class="chapter" data-level="11.5.2" data-path="control.html"><a href="control.html#estimation-3"><i class="fa fa-check"></i><b>11.5.2</b> estimation</a></li>
<li class="chapter" data-level="11.5.3" data-path="control.html"><a href="control.html#summary-10"><i class="fa fa-check"></i><b>11.5.3</b> summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="previous-gwas.html"><a href="previous-gwas.html"><i class="fa fa-check"></i><b>12</b> previous GWAS</a>
<ul>
<li class="chapter" data-level="12.1" data-path="previous-gwas.html"><a href="previous-gwas.html#qc"><i class="fa fa-check"></i><b>12.1</b> QC</a></li>
<li class="chapter" data-level="12.2" data-path="previous-gwas.html"><a href="previous-gwas.html#gwas-telomere-length"><i class="fa fa-check"></i><b>12.2</b> gwas-telomere length</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="previous-gwas.html"><a href="previous-gwas.html#aver2_j"><i class="fa fa-check"></i><b>12.2.1</b> aver2_j</a></li>
<li class="chapter" data-level="12.2.2" data-path="previous-gwas.html"><a href="previous-gwas.html#organize-data-2"><i class="fa fa-check"></i><b>12.2.2</b> organize data</a></li>
<li class="chapter" data-level="12.2.3" data-path="previous-gwas.html"><a href="previous-gwas.html#chisq-aver2_j-3"><i class="fa fa-check"></i><b>12.2.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="previous-gwas.html"><a href="previous-gwas.html#pr-interval-gwas"><i class="fa fa-check"></i><b>12.3</b> PR interval GWAS</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="previous-gwas.html"><a href="previous-gwas.html#aver2_j-1"><i class="fa fa-check"></i><b>12.3.1</b> aver2_j</a></li>
<li class="chapter" data-level="12.3.2" data-path="previous-gwas.html"><a href="previous-gwas.html#organize-data-3"><i class="fa fa-check"></i><b>12.3.2</b> organize data</a></li>
<li class="chapter" data-level="12.3.3" data-path="previous-gwas.html"><a href="previous-gwas.html#chisq-aver2_j-4"><i class="fa fa-check"></i><b>12.3.3</b> chisq ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="previous-gwas.html"><a href="previous-gwas.html#ben-neale-pan-ukbb"><i class="fa fa-check"></i><b>12.4</b> Ben Neale Pan-UKBB</a></li>
<li class="chapter" data-level="12.5" data-path="previous-gwas.html"><a href="previous-gwas.html#notesconcerns"><i class="fa fa-check"></i><b>12.5</b> notes/concerns</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html"><i class="fa fa-check"></i><b>13</b> GWAS: White British + Irish</a>
<ul>
<li class="chapter" data-level="13.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#id-list-1"><i class="fa fa-check"></i><b>13.1</b> ID list</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#ids-who-have-no-missing-data"><i class="fa fa-check"></i><b>13.1.1</b> Ids who have no missing data</a></li>
<li class="chapter" data-level="13.1.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#relatedness-filtering-1"><i class="fa fa-check"></i><b>13.1.2</b> relatedness filtering</a></li>
<li class="chapter" data-level="13.1.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#pc-plot-1"><i class="fa fa-check"></i><b>13.1.3</b> PC plot</a></li>
<li class="chapter" data-level="13.1.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#phenotypic-differences"><i class="fa fa-check"></i><b>13.1.4</b> phenotypic differences</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#gwas-lm-1"><i class="fa fa-check"></i><b>13.2</b> GWAS-lm</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#basic-covariates"><i class="fa fa-check"></i><b>13.2.1</b> basic covariates</a></li>
<li class="chapter" data-level="13.2.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#basic-covariates-pcs"><i class="fa fa-check"></i><b>13.2.2</b> basic covariates + PCs</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#chisq-aver2_j-5"><i class="fa fa-check"></i><b>13.3</b> chisq ~ aver2_j</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#calc-aver2_j-1"><i class="fa fa-check"></i><b>13.3.1</b> calc aver2_j</a></li>
<li class="chapter" data-level="13.3.2" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#organize-data-4"><i class="fa fa-check"></i><b>13.3.2</b> organize data</a></li>
<li class="chapter" data-level="13.3.3" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#detect-confounding-wt-pcs"><i class="fa fa-check"></i><b>13.3.3</b> detect confounding: w/t PCs</a></li>
<li class="chapter" data-level="13.3.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#detect-confounding-with-pcs"><i class="fa fa-check"></i><b>13.3.4</b> detect confounding: with PCs</a></li>
<li class="chapter" data-level="13.3.5" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#inflation-good-gwas-vs.-control-vs.-british-irish"><i class="fa fa-check"></i><b>13.3.5</b> inflation: good gwas vs. control vs. british-irish</a></li>
<li class="chapter" data-level="13.3.6" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#inflation-aver2"><i class="fa fa-check"></i><b>13.3.6</b> inflation | aver2</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="gwas-white-british-irish.html"><a href="gwas-white-british-irish.html#ideas-to-explore-to-do-list"><i class="fa fa-check"></i><b>13.4</b> Ideas to explore/ to do list:</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="related-individuals.html"><a href="related-individuals.html"><i class="fa fa-check"></i><b>14</b> related individuals</a>
<ul>
<li class="chapter" data-level="14.1" data-path="related-individuals.html"><a href="related-individuals.html#genotyped-snps"><i class="fa fa-check"></i><b>14.1</b> genotyped SNPs</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-2"><i class="fa fa-check"></i><b>14.1.1</b> aver2_j</a></li>
<li class="chapter" data-level="14.1.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-2"><i class="fa fa-check"></i><b>14.1.2</b> gwas</a></li>
<li class="chapter" data-level="14.1.3" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-5"><i class="fa fa-check"></i><b>14.1.3</b> organize data</a></li>
<li class="chapter" data-level="14.1.4" data-path="related-individuals.html"><a href="related-individuals.html#summary-11"><i class="fa fa-check"></i><b>14.1.4</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="related-individuals.html"><a href="related-individuals.html#hapmap3-snps"><i class="fa fa-check"></i><b>14.2</b> hapmap3 SNPs</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="related-individuals.html"><a href="related-individuals.html#genotype-data"><i class="fa fa-check"></i><b>14.2.1</b> genotype data</a></li>
<li class="chapter" data-level="14.2.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-3"><i class="fa fa-check"></i><b>14.2.2</b> gwas</a></li>
<li class="chapter" data-level="14.2.3" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-3"><i class="fa fa-check"></i><b>14.2.3</b> aver2_j</a></li>
<li class="chapter" data-level="14.2.4" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-6"><i class="fa fa-check"></i><b>14.2.4</b> organize data</a></li>
<li class="chapter" data-level="14.2.5" data-path="related-individuals.html"><a href="related-individuals.html#chisq-aver2_j-6"><i class="fa fa-check"></i><b>14.2.5</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="14.2.6" data-path="related-individuals.html"><a href="related-individuals.html#inflation-aver2_j"><i class="fa fa-check"></i><b>14.2.6</b> inflation ~ aver2_j</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="related-individuals.html"><a href="related-individuals.html#mix-unrel-rel"><i class="fa fa-check"></i><b>14.3</b> mix unrel &amp; rel</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="related-individuals.html"><a href="related-individuals.html#genotype"><i class="fa fa-check"></i><b>14.3.1</b> genotype</a></li>
<li class="chapter" data-level="14.3.2" data-path="related-individuals.html"><a href="related-individuals.html#gwas-4"><i class="fa fa-check"></i><b>14.3.2</b> gwas</a></li>
<li class="chapter" data-level="14.3.3" data-path="related-individuals.html"><a href="related-individuals.html#aver2_j-4"><i class="fa fa-check"></i><b>14.3.3</b> aver2_j</a></li>
<li class="chapter" data-level="14.3.4" data-path="related-individuals.html"><a href="related-individuals.html#organize-data-7"><i class="fa fa-check"></i><b>14.3.4</b> organize data</a></li>
<li class="chapter" data-level="14.3.5" data-path="related-individuals.html"><a href="related-individuals.html#chisq-aver2_j-7"><i class="fa fa-check"></i><b>14.3.5</b> chisq ~ aver2_j</a></li>
<li class="chapter" data-level="14.3.6" data-path="related-individuals.html"><a href="related-individuals.html#inflation-aver2_j-1"><i class="fa fa-check"></i><b>14.3.6</b> inflation ~ aver2_j</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html"><i class="fa fa-check"></i><b>15</b> compute <span class="math inline">\(\sum_{i,j}^{m_1, m_2}r^2_{i,j}\)</span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#good-gwas-all-qced-snps"><i class="fa fa-check"></i><b>15.1</b> good GWAS-all qced snps</a></li>
<li class="chapter" data-level="15.2" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#good-gwass--ldak-thin-snps"><i class="fa fa-check"></i><b>15.2</b> good GWASs- ldak-thin snps</a></li>
<li class="chapter" data-level="15.3" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#bad-gwass-all-qced-snps"><i class="fa fa-check"></i><b>15.3</b> bad GWASs-all qced snps</a></li>
<li class="chapter" data-level="15.4" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#summary-12"><i class="fa fa-check"></i><b>15.4</b> summary</a></li>
<li class="chapter" data-level="15.5" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#aver2j"><i class="fa fa-check"></i><b>15.5</b> compute aver2_j</a></li>
<li class="chapter" data-level="15.6" data-path="compute-sum_ijm_1-m_2r2_ij.html"><a href="compute-sum_ijm_1-m_2r2_ij.html#mixed-pop-gwas-with-pc-as-covariates"><i class="fa fa-check"></i><b>15.6</b> mixed pop GWAS with PC as covariates</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="assortative-mating.html"><a href="assortative-mating.html"><i class="fa fa-check"></i><b>16</b> Assortative mating</a>
<ul>
<li class="chapter" data-level="16.1" data-path="assortative-mating.html"><a href="assortative-mating.html#test-the-idea"><i class="fa fa-check"></i><b>16.1</b> Test the idea</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="assortative-mating.html"><a href="assortative-mating.html#st-try"><i class="fa fa-check"></i><b>16.1.1</b> 1st try</a></li>
<li class="chapter" data-level="16.1.2" data-path="assortative-mating.html"><a href="assortative-mating.html#nd-try"><i class="fa fa-check"></i><b>16.1.2</b> 2nd try</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html"><i class="fa fa-check"></i><b>17</b> Reference Panel: 1k Genome</a>
<ul>
<li class="chapter" data-level="17.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#common-snplist"><i class="fa fa-check"></i><b>17.1</b> common snplist</a></li>
<li class="chapter" data-level="17.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#compute-aver2"><i class="fa fa-check"></i><b>17.2</b> compute aver2</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#bad-gwas-1"><i class="fa fa-check"></i><b>17.2.1</b> bad gwas</a></li>
<li class="chapter" data-level="17.2.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#varying-levels-of-confounding"><i class="fa fa-check"></i><b>17.2.2</b> varying levels of confounding</a></li>
<li class="chapter" data-level="17.2.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#good-gwas-1"><i class="fa fa-check"></i><b>17.2.3</b> good gwas</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#detect-confounding"><i class="fa fa-check"></i><b>17.3</b> detect confounding</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#bad-gwas-2"><i class="fa fa-check"></i><b>17.3.1</b> bad gwas</a></li>
<li class="chapter" data-level="17.3.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#varying-levels-of-confounding-1"><i class="fa fa-check"></i><b>17.3.2</b> varying levels of confounding</a></li>
<li class="chapter" data-level="17.3.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#good-gwas-2"><i class="fa fa-check"></i><b>17.3.3</b> good gwas</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#estimate-inflation"><i class="fa fa-check"></i><b>17.4</b> estimate inflation</a></li>
<li class="chapter" data-level="17.5" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#stratified-aver2"><i class="fa fa-check"></i><b>17.5</b> stratified aver2</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#calc-aver2"><i class="fa fa-check"></i><b>17.5.1</b> calc aver2</a></li>
<li class="chapter" data-level="17.5.2" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#organize-data-8"><i class="fa fa-check"></i><b>17.5.2</b> organize data</a></li>
<li class="chapter" data-level="17.5.3" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#plot-aver2-of-pairwise-mixture-pops"><i class="fa fa-check"></i><b>17.5.3</b> plot aver2 of pairwise mixture pops</a></li>
<li class="chapter" data-level="17.5.4" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#chisq-1-x-aver2"><i class="fa fa-check"></i><b>17.5.4</b> chisq ~ 1 x aver2</a></li>
<li class="chapter" data-level="17.5.5" data-path="reference-panel-1k-genome.html"><a href="reference-panel-1k-genome.html#chisq-multi-aver2"><i class="fa fa-check"></i><b>17.5.5</b> chisq ~ multi-aver2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html"><i class="fa fa-check"></i><b>18</b> Fine-scale population stratification</a>
<ul>
<li class="chapter" data-level="18.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#birth-location-data"><i class="fa fa-check"></i><b>18.1</b> birth location data</a></li>
<li class="chapter" data-level="18.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#pca-of-337k"><i class="fa fa-check"></i><b>18.2</b> pca of 337k</a></li>
<li class="chapter" data-level="18.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#birth-place-gwas"><i class="fa fa-check"></i><b>18.3</b> birth place gwas</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-5"><i class="fa fa-check"></i><b>18.3.1</b> gwas</a></li>
<li class="chapter" data-level="18.3.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#chisq-aver2-1"><i class="fa fa-check"></i><b>18.3.2</b> chisq ~ aver2</a></li>
<li class="chapter" data-level="18.3.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#detect-inflation-using-1kg"><i class="fa fa-check"></i><b>18.3.3</b> detect inflation using 1kg</a></li>
<li class="chapter" data-level="18.3.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-results"><i class="fa fa-check"></i><b>18.3.4</b> gwas results</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#gwas-based-on-pc-clusters"><i class="fa fa-check"></i><b>18.4</b> GWAS based on PC clusters</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-lists"><i class="fa fa-check"></i><b>18.4.1</b> id lists</a></li>
<li class="chapter" data-level="18.4.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-list-for-bad-gwas2"><i class="fa fa-check"></i><b>18.4.2</b> id list for bad gwas2</a></li>
<li class="chapter" data-level="18.4.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#id-list-for-bad-gwas3"><i class="fa fa-check"></i><b>18.4.3</b> id list for bad gwas3</a></li>
<li class="chapter" data-level="18.4.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-3"><i class="fa fa-check"></i><b>18.4.4</b> bad gwas</a></li>
<li class="chapter" data-level="18.4.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2"><i class="fa fa-check"></i><b>18.4.5</b> bad gwas#2</a></li>
<li class="chapter" data-level="18.4.6" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3"><i class="fa fa-check"></i><b>18.4.6</b> bad gwas#3</a></li>
<li class="chapter" data-level="18.4.7" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-3"><i class="fa fa-check"></i><b>18.4.7</b> good gwas</a></li>
<li class="chapter" data-level="18.4.8" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-1"><i class="fa fa-check"></i><b>18.4.8</b> control gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#compute-aver2-1"><i class="fa fa-check"></i><b>18.5</b> compute aver2</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-4"><i class="fa fa-check"></i><b>18.5.1</b> bad-gwas</a></li>
<li class="chapter" data-level="18.5.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2-1"><i class="fa fa-check"></i><b>18.5.2</b> bad-gwas#2</a></li>
<li class="chapter" data-level="18.5.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3-1"><i class="fa fa-check"></i><b>18.5.3</b> bad-gwas#3</a></li>
<li class="chapter" data-level="18.5.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-4"><i class="fa fa-check"></i><b>18.5.4</b> good-gwas</a></li>
<li class="chapter" data-level="18.5.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-2"><i class="fa fa-check"></i><b>18.5.5</b> control-gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#chisq-aver2-2"><i class="fa fa-check"></i><b>18.6</b> chisq ~ aver2</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas-5"><i class="fa fa-check"></i><b>18.6.1</b> bad gwas</a></li>
<li class="chapter" data-level="18.6.2" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas2-2"><i class="fa fa-check"></i><b>18.6.2</b> bad gwas#2</a></li>
<li class="chapter" data-level="18.6.3" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#bad-gwas3-2"><i class="fa fa-check"></i><b>18.6.3</b> bad gwas#3</a></li>
<li class="chapter" data-level="18.6.4" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#good-gwas-5"><i class="fa fa-check"></i><b>18.6.4</b> good gwas</a></li>
<li class="chapter" data-level="18.6.5" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#control-gwas-3"><i class="fa fa-check"></i><b>18.6.5</b> control gwas</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="fine-scale-population-stratification.html"><a href="fine-scale-population-stratification.html#inflation-aver2-1"><i class="fa fa-check"></i><b>18.7</b> inflation ~ aver2</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GWAS Quality Control</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reference-panel-1k-genome" class="section level1" number="17">
<h1><span class="header-section-number">17</span> Reference Panel: 1k Genome</h1>
<p>Here we want to test the idea if aver2 computed using mixed populations from a reference panel can be used for our proposed test. We will use genotype data from the 1k genome project as the reference panel. Here are the steps.</p>
<ol style="list-style-type: decimal">
<li>get the overlapping snp list of the two datasets, ukbb &amp; 1k genome.</li>
<li>randomly select 1000 snps from each chromosome. This will will give 22k snps.</li>
<li>compute aver2 from each dataset &amp; compare them.</li>
</ol>
<p>Note: we could also consider stratified analyses based on maf.</p>
<div id="common-snplist" class="section level2" number="17.1">
<h2><span class="header-section-number">17.1</span> common snplist</h2>
<div class="sourceCode" id="cb138"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb138-1"><a href="reference-panel-1k-genome.html#cb138-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-2"><a href="reference-panel-1k-genome.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ref-1kg</span>
<span id="cb138-3"><a href="reference-panel-1k-genome.html#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ref-1kg/snplist</span>
<span id="cb138-4"><a href="reference-panel-1k-genome.html#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ref-1kg/ukbb</span>
<span id="cb138-5"><a href="reference-panel-1k-genome.html#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ref-1kg/1kg</span>
<span id="cb138-6"><a href="reference-panel-1k-genome.html#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ref-1kg/1kg/out</span>
<span id="cb138-7"><a href="reference-panel-1k-genome.html#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ref-1kg/1kg/gen</span>
<span id="cb138-8"><a href="reference-panel-1k-genome.html#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ref-1kg/ukbb/out</span>
<span id="cb138-9"><a href="reference-panel-1k-genome.html#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="reference-panel-1k-genome.html#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="co"># common snp list----------------------------------------------------------------------</span></span>
<span id="cb138-11"><a href="reference-panel-1k-genome.html#cb138-11" aria-hidden="true" tabindex="-1"></a><span class="va">ref</span><span class="op">=</span>ref-1kg/1kg/gen/1000b.bim</span>
<span id="cb138-12"><a href="reference-panel-1k-genome.html#cb138-12" aria-hidden="true" tabindex="-1"></a><span class="va">ukbb1</span><span class="op">=</span>gen/geno-unrel.bim</span>
<span id="cb138-13"><a href="reference-panel-1k-genome.html#cb138-13" aria-hidden="true" tabindex="-1"></a><span class="va">ukbb2</span><span class="op">=</span>gen/snps-unrel-inds.use</span>
<span id="cb138-14"><a href="reference-panel-1k-genome.html#cb138-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-15"><a href="reference-panel-1k-genome.html#cb138-15" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{a=$5; </span></span>
<span id="cb138-16"><a href="reference-panel-1k-genome.html#cb138-16" aria-hidden="true" tabindex="-1"></a><span class="st">      b=$6;</span></span>
<span id="cb138-17"><a href="reference-panel-1k-genome.html#cb138-17" aria-hidden="true" tabindex="-1"></a><span class="st">      if(a&lt;b) </span></span>
<span id="cb138-18"><a href="reference-panel-1k-genome.html#cb138-18" aria-hidden="true" tabindex="-1"></a><span class="st">      print $1, $2, $2 &quot;_&quot; a &quot;_&quot; b;</span></span>
<span id="cb138-19"><a href="reference-panel-1k-genome.html#cb138-19" aria-hidden="true" tabindex="-1"></a><span class="st">      else </span></span>
<span id="cb138-20"><a href="reference-panel-1k-genome.html#cb138-20" aria-hidden="true" tabindex="-1"></a><span class="st">      print $1, $2, $2 &quot;_&quot; b &quot;_&quot;a}&#39;</span> <span class="dt">\</span></span>
<span id="cb138-21"><a href="reference-panel-1k-genome.html#cb138-21" aria-hidden="true" tabindex="-1"></a>      <span class="va">$ref</span> <span class="op">&gt;</span> 1kg.tmp</span>
<span id="cb138-22"><a href="reference-panel-1k-genome.html#cb138-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-23"><a href="reference-panel-1k-genome.html#cb138-23" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;{a=$5; </span></span>
<span id="cb138-24"><a href="reference-panel-1k-genome.html#cb138-24" aria-hidden="true" tabindex="-1"></a><span class="st">      b=$6;</span></span>
<span id="cb138-25"><a href="reference-panel-1k-genome.html#cb138-25" aria-hidden="true" tabindex="-1"></a><span class="st">      if(a&lt;b) </span></span>
<span id="cb138-26"><a href="reference-panel-1k-genome.html#cb138-26" aria-hidden="true" tabindex="-1"></a><span class="st">      print $1, $2, $1 &quot;:&quot; $4 &quot;_&quot; a &quot;_&quot; b;</span></span>
<span id="cb138-27"><a href="reference-panel-1k-genome.html#cb138-27" aria-hidden="true" tabindex="-1"></a><span class="st">      else </span></span>
<span id="cb138-28"><a href="reference-panel-1k-genome.html#cb138-28" aria-hidden="true" tabindex="-1"></a><span class="st">      print $1, $2, $1 &quot;:&quot; $4 &quot;_&quot; b &quot;_&quot; a}&#39;</span> <span class="dt">\</span></span>
<span id="cb138-29"><a href="reference-panel-1k-genome.html#cb138-29" aria-hidden="true" tabindex="-1"></a>      <span class="va">$ukbb1</span> <span class="op">&gt;</span>ukbb1.tmp</span>
<span id="cb138-30"><a href="reference-panel-1k-genome.html#cb138-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-31"><a href="reference-panel-1k-genome.html#cb138-31" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; next} </span></span>
<span id="cb138-32"><a href="reference-panel-1k-genome.html#cb138-32" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($2 in a) print $0}&#39;</span> <span class="va">$ukbb2</span> ukbb1.tmp <span class="op">&gt;</span> ukbb2.tmp</span>
<span id="cb138-33"><a href="reference-panel-1k-genome.html#cb138-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-34"><a href="reference-panel-1k-genome.html#cb138-34" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$3]; next} </span></span>
<span id="cb138-35"><a href="reference-panel-1k-genome.html#cb138-35" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($3 in a) print $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb138-36"><a href="reference-panel-1k-genome.html#cb138-36" aria-hidden="true" tabindex="-1"></a>     ukbb2.tmp 1kg.tmp <span class="op">&gt;</span> ref-1kg/snplist/1kg-common-snps <span class="co"># m=1,097,285</span></span>
<span id="cb138-37"><a href="reference-panel-1k-genome.html#cb138-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-38"><a href="reference-panel-1k-genome.html#cb138-38" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$3]; next} </span></span>
<span id="cb138-39"><a href="reference-panel-1k-genome.html#cb138-39" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($3 in a) print $0}&#39;</span> <span class="dt">\</span></span>
<span id="cb138-40"><a href="reference-panel-1k-genome.html#cb138-40" aria-hidden="true" tabindex="-1"></a>     1kg.tmp ukbb2.tmp<span class="op">&gt;</span> ref-1kg/snplist/ukbb-common-snps <span class="co"># m=1,097,285</span></span>
<span id="cb138-41"><a href="reference-panel-1k-genome.html#cb138-41" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb138-42"><a href="reference-panel-1k-genome.html#cb138-42" aria-hidden="true" tabindex="-1"></a><span class="co"># select 22k SNPs from the common list ----------------------------------------</span></span>
<span id="cb138-43"><a href="reference-panel-1k-genome.html#cb138-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb138-44"><a href="reference-panel-1k-genome.html#cb138-44" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> i=<span class="va">$i</span> <span class="st">&#39;($1==i){print $3}&#39;</span> ref-1kg/snplist/1kg-common-snps <span class="op">&gt;</span> temp</span>
<span id="cb138-45"><a href="reference-panel-1k-genome.html#cb138-45" aria-hidden="true" tabindex="-1"></a><span class="ex">shuf</span> temp <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 1000 <span class="op">&gt;</span> ref-1kg/snplist/rand-1k-chrom<span class="va">$i</span></span>
<span id="cb138-46"><a href="reference-panel-1k-genome.html#cb138-46" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb138-47"><a href="reference-panel-1k-genome.html#cb138-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-48"><a href="reference-panel-1k-genome.html#cb138-48" aria-hidden="true" tabindex="-1"></a><span class="co"># combine files</span></span>
<span id="cb138-49"><a href="reference-panel-1k-genome.html#cb138-49" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>ref-1kg/snplist</span>
<span id="cb138-50"><a href="reference-panel-1k-genome.html#cb138-50" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">$dir</span>/rand-22k</span>
<span id="cb138-51"><a href="reference-panel-1k-genome.html#cb138-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb138-52"><a href="reference-panel-1k-genome.html#cb138-52" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="va">$dir</span>/rand-1k-chrom<span class="va">$i</span> <span class="op">&gt;&gt;</span> <span class="va">$dir</span>/rand-22k</span>
<span id="cb138-53"><a href="reference-panel-1k-genome.html#cb138-53" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb138-54"><a href="reference-panel-1k-genome.html#cb138-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-55"><a href="reference-panel-1k-genome.html#cb138-55" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> ref-1kg/snplist/rand-1k-chrom<span class="pp">*</span></span>
<span id="cb138-56"><a href="reference-panel-1k-genome.html#cb138-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-57"><a href="reference-panel-1k-genome.html#cb138-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 1kg snp names</span></span>
<span id="cb138-58"><a href="reference-panel-1k-genome.html#cb138-58" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>ref-1kg/snplist</span>
<span id="cb138-59"><a href="reference-panel-1k-genome.html#cb138-59" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; next} </span></span>
<span id="cb138-60"><a href="reference-panel-1k-genome.html#cb138-60" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($3 in a) print $2}&#39;</span> <span class="dt">\</span></span>
<span id="cb138-61"><a href="reference-panel-1k-genome.html#cb138-61" aria-hidden="true" tabindex="-1"></a>     <span class="va">$dir</span>/rand-22k <span class="va">$dir</span>/1kg-common-snps <span class="op">&gt;</span> <span class="va">$dir</span>/1kg-22k-snps.use</span>
<span id="cb138-62"><a href="reference-panel-1k-genome.html#cb138-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-63"><a href="reference-panel-1k-genome.html#cb138-63" aria-hidden="true" tabindex="-1"></a><span class="co"># ukbb snp names</span></span>
<span id="cb138-64"><a href="reference-panel-1k-genome.html#cb138-64" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>ref-1kg/snplist</span>
<span id="cb138-65"><a href="reference-panel-1k-genome.html#cb138-65" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; next} </span></span>
<span id="cb138-66"><a href="reference-panel-1k-genome.html#cb138-66" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($3 in a) print $2}&#39;</span> <span class="dt">\</span></span>
<span id="cb138-67"><a href="reference-panel-1k-genome.html#cb138-67" aria-hidden="true" tabindex="-1"></a>     <span class="va">$dir</span>/rand-22k <span class="va">$dir</span>/ukbb-common-snps <span class="op">&gt;</span> <span class="va">$dir</span>/ukbb-22k-snps.use</span>
<span id="cb138-68"><a href="reference-panel-1k-genome.html#cb138-68" aria-hidden="true" tabindex="-1"></a>     </span></code></pre></div>
</div>
<div id="compute-aver2" class="section level2" number="17.2">
<h2><span class="header-section-number">17.2</span> compute aver2</h2>
<div id="bad-gwas-1" class="section level3" number="17.2.1">
<h3><span class="header-section-number">17.2.1</span> bad gwas</h3>
<div class="sourceCode" id="cb139"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb139-1"><a href="reference-panel-1k-genome.html#cb139-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2"><a href="reference-panel-1k-genome.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="co"># compute aver2 ----------------------------------------------------------------</span></span>
<span id="cb139-3"><a href="reference-panel-1k-genome.html#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1kg</span></span>
<span id="cb139-4"><a href="reference-panel-1k-genome.html#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="va">list</span><span class="op">=</span>../ref-1kg/snplist/1kg-22k-snps.use</span>
<span id="cb139-5"><a href="reference-panel-1k-genome.html#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../ref-1kg/1kg/gen/1000b</span>
<span id="cb139-6"><a href="reference-panel-1k-genome.html#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../ref-1kg/aver2/1kg.aver2</span>
<span id="cb139-7"><a href="reference-panel-1k-genome.html#cb139-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-8"><a href="reference-panel-1k-genome.html#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb139-9"><a href="reference-panel-1k-genome.html#cb139-9" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb139-10"><a href="reference-panel-1k-genome.html#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb139-11"><a href="reference-panel-1k-genome.html#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb139-12"><a href="reference-panel-1k-genome.html#cb139-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb139-13"><a href="reference-panel-1k-genome.html#cb139-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb139-14"><a href="reference-panel-1k-genome.html#cb139-14" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb139-15"><a href="reference-panel-1k-genome.html#cb139-15" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb139-16"><a href="reference-panel-1k-genome.html#cb139-16" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb139-17"><a href="reference-panel-1k-genome.html#cb139-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$list</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb139-18"><a href="reference-panel-1k-genome.html#cb139-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$list</span></span>
<span id="cb139-19"><a href="reference-panel-1k-genome.html#cb139-19" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-1kg</span>
<span id="cb139-20"><a href="reference-panel-1k-genome.html#cb139-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-21"><a href="reference-panel-1k-genome.html#cb139-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ukbb</span></span>
<span id="cb139-22"><a href="reference-panel-1k-genome.html#cb139-22" aria-hidden="true" tabindex="-1"></a><span class="va">list</span><span class="op">=</span>../ref-1kg/snplist/ukbb-22k-snps.use</span>
<span id="cb139-23"><a href="reference-panel-1k-genome.html#cb139-23" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-mix</span>
<span id="cb139-24"><a href="reference-panel-1k-genome.html#cb139-24" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../ref-1kg/aver2/ukbb.aver2</span>
<span id="cb139-25"><a href="reference-panel-1k-genome.html#cb139-25" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../mix-pop-gwas.id</span>
<span id="cb139-26"><a href="reference-panel-1k-genome.html#cb139-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-27"><a href="reference-panel-1k-genome.html#cb139-27" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb139-28"><a href="reference-panel-1k-genome.html#cb139-28" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb139-29"><a href="reference-panel-1k-genome.html#cb139-29" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb139-30"><a href="reference-panel-1k-genome.html#cb139-30" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb139-31"><a href="reference-panel-1k-genome.html#cb139-31" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb139-32"><a href="reference-panel-1k-genome.html#cb139-32" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb139-33"><a href="reference-panel-1k-genome.html#cb139-33" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb139-34"><a href="reference-panel-1k-genome.html#cb139-34" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb139-35"><a href="reference-panel-1k-genome.html#cb139-35" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb139-36"><a href="reference-panel-1k-genome.html#cb139-36" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb139-37"><a href="reference-panel-1k-genome.html#cb139-37" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$list</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb139-38"><a href="reference-panel-1k-genome.html#cb139-38" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$list</span></span>
<span id="cb139-39"><a href="reference-panel-1k-genome.html#cb139-39" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-ukbb</span>
<span id="cb139-40"><a href="reference-panel-1k-genome.html#cb139-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-41"><a href="reference-panel-1k-genome.html#cb139-41" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb139-42"><a href="reference-panel-1k-genome.html#cb139-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{1kg</span><span class="op">,</span><span class="dt">ukbb}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb139-43"><a href="reference-panel-1k-genome.html#cb139-43" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-<span class="va">$i</span></span>
<span id="cb139-44"><a href="reference-panel-1k-genome.html#cb139-44" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span>../job-records/calc-aver2-ref</span>
<span id="cb139-45"><a href="reference-panel-1k-genome.html#cb139-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-46"><a href="reference-panel-1k-genome.html#cb139-46" aria-hidden="true" tabindex="-1"></a><span class="co"># organize data ----------------------------------------------------------------</span></span>
<span id="cb139-47"><a href="reference-panel-1k-genome.html#cb139-47" aria-hidden="true" tabindex="-1"></a><span class="va">aver2_ref</span><span class="op">=</span>ref-1kg/aver2/1kg.aver2.rjk2.average</span>
<span id="cb139-48"><a href="reference-panel-1k-genome.html#cb139-48" aria-hidden="true" tabindex="-1"></a><span class="va">aver2_ukbb</span><span class="op">=</span>ref-1kg/aver2/ukbb.aver2.rjk2.average</span>
<span id="cb139-49"><a href="reference-panel-1k-genome.html#cb139-49" aria-hidden="true" tabindex="-1"></a><span class="va">ref</span><span class="op">=</span>ref-1kg/snplist/1kg-common-snps</span>
<span id="cb139-50"><a href="reference-panel-1k-genome.html#cb139-50" aria-hidden="true" tabindex="-1"></a><span class="va">ukbb</span><span class="op">=</span>ref-1kg/snplist/ukbb-common-snps</span>
<span id="cb139-51"><a href="reference-panel-1k-genome.html#cb139-51" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>ref-1kg/aver2/1kg-ukbb.aver2</span>
<span id="cb139-52"><a href="reference-panel-1k-genome.html#cb139-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-53"><a href="reference-panel-1k-genome.html#cb139-53" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$2]; b[$2]=$3; next}</span></span>
<span id="cb139-54"><a href="reference-panel-1k-genome.html#cb139-54" aria-hidden="true" tabindex="-1"></a><span class="st">      {if ($1 in a) print b[$1], $1, $2}&#39;</span> <span class="va">$ref</span> <span class="va">$aver2_ref</span> <span class="op">&gt;</span> ref-1kg/aver2/1kg-tmp</span>
<span id="cb139-55"><a href="reference-panel-1k-genome.html#cb139-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb139-56"><a href="reference-panel-1k-genome.html#cb139-56" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$2]; b[$2]=$3; next}</span></span>
<span id="cb139-57"><a href="reference-panel-1k-genome.html#cb139-57" aria-hidden="true" tabindex="-1"></a><span class="st">      {if ($1 in a) print b[$1], $1, $2}&#39;</span> <span class="va">$ukbb</span> <span class="va">$aver2_ukbb</span> <span class="op">&gt;</span> ref-1kg/aver2/ukbb-tmp</span>
<span id="cb139-58"><a href="reference-panel-1k-genome.html#cb139-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-59"><a href="reference-panel-1k-genome.html#cb139-59" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>ref-1kg/aver2</span>
<span id="cb139-60"><a href="reference-panel-1k-genome.html#cb139-60" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb&quot; }</span></span>
<span id="cb139-61"><a href="reference-panel-1k-genome.html#cb139-61" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR {a[$1]; b[$1]=$2; c[$1]=$3; next}</span></span>
<span id="cb139-62"><a href="reference-panel-1k-genome.html#cb139-62" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $2, b[$1], c[$1], $3 }&#39;</span> <span class="va">$dir</span>/1kg-tmp <span class="va">$dir</span>/ukbb-tmp <span class="op">&gt;</span> <span class="va">$out</span> </span>
<span id="cb139-63"><a href="reference-panel-1k-genome.html#cb139-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-64"><a href="reference-panel-1k-genome.html#cb139-64" aria-hidden="true" tabindex="-1"></a><span class="co"># combine aver2 with ukbb phenotypes--------------------------------------------</span></span>
<span id="cb139-65"><a href="reference-panel-1k-genome.html#cb139-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-66"><a href="reference-panel-1k-genome.html#cb139-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb139-67"><a href="reference-panel-1k-genome.html#cb139-67" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-mix/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb139-68"><a href="reference-panel-1k-genome.html#cb139-68" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>ref-1kg/aver2/1kg-ukbb.aver2</span>
<span id="cb139-69"><a href="reference-panel-1k-genome.html#cb139-69" aria-hidden="true" tabindex="-1"></a><span class="va">tmp</span><span class="op">=</span>ref-1kg/out/<span class="va">$trait</span>.tmp</span>
<span id="cb139-70"><a href="reference-panel-1k-genome.html#cb139-70" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-unrel-inds.ldscore</span>
<span id="cb139-71"><a href="reference-panel-1k-genome.html#cb139-71" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>ref-1kg/out/<span class="va">$trait</span>.out</span>
<span id="cb139-72"><a href="reference-panel-1k-genome.html#cb139-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-73"><a href="reference-panel-1k-genome.html#cb139-73" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb chisq&quot; }</span></span>
<span id="cb139-74"><a href="reference-panel-1k-genome.html#cb139-74" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR &amp;&amp; NR &gt; 1 {a[$1]; b[$1]=$5; next} </span></span>
<span id="cb139-75"><a href="reference-panel-1k-genome.html#cb139-75" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $0, b[$1]}&#39;</span> <span class="va">$gwas</span> <span class="va">$aver2</span><span class="op">&gt;</span> <span class="va">$tmp</span></span>
<span id="cb139-76"><a href="reference-panel-1k-genome.html#cb139-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-77"><a href="reference-panel-1k-genome.html#cb139-77" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb chisq ldsc&quot; }</span></span>
<span id="cb139-78"><a href="reference-panel-1k-genome.html#cb139-78" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb139-79"><a href="reference-panel-1k-genome.html#cb139-79" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $0, b[$1]}&#39;</span> <span class="va">$ldsc</span> <span class="va">$tmp</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb139-80"><a href="reference-panel-1k-genome.html#cb139-80" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb139-81"><a href="reference-panel-1k-genome.html#cb139-81" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="varying-levels-of-confounding" class="section level3" number="17.2.2">
<h3><span class="header-section-number">17.2.2</span> varying levels of confounding</h3>
<div class="sourceCode" id="cb140"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb140-1"><a href="reference-panel-1k-genome.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute aver2 ----------------------------------------------------------------</span></span>
<span id="cb140-2"><a href="reference-panel-1k-genome.html#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ukbb</span></span>
<span id="cb140-3"><a href="reference-panel-1k-genome.html#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb140-4"><a href="reference-panel-1k-genome.html#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="reference-panel-1k-genome.html#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="co"># mkdir</span></span>
<span id="cb140-6"><a href="reference-panel-1k-genome.html#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ref-1kg/aver2-<span class="va">$n</span>-noneuro</span>
<span id="cb140-7"><a href="reference-panel-1k-genome.html#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="reference-panel-1k-genome.html#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="co"># define vars</span></span>
<span id="cb140-9"><a href="reference-panel-1k-genome.html#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-mix</span>
<span id="cb140-10"><a href="reference-panel-1k-genome.html#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../ref-1kg/aver2-<span class="va">$n</span>-noneuro/ukbb.aver2</span>
<span id="cb140-11"><a href="reference-panel-1k-genome.html#cb140-11" aria-hidden="true" tabindex="-1"></a><span class="va">list</span><span class="op">=</span>../ref-1kg/snplist/ukbb-22k-snps.use</span>
<span id="cb140-12"><a href="reference-panel-1k-genome.html#cb140-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-13"><a href="reference-panel-1k-genome.html#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$n</span> <span class="ot">==</span> 0k <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb140-14"><a href="reference-panel-1k-genome.html#cb140-14" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../rand.100000</span>
<span id="cb140-15"><a href="reference-panel-1k-genome.html#cb140-15" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb140-16"><a href="reference-panel-1k-genome.html#cb140-16" aria-hidden="true" tabindex="-1"></a>  <span class="va">id</span><span class="op">=</span>../mix-pop-gwas-<span class="va">$n</span>-noneuro.id</span>
<span id="cb140-17"><a href="reference-panel-1k-genome.html#cb140-17" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb140-18"><a href="reference-panel-1k-genome.html#cb140-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-19"><a href="reference-panel-1k-genome.html#cb140-19" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb140-20"><a href="reference-panel-1k-genome.html#cb140-20" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb140-21"><a href="reference-panel-1k-genome.html#cb140-21" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb140-22"><a href="reference-panel-1k-genome.html#cb140-22" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 25G</span></span>
<span id="cb140-23"><a href="reference-panel-1k-genome.html#cb140-23" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb140-24"><a href="reference-panel-1k-genome.html#cb140-24" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb140-25"><a href="reference-panel-1k-genome.html#cb140-25" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb140-26"><a href="reference-panel-1k-genome.html#cb140-26" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb140-27"><a href="reference-panel-1k-genome.html#cb140-27" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb140-28"><a href="reference-panel-1k-genome.html#cb140-28" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb140-29"><a href="reference-panel-1k-genome.html#cb140-29" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$list</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb140-30"><a href="reference-panel-1k-genome.html#cb140-30" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$list</span></span>
<span id="cb140-31"><a href="reference-panel-1k-genome.html#cb140-31" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-ukbb-<span class="va">$n</span>-noneuro</span>
<span id="cb140-32"><a href="reference-panel-1k-genome.html#cb140-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb140-33"><a href="reference-panel-1k-genome.html#cb140-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-34"><a href="reference-panel-1k-genome.html#cb140-34" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb140-35"><a href="reference-panel-1k-genome.html#cb140-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb140-36"><a href="reference-panel-1k-genome.html#cb140-36" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-ukbb-<span class="va">$n</span>-noneuro</span>
<span id="cb140-37"><a href="reference-panel-1k-genome.html#cb140-37" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span>../job-records/calc-aver2-varying-noneuro</span>
<span id="cb140-38"><a href="reference-panel-1k-genome.html#cb140-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-39"><a href="reference-panel-1k-genome.html#cb140-39" aria-hidden="true" tabindex="-1"></a><span class="co"># organize data ----------------------------------------------------------------</span></span>
<span id="cb140-40"><a href="reference-panel-1k-genome.html#cb140-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-41"><a href="reference-panel-1k-genome.html#cb140-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb140-42"><a href="reference-panel-1k-genome.html#cb140-42" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>ref-1kg/aver2-<span class="va">$n</span>-noneuro</span>
<span id="cb140-43"><a href="reference-panel-1k-genome.html#cb140-43" aria-hidden="true" tabindex="-1"></a><span class="va">aver2_ref</span><span class="op">=</span>ref-1kg/aver2/1kg.aver2.rjk2.average</span>
<span id="cb140-44"><a href="reference-panel-1k-genome.html#cb140-44" aria-hidden="true" tabindex="-1"></a><span class="va">aver2_ukbb</span><span class="op">=</span><span class="va">$dir</span>/ukbb.aver2.rjk2.average</span>
<span id="cb140-45"><a href="reference-panel-1k-genome.html#cb140-45" aria-hidden="true" tabindex="-1"></a><span class="va">ref</span><span class="op">=</span>ref-1kg/snplist/1kg-common-snps</span>
<span id="cb140-46"><a href="reference-panel-1k-genome.html#cb140-46" aria-hidden="true" tabindex="-1"></a><span class="va">ukbb</span><span class="op">=</span>ref-1kg/snplist/ukbb-common-snps</span>
<span id="cb140-47"><a href="reference-panel-1k-genome.html#cb140-47" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$dir</span>/1kg-ukbb.aver2</span>
<span id="cb140-48"><a href="reference-panel-1k-genome.html#cb140-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-49"><a href="reference-panel-1k-genome.html#cb140-49" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$2]; b[$2]=$3; next}</span></span>
<span id="cb140-50"><a href="reference-panel-1k-genome.html#cb140-50" aria-hidden="true" tabindex="-1"></a><span class="st">      {if ($1 in a) print b[$1], $1, $2}&#39;</span> <span class="va">$ref</span> <span class="va">$aver2_ref</span> <span class="op">&gt;</span> <span class="va">$dir</span>/1kg-tmp</span>
<span id="cb140-51"><a href="reference-panel-1k-genome.html#cb140-51" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb140-52"><a href="reference-panel-1k-genome.html#cb140-52" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$2]; b[$2]=$3; next}</span></span>
<span id="cb140-53"><a href="reference-panel-1k-genome.html#cb140-53" aria-hidden="true" tabindex="-1"></a><span class="st">      {if ($1 in a) print b[$1], $1, $2}&#39;</span> <span class="va">$ukbb</span> <span class="va">$aver2_ukbb</span> <span class="op">&gt;</span> <span class="va">$dir</span>/ukbb-tmp</span>
<span id="cb140-54"><a href="reference-panel-1k-genome.html#cb140-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-55"><a href="reference-panel-1k-genome.html#cb140-55" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb&quot; }</span></span>
<span id="cb140-56"><a href="reference-panel-1k-genome.html#cb140-56" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR {a[$1]; b[$1]=$2; c[$1]=$3; next}</span></span>
<span id="cb140-57"><a href="reference-panel-1k-genome.html#cb140-57" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $2, b[$1], c[$1], $3 }&#39;</span> <span class="va">$dir</span>/1kg-tmp <span class="va">$dir</span>/ukbb-tmp <span class="op">&gt;</span> <span class="va">$out</span> </span>
<span id="cb140-58"><a href="reference-panel-1k-genome.html#cb140-58" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb140-59"><a href="reference-panel-1k-genome.html#cb140-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-60"><a href="reference-panel-1k-genome.html#cb140-60" aria-hidden="true" tabindex="-1"></a><span class="co"># combine aver2 with ukbb phenotypes--------------------------------------------</span></span>
<span id="cb140-61"><a href="reference-panel-1k-genome.html#cb140-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-62"><a href="reference-panel-1k-genome.html#cb140-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="dt">{0k</span><span class="op">,</span><span class="dt">1k</span><span class="op">,</span><span class="dt">2k</span><span class="op">,</span><span class="dt">3k</span><span class="op">,</span><span class="dt">4k</span><span class="op">,</span><span class="dt">5k</span><span class="op">,</span><span class="dt">6k}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb140-63"><a href="reference-panel-1k-genome.html#cb140-63" aria-hidden="true" tabindex="-1"></a><span class="co"># mkdir </span></span>
<span id="cb140-64"><a href="reference-panel-1k-genome.html#cb140-64" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ref-1kg/out-<span class="va">$n</span>-noneuro</span>
<span id="cb140-65"><a href="reference-panel-1k-genome.html#cb140-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-66"><a href="reference-panel-1k-genome.html#cb140-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb140-67"><a href="reference-panel-1k-genome.html#cb140-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-68"><a href="reference-panel-1k-genome.html#cb140-68" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-mix-<span class="va">$n</span>-noneuro/maf.01/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb140-69"><a href="reference-panel-1k-genome.html#cb140-69" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>ref-1kg/aver2-<span class="va">$n</span>-noneuro/1kg-ukbb.aver2</span>
<span id="cb140-70"><a href="reference-panel-1k-genome.html#cb140-70" aria-hidden="true" tabindex="-1"></a><span class="va">tmp</span><span class="op">=</span>ref-1kg/out-<span class="va">$n</span>-noneuro/<span class="va">$trait</span>.tmp</span>
<span id="cb140-71"><a href="reference-panel-1k-genome.html#cb140-71" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-unrel-inds.ldscore</span>
<span id="cb140-72"><a href="reference-panel-1k-genome.html#cb140-72" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>ref-1kg/out-<span class="va">$n</span>-noneuro/<span class="va">$trait</span>.out</span>
<span id="cb140-73"><a href="reference-panel-1k-genome.html#cb140-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-74"><a href="reference-panel-1k-genome.html#cb140-74" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb chisq&quot; }</span></span>
<span id="cb140-75"><a href="reference-panel-1k-genome.html#cb140-75" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR &amp;&amp; NR &gt; 1 {a[$1]; b[$1]=$5; next} </span></span>
<span id="cb140-76"><a href="reference-panel-1k-genome.html#cb140-76" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $0, b[$1]}&#39;</span> <span class="va">$gwas</span> <span class="va">$aver2</span><span class="op">&gt;</span> <span class="va">$tmp</span></span>
<span id="cb140-77"><a href="reference-panel-1k-genome.html#cb140-77" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb140-78"><a href="reference-panel-1k-genome.html#cb140-78" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb chisq ldsc&quot; }</span></span>
<span id="cb140-79"><a href="reference-panel-1k-genome.html#cb140-79" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb140-80"><a href="reference-panel-1k-genome.html#cb140-80" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $0, b[$1]}&#39;</span> <span class="va">$ldsc</span> <span class="va">$tmp</span> <span class="op">&gt;</span> <span class="va">$out</span>     </span>
<span id="cb140-81"><a href="reference-panel-1k-genome.html#cb140-81" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb140-82"><a href="reference-panel-1k-genome.html#cb140-82" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="good-gwas-1" class="section level3" number="17.2.3">
<h3><span class="header-section-number">17.2.3</span> good gwas</h3>
<div class="sourceCode" id="cb141"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb141-1"><a href="reference-panel-1k-genome.html#cb141-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-2"><a href="reference-panel-1k-genome.html#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="co"># compute aver2 ----------------------------------------------------------------</span></span>
<span id="cb141-3"><a href="reference-panel-1k-genome.html#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="reference-panel-1k-genome.html#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ukbb</span></span>
<span id="cb141-5"><a href="reference-panel-1k-genome.html#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="va">list</span><span class="op">=</span>../ref-1kg/snplist/ukbb-22k-snps.use</span>
<span id="cb141-6"><a href="reference-panel-1k-genome.html#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../gen/geno-unrel</span>
<span id="cb141-7"><a href="reference-panel-1k-genome.html#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../ref-1kg/aver2-good-gwas/ukbb.aver2</span>
<span id="cb141-8"><a href="reference-panel-1k-genome.html#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../unrelated/rand.100000</span>
<span id="cb141-9"><a href="reference-panel-1k-genome.html#cb141-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-10"><a href="reference-panel-1k-genome.html#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb141-11"><a href="reference-panel-1k-genome.html#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb141-12"><a href="reference-panel-1k-genome.html#cb141-12" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb141-13"><a href="reference-panel-1k-genome.html#cb141-13" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 30G</span></span>
<span id="cb141-14"><a href="reference-panel-1k-genome.html#cb141-14" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 7</span></span>
<span id="cb141-15"><a href="reference-panel-1k-genome.html#cb141-15" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb141-16"><a href="reference-panel-1k-genome.html#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb141-17"><a href="reference-panel-1k-genome.html#cb141-17" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb141-18"><a href="reference-panel-1k-genome.html#cb141-18" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb141-19"><a href="reference-panel-1k-genome.html#cb141-19" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb141-20"><a href="reference-panel-1k-genome.html#cb141-20" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$list</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb141-21"><a href="reference-panel-1k-genome.html#cb141-21" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$list</span></span>
<span id="cb141-22"><a href="reference-panel-1k-genome.html#cb141-22" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-ukbb</span>
<span id="cb141-23"><a href="reference-panel-1k-genome.html#cb141-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-24"><a href="reference-panel-1k-genome.html#cb141-24" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb141-25"><a href="reference-panel-1k-genome.html#cb141-25" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-ukbb <span class="op">&gt;</span> ../job-records/calc-aver2-good-gwas</span>
<span id="cb141-26"><a href="reference-panel-1k-genome.html#cb141-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-27"><a href="reference-panel-1k-genome.html#cb141-27" aria-hidden="true" tabindex="-1"></a><span class="co"># organize data ----------------------------------------------------------------</span></span>
<span id="cb141-28"><a href="reference-panel-1k-genome.html#cb141-28" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>ref-1kg/aver2-good-gwas</span>
<span id="cb141-29"><a href="reference-panel-1k-genome.html#cb141-29" aria-hidden="true" tabindex="-1"></a><span class="va">aver2_ref</span><span class="op">=</span>ref-1kg/aver2/1kg.aver2.rjk2.average</span>
<span id="cb141-30"><a href="reference-panel-1k-genome.html#cb141-30" aria-hidden="true" tabindex="-1"></a><span class="va">aver2_ukbb</span><span class="op">=</span><span class="va">$dir</span>/ukbb.aver2.rjk2.average</span>
<span id="cb141-31"><a href="reference-panel-1k-genome.html#cb141-31" aria-hidden="true" tabindex="-1"></a><span class="va">ref</span><span class="op">=</span>ref-1kg/snplist/1kg-common-snps</span>
<span id="cb141-32"><a href="reference-panel-1k-genome.html#cb141-32" aria-hidden="true" tabindex="-1"></a><span class="va">ukbb</span><span class="op">=</span>ref-1kg/snplist/ukbb-common-snps</span>
<span id="cb141-33"><a href="reference-panel-1k-genome.html#cb141-33" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$dir</span>/1kg-ukbb.aver2</span>
<span id="cb141-34"><a href="reference-panel-1k-genome.html#cb141-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-35"><a href="reference-panel-1k-genome.html#cb141-35" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$2]; b[$2]=$3; next}</span></span>
<span id="cb141-36"><a href="reference-panel-1k-genome.html#cb141-36" aria-hidden="true" tabindex="-1"></a><span class="st">      {if ($1 in a) print b[$1], $1, $2}&#39;</span> <span class="va">$ref</span> <span class="va">$aver2_ref</span> <span class="op">&gt;</span> <span class="va">$dir</span>/1kg-tmp</span>
<span id="cb141-37"><a href="reference-panel-1k-genome.html#cb141-37" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb141-38"><a href="reference-panel-1k-genome.html#cb141-38" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$2]; b[$2]=$3; next}</span></span>
<span id="cb141-39"><a href="reference-panel-1k-genome.html#cb141-39" aria-hidden="true" tabindex="-1"></a><span class="st">      {if ($1 in a) print b[$1], $1, $2}&#39;</span> <span class="va">$ukbb</span> <span class="va">$aver2_ukbb</span> <span class="op">&gt;</span> <span class="va">$dir</span>/ukbb-tmp</span>
<span id="cb141-40"><a href="reference-panel-1k-genome.html#cb141-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-41"><a href="reference-panel-1k-genome.html#cb141-41" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb&quot; }</span></span>
<span id="cb141-42"><a href="reference-panel-1k-genome.html#cb141-42" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR {a[$1]; b[$1]=$2; c[$1]=$3; next}</span></span>
<span id="cb141-43"><a href="reference-panel-1k-genome.html#cb141-43" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $2, b[$1], c[$1], $3 }&#39;</span> <span class="va">$dir</span>/1kg-tmp <span class="va">$dir</span>/ukbb-tmp <span class="op">&gt;</span> <span class="va">$out</span> </span>
<span id="cb141-44"><a href="reference-panel-1k-genome.html#cb141-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-45"><a href="reference-panel-1k-genome.html#cb141-45" aria-hidden="true" tabindex="-1"></a><span class="co"># combine aver2 with ukbb phenotypes--------------------------------------------</span></span>
<span id="cb141-46"><a href="reference-panel-1k-genome.html#cb141-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-47"><a href="reference-panel-1k-genome.html#cb141-47" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ref-1kg/out-good-gwas</span>
<span id="cb141-48"><a href="reference-panel-1k-genome.html#cb141-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-49"><a href="reference-panel-1k-genome.html#cb141-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb141-50"><a href="reference-panel-1k-genome.html#cb141-50" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>unrelated/gwas-good/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb141-51"><a href="reference-panel-1k-genome.html#cb141-51" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>ref-1kg/aver2-good-gwas/1kg-ukbb.aver2</span>
<span id="cb141-52"><a href="reference-panel-1k-genome.html#cb141-52" aria-hidden="true" tabindex="-1"></a><span class="va">tmp</span><span class="op">=</span>ref-1kg/out-good-gwas/<span class="va">$trait</span>.tmp</span>
<span id="cb141-53"><a href="reference-panel-1k-genome.html#cb141-53" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-unrel-inds.ldscore</span>
<span id="cb141-54"><a href="reference-panel-1k-genome.html#cb141-54" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>ref-1kg/out-good-gwas/<span class="va">$trait</span>.out</span>
<span id="cb141-55"><a href="reference-panel-1k-genome.html#cb141-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-56"><a href="reference-panel-1k-genome.html#cb141-56" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb chisq&quot; }</span></span>
<span id="cb141-57"><a href="reference-panel-1k-genome.html#cb141-57" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR &amp;&amp; NR &gt; 1 {a[$1]; b[$1]=$5; next} </span></span>
<span id="cb141-58"><a href="reference-panel-1k-genome.html#cb141-58" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $0, b[$1]}&#39;</span> <span class="va">$gwas</span> <span class="va">$aver2</span><span class="op">&gt;</span> <span class="va">$tmp</span></span>
<span id="cb141-59"><a href="reference-panel-1k-genome.html#cb141-59" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb141-60"><a href="reference-panel-1k-genome.html#cb141-60" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb chisq ldsc&quot; }</span></span>
<span id="cb141-61"><a href="reference-panel-1k-genome.html#cb141-61" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb141-62"><a href="reference-panel-1k-genome.html#cb141-62" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $0, b[$1]}&#39;</span> <span class="va">$ldsc</span> <span class="va">$tmp</span> <span class="op">&gt;</span> <span class="va">$out</span></span>
<span id="cb141-63"><a href="reference-panel-1k-genome.html#cb141-63" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb141-64"><a href="reference-panel-1k-genome.html#cb141-64" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
</div>
<div id="detect-confounding" class="section level2" number="17.3">
<h2><span class="header-section-number">17.3</span> detect confounding</h2>
<div id="bad-gwas-2" class="section level3" number="17.3.1">
<h3><span class="header-section-number">17.3.1</span> bad gwas</h3>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="reference-panel-1k-genome.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot aver2 1kg vs. ukbb ------------------------------------------------------</span></span>
<span id="cb142-2"><a href="reference-panel-1k-genome.html#cb142-2" aria-hidden="true" tabindex="-1"></a>file<span class="ot">=</span><span class="st">&quot;ref-1kg/aver2/1kg-ukbb.aver2&quot;</span></span>
<span id="cb142-3"><a href="reference-panel-1k-genome.html#cb142-3" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">read.table</span>(file,<span class="at">stringsAsFactors =</span> F, <span class="at">header=</span>T)</span>
<span id="cb142-4"><a href="reference-panel-1k-genome.html#cb142-4" aria-hidden="true" tabindex="-1"></a>cor<span class="ot">=</span><span class="fu">round</span>(<span class="fu">cor</span>(dat<span class="sc">$</span>ref, dat<span class="sc">$</span>ukbb),<span class="dv">2</span>)<span class="co"># 0.6833908</span></span>
<span id="cb142-5"><a href="reference-panel-1k-genome.html#cb142-5" aria-hidden="true" tabindex="-1"></a>corx<span class="ot">=</span><span class="fu">min</span>(dat<span class="sc">$</span>ref)</span>
<span id="cb142-6"><a href="reference-panel-1k-genome.html#cb142-6" aria-hidden="true" tabindex="-1"></a>cory<span class="ot">=</span><span class="fu">max</span>(dat<span class="sc">$</span>ukbb)</span>
<span id="cb142-7"><a href="reference-panel-1k-genome.html#cb142-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-8"><a href="reference-panel-1k-genome.html#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation --------------------</span></span>
<span id="cb142-9"><a href="reference-panel-1k-genome.html#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/aver2-1kg-vs-ukbb.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb142-10"><a href="reference-panel-1k-genome.html#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb142-11"><a href="reference-panel-1k-genome.html#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>ref, dat<span class="sc">$</span>ukbb,</span>
<span id="cb142-12"><a href="reference-panel-1k-genome.html#cb142-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;1k genome&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ukbb&quot;</span>,</span>
<span id="cb142-13"><a href="reference-panel-1k-genome.html#cb142-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot; aver2&quot;</span>,</span>
<span id="cb142-14"><a href="reference-panel-1k-genome.html#cb142-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb142-15"><a href="reference-panel-1k-genome.html#cb142-15" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(corx, cory, <span class="fu">paste0</span>(<span class="st">&quot;r = &quot;</span>, cor), </span>
<span id="cb142-16"><a href="reference-panel-1k-genome.html#cb142-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb142-17"><a href="reference-panel-1k-genome.html#cb142-17" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb142-18"><a href="reference-panel-1k-genome.html#cb142-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-19"><a href="reference-panel-1k-genome.html#cb142-19" aria-hidden="true" tabindex="-1"></a><span class="co"># histograms of STANDARDIZED aver2 --------------------------------------------</span></span>
<span id="cb142-20"><a href="reference-panel-1k-genome.html#cb142-20" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/aver2-1kg-vs-ukbb-histogram.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb142-21"><a href="reference-panel-1k-genome.html#cb142-21" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>ref_std<span class="ot">=</span><span class="fu">scale</span>(dat<span class="sc">$</span>ref)</span>
<span id="cb142-22"><a href="reference-panel-1k-genome.html#cb142-22" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>ukbb_std<span class="ot">=</span><span class="fu">scale</span>(dat<span class="sc">$</span>ukbb)</span>
<span id="cb142-23"><a href="reference-panel-1k-genome.html#cb142-23" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb142-24"><a href="reference-panel-1k-genome.html#cb142-24" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="fu">min</span>(dat[,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb142-25"><a href="reference-panel-1k-genome.html#cb142-25" aria-hidden="true" tabindex="-1"></a>end<span class="ot">=</span><span class="fu">max</span>(dat[,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb142-26"><a href="reference-panel-1k-genome.html#cb142-26" aria-hidden="true" tabindex="-1"></a>hist1<span class="ot">=</span><span class="fu">hist</span>(dat<span class="sc">$</span>ref_std, <span class="at">freq=</span>F, </span>
<span id="cb142-27"><a href="reference-panel-1k-genome.html#cb142-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">211</span>,<span class="dv">211</span>,<span class="dv">211</span>, <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">180</span>),</span>
<span id="cb142-28"><a href="reference-panel-1k-genome.html#cb142-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">breaks=</span><span class="dv">100</span>, <span class="at">border=</span>F, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>),</span>
<span id="cb142-29"><a href="reference-panel-1k-genome.html#cb142-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlim=</span><span class="fu">c</span>(start,<span class="dv">5</span>))</span>
<span id="cb142-30"><a href="reference-panel-1k-genome.html#cb142-30" aria-hidden="true" tabindex="-1"></a>hist2<span class="ot">=</span><span class="fu">hist</span>(dat<span class="sc">$</span>ukbb_std, <span class="at">freq=</span>F,</span>
<span id="cb142-31"><a href="reference-panel-1k-genome.html#cb142-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">255</span>, <span class="dv">179</span>,<span class="dv">138</span>, <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">180</span>),</span>
<span id="cb142-32"><a href="reference-panel-1k-genome.html#cb142-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">breaks=</span><span class="dv">100</span>, <span class="at">border=</span>F, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>),</span>
<span id="cb142-33"><a href="reference-panel-1k-genome.html#cb142-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlim=</span><span class="fu">c</span>(start, <span class="dv">5</span>),</span>
<span id="cb142-34"><a href="reference-panel-1k-genome.html#cb142-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">add=</span>T)</span>
<span id="cb142-35"><a href="reference-panel-1k-genome.html#cb142-35" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb142-36"><a href="reference-panel-1k-genome.html#cb142-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-37"><a href="reference-panel-1k-genome.html#cb142-37" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2 1kg  ------------------------------------------------------</span></span>
<span id="cb142-38"><a href="reference-panel-1k-genome.html#cb142-38" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb142-39"><a href="reference-panel-1k-genome.html#cb142-39" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb142-40"><a href="reference-panel-1k-genome.html#cb142-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb142-41"><a href="reference-panel-1k-genome.html#cb142-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb142-42"><a href="reference-panel-1k-genome.html#cb142-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-43"><a href="reference-panel-1k-genome.html#cb142-43" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-bad-gwas-1kg-ref.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb142-44"><a href="reference-panel-1k-genome.html#cb142-44" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb142-45"><a href="reference-panel-1k-genome.html#cb142-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-46"><a href="reference-panel-1k-genome.html#cb142-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb142-47"><a href="reference-panel-1k-genome.html#cb142-47" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb142-48"><a href="reference-panel-1k-genome.html#cb142-48" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb142-49"><a href="reference-panel-1k-genome.html#cb142-49" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;ref&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)]</span>
<span id="cb142-50"><a href="reference-panel-1k-genome.html#cb142-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;aver2&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)</span>
<span id="cb142-51"><a href="reference-panel-1k-genome.html#cb142-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-52"><a href="reference-panel-1k-genome.html#cb142-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb142-53"><a href="reference-panel-1k-genome.html#cb142-53" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb142-54"><a href="reference-panel-1k-genome.html#cb142-54" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb142-55"><a href="reference-panel-1k-genome.html#cb142-55" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb142-56"><a href="reference-panel-1k-genome.html#cb142-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-57"><a href="reference-panel-1k-genome.html#cb142-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb142-58"><a href="reference-panel-1k-genome.html#cb142-58" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb142-59"><a href="reference-panel-1k-genome.html#cb142-59" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb142-60"><a href="reference-panel-1k-genome.html#cb142-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-61"><a href="reference-panel-1k-genome.html#cb142-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb142-62"><a href="reference-panel-1k-genome.html#cb142-62" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb142-63"><a href="reference-panel-1k-genome.html#cb142-63" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb142-64"><a href="reference-panel-1k-genome.html#cb142-64" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb142-65"><a href="reference-panel-1k-genome.html#cb142-65" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb142-66"><a href="reference-panel-1k-genome.html#cb142-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-67"><a href="reference-panel-1k-genome.html#cb142-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb142-68"><a href="reference-panel-1k-genome.html#cb142-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb142-69"><a href="reference-panel-1k-genome.html#cb142-69" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb142-70"><a href="reference-panel-1k-genome.html#cb142-70" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb142-71"><a href="reference-panel-1k-genome.html#cb142-71" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb142-72"><a href="reference-panel-1k-genome.html#cb142-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 ,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb142-73"><a href="reference-panel-1k-genome.html#cb142-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb142-74"><a href="reference-panel-1k-genome.html#cb142-74" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb142-75"><a href="reference-panel-1k-genome.html#cb142-75" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb142-76"><a href="reference-panel-1k-genome.html#cb142-76" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb142-77"><a href="reference-panel-1k-genome.html#cb142-77" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-78"><a href="reference-panel-1k-genome.html#cb142-78" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb142-79"><a href="reference-panel-1k-genome.html#cb142-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-80"><a href="reference-panel-1k-genome.html#cb142-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-81"><a href="reference-panel-1k-genome.html#cb142-81" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2 ukbb ------------------------------------------------------</span></span>
<span id="cb142-82"><a href="reference-panel-1k-genome.html#cb142-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-83"><a href="reference-panel-1k-genome.html#cb142-83" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb142-84"><a href="reference-panel-1k-genome.html#cb142-84" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb142-85"><a href="reference-panel-1k-genome.html#cb142-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb142-86"><a href="reference-panel-1k-genome.html#cb142-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb142-87"><a href="reference-panel-1k-genome.html#cb142-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-88"><a href="reference-panel-1k-genome.html#cb142-88" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-bad-gwas-ukbb.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb142-89"><a href="reference-panel-1k-genome.html#cb142-89" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb142-90"><a href="reference-panel-1k-genome.html#cb142-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-91"><a href="reference-panel-1k-genome.html#cb142-91" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb142-92"><a href="reference-panel-1k-genome.html#cb142-92" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb142-93"><a href="reference-panel-1k-genome.html#cb142-93" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb142-94"><a href="reference-panel-1k-genome.html#cb142-94" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;ukbb&quot;</span>,<span class="st">&quot;chisq&quot;</span>)]</span>
<span id="cb142-95"><a href="reference-panel-1k-genome.html#cb142-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;aver2&quot;</span>,<span class="st">&quot;chisq&quot;</span>)</span>
<span id="cb142-96"><a href="reference-panel-1k-genome.html#cb142-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-97"><a href="reference-panel-1k-genome.html#cb142-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb142-98"><a href="reference-panel-1k-genome.html#cb142-98" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat)</span>
<span id="cb142-99"><a href="reference-panel-1k-genome.html#cb142-99" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb142-100"><a href="reference-panel-1k-genome.html#cb142-100" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb142-101"><a href="reference-panel-1k-genome.html#cb142-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-102"><a href="reference-panel-1k-genome.html#cb142-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb142-103"><a href="reference-panel-1k-genome.html#cb142-103" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb142-104"><a href="reference-panel-1k-genome.html#cb142-104" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb142-105"><a href="reference-panel-1k-genome.html#cb142-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-106"><a href="reference-panel-1k-genome.html#cb142-106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb142-107"><a href="reference-panel-1k-genome.html#cb142-107" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb142-108"><a href="reference-panel-1k-genome.html#cb142-108" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb142-109"><a href="reference-panel-1k-genome.html#cb142-109" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb142-110"><a href="reference-panel-1k-genome.html#cb142-110" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb142-111"><a href="reference-panel-1k-genome.html#cb142-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-112"><a href="reference-panel-1k-genome.html#cb142-112" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb142-113"><a href="reference-panel-1k-genome.html#cb142-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb142-114"><a href="reference-panel-1k-genome.html#cb142-114" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb142-115"><a href="reference-panel-1k-genome.html#cb142-115" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb142-116"><a href="reference-panel-1k-genome.html#cb142-116" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb142-117"><a href="reference-panel-1k-genome.html#cb142-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(mod,<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb142-118"><a href="reference-panel-1k-genome.html#cb142-118" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb142-119"><a href="reference-panel-1k-genome.html#cb142-119" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb142-120"><a href="reference-panel-1k-genome.html#cb142-120" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb142-121"><a href="reference-panel-1k-genome.html#cb142-121" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb142-122"><a href="reference-panel-1k-genome.html#cb142-122" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-123"><a href="reference-panel-1k-genome.html#cb142-123" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb142-124"><a href="reference-panel-1k-genome.html#cb142-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-125"><a href="reference-panel-1k-genome.html#cb142-125" aria-hidden="true" tabindex="-1"></a><span class="co"># chisq ~ STANDARDIZED aver2 binned data----------------------------------------</span></span>
<span id="cb142-126"><a href="reference-panel-1k-genome.html#cb142-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-127"><a href="reference-panel-1k-genome.html#cb142-127" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb142-128"><a href="reference-panel-1k-genome.html#cb142-128" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb142-129"><a href="reference-panel-1k-genome.html#cb142-129" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb142-130"><a href="reference-panel-1k-genome.html#cb142-130" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb142-131"><a href="reference-panel-1k-genome.html#cb142-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-132"><a href="reference-panel-1k-genome.html#cb142-132" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-ukbb-vs-1kg.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb142-133"><a href="reference-panel-1k-genome.html#cb142-133" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb142-134"><a href="reference-panel-1k-genome.html#cb142-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-135"><a href="reference-panel-1k-genome.html#cb142-135" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb142-136"><a href="reference-panel-1k-genome.html#cb142-136" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb142-137"><a href="reference-panel-1k-genome.html#cb142-137" aria-hidden="true" tabindex="-1"></a>  bad<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb142-138"><a href="reference-panel-1k-genome.html#cb142-138" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">snp=</span>bad<span class="sc">$</span>ukbb_snp,</span>
<span id="cb142-139"><a href="reference-panel-1k-genome.html#cb142-139" aria-hidden="true" tabindex="-1"></a>                 <span class="at">aver2_ref=</span><span class="fu">scale</span>(bad<span class="sc">$</span>ref), <span class="co"># </span><span class="al">NOTE</span><span class="co">: aver2 is standardized</span></span>
<span id="cb142-140"><a href="reference-panel-1k-genome.html#cb142-140" aria-hidden="true" tabindex="-1"></a>                 <span class="at">aver2_ukbb=</span><span class="fu">scale</span>(bad<span class="sc">$</span>ukbb), <span class="co"># </span><span class="al">NOTE</span><span class="co">: aver2 is standardized</span></span>
<span id="cb142-141"><a href="reference-panel-1k-genome.html#cb142-141" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chisq=</span>bad<span class="sc">$</span>chisq, <span class="co"># chisq from the bad gwas</span></span>
<span id="cb142-142"><a href="reference-panel-1k-genome.html#cb142-142" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ldsc=</span>bad<span class="sc">$</span>ldsc)</span>
<span id="cb142-143"><a href="reference-panel-1k-genome.html#cb142-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-144"><a href="reference-panel-1k-genome.html#cb142-144" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb142-145"><a href="reference-panel-1k-genome.html#cb142-145" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2_ref <span class="sc">+</span> ldsc,<span class="at">data=</span>dat) <span class="co"># using aver2 from 1kg</span></span>
<span id="cb142-146"><a href="reference-panel-1k-genome.html#cb142-146" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2_ukbb <span class="sc">+</span> ldsc,<span class="at">data=</span>dat) <span class="co"># using aver2 from ukbb</span></span>
<span id="cb142-147"><a href="reference-panel-1k-genome.html#cb142-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-148"><a href="reference-panel-1k-genome.html#cb142-148" aria-hidden="true" tabindex="-1"></a>  <span class="co"># chisq hat</span></span>
<span id="cb142-149"><a href="reference-panel-1k-genome.html#cb142-149" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>predict_ref<span class="ot">=</span><span class="fu">predict</span>(mod1)</span>
<span id="cb142-150"><a href="reference-panel-1k-genome.html#cb142-150" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>predict_ukbb<span class="ot">=</span><span class="fu">predict</span>(mod2)</span>
<span id="cb142-151"><a href="reference-panel-1k-genome.html#cb142-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-152"><a href="reference-panel-1k-genome.html#cb142-152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb142-153"><a href="reference-panel-1k-genome.html#cb142-153" aria-hidden="true" tabindex="-1"></a>  cutoff1<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2_ref, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb142-154"><a href="reference-panel-1k-genome.html#cb142-154" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin1<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2_ref, <span class="at">breaks=</span>cutoff1, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff1)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb142-155"><a href="reference-panel-1k-genome.html#cb142-155" aria-hidden="true" tabindex="-1"></a>  cutoff2<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2_ukbb, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb142-156"><a href="reference-panel-1k-genome.html#cb142-156" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin2<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2_ukbb, <span class="at">breaks=</span>cutoff2, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff2)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb142-157"><a href="reference-panel-1k-genome.html#cb142-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-158"><a href="reference-panel-1k-genome.html#cb142-158" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb142-159"><a href="reference-panel-1k-genome.html#cb142-159" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ref=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin1, mean),</span>
<span id="cb142-160"><a href="reference-panel-1k-genome.html#cb142-160" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chisq_ukbb=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin2, mean),</span>
<span id="cb142-161"><a href="reference-panel-1k-genome.html#cb142-161" aria-hidden="true" tabindex="-1"></a>                 <span class="at">predict_ref=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>predict_ref,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin1, mean),</span>
<span id="cb142-162"><a href="reference-panel-1k-genome.html#cb142-162" aria-hidden="true" tabindex="-1"></a>                 <span class="at">predict_ukbb=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>predict_ukbb,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin2, mean))</span>
<span id="cb142-163"><a href="reference-panel-1k-genome.html#cb142-163" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_ref<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2_ref,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin1, mean)</span>
<span id="cb142-164"><a href="reference-panel-1k-genome.html#cb142-164" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_ukbb<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2_ukbb,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin2, mean)</span>
<span id="cb142-165"><a href="reference-panel-1k-genome.html#cb142-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-166"><a href="reference-panel-1k-genome.html#cb142-166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb142-167"><a href="reference-panel-1k-genome.html#cb142-167" aria-hidden="true" tabindex="-1"></a>  ystart<span class="ot">=</span><span class="fu">min</span>(out[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb142-168"><a href="reference-panel-1k-genome.html#cb142-168" aria-hidden="true" tabindex="-1"></a>  yend<span class="ot">=</span><span class="fu">max</span>(out[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb142-169"><a href="reference-panel-1k-genome.html#cb142-169" aria-hidden="true" tabindex="-1"></a>  xstart<span class="ot">=</span><span class="fu">min</span>(out[, <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb142-170"><a href="reference-panel-1k-genome.html#cb142-170" aria-hidden="true" tabindex="-1"></a>  xend<span class="ot">=</span><span class="fu">max</span>(out[,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb142-171"><a href="reference-panel-1k-genome.html#cb142-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-172"><a href="reference-panel-1k-genome.html#cb142-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_ukbb, out<span class="sc">$</span>chisq_ukbb,</span>
<span id="cb142-173"><a href="reference-panel-1k-genome.html#cb142-173" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>, <span class="at">xlab=</span><span class="st">&quot; standardized aver2 bin&quot;</span>,</span>
<span id="cb142-174"><a href="reference-panel-1k-genome.html#cb142-174" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(xstart, xend), <span class="at">ylim=</span><span class="fu">c</span>(ystart, yend),</span>
<span id="cb142-175"><a href="reference-panel-1k-genome.html#cb142-175" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;lightgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb142-176"><a href="reference-panel-1k-genome.html#cb142-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(out<span class="sc">$</span>bin_ref, out<span class="sc">$</span>chisq_ref, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb142-177"><a href="reference-panel-1k-genome.html#cb142-177" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span><span class="fu">rgb</span>(<span class="dv">255</span>, <span class="dv">179</span>, <span class="dv">138</span>, <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">200</span>), </span>
<span id="cb142-178"><a href="reference-panel-1k-genome.html#cb142-178" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb142-179"><a href="reference-panel-1k-genome.html#cb142-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(out<span class="sc">$</span>bin_ukbb, out<span class="sc">$</span>predict_ukbb, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;darkgrey&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb142-180"><a href="reference-panel-1k-genome.html#cb142-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(out<span class="sc">$</span>bin_ref, out<span class="sc">$</span>predict_ref, <span class="dv">1</span>, </span>
<span id="cb142-181"><a href="reference-panel-1k-genome.html#cb142-181" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="st">&quot;darkorange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb142-182"><a href="reference-panel-1k-genome.html#cb142-182" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-183"><a href="reference-panel-1k-genome.html#cb142-183" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-184"><a href="reference-panel-1k-genome.html#cb142-184" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb142-185"><a href="reference-panel-1k-genome.html#cb142-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-186"><a href="reference-panel-1k-genome.html#cb142-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-187"><a href="reference-panel-1k-genome.html#cb142-187" aria-hidden="true" tabindex="-1"></a><span class="co"># raw chisq ~ STANDARDIZED aver2------------------------------------------------</span></span>
<span id="cb142-188"><a href="reference-panel-1k-genome.html#cb142-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-189"><a href="reference-panel-1k-genome.html#cb142-189" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb142-190"><a href="reference-panel-1k-genome.html#cb142-190" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb142-191"><a href="reference-panel-1k-genome.html#cb142-191" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb142-192"><a href="reference-panel-1k-genome.html#cb142-192" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb142-193"><a href="reference-panel-1k-genome.html#cb142-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-194"><a href="reference-panel-1k-genome.html#cb142-194" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-ukbb-vs-1kg.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb142-195"><a href="reference-panel-1k-genome.html#cb142-195" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb142-196"><a href="reference-panel-1k-genome.html#cb142-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-197"><a href="reference-panel-1k-genome.html#cb142-197" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb142-198"><a href="reference-panel-1k-genome.html#cb142-198" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb142-199"><a href="reference-panel-1k-genome.html#cb142-199" aria-hidden="true" tabindex="-1"></a>  bad<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb142-200"><a href="reference-panel-1k-genome.html#cb142-200" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">snp=</span>bad<span class="sc">$</span>ukbb_snp,</span>
<span id="cb142-201"><a href="reference-panel-1k-genome.html#cb142-201" aria-hidden="true" tabindex="-1"></a>                 <span class="at">aver2_ref=</span><span class="fu">scale</span>(bad<span class="sc">$</span>ref), <span class="co"># </span><span class="al">NOTE</span><span class="co">: aver2 is standardized</span></span>
<span id="cb142-202"><a href="reference-panel-1k-genome.html#cb142-202" aria-hidden="true" tabindex="-1"></a>                 <span class="at">aver2_ukbb=</span><span class="fu">scale</span>(bad<span class="sc">$</span>ukbb), <span class="co"># </span><span class="al">NOTE</span><span class="co">: aver2 is standardized</span></span>
<span id="cb142-203"><a href="reference-panel-1k-genome.html#cb142-203" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chisq=</span>bad<span class="sc">$</span>chisq, <span class="co"># chisq from the bad gwas</span></span>
<span id="cb142-204"><a href="reference-panel-1k-genome.html#cb142-204" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ldsc=</span>bad<span class="sc">$</span>ldsc)</span>
<span id="cb142-205"><a href="reference-panel-1k-genome.html#cb142-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-206"><a href="reference-panel-1k-genome.html#cb142-206" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb142-207"><a href="reference-panel-1k-genome.html#cb142-207" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2_ref <span class="sc">+</span> ldsc,<span class="at">data=</span>dat) <span class="co"># using aver2 from 1kg</span></span>
<span id="cb142-208"><a href="reference-panel-1k-genome.html#cb142-208" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2_ukbb <span class="sc">+</span> ldsc,<span class="at">data=</span>dat) <span class="co"># using aver2 from ukbb</span></span>
<span id="cb142-209"><a href="reference-panel-1k-genome.html#cb142-209" aria-hidden="true" tabindex="-1"></a>  <span class="co"># chisq hat</span></span>
<span id="cb142-210"><a href="reference-panel-1k-genome.html#cb142-210" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>predict_ref<span class="ot">=</span><span class="fu">predict</span>(mod1)</span>
<span id="cb142-211"><a href="reference-panel-1k-genome.html#cb142-211" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>predict_ukbb<span class="ot">=</span><span class="fu">predict</span>(mod2)</span>
<span id="cb142-212"><a href="reference-panel-1k-genome.html#cb142-212" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-213"><a href="reference-panel-1k-genome.html#cb142-213" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb142-214"><a href="reference-panel-1k-genome.html#cb142-214" aria-hidden="true" tabindex="-1"></a>  ystart<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(dat<span class="sc">$</span>chisq,dat<span class="sc">$</span>predict_ref, dat<span class="sc">$</span>predict_ukbb))</span>
<span id="cb142-215"><a href="reference-panel-1k-genome.html#cb142-215" aria-hidden="true" tabindex="-1"></a>  yend<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(dat<span class="sc">$</span>chisq,dat<span class="sc">$</span>predict_ref, dat<span class="sc">$</span>predict_ukbb))</span>
<span id="cb142-216"><a href="reference-panel-1k-genome.html#cb142-216" aria-hidden="true" tabindex="-1"></a>  xstart<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(dat<span class="sc">$</span>aver2_ref, dat<span class="sc">$</span>aver2_ukbb))</span>
<span id="cb142-217"><a href="reference-panel-1k-genome.html#cb142-217" aria-hidden="true" tabindex="-1"></a>  xend<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(dat<span class="sc">$</span>aver2_ref, dat<span class="sc">$</span>aver2_ukbb))</span>
<span id="cb142-218"><a href="reference-panel-1k-genome.html#cb142-218" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-219"><a href="reference-panel-1k-genome.html#cb142-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(dat<span class="sc">$</span>aver2_ukbb, dat<span class="sc">$</span>chisq,</span>
<span id="cb142-220"><a href="reference-panel-1k-genome.html#cb142-220" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab=</span><span class="st">&quot;chisq&quot;</span>, <span class="at">xlab=</span><span class="st">&quot; standardized aver2&quot;</span>,</span>
<span id="cb142-221"><a href="reference-panel-1k-genome.html#cb142-221" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(xstart, xend), <span class="at">ylim=</span><span class="fu">c</span>(ystart, yend),</span>
<span id="cb142-222"><a href="reference-panel-1k-genome.html#cb142-222" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;lightgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb142-223"><a href="reference-panel-1k-genome.html#cb142-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(dat<span class="sc">$</span>aver2_ref, dat<span class="sc">$</span>chisq, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb142-224"><a href="reference-panel-1k-genome.html#cb142-224" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span><span class="fu">rgb</span>(<span class="dv">255</span>, <span class="dv">179</span>, <span class="dv">138</span>, <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">200</span>), </span>
<span id="cb142-225"><a href="reference-panel-1k-genome.html#cb142-225" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb142-226"><a href="reference-panel-1k-genome.html#cb142-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(dat<span class="sc">$</span>aver2_ukbb, dat<span class="sc">$</span>predict_ukbb, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;darkgrey&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb142-227"><a href="reference-panel-1k-genome.html#cb142-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(dat<span class="sc">$</span>aver2_ref, dat<span class="sc">$</span>predict_ref, <span class="dv">1</span>, </span>
<span id="cb142-228"><a href="reference-panel-1k-genome.html#cb142-228" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="st">&quot;darkorange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb142-229"><a href="reference-panel-1k-genome.html#cb142-229" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-230"><a href="reference-panel-1k-genome.html#cb142-230" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-231"><a href="reference-panel-1k-genome.html#cb142-231" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="varying-levels-of-confounding-1" class="section level3" number="17.3.2">
<h3><span class="header-section-number">17.3.2</span> varying levels of confounding</h3>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="reference-panel-1k-genome.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot aver2 1kg vs. ukbb ------------------------------------------------------</span></span>
<span id="cb143-2"><a href="reference-panel-1k-genome.html#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="reference-panel-1k-genome.html#cb143-3" aria-hidden="true" tabindex="-1"></a>n_noneuro<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0k&quot;</span>,<span class="st">&quot;1k&quot;</span>, <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span>)</span>
<span id="cb143-4"><a href="reference-panel-1k-genome.html#cb143-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-5"><a href="reference-panel-1k-genome.html#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/aver2-1kg-vs-ukbb-varying-noneuro.png&quot;</span>, </span>
<span id="cb143-6"><a href="reference-panel-1k-genome.html#cb143-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">40</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb143-7"><a href="reference-panel-1k-genome.html#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb143-8"><a href="reference-panel-1k-genome.html#cb143-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-9"><a href="reference-panel-1k-genome.html#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> n_noneuro){</span>
<span id="cb143-10"><a href="reference-panel-1k-genome.html#cb143-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-11"><a href="reference-panel-1k-genome.html#cb143-11" aria-hidden="true" tabindex="-1"></a>file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/aver2-&quot;</span>,i,<span class="st">&quot;-noneuro/1kg-ukbb.aver2&quot;</span>)</span>
<span id="cb143-12"><a href="reference-panel-1k-genome.html#cb143-12" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">read.table</span>(file,<span class="at">stringsAsFactors =</span> F, <span class="at">header=</span>T)</span>
<span id="cb143-13"><a href="reference-panel-1k-genome.html#cb143-13" aria-hidden="true" tabindex="-1"></a>cor<span class="ot">=</span><span class="fu">round</span>(<span class="fu">cor</span>(dat<span class="sc">$</span>ref, dat<span class="sc">$</span>ukbb),<span class="dv">2</span>)</span>
<span id="cb143-14"><a href="reference-panel-1k-genome.html#cb143-14" aria-hidden="true" tabindex="-1"></a>corx<span class="ot">=</span><span class="fu">min</span>(dat<span class="sc">$</span>ref)</span>
<span id="cb143-15"><a href="reference-panel-1k-genome.html#cb143-15" aria-hidden="true" tabindex="-1"></a>cory<span class="ot">=</span><span class="fu">max</span>(dat<span class="sc">$</span>ukbb)</span>
<span id="cb143-16"><a href="reference-panel-1k-genome.html#cb143-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-17"><a href="reference-panel-1k-genome.html#cb143-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>ref, dat<span class="sc">$</span>ukbb,</span>
<span id="cb143-18"><a href="reference-panel-1k-genome.html#cb143-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;1k genome&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ukbb&quot;</span>,</span>
<span id="cb143-19"><a href="reference-panel-1k-genome.html#cb143-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&quot;aver2 &quot;</span>, i,<span class="st">&quot; noneuropean&quot;</span>),</span>
<span id="cb143-20"><a href="reference-panel-1k-genome.html#cb143-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb143-21"><a href="reference-panel-1k-genome.html#cb143-21" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(corx, cory, <span class="fu">paste0</span>(<span class="st">&quot;r = &quot;</span>, cor), </span>
<span id="cb143-22"><a href="reference-panel-1k-genome.html#cb143-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb143-23"><a href="reference-panel-1k-genome.html#cb143-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb143-24"><a href="reference-panel-1k-genome.html#cb143-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-25"><a href="reference-panel-1k-genome.html#cb143-25" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb143-26"><a href="reference-panel-1k-genome.html#cb143-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-27"><a href="reference-panel-1k-genome.html#cb143-27" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2 1kg  ------------------------------------------------------</span></span>
<span id="cb143-28"><a href="reference-panel-1k-genome.html#cb143-28" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb143-29"><a href="reference-panel-1k-genome.html#cb143-29" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb143-30"><a href="reference-panel-1k-genome.html#cb143-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb143-31"><a href="reference-panel-1k-genome.html#cb143-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb143-32"><a href="reference-panel-1k-genome.html#cb143-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-33"><a href="reference-panel-1k-genome.html#cb143-33" aria-hidden="true" tabindex="-1"></a>n_noneuro<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0k&quot;</span>,<span class="st">&quot;1k&quot;</span>, <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span>)</span>
<span id="cb143-34"><a href="reference-panel-1k-genome.html#cb143-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-35"><a href="reference-panel-1k-genome.html#cb143-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> n_noneuro){</span>
<span id="cb143-36"><a href="reference-panel-1k-genome.html#cb143-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-37"><a href="reference-panel-1k-genome.html#cb143-37" aria-hidden="true" tabindex="-1"></a>plotnm<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-aver2-bin-bad-gwas-&quot;</span>, j,<span class="st">&quot;-noneuro-1kg-ref.png&quot;</span>)</span>
<span id="cb143-38"><a href="reference-panel-1k-genome.html#cb143-38" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(plotnm, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb143-39"><a href="reference-panel-1k-genome.html#cb143-39" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb143-40"><a href="reference-panel-1k-genome.html#cb143-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-41"><a href="reference-panel-1k-genome.html#cb143-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb143-42"><a href="reference-panel-1k-genome.html#cb143-42" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb143-43"><a href="reference-panel-1k-genome.html#cb143-43" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out-&quot;</span>,j ,<span class="st">&quot;-noneuro/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb143-44"><a href="reference-panel-1k-genome.html#cb143-44" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;ref&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)]</span>
<span id="cb143-45"><a href="reference-panel-1k-genome.html#cb143-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;aver2&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)</span>
<span id="cb143-46"><a href="reference-panel-1k-genome.html#cb143-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-47"><a href="reference-panel-1k-genome.html#cb143-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb143-48"><a href="reference-panel-1k-genome.html#cb143-48" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb143-49"><a href="reference-panel-1k-genome.html#cb143-49" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb143-50"><a href="reference-panel-1k-genome.html#cb143-50" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb143-51"><a href="reference-panel-1k-genome.html#cb143-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-52"><a href="reference-panel-1k-genome.html#cb143-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb143-53"><a href="reference-panel-1k-genome.html#cb143-53" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb143-54"><a href="reference-panel-1k-genome.html#cb143-54" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb143-55"><a href="reference-panel-1k-genome.html#cb143-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-56"><a href="reference-panel-1k-genome.html#cb143-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb143-57"><a href="reference-panel-1k-genome.html#cb143-57" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb143-58"><a href="reference-panel-1k-genome.html#cb143-58" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb143-59"><a href="reference-panel-1k-genome.html#cb143-59" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb143-60"><a href="reference-panel-1k-genome.html#cb143-60" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb143-61"><a href="reference-panel-1k-genome.html#cb143-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-62"><a href="reference-panel-1k-genome.html#cb143-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb143-63"><a href="reference-panel-1k-genome.html#cb143-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb143-64"><a href="reference-panel-1k-genome.html#cb143-64" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb143-65"><a href="reference-panel-1k-genome.html#cb143-65" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb143-66"><a href="reference-panel-1k-genome.html#cb143-66" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb143-67"><a href="reference-panel-1k-genome.html#cb143-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb143-68"><a href="reference-panel-1k-genome.html#cb143-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb143-69"><a href="reference-panel-1k-genome.html#cb143-69" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb143-70"><a href="reference-panel-1k-genome.html#cb143-70" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb143-71"><a href="reference-panel-1k-genome.html#cb143-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb143-72"><a href="reference-panel-1k-genome.html#cb143-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb143-73"><a href="reference-panel-1k-genome.html#cb143-73" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb143-74"><a href="reference-panel-1k-genome.html#cb143-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb143-75"><a href="reference-panel-1k-genome.html#cb143-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-76"><a href="reference-panel-1k-genome.html#cb143-76" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2 ukbb ------------------------------------------------------</span></span>
<span id="cb143-77"><a href="reference-panel-1k-genome.html#cb143-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-78"><a href="reference-panel-1k-genome.html#cb143-78" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb143-79"><a href="reference-panel-1k-genome.html#cb143-79" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb143-80"><a href="reference-panel-1k-genome.html#cb143-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb143-81"><a href="reference-panel-1k-genome.html#cb143-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb143-82"><a href="reference-panel-1k-genome.html#cb143-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-83"><a href="reference-panel-1k-genome.html#cb143-83" aria-hidden="true" tabindex="-1"></a>n_noneuro<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0k&quot;</span>,<span class="st">&quot;1k&quot;</span>, <span class="st">&quot;2k&quot;</span>, <span class="st">&quot;3k&quot;</span>, <span class="st">&quot;4k&quot;</span>, <span class="st">&quot;5k&quot;</span>, <span class="st">&quot;6k&quot;</span>)</span>
<span id="cb143-84"><a href="reference-panel-1k-genome.html#cb143-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-85"><a href="reference-panel-1k-genome.html#cb143-85" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> n_noneuro){</span>
<span id="cb143-86"><a href="reference-panel-1k-genome.html#cb143-86" aria-hidden="true" tabindex="-1"></a>plotnm<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-aver2-bin-bad-gwas-&quot;</span>, j,<span class="st">&quot;-noneuro-ukbb.png&quot;</span>)</span>
<span id="cb143-87"><a href="reference-panel-1k-genome.html#cb143-87" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(plotnm, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb143-88"><a href="reference-panel-1k-genome.html#cb143-88" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb143-89"><a href="reference-panel-1k-genome.html#cb143-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-90"><a href="reference-panel-1k-genome.html#cb143-90" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb143-91"><a href="reference-panel-1k-genome.html#cb143-91" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb143-92"><a href="reference-panel-1k-genome.html#cb143-92" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out-&quot;</span>,j,<span class="st">&quot;-noneuro/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb143-93"><a href="reference-panel-1k-genome.html#cb143-93" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;ukbb&quot;</span>,<span class="st">&quot;chisq&quot;</span>)]</span>
<span id="cb143-94"><a href="reference-panel-1k-genome.html#cb143-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;aver2&quot;</span>,<span class="st">&quot;chisq&quot;</span>)</span>
<span id="cb143-95"><a href="reference-panel-1k-genome.html#cb143-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-96"><a href="reference-panel-1k-genome.html#cb143-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb143-97"><a href="reference-panel-1k-genome.html#cb143-97" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat)</span>
<span id="cb143-98"><a href="reference-panel-1k-genome.html#cb143-98" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb143-99"><a href="reference-panel-1k-genome.html#cb143-99" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb143-100"><a href="reference-panel-1k-genome.html#cb143-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-101"><a href="reference-panel-1k-genome.html#cb143-101" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb143-102"><a href="reference-panel-1k-genome.html#cb143-102" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb143-103"><a href="reference-panel-1k-genome.html#cb143-103" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb143-104"><a href="reference-panel-1k-genome.html#cb143-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-105"><a href="reference-panel-1k-genome.html#cb143-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb143-106"><a href="reference-panel-1k-genome.html#cb143-106" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb143-107"><a href="reference-panel-1k-genome.html#cb143-107" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb143-108"><a href="reference-panel-1k-genome.html#cb143-108" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb143-109"><a href="reference-panel-1k-genome.html#cb143-109" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb143-110"><a href="reference-panel-1k-genome.html#cb143-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-111"><a href="reference-panel-1k-genome.html#cb143-111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb143-112"><a href="reference-panel-1k-genome.html#cb143-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb143-113"><a href="reference-panel-1k-genome.html#cb143-113" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb143-114"><a href="reference-panel-1k-genome.html#cb143-114" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb143-115"><a href="reference-panel-1k-genome.html#cb143-115" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb143-116"><a href="reference-panel-1k-genome.html#cb143-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(mod,<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb143-117"><a href="reference-panel-1k-genome.html#cb143-117" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb143-118"><a href="reference-panel-1k-genome.html#cb143-118" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb143-119"><a href="reference-panel-1k-genome.html#cb143-119" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb143-120"><a href="reference-panel-1k-genome.html#cb143-120" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb143-121"><a href="reference-panel-1k-genome.html#cb143-121" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb143-122"><a href="reference-panel-1k-genome.html#cb143-122" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb143-123"><a href="reference-panel-1k-genome.html#cb143-123" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="good-gwas-2" class="section level3" number="17.3.3">
<h3><span class="header-section-number">17.3.3</span> good gwas</h3>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="reference-panel-1k-genome.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot aver2 1kg vs. ukbb ------------------------------------------------------</span></span>
<span id="cb144-2"><a href="reference-panel-1k-genome.html#cb144-2" aria-hidden="true" tabindex="-1"></a>file<span class="ot">=</span><span class="st">&quot;ref-1kg/aver2-good-gwas/1kg-ukbb.aver2&quot;</span></span>
<span id="cb144-3"><a href="reference-panel-1k-genome.html#cb144-3" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">read.table</span>(file,<span class="at">stringsAsFactors =</span> F, <span class="at">header=</span>T)</span>
<span id="cb144-4"><a href="reference-panel-1k-genome.html#cb144-4" aria-hidden="true" tabindex="-1"></a>cor<span class="ot">=</span><span class="fu">round</span>(<span class="fu">cor</span>(dat<span class="sc">$</span>ref, dat<span class="sc">$</span>ukbb),<span class="dv">2</span>)</span>
<span id="cb144-5"><a href="reference-panel-1k-genome.html#cb144-5" aria-hidden="true" tabindex="-1"></a>corx<span class="ot">=</span><span class="fu">min</span>(dat<span class="sc">$</span>ref)</span>
<span id="cb144-6"><a href="reference-panel-1k-genome.html#cb144-6" aria-hidden="true" tabindex="-1"></a>cory<span class="ot">=</span><span class="fu">max</span>(dat<span class="sc">$</span>ukbb)</span>
<span id="cb144-7"><a href="reference-panel-1k-genome.html#cb144-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-8"><a href="reference-panel-1k-genome.html#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/aver2-1kg-vs-ukbb-good-gwas.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb144-9"><a href="reference-panel-1k-genome.html#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb144-10"><a href="reference-panel-1k-genome.html#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>ref, dat<span class="sc">$</span>ukbb,</span>
<span id="cb144-11"><a href="reference-panel-1k-genome.html#cb144-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;1k genome&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ukbb&quot;</span>,</span>
<span id="cb144-12"><a href="reference-panel-1k-genome.html#cb144-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot; aver2&quot;</span>,</span>
<span id="cb144-13"><a href="reference-panel-1k-genome.html#cb144-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb144-14"><a href="reference-panel-1k-genome.html#cb144-14" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(corx, cory, <span class="fu">paste0</span>(<span class="st">&quot;r = &quot;</span>, cor), </span>
<span id="cb144-15"><a href="reference-panel-1k-genome.html#cb144-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb144-16"><a href="reference-panel-1k-genome.html#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb144-17"><a href="reference-panel-1k-genome.html#cb144-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-18"><a href="reference-panel-1k-genome.html#cb144-18" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2 1kg  ------------------------------------------------------</span></span>
<span id="cb144-19"><a href="reference-panel-1k-genome.html#cb144-19" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb144-20"><a href="reference-panel-1k-genome.html#cb144-20" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb144-21"><a href="reference-panel-1k-genome.html#cb144-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb144-22"><a href="reference-panel-1k-genome.html#cb144-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb144-23"><a href="reference-panel-1k-genome.html#cb144-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-24"><a href="reference-panel-1k-genome.html#cb144-24" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-good-gwas-1kg-ref.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb144-25"><a href="reference-panel-1k-genome.html#cb144-25" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb144-26"><a href="reference-panel-1k-genome.html#cb144-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-27"><a href="reference-panel-1k-genome.html#cb144-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb144-28"><a href="reference-panel-1k-genome.html#cb144-28" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb144-29"><a href="reference-panel-1k-genome.html#cb144-29" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out-good-gwas/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb144-30"><a href="reference-panel-1k-genome.html#cb144-30" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;ref&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)]</span>
<span id="cb144-31"><a href="reference-panel-1k-genome.html#cb144-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;aver2&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)</span>
<span id="cb144-32"><a href="reference-panel-1k-genome.html#cb144-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-33"><a href="reference-panel-1k-genome.html#cb144-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb144-34"><a href="reference-panel-1k-genome.html#cb144-34" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb144-35"><a href="reference-panel-1k-genome.html#cb144-35" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb144-36"><a href="reference-panel-1k-genome.html#cb144-36" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb144-37"><a href="reference-panel-1k-genome.html#cb144-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-38"><a href="reference-panel-1k-genome.html#cb144-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb144-39"><a href="reference-panel-1k-genome.html#cb144-39" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb144-40"><a href="reference-panel-1k-genome.html#cb144-40" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb144-41"><a href="reference-panel-1k-genome.html#cb144-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-42"><a href="reference-panel-1k-genome.html#cb144-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb144-43"><a href="reference-panel-1k-genome.html#cb144-43" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb144-44"><a href="reference-panel-1k-genome.html#cb144-44" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb144-45"><a href="reference-panel-1k-genome.html#cb144-45" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb144-46"><a href="reference-panel-1k-genome.html#cb144-46" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb144-47"><a href="reference-panel-1k-genome.html#cb144-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-48"><a href="reference-panel-1k-genome.html#cb144-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb144-49"><a href="reference-panel-1k-genome.html#cb144-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb144-50"><a href="reference-panel-1k-genome.html#cb144-50" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb144-51"><a href="reference-panel-1k-genome.html#cb144-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb144-52"><a href="reference-panel-1k-genome.html#cb144-52" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb144-53"><a href="reference-panel-1k-genome.html#cb144-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb144-54"><a href="reference-panel-1k-genome.html#cb144-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb144-55"><a href="reference-panel-1k-genome.html#cb144-55" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb144-56"><a href="reference-panel-1k-genome.html#cb144-56" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb144-57"><a href="reference-panel-1k-genome.html#cb144-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb144-58"><a href="reference-panel-1k-genome.html#cb144-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-59"><a href="reference-panel-1k-genome.html#cb144-59" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb144-60"><a href="reference-panel-1k-genome.html#cb144-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-61"><a href="reference-panel-1k-genome.html#cb144-61" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2 ukbb ------------------------------------------------------</span></span>
<span id="cb144-62"><a href="reference-panel-1k-genome.html#cb144-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-63"><a href="reference-panel-1k-genome.html#cb144-63" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb144-64"><a href="reference-panel-1k-genome.html#cb144-64" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb144-65"><a href="reference-panel-1k-genome.html#cb144-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb144-66"><a href="reference-panel-1k-genome.html#cb144-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb144-67"><a href="reference-panel-1k-genome.html#cb144-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-68"><a href="reference-panel-1k-genome.html#cb144-68" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/chisq-aver2-bin-good-gwas-ukbb.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb144-69"><a href="reference-panel-1k-genome.html#cb144-69" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb144-70"><a href="reference-panel-1k-genome.html#cb144-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-71"><a href="reference-panel-1k-genome.html#cb144-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb144-72"><a href="reference-panel-1k-genome.html#cb144-72" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb144-73"><a href="reference-panel-1k-genome.html#cb144-73" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out-good-gwas/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb144-74"><a href="reference-panel-1k-genome.html#cb144-74" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;ukbb&quot;</span>,<span class="st">&quot;chisq&quot;</span>)]</span>
<span id="cb144-75"><a href="reference-panel-1k-genome.html#cb144-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;aver2&quot;</span>,<span class="st">&quot;chisq&quot;</span>)</span>
<span id="cb144-76"><a href="reference-panel-1k-genome.html#cb144-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-77"><a href="reference-panel-1k-genome.html#cb144-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb144-78"><a href="reference-panel-1k-genome.html#cb144-78" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat)</span>
<span id="cb144-79"><a href="reference-panel-1k-genome.html#cb144-79" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb144-80"><a href="reference-panel-1k-genome.html#cb144-80" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb144-81"><a href="reference-panel-1k-genome.html#cb144-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-82"><a href="reference-panel-1k-genome.html#cb144-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb144-83"><a href="reference-panel-1k-genome.html#cb144-83" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb144-84"><a href="reference-panel-1k-genome.html#cb144-84" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb144-85"><a href="reference-panel-1k-genome.html#cb144-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-86"><a href="reference-panel-1k-genome.html#cb144-86" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb144-87"><a href="reference-panel-1k-genome.html#cb144-87" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb144-88"><a href="reference-panel-1k-genome.html#cb144-88" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb144-89"><a href="reference-panel-1k-genome.html#cb144-89" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb144-90"><a href="reference-panel-1k-genome.html#cb144-90" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb144-91"><a href="reference-panel-1k-genome.html#cb144-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-92"><a href="reference-panel-1k-genome.html#cb144-92" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb144-93"><a href="reference-panel-1k-genome.html#cb144-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb144-94"><a href="reference-panel-1k-genome.html#cb144-94" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb144-95"><a href="reference-panel-1k-genome.html#cb144-95" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb144-96"><a href="reference-panel-1k-genome.html#cb144-96" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb144-97"><a href="reference-panel-1k-genome.html#cb144-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(mod,<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb144-98"><a href="reference-panel-1k-genome.html#cb144-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb144-99"><a href="reference-panel-1k-genome.html#cb144-99" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb144-100"><a href="reference-panel-1k-genome.html#cb144-100" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb144-101"><a href="reference-panel-1k-genome.html#cb144-101" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb144-102"><a href="reference-panel-1k-genome.html#cb144-102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-103"><a href="reference-panel-1k-genome.html#cb144-103" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
</div>
<div id="estimate-inflation" class="section level2" number="17.4">
<h2><span class="header-section-number">17.4</span> estimate inflation</h2>
<p>Here we want to estimate inflation using aver2 computed from 1k genome and compare that with aver2 computed from UKBB. We observed that the aver2 values from 1k genome are larger than those from UKBB, although the correlation is strong (~0.6). Here we want to check if the difference in the absolute values of aver2 affects the estimation of inflation. Inflation is under-estimated when using aver2 from 1kg.</p>
<p>Note we standardized aver2 so that inflation~aver2_ukbb &amp; inflation ~ aver2_ref can be plotted side by side.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="reference-panel-1k-genome.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimated inflation: 1k genome vs. ukbb --------------------------------------</span></span>
<span id="cb145-2"><a href="reference-panel-1k-genome.html#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get transparent colors</span></span>
<span id="cb145-3"><a href="reference-panel-1k-genome.html#cb145-3" aria-hidden="true" tabindex="-1"></a>colmat<span class="ot">=</span><span class="fu">col2rgb</span>(<span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>, <span class="st">&quot;powderblue&quot;</span>))</span>
<span id="cb145-4"><a href="reference-panel-1k-genome.html#cb145-4" aria-hidden="true" tabindex="-1"></a>mycol1<span class="ot">=</span><span class="fu">rgb</span>(colmat[<span class="dv">1</span>,<span class="dv">1</span>], colmat[<span class="dv">2</span>,<span class="dv">1</span>], colmat[<span class="dv">3</span>,<span class="dv">1</span>], <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">200</span>)</span>
<span id="cb145-5"><a href="reference-panel-1k-genome.html#cb145-5" aria-hidden="true" tabindex="-1"></a>mycol2<span class="ot">=</span><span class="fu">rgb</span>(colmat[<span class="dv">1</span>,<span class="dv">2</span>], colmat[<span class="dv">2</span>,<span class="dv">2</span>], colmat[<span class="dv">3</span>,<span class="dv">2</span>], <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">200</span>)</span>
<span id="cb145-6"><a href="reference-panel-1k-genome.html#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb145-7"><a href="reference-panel-1k-genome.html#cb145-7" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb145-8"><a href="reference-panel-1k-genome.html#cb145-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb145-9"><a href="reference-panel-1k-genome.html#cb145-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb145-10"><a href="reference-panel-1k-genome.html#cb145-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-11"><a href="reference-panel-1k-genome.html#cb145-11" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/inflation-hat-ukbb-vs-1kg.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb145-12"><a href="reference-panel-1k-genome.html#cb145-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb145-13"><a href="reference-panel-1k-genome.html#cb145-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-14"><a href="reference-panel-1k-genome.html#cb145-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb145-15"><a href="reference-panel-1k-genome.html#cb145-15" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb145-16"><a href="reference-panel-1k-genome.html#cb145-16" aria-hidden="true" tabindex="-1"></a>  bad<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb145-17"><a href="reference-panel-1k-genome.html#cb145-17" aria-hidden="true" tabindex="-1"></a>  good<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out-good-gwas/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb145-18"><a href="reference-panel-1k-genome.html#cb145-18" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(good<span class="sc">$</span>ukbb_snp, bad<span class="sc">$</span>ukbb_snp)</span>
<span id="cb145-19"><a href="reference-panel-1k-genome.html#cb145-19" aria-hidden="true" tabindex="-1"></a>  bad<span class="ot">=</span>bad[m,] <span class="co"># align good and bad gwas data</span></span>
<span id="cb145-20"><a href="reference-panel-1k-genome.html#cb145-20" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">snp=</span>good<span class="sc">$</span>ukbb_snp,</span>
<span id="cb145-21"><a href="reference-panel-1k-genome.html#cb145-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inflation=</span>bad<span class="sc">$</span>chisq<span class="sc">-</span>good<span class="sc">$</span>chisq,</span>
<span id="cb145-22"><a href="reference-panel-1k-genome.html#cb145-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">aver2_ref=</span>bad<span class="sc">$</span>ref,</span>
<span id="cb145-23"><a href="reference-panel-1k-genome.html#cb145-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">aver2_ukbb=</span>bad<span class="sc">$</span>ukbb,</span>
<span id="cb145-24"><a href="reference-panel-1k-genome.html#cb145-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chisq=</span>bad<span class="sc">$</span>chisq, <span class="co"># chisq from the bad gwas</span></span>
<span id="cb145-25"><a href="reference-panel-1k-genome.html#cb145-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ldsc=</span>good<span class="sc">$</span>ldsc)</span>
<span id="cb145-26"><a href="reference-panel-1k-genome.html#cb145-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-27"><a href="reference-panel-1k-genome.html#cb145-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb145-28"><a href="reference-panel-1k-genome.html#cb145-28" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2_ref <span class="sc">+</span> ldsc,<span class="at">data=</span>dat) <span class="co"># using aver2 from 1kg</span></span>
<span id="cb145-29"><a href="reference-panel-1k-genome.html#cb145-29" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2_ukbb <span class="sc">+</span> ldsc,<span class="at">data=</span>dat) <span class="co"># using aver2 from ukbb</span></span>
<span id="cb145-30"><a href="reference-panel-1k-genome.html#cb145-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-31"><a href="reference-panel-1k-genome.html#cb145-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inflation hat</span></span>
<span id="cb145-32"><a href="reference-panel-1k-genome.html#cb145-32" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>inflation_ref<span class="ot">=</span>mod1<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod1<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dat<span class="sc">$</span>aver2_ref<span class="dv">-1</span></span>
<span id="cb145-33"><a href="reference-panel-1k-genome.html#cb145-33" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>inflation_ukbb<span class="ot">=</span>mod2<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod2<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dat<span class="sc">$</span>aver2_ukbb<span class="dv">-1</span></span>
<span id="cb145-34"><a href="reference-panel-1k-genome.html#cb145-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb145-35"><a href="reference-panel-1k-genome.html#cb145-35" aria-hidden="true" tabindex="-1"></a>  start<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(dat<span class="sc">$</span>inflation,dat<span class="sc">$</span>inflation_ref, dat<span class="sc">$</span>inflation_ukbb))</span>
<span id="cb145-36"><a href="reference-panel-1k-genome.html#cb145-36" aria-hidden="true" tabindex="-1"></a>  end<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(dat<span class="sc">$</span>inflation,dat<span class="sc">$</span>inflation_ref, dat<span class="sc">$</span>inflation_ukbb))</span>
<span id="cb145-37"><a href="reference-panel-1k-genome.html#cb145-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-38"><a href="reference-panel-1k-genome.html#cb145-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(dat<span class="sc">$</span>inflation, dat<span class="sc">$</span>inflation_ukbb,</span>
<span id="cb145-39"><a href="reference-panel-1k-genome.html#cb145-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;inflation&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;inflation_hat&quot;</span>,</span>
<span id="cb145-40"><a href="reference-panel-1k-genome.html#cb145-40" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb145-41"><a href="reference-panel-1k-genome.html#cb145-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlim=</span><span class="fu">c</span>(start, end), <span class="at">ylim=</span><span class="fu">c</span>(start,end),</span>
<span id="cb145-42"><a href="reference-panel-1k-genome.html#cb145-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span>mycol1, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb145-43"><a href="reference-panel-1k-genome.html#cb145-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(dat<span class="sc">$</span>inflation, dat<span class="sc">$</span>inflation_ref, <span class="at">cex =</span> <span class="fl">1.5</span>, </span>
<span id="cb145-44"><a href="reference-panel-1k-genome.html#cb145-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span>mycol2, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb145-45"><a href="reference-panel-1k-genome.html#cb145-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb145-46"><a href="reference-panel-1k-genome.html#cb145-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb145-47"><a href="reference-panel-1k-genome.html#cb145-47" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb145-48"><a href="reference-panel-1k-genome.html#cb145-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-49"><a href="reference-panel-1k-genome.html#cb145-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-50"><a href="reference-panel-1k-genome.html#cb145-50" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation ~ STANDARDIZED aver2 raw --------------------------------------------</span></span>
<span id="cb145-51"><a href="reference-panel-1k-genome.html#cb145-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-52"><a href="reference-panel-1k-genome.html#cb145-52" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb145-53"><a href="reference-panel-1k-genome.html#cb145-53" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb145-54"><a href="reference-panel-1k-genome.html#cb145-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb145-55"><a href="reference-panel-1k-genome.html#cb145-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb145-56"><a href="reference-panel-1k-genome.html#cb145-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-57"><a href="reference-panel-1k-genome.html#cb145-57" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/inflation-aver2-ukbb-vs-1kg.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb145-58"><a href="reference-panel-1k-genome.html#cb145-58" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb145-59"><a href="reference-panel-1k-genome.html#cb145-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-60"><a href="reference-panel-1k-genome.html#cb145-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb145-61"><a href="reference-panel-1k-genome.html#cb145-61" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb145-62"><a href="reference-panel-1k-genome.html#cb145-62" aria-hidden="true" tabindex="-1"></a>  bad<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb145-63"><a href="reference-panel-1k-genome.html#cb145-63" aria-hidden="true" tabindex="-1"></a>  good<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out-good-gwas/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb145-64"><a href="reference-panel-1k-genome.html#cb145-64" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(good<span class="sc">$</span>ukbb_snp, bad<span class="sc">$</span>ukbb_snp)</span>
<span id="cb145-65"><a href="reference-panel-1k-genome.html#cb145-65" aria-hidden="true" tabindex="-1"></a>  bad<span class="ot">=</span>bad[m,] <span class="co"># align good and bad gwas data</span></span>
<span id="cb145-66"><a href="reference-panel-1k-genome.html#cb145-66" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">snp=</span>good<span class="sc">$</span>ukbb_snp,</span>
<span id="cb145-67"><a href="reference-panel-1k-genome.html#cb145-67" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inflation=</span>bad<span class="sc">$</span>chisq<span class="sc">-</span>good<span class="sc">$</span>chisq,</span>
<span id="cb145-68"><a href="reference-panel-1k-genome.html#cb145-68" aria-hidden="true" tabindex="-1"></a>                 <span class="at">aver2_ref=</span><span class="fu">scale</span>(bad<span class="sc">$</span>ref), <span class="co"># </span><span class="al">NOTE</span><span class="co">: aver2 is standardized</span></span>
<span id="cb145-69"><a href="reference-panel-1k-genome.html#cb145-69" aria-hidden="true" tabindex="-1"></a>                 <span class="at">aver2_ukbb=</span><span class="fu">scale</span>(bad<span class="sc">$</span>ukbb), <span class="co"># </span><span class="al">NOTE</span><span class="co">: aver2 is standardized</span></span>
<span id="cb145-70"><a href="reference-panel-1k-genome.html#cb145-70" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chisq=</span>bad<span class="sc">$</span>chisq, <span class="co"># chisq from the bad gwas</span></span>
<span id="cb145-71"><a href="reference-panel-1k-genome.html#cb145-71" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ldsc=</span>good<span class="sc">$</span>ldsc)</span>
<span id="cb145-72"><a href="reference-panel-1k-genome.html#cb145-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-73"><a href="reference-panel-1k-genome.html#cb145-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb145-74"><a href="reference-panel-1k-genome.html#cb145-74" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2_ref <span class="sc">+</span> ldsc,<span class="at">data=</span>dat) <span class="co"># using aver2 from 1kg</span></span>
<span id="cb145-75"><a href="reference-panel-1k-genome.html#cb145-75" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2_ukbb <span class="sc">+</span> ldsc,<span class="at">data=</span>dat) <span class="co"># using aver2 from ukbb</span></span>
<span id="cb145-76"><a href="reference-panel-1k-genome.html#cb145-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inflation hat</span></span>
<span id="cb145-77"><a href="reference-panel-1k-genome.html#cb145-77" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>inflation_ref<span class="ot">=</span>mod1<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod1<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dat<span class="sc">$</span>aver2_ref<span class="dv">-1</span></span>
<span id="cb145-78"><a href="reference-panel-1k-genome.html#cb145-78" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>inflation_ukbb<span class="ot">=</span>mod2<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod2<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dat<span class="sc">$</span>aver2_ukbb<span class="dv">-1</span></span>
<span id="cb145-79"><a href="reference-panel-1k-genome.html#cb145-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-80"><a href="reference-panel-1k-genome.html#cb145-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb145-81"><a href="reference-panel-1k-genome.html#cb145-81" aria-hidden="true" tabindex="-1"></a>  ystart<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(dat<span class="sc">$</span>inflation,dat<span class="sc">$</span>inflation_ref, dat<span class="sc">$</span>inflation_ukbb))</span>
<span id="cb145-82"><a href="reference-panel-1k-genome.html#cb145-82" aria-hidden="true" tabindex="-1"></a>  yend<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(dat<span class="sc">$</span>inflation,dat<span class="sc">$</span>inflation_ref, dat<span class="sc">$</span>inflation_ukbb))</span>
<span id="cb145-83"><a href="reference-panel-1k-genome.html#cb145-83" aria-hidden="true" tabindex="-1"></a>  xstart<span class="ot">=</span><span class="fu">min</span>(<span class="fu">c</span>(dat<span class="sc">$</span>aver2_ref, dat<span class="sc">$</span>aver2_ukbb))</span>
<span id="cb145-84"><a href="reference-panel-1k-genome.html#cb145-84" aria-hidden="true" tabindex="-1"></a>  xend<span class="ot">=</span><span class="fu">max</span>(<span class="fu">c</span>(dat<span class="sc">$</span>aver2_ref, dat<span class="sc">$</span>aver2_ukbb))</span>
<span id="cb145-85"><a href="reference-panel-1k-genome.html#cb145-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-86"><a href="reference-panel-1k-genome.html#cb145-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(dat<span class="sc">$</span>aver2_ukbb, dat<span class="sc">$</span>inflation,</span>
<span id="cb145-87"><a href="reference-panel-1k-genome.html#cb145-87" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab=</span><span class="st">&quot;inflation&quot;</span>, <span class="at">xlab=</span><span class="st">&quot; standardized aver2&quot;</span>,</span>
<span id="cb145-88"><a href="reference-panel-1k-genome.html#cb145-88" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(xstart, xend), <span class="at">ylim=</span><span class="fu">c</span>(ystart, yend),</span>
<span id="cb145-89"><a href="reference-panel-1k-genome.html#cb145-89" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;lightgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb145-90"><a href="reference-panel-1k-genome.html#cb145-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(dat<span class="sc">$</span>aver2_ref, dat<span class="sc">$</span>inflation, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb145-91"><a href="reference-panel-1k-genome.html#cb145-91" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span><span class="fu">rgb</span>(<span class="dv">255</span>, <span class="dv">179</span>, <span class="dv">138</span>, <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">200</span>), </span>
<span id="cb145-92"><a href="reference-panel-1k-genome.html#cb145-92" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb145-93"><a href="reference-panel-1k-genome.html#cb145-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(dat<span class="sc">$</span>aver2_ukbb, dat<span class="sc">$</span>inflation_ukbb, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;darkgrey&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb145-94"><a href="reference-panel-1k-genome.html#cb145-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(dat<span class="sc">$</span>aver2_ref, dat<span class="sc">$</span>inflation_ref, <span class="dv">1</span>, </span>
<span id="cb145-95"><a href="reference-panel-1k-genome.html#cb145-95" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="st">&quot;darkorange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb145-96"><a href="reference-panel-1k-genome.html#cb145-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-97"><a href="reference-panel-1k-genome.html#cb145-97" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb145-98"><a href="reference-panel-1k-genome.html#cb145-98" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb145-99"><a href="reference-panel-1k-genome.html#cb145-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-100"><a href="reference-panel-1k-genome.html#cb145-100" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation ~ STANDARDIZED aver2 binned data----------------------------------------</span></span>
<span id="cb145-101"><a href="reference-panel-1k-genome.html#cb145-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-102"><a href="reference-panel-1k-genome.html#cb145-102" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb145-103"><a href="reference-panel-1k-genome.html#cb145-103" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb145-104"><a href="reference-panel-1k-genome.html#cb145-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb145-105"><a href="reference-panel-1k-genome.html#cb145-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb145-106"><a href="reference-panel-1k-genome.html#cb145-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-107"><a href="reference-panel-1k-genome.html#cb145-107" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/inflation-aver2-bin-ukbb-vs-1kg.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb145-108"><a href="reference-panel-1k-genome.html#cb145-108" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb145-109"><a href="reference-panel-1k-genome.html#cb145-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-110"><a href="reference-panel-1k-genome.html#cb145-110" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb145-111"><a href="reference-panel-1k-genome.html#cb145-111" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb145-112"><a href="reference-panel-1k-genome.html#cb145-112" aria-hidden="true" tabindex="-1"></a>  bad<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb145-113"><a href="reference-panel-1k-genome.html#cb145-113" aria-hidden="true" tabindex="-1"></a>  good<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/out-good-gwas/&quot;</span>,trait,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb145-114"><a href="reference-panel-1k-genome.html#cb145-114" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">match</span>(good<span class="sc">$</span>ukbb_snp, bad<span class="sc">$</span>ukbb_snp)</span>
<span id="cb145-115"><a href="reference-panel-1k-genome.html#cb145-115" aria-hidden="true" tabindex="-1"></a>  bad<span class="ot">=</span>bad[m,] <span class="co"># align good and bad gwas data</span></span>
<span id="cb145-116"><a href="reference-panel-1k-genome.html#cb145-116" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">snp=</span>good<span class="sc">$</span>ukbb_snp,</span>
<span id="cb145-117"><a href="reference-panel-1k-genome.html#cb145-117" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inflation=</span>bad<span class="sc">$</span>chisq<span class="sc">-</span>good<span class="sc">$</span>chisq,</span>
<span id="cb145-118"><a href="reference-panel-1k-genome.html#cb145-118" aria-hidden="true" tabindex="-1"></a>                 <span class="at">aver2_ref=</span><span class="fu">scale</span>(bad<span class="sc">$</span>ref), <span class="co"># </span><span class="al">NOTE</span><span class="co">: aver2 is standardized</span></span>
<span id="cb145-119"><a href="reference-panel-1k-genome.html#cb145-119" aria-hidden="true" tabindex="-1"></a>                 <span class="at">aver2_ukbb=</span><span class="fu">scale</span>(bad<span class="sc">$</span>ukbb), <span class="co"># </span><span class="al">NOTE</span><span class="co">: aver2 is standardized</span></span>
<span id="cb145-120"><a href="reference-panel-1k-genome.html#cb145-120" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chisq=</span>bad<span class="sc">$</span>chisq, <span class="co"># chisq from the bad gwas</span></span>
<span id="cb145-121"><a href="reference-panel-1k-genome.html#cb145-121" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ldsc=</span>good<span class="sc">$</span>ldsc)</span>
<span id="cb145-122"><a href="reference-panel-1k-genome.html#cb145-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-123"><a href="reference-panel-1k-genome.html#cb145-123" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb145-124"><a href="reference-panel-1k-genome.html#cb145-124" aria-hidden="true" tabindex="-1"></a>  mod1<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2_ref <span class="sc">+</span> ldsc,<span class="at">data=</span>dat) <span class="co"># using aver2 from 1kg</span></span>
<span id="cb145-125"><a href="reference-panel-1k-genome.html#cb145-125" aria-hidden="true" tabindex="-1"></a>  mod2<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2_ukbb <span class="sc">+</span> ldsc,<span class="at">data=</span>dat) <span class="co"># using aver2 from ukbb</span></span>
<span id="cb145-126"><a href="reference-panel-1k-genome.html#cb145-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-127"><a href="reference-panel-1k-genome.html#cb145-127" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inflation hat</span></span>
<span id="cb145-128"><a href="reference-panel-1k-genome.html#cb145-128" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>inflation_ref<span class="ot">=</span>mod1<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod1<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dat<span class="sc">$</span>aver2_ref<span class="dv">-1</span></span>
<span id="cb145-129"><a href="reference-panel-1k-genome.html#cb145-129" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>inflation_ukbb<span class="ot">=</span>mod2<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>mod2<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dat<span class="sc">$</span>aver2_ukbb<span class="dv">-1</span></span>
<span id="cb145-130"><a href="reference-panel-1k-genome.html#cb145-130" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-131"><a href="reference-panel-1k-genome.html#cb145-131" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb145-132"><a href="reference-panel-1k-genome.html#cb145-132" aria-hidden="true" tabindex="-1"></a>  cutoff1<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2_ref, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb145-133"><a href="reference-panel-1k-genome.html#cb145-133" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin1<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2_ref, <span class="at">breaks=</span>cutoff1, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff1)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb145-134"><a href="reference-panel-1k-genome.html#cb145-134" aria-hidden="true" tabindex="-1"></a>  cutoff2<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2_ukbb, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb145-135"><a href="reference-panel-1k-genome.html#cb145-135" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin2<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2_ukbb, <span class="at">breaks=</span>cutoff2, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff2)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb145-136"><a href="reference-panel-1k-genome.html#cb145-136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-137"><a href="reference-panel-1k-genome.html#cb145-137" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb145-138"><a href="reference-panel-1k-genome.html#cb145-138" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">inflation_ref=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin1, mean),</span>
<span id="cb145-139"><a href="reference-panel-1k-genome.html#cb145-139" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inflation_ukbb=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin2, mean),</span>
<span id="cb145-140"><a href="reference-panel-1k-genome.html#cb145-140" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inflation_hat_ref=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation_ref,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin1, mean),</span>
<span id="cb145-141"><a href="reference-panel-1k-genome.html#cb145-141" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inflation_hat_ukbb=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>inflation_ukbb,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin2, mean))</span>
<span id="cb145-142"><a href="reference-panel-1k-genome.html#cb145-142" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_ref<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2_ref,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin1, mean)</span>
<span id="cb145-143"><a href="reference-panel-1k-genome.html#cb145-143" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_ukbb<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2_ukbb,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin2, mean)</span>
<span id="cb145-144"><a href="reference-panel-1k-genome.html#cb145-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-145"><a href="reference-panel-1k-genome.html#cb145-145" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb145-146"><a href="reference-panel-1k-genome.html#cb145-146" aria-hidden="true" tabindex="-1"></a>  ystart<span class="ot">=</span><span class="fu">min</span>(out[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb145-147"><a href="reference-panel-1k-genome.html#cb145-147" aria-hidden="true" tabindex="-1"></a>  yend<span class="ot">=</span><span class="fu">max</span>(out[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb145-148"><a href="reference-panel-1k-genome.html#cb145-148" aria-hidden="true" tabindex="-1"></a>  xstart<span class="ot">=</span><span class="fu">min</span>(out[, <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb145-149"><a href="reference-panel-1k-genome.html#cb145-149" aria-hidden="true" tabindex="-1"></a>  xend<span class="ot">=</span><span class="fu">max</span>(out[,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb145-150"><a href="reference-panel-1k-genome.html#cb145-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-151"><a href="reference-panel-1k-genome.html#cb145-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_ukbb, out<span class="sc">$</span>inflation_ukbb,</span>
<span id="cb145-152"><a href="reference-panel-1k-genome.html#cb145-152" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab=</span><span class="st">&quot;mean inflation&quot;</span>, <span class="at">xlab=</span><span class="st">&quot; standardized aver2 bin&quot;</span>,</span>
<span id="cb145-153"><a href="reference-panel-1k-genome.html#cb145-153" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim=</span><span class="fu">c</span>(xstart, xend), <span class="at">ylim=</span><span class="fu">c</span>(ystart, yend),</span>
<span id="cb145-154"><a href="reference-panel-1k-genome.html#cb145-154" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>trait, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;lightgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb145-155"><a href="reference-panel-1k-genome.html#cb145-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(out<span class="sc">$</span>bin_ref, out<span class="sc">$</span>inflation_ref, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb145-156"><a href="reference-panel-1k-genome.html#cb145-156" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span><span class="fu">rgb</span>(<span class="dv">255</span>, <span class="dv">179</span>, <span class="dv">138</span>, <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">200</span>), </span>
<span id="cb145-157"><a href="reference-panel-1k-genome.html#cb145-157" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb145-158"><a href="reference-panel-1k-genome.html#cb145-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(out<span class="sc">$</span>bin_ukbb, out<span class="sc">$</span>inflation_hat_ukbb, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;darkgrey&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb145-159"><a href="reference-panel-1k-genome.html#cb145-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(out<span class="sc">$</span>bin_ref, out<span class="sc">$</span>inflation_hat_ref, <span class="dv">1</span>, </span>
<span id="cb145-160"><a href="reference-panel-1k-genome.html#cb145-160" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="st">&quot;darkorange&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb145-161"><a href="reference-panel-1k-genome.html#cb145-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-162"><a href="reference-panel-1k-genome.html#cb145-162" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb145-163"><a href="reference-panel-1k-genome.html#cb145-163" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="stratified-aver2" class="section level2" number="17.5">
<h2><span class="header-section-number">17.5</span> stratified aver2</h2>
<div id="calc-aver2" class="section level3" number="17.5.1">
<h3><span class="header-section-number">17.5.1</span> calc aver2</h3>
<p>Here we want to compute aver2 for African+Asians, African+European, European+Asian.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb146-1"><a href="reference-panel-1k-genome.html#cb146-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-2"><a href="reference-panel-1k-genome.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="co"># select  id---------------------------------------------------------------------</span></span>
<span id="cb146-3"><a href="reference-panel-1k-genome.html#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="reference-panel-1k-genome.html#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get n=500 for each pop</span></span>
<span id="cb146-5"><a href="reference-panel-1k-genome.html#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span>ref-1kg/1kg/gen/1000g.pops</span>
<span id="cb146-6"><a href="reference-panel-1k-genome.html#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{AFR</span><span class="op">,</span><span class="dt">EUR</span><span class="op">,</span><span class="dt">EAS}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb146-7"><a href="reference-panel-1k-genome.html#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>ref-1kg/<span class="va">$pop</span>-500.use</span>
<span id="cb146-8"><a href="reference-panel-1k-genome.html#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="at">-v</span> pop=<span class="va">$pop</span> <span class="st">&#39;($3==pop){print $1, $1}&#39;</span> <span class="va">$infile</span> <span class="op">&gt;</span> ref-1kg/tmp</span>
<span id="cb146-9"><a href="reference-panel-1k-genome.html#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="ex">shuf</span> ref-1kg/tmp <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 500 <span class="op">&gt;</span> <span class="va">$outfile</span></span>
<span id="cb146-10"><a href="reference-panel-1k-genome.html#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> ref-1kg/tmp </span>
<span id="cb146-11"><a href="reference-panel-1k-genome.html#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb146-12"><a href="reference-panel-1k-genome.html#cb146-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-13"><a href="reference-panel-1k-genome.html#cb146-13" aria-hidden="true" tabindex="-1"></a><span class="co"># mix 2 pops at at time</span></span>
<span id="cb146-14"><a href="reference-panel-1k-genome.html#cb146-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop1 <span class="kw">in</span> <span class="dt">{AFR</span><span class="op">,</span><span class="dt">EUR}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb146-15"><a href="reference-panel-1k-genome.html#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop2 <span class="kw">in</span> <span class="dt">{AFR</span><span class="op">,</span><span class="dt">EAS}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb146-16"><a href="reference-panel-1k-genome.html#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$pop1</span><span class="st">&quot;</span> <span class="ot">!=</span> <span class="st">&quot;</span><span class="va">$pop2</span><span class="st">&quot;</span> <span class="bu">]</span> <span class="kw">;</span> <span class="cf">then</span> </span>
<span id="cb146-17"><a href="reference-panel-1k-genome.html#cb146-17" aria-hidden="true" tabindex="-1"></a>  <span class="va">infile1</span><span class="op">=</span>ref-1kg/<span class="va">$pop1</span>-500.use</span>
<span id="cb146-18"><a href="reference-panel-1k-genome.html#cb146-18" aria-hidden="true" tabindex="-1"></a>  <span class="va">infile2</span><span class="op">=</span>ref-1kg/<span class="va">$pop2</span>-500.use</span>
<span id="cb146-19"><a href="reference-panel-1k-genome.html#cb146-19" aria-hidden="true" tabindex="-1"></a>  <span class="va">outfile</span><span class="op">=</span>ref-1kg/<span class="va">$pop1</span>-<span class="va">$pop2</span>.use</span>
<span id="cb146-20"><a href="reference-panel-1k-genome.html#cb146-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span> <span class="va">$infile1</span> <span class="va">$infile2</span> <span class="op">&gt;</span> <span class="va">$outfile</span></span>
<span id="cb146-21"><a href="reference-panel-1k-genome.html#cb146-21" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb146-22"><a href="reference-panel-1k-genome.html#cb146-22" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb146-23"><a href="reference-panel-1k-genome.html#cb146-23" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb146-24"><a href="reference-panel-1k-genome.html#cb146-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-25"><a href="reference-panel-1k-genome.html#cb146-25" aria-hidden="true" tabindex="-1"></a><span class="co"># mix 3 pops together</span></span>
<span id="cb146-26"><a href="reference-panel-1k-genome.html#cb146-26" aria-hidden="true" tabindex="-1"></a><span class="va">infile1</span><span class="op">=</span>ref-1kg/EUR-500.use</span>
<span id="cb146-27"><a href="reference-panel-1k-genome.html#cb146-27" aria-hidden="true" tabindex="-1"></a><span class="va">infile2</span><span class="op">=</span>ref-1kg/EAS-500.use</span>
<span id="cb146-28"><a href="reference-panel-1k-genome.html#cb146-28" aria-hidden="true" tabindex="-1"></a><span class="va">infile3</span><span class="op">=</span>ref-1kg/AFR-500.use</span>
<span id="cb146-29"><a href="reference-panel-1k-genome.html#cb146-29" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span>ref-1kg/EUR-EAS-AFR.use</span>
<span id="cb146-30"><a href="reference-panel-1k-genome.html#cb146-30" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="va">$infile1</span> <span class="va">$infile2</span> <span class="va">$infile3</span> <span class="op">&gt;</span> <span class="va">$outfile</span></span>
<span id="cb146-31"><a href="reference-panel-1k-genome.html#cb146-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-32"><a href="reference-panel-1k-genome.html#cb146-32" aria-hidden="true" tabindex="-1"></a><span class="co"># compute aver2 for each mixture pops-------------------------------------------</span></span>
<span id="cb146-33"><a href="reference-panel-1k-genome.html#cb146-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-34"><a href="reference-panel-1k-genome.html#cb146-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{AFR-EAS</span><span class="op">,</span><span class="dt">EUR-AFR</span><span class="op">,</span><span class="dt">EUR-EAS</span><span class="op">,</span><span class="dt">EUR-EAS-AFR}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb146-35"><a href="reference-panel-1k-genome.html#cb146-35" aria-hidden="true" tabindex="-1"></a><span class="va">list</span><span class="op">=</span>../ref-1kg/snplist/1kg-22k-snps.use</span>
<span id="cb146-36"><a href="reference-panel-1k-genome.html#cb146-36" aria-hidden="true" tabindex="-1"></a><span class="va">bfile</span><span class="op">=</span>../ref-1kg/1kg/gen/1000b</span>
<span id="cb146-37"><a href="reference-panel-1k-genome.html#cb146-37" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>../ref-1kg/<span class="va">$pop</span>.use</span>
<span id="cb146-38"><a href="reference-panel-1k-genome.html#cb146-38" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>../ref-1kg/aver2/1kg-<span class="va">$pop</span>.aver2</span>
<span id="cb146-39"><a href="reference-panel-1k-genome.html#cb146-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-40"><a href="reference-panel-1k-genome.html#cb146-40" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;#&quot;&#39;!&#39;&quot;/bin/bash</span></span>
<span id="cb146-41"><a href="reference-panel-1k-genome.html#cb146-41" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --constraint </span><span class="dt">\&quot;</span><span class="st">s04|s05</span><span class="dt">\&quot;</span></span>
<span id="cb146-42"><a href="reference-panel-1k-genome.html#cb146-42" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --partition normal</span></span>
<span id="cb146-43"><a href="reference-panel-1k-genome.html#cb146-43" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH --mem 10G</span></span>
<span id="cb146-44"><a href="reference-panel-1k-genome.html#cb146-44" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -c 2</span></span>
<span id="cb146-45"><a href="reference-panel-1k-genome.html#cb146-45" aria-hidden="true" tabindex="-1"></a><span class="st">#SBATCH -t 00:40:0</span></span>
<span id="cb146-46"><a href="reference-panel-1k-genome.html#cb146-46" aria-hidden="true" tabindex="-1"></a><span class="st">./ldak5.2 --max-threads 7 </span><span class="dt">\</span></span>
<span id="cb146-47"><a href="reference-panel-1k-genome.html#cb146-47" aria-hidden="true" tabindex="-1"></a><span class="st">          --calc-inflation </span><span class="va">$out</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb146-48"><a href="reference-panel-1k-genome.html#cb146-48" aria-hidden="true" tabindex="-1"></a><span class="st">          --bfile </span><span class="va">$bfile</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb146-49"><a href="reference-panel-1k-genome.html#cb146-49" aria-hidden="true" tabindex="-1"></a><span class="st">          --keep </span><span class="va">$id</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb146-50"><a href="reference-panel-1k-genome.html#cb146-50" aria-hidden="true" tabindex="-1"></a><span class="st">          --lista </span><span class="va">$list</span><span class="st"> </span><span class="dt">\</span></span>
<span id="cb146-51"><a href="reference-panel-1k-genome.html#cb146-51" aria-hidden="true" tabindex="-1"></a><span class="st">          --listb </span><span class="va">$list</span></span>
<span id="cb146-52"><a href="reference-panel-1k-genome.html#cb146-52" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">&gt;</span>sh_script/calc-aver2-1kg-<span class="va">$pop</span></span>
<span id="cb146-53"><a href="reference-panel-1k-genome.html#cb146-53" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb146-54"><a href="reference-panel-1k-genome.html#cb146-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-55"><a href="reference-panel-1k-genome.html#cb146-55" aria-hidden="true" tabindex="-1"></a><span class="co"># submit the job</span></span>
<span id="cb146-56"><a href="reference-panel-1k-genome.html#cb146-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{AFR-EAS</span><span class="op">,</span><span class="dt">EUR-AFR</span><span class="op">,</span><span class="dt">EUR-EAS</span><span class="op">,</span><span class="dt">EUR-EAS-AFR}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb146-57"><a href="reference-panel-1k-genome.html#cb146-57" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-A</span> snpher ../sh_script/calc-aver2-1kg-<span class="va">$pop</span></span>
<span id="cb146-58"><a href="reference-panel-1k-genome.html#cb146-58" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&gt;</span>../job-records/calc-aver2-pairwise-mixture</span></code></pre></div>
</div>
<div id="organize-data-8" class="section level3" number="17.5.2">
<h3><span class="header-section-number">17.5.2</span> organize data</h3>
<div class="sourceCode" id="cb147"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb147-1"><a href="reference-panel-1k-genome.html#cb147-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-2"><a href="reference-panel-1k-genome.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="co"># putting aver2 together for ukbb &amp; 1kg------------------------------------------</span></span>
<span id="cb147-3"><a href="reference-panel-1k-genome.html#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{AFR-EAS</span><span class="op">,</span><span class="dt">EUR-AFR</span><span class="op">,</span><span class="dt">EUR-EAS</span><span class="op">,</span><span class="dt">EUR-EAS-AFR}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb147-4"><a href="reference-panel-1k-genome.html#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>ref-1kg/aver2</span>
<span id="cb147-5"><a href="reference-panel-1k-genome.html#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="va">aver2_ref</span><span class="op">=</span><span class="va">$dir</span>/1kg-<span class="va">$pop</span>.aver2.rjk2.average</span>
<span id="cb147-6"><a href="reference-panel-1k-genome.html#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="va">aver2_ukbb</span><span class="op">=</span><span class="va">$dir</span>/ukbb.aver2.rjk2.average</span>
<span id="cb147-7"><a href="reference-panel-1k-genome.html#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="va">ref</span><span class="op">=</span>ref-1kg/snplist/1kg-common-snps</span>
<span id="cb147-8"><a href="reference-panel-1k-genome.html#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="va">ukbb</span><span class="op">=</span>ref-1kg/snplist/ukbb-common-snps</span>
<span id="cb147-9"><a href="reference-panel-1k-genome.html#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span><span class="va">$dir</span>/1kg-ukbb-<span class="va">$pop</span>.aver2</span>
<span id="cb147-10"><a href="reference-panel-1k-genome.html#cb147-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-11"><a href="reference-panel-1k-genome.html#cb147-11" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$2]; b[$2]=$3; next}</span></span>
<span id="cb147-12"><a href="reference-panel-1k-genome.html#cb147-12" aria-hidden="true" tabindex="-1"></a><span class="st">      {if ($1 in a) print b[$1], $1, $2}&#39;</span> <span class="va">$ref</span> <span class="va">$aver2_ref</span> <span class="op">&gt;</span> <span class="va">$dir</span>/1kg-tmp</span>
<span id="cb147-13"><a href="reference-panel-1k-genome.html#cb147-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb147-14"><a href="reference-panel-1k-genome.html#cb147-14" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$2]; b[$2]=$3; next}</span></span>
<span id="cb147-15"><a href="reference-panel-1k-genome.html#cb147-15" aria-hidden="true" tabindex="-1"></a><span class="st">      {if ($1 in a) print b[$1], $1, $2}&#39;</span> <span class="va">$ukbb</span> <span class="va">$aver2_ukbb</span> <span class="op">&gt;</span> <span class="va">$dir</span>/ukbb-tmp</span>
<span id="cb147-16"><a href="reference-panel-1k-genome.html#cb147-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-17"><a href="reference-panel-1k-genome.html#cb147-17" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb&quot; }</span></span>
<span id="cb147-18"><a href="reference-panel-1k-genome.html#cb147-18" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR {a[$1]; b[$1]=$2; c[$1]=$3; next}</span></span>
<span id="cb147-19"><a href="reference-panel-1k-genome.html#cb147-19" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $2, b[$1], c[$1], $3 }&#39;</span> <span class="va">$dir</span>/1kg-tmp <span class="va">$dir</span>/ukbb-tmp <span class="op">&gt;</span> <span class="va">$out</span> </span>
<span id="cb147-20"><a href="reference-panel-1k-genome.html#cb147-20" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb147-21"><a href="reference-panel-1k-genome.html#cb147-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-22"><a href="reference-panel-1k-genome.html#cb147-22" aria-hidden="true" tabindex="-1"></a><span class="co"># combine aver2 + chisq + ldsc -------------------------------------------------</span></span>
<span id="cb147-23"><a href="reference-panel-1k-genome.html#cb147-23" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ref-1kg/pairwise-mixture-out</span>
<span id="cb147-24"><a href="reference-panel-1k-genome.html#cb147-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-25"><a href="reference-panel-1k-genome.html#cb147-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{AFR-EAS</span><span class="op">,</span><span class="dt">EUR-AFR</span><span class="op">,</span><span class="dt">EUR-EAS</span><span class="op">,</span><span class="dt">EUR-EAS-AFR}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb147-26"><a href="reference-panel-1k-genome.html#cb147-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb147-27"><a href="reference-panel-1k-genome.html#cb147-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-28"><a href="reference-panel-1k-genome.html#cb147-28" aria-hidden="true" tabindex="-1"></a><span class="va">gwas</span><span class="op">=</span>gwas-mix/<span class="va">$trait</span>-linear.summaries</span>
<span id="cb147-29"><a href="reference-panel-1k-genome.html#cb147-29" aria-hidden="true" tabindex="-1"></a><span class="va">aver2</span><span class="op">=</span>ref-1kg/aver2/1kg-ukbb-<span class="va">$pop</span>.aver2</span>
<span id="cb147-30"><a href="reference-panel-1k-genome.html#cb147-30" aria-hidden="true" tabindex="-1"></a><span class="va">tmp</span><span class="op">=</span>ref-1kg/pairwise-mixture-out/<span class="va">$trait</span>.tmp</span>
<span id="cb147-31"><a href="reference-panel-1k-genome.html#cb147-31" aria-hidden="true" tabindex="-1"></a><span class="va">ldsc</span><span class="op">=</span>snps-unrel-inds.ldscore</span>
<span id="cb147-32"><a href="reference-panel-1k-genome.html#cb147-32" aria-hidden="true" tabindex="-1"></a><span class="va">out</span><span class="op">=</span>ref-1kg/pairwise-mixture-out/<span class="va">$trait</span>-<span class="va">$pop</span>.out</span>
<span id="cb147-33"><a href="reference-panel-1k-genome.html#cb147-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-34"><a href="reference-panel-1k-genome.html#cb147-34" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb chisq&quot; }</span></span>
<span id="cb147-35"><a href="reference-panel-1k-genome.html#cb147-35" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR &amp;&amp; NR &gt; 1 {a[$1]; b[$1]=$5; next} </span></span>
<span id="cb147-36"><a href="reference-panel-1k-genome.html#cb147-36" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $0, b[$1]}&#39;</span> <span class="va">$gwas</span> <span class="va">$aver2</span><span class="op">&gt;</span> <span class="va">$tmp</span></span>
<span id="cb147-37"><a href="reference-panel-1k-genome.html#cb147-37" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb147-38"><a href="reference-panel-1k-genome.html#cb147-38" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;BEGIN{print &quot;ukbb_snp ref_snp ref ukbb chisq ldsc&quot; }</span></span>
<span id="cb147-39"><a href="reference-panel-1k-genome.html#cb147-39" aria-hidden="true" tabindex="-1"></a><span class="st">     NR==FNR {a[$1]; b[$1]=$2; next} </span></span>
<span id="cb147-40"><a href="reference-panel-1k-genome.html#cb147-40" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print $0, b[$1]}&#39;</span> <span class="va">$ldsc</span> <span class="va">$tmp</span> <span class="op">&gt;</span> <span class="va">$out</span>     </span>
<span id="cb147-41"><a href="reference-panel-1k-genome.html#cb147-41" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb147-42"><a href="reference-panel-1k-genome.html#cb147-42" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb147-43"><a href="reference-panel-1k-genome.html#cb147-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-44"><a href="reference-panel-1k-genome.html#cb147-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-45"><a href="reference-panel-1k-genome.html#cb147-45" aria-hidden="true" tabindex="-1"></a><span class="co"># combine aver2 + chisq + ldsc for chisq ~ multi-aver2--------------------------</span></span>
<span id="cb147-46"><a href="reference-panel-1k-genome.html#cb147-46" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span>ref-1kg/pairwise-mixture-out</span>
<span id="cb147-47"><a href="reference-panel-1k-genome.html#cb147-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trait <span class="kw">in</span> <span class="dt">{awake</span><span class="op">,</span><span class="dt">bmi</span><span class="op">,</span><span class="dt">chron</span><span class="op">,</span><span class="dt">ever</span><span class="op">,</span><span class="dt">fvc</span><span class="op">,</span><span class="dt">height</span><span class="op">,</span><span class="dt">imp</span><span class="op">,</span><span class="dt">neur</span><span class="op">,</span><span class="dt">pulse</span><span class="op">,</span><span class="dt">quals</span><span class="op">,</span><span class="dt">reaction</span><span class="op">,</span><span class="dt">sbp</span><span class="op">,</span><span class="dt">snoring</span><span class="op">,</span><span class="dt">hyper}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb147-48"><a href="reference-panel-1k-genome.html#cb147-48" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR&gt;1 {print $1, $5, $6}&#39;</span> <span class="va">$dir</span>/<span class="va">$trait</span>-AFR-EAS.out <span class="op">&gt;</span> <span class="va">$dir</span>/ukbb_snps_chisq_ldsc</span>
<span id="cb147-49"><a href="reference-panel-1k-genome.html#cb147-49" aria-hidden="true" tabindex="-1"></a><span class="va">outfile</span><span class="op">=</span><span class="va">$dir</span>/<span class="va">$trait</span>-all.out</span>
<span id="cb147-50"><a href="reference-panel-1k-genome.html#cb147-50" aria-hidden="true" tabindex="-1"></a><span class="va">snps</span><span class="op">=</span><span class="va">$dir</span>/ukbb_snps_chisq_ldsc</span>
<span id="cb147-51"><a href="reference-panel-1k-genome.html#cb147-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-52"><a href="reference-panel-1k-genome.html#cb147-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> <span class="dt">{AFR-EAS</span><span class="op">,</span><span class="dt">EUR-AFR</span><span class="op">,</span><span class="dt">EUR-EAS}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb147-53"><a href="reference-panel-1k-genome.html#cb147-53" aria-hidden="true" tabindex="-1"></a><span class="va">infile</span><span class="op">=</span><span class="va">$dir</span>/<span class="va">$trait</span>-<span class="va">$pop</span>.out</span>
<span id="cb147-54"><a href="reference-panel-1k-genome.html#cb147-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-55"><a href="reference-panel-1k-genome.html#cb147-55" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">&#39;NR==FNR {a[$1]; b[$1]=$3; next} </span></span>
<span id="cb147-56"><a href="reference-panel-1k-genome.html#cb147-56" aria-hidden="true" tabindex="-1"></a><span class="st">     {if ($1 in a) print b[$1];</span></span>
<span id="cb147-57"><a href="reference-panel-1k-genome.html#cb147-57" aria-hidden="true" tabindex="-1"></a><span class="st">      else print &quot;NA&quot; }&#39;</span> <span class="va">$infile</span> <span class="va">$snps</span><span class="op">&gt;</span> <span class="va">$dir</span>/<span class="va">$pop</span></span>
<span id="cb147-58"><a href="reference-panel-1k-genome.html#cb147-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-59"><a href="reference-panel-1k-genome.html#cb147-59" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb147-60"><a href="reference-panel-1k-genome.html#cb147-60" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="va">$snps</span> <span class="dt">\</span></span>
<span id="cb147-61"><a href="reference-panel-1k-genome.html#cb147-61" aria-hidden="true" tabindex="-1"></a>      <span class="va">$dir</span>/AFR-EAS <span class="dt">\</span></span>
<span id="cb147-62"><a href="reference-panel-1k-genome.html#cb147-62" aria-hidden="true" tabindex="-1"></a>      <span class="va">$dir</span>/EUR-AFR <span class="dt">\</span></span>
<span id="cb147-63"><a href="reference-panel-1k-genome.html#cb147-63" aria-hidden="true" tabindex="-1"></a>      <span class="va">$dir</span>/EUR-EAS <span class="dt">\</span></span>
<span id="cb147-64"><a href="reference-panel-1k-genome.html#cb147-64" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;BEGIN{OFS=&quot;;&quot; ; </span></span>
<span id="cb147-65"><a href="reference-panel-1k-genome.html#cb147-65" aria-hidden="true" tabindex="-1"></a><span class="st">                  print &quot;ukbb_snp;chisq;ldsc;AFR_EAS;EUR_AFR;EUR_EAS&quot;}</span></span>
<span id="cb147-66"><a href="reference-panel-1k-genome.html#cb147-66" aria-hidden="true" tabindex="-1"></a><span class="st">             {$1=$1}1&#39;</span> <span class="op">&gt;</span> <span class="va">$outfile</span></span>
<span id="cb147-67"><a href="reference-panel-1k-genome.html#cb147-67" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div id="plot-aver2-of-pairwise-mixture-pops" class="section level3" number="17.5.3">
<h3><span class="header-section-number">17.5.3</span> plot aver2 of pairwise mixture pops</h3>
<p>aver2 is sensitive to population stratification. Stratified aver2 helps to segregate SNPs that are particularly sensitive to population differences. For the random selection of SNPs, some are particularly sensitive to European-Asian differences but not so much to European-African differences; others are particularly sensitive to European-African differences but not so much to European-Asian differences.</p>
<p>Ideas to explore:
1. annotate the genome using aver2 computed using pairwise population mixtures so that we have different sets of SNPs that are particularly sensitive to a pair of population mixture.
2. We could regress chisq on multiple aver2 computed using different pairwise pop mixtures. The advantage of this approach is that we can hold various ancestry differences constant, while varying other ancestry differences. If there is inflation caused by pop stratification, we can use this approach to pinpoint the inflation is due to what ancestry differences.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="reference-panel-1k-genome.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare with ukbb ------------------------------------------------------------</span></span>
<span id="cb148-2"><a href="reference-panel-1k-genome.html#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="reference-panel-1k-genome.html#cb148-3" aria-hidden="true" tabindex="-1"></a>pop<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;AFR-EAS&quot;</span>,<span class="st">&quot;EUR-AFR&quot;</span>,<span class="st">&quot;EUR-EAS&quot;</span>,<span class="st">&quot;EUR-EAS-AFR&quot;</span>)</span>
<span id="cb148-4"><a href="reference-panel-1k-genome.html#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="reference-panel-1k-genome.html#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/aver2-1kg-vs-ukbb-pairwise-mixture.png&quot;</span>, </span>
<span id="cb148-6"><a href="reference-panel-1k-genome.html#cb148-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">40</span>, <span class="at">height=</span><span class="dv">10</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb148-7"><a href="reference-panel-1k-genome.html#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb148-8"><a href="reference-panel-1k-genome.html#cb148-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-9"><a href="reference-panel-1k-genome.html#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> pop){</span>
<span id="cb148-10"><a href="reference-panel-1k-genome.html#cb148-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-11"><a href="reference-panel-1k-genome.html#cb148-11" aria-hidden="true" tabindex="-1"></a>file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/aver2/1kg-ukbb-&quot;</span>,i,<span class="st">&quot;.aver2&quot;</span>)</span>
<span id="cb148-12"><a href="reference-panel-1k-genome.html#cb148-12" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">read.table</span>(file,<span class="at">stringsAsFactors =</span> F, <span class="at">header=</span>T)</span>
<span id="cb148-13"><a href="reference-panel-1k-genome.html#cb148-13" aria-hidden="true" tabindex="-1"></a>cor<span class="ot">=</span><span class="fu">round</span>(<span class="fu">cor</span>(dat<span class="sc">$</span>ref, dat<span class="sc">$</span>ukbb, <span class="at">use=</span><span class="st">&quot;pairwise.complete.obs&quot;</span>),<span class="dv">2</span>)</span>
<span id="cb148-14"><a href="reference-panel-1k-genome.html#cb148-14" aria-hidden="true" tabindex="-1"></a>corx<span class="ot">=</span><span class="fu">min</span>(dat<span class="sc">$</span>ref, <span class="at">na.rm=</span>T)</span>
<span id="cb148-15"><a href="reference-panel-1k-genome.html#cb148-15" aria-hidden="true" tabindex="-1"></a>cory<span class="ot">=</span><span class="fu">max</span>(dat<span class="sc">$</span>ukbb, <span class="at">na.rm=</span>T)</span>
<span id="cb148-16"><a href="reference-panel-1k-genome.html#cb148-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-17"><a href="reference-panel-1k-genome.html#cb148-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>ref, dat<span class="sc">$</span>ukbb,</span>
<span id="cb148-18"><a href="reference-panel-1k-genome.html#cb148-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;1k genome&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;ukbb&quot;</span>,</span>
<span id="cb148-19"><a href="reference-panel-1k-genome.html#cb148-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&quot;aver2 &quot;</span>, i),</span>
<span id="cb148-20"><a href="reference-panel-1k-genome.html#cb148-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb148-21"><a href="reference-panel-1k-genome.html#cb148-21" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(corx, cory, <span class="fu">paste0</span>(<span class="st">&quot;r = &quot;</span>, cor), </span>
<span id="cb148-22"><a href="reference-panel-1k-genome.html#cb148-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb148-23"><a href="reference-panel-1k-genome.html#cb148-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb148-24"><a href="reference-panel-1k-genome.html#cb148-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-25"><a href="reference-panel-1k-genome.html#cb148-25" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb148-26"><a href="reference-panel-1k-genome.html#cb148-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-27"><a href="reference-panel-1k-genome.html#cb148-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 3d scatter of r2 of pairwise mixture populations -----------------------------</span></span>
<span id="cb148-28"><a href="reference-panel-1k-genome.html#cb148-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-29"><a href="reference-panel-1k-genome.html#cb148-29" aria-hidden="true" tabindex="-1"></a><span class="co"># organize data</span></span>
<span id="cb148-30"><a href="reference-panel-1k-genome.html#cb148-30" aria-hidden="true" tabindex="-1"></a>pop<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;AFR-EAS&quot;</span>,<span class="st">&quot;EUR-AFR&quot;</span>,<span class="st">&quot;EUR-EAS&quot;</span>)</span>
<span id="cb148-31"><a href="reference-panel-1k-genome.html#cb148-31" aria-hidden="true" tabindex="-1"></a>colnm<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;AFR_EAS&quot;</span>,<span class="st">&quot;EUR_AFR&quot;</span>,<span class="st">&quot;EUR_EAS&quot;</span>)</span>
<span id="cb148-32"><a href="reference-panel-1k-genome.html#cb148-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb148-33"><a href="reference-panel-1k-genome.html#cb148-33" aria-hidden="true" tabindex="-1"></a>mix<span class="ot">=</span>pop[i]</span>
<span id="cb148-34"><a href="reference-panel-1k-genome.html#cb148-34" aria-hidden="true" tabindex="-1"></a>file<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/aver2/1kg-ukbb-&quot;</span>,mix,<span class="st">&quot;.aver2&quot;</span>)</span>
<span id="cb148-35"><a href="reference-panel-1k-genome.html#cb148-35" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span><span class="fu">read.table</span>(file,<span class="at">stringsAsFactors =</span> F, <span class="at">header=</span>T)</span>
<span id="cb148-36"><a href="reference-panel-1k-genome.html#cb148-36" aria-hidden="true" tabindex="-1"></a>out0<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]</span>
<span id="cb148-37"><a href="reference-panel-1k-genome.html#cb148-37" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(out0)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;ukbb_snp&quot;</span>,colnm[i])</span>
<span id="cb148-38"><a href="reference-panel-1k-genome.html#cb148-38" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){out<span class="ot">=</span>out0} <span class="cf">else</span> {out<span class="ot">=</span><span class="fu">cbind</span>(out,out0[<span class="sc">-</span><span class="dv">1</span>]); <span class="fu">names</span>(out)[i<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span>colnm[i]}</span>
<span id="cb148-39"><a href="reference-panel-1k-genome.html#cb148-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb148-40"><a href="reference-panel-1k-genome.html#cb148-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-41"><a href="reference-panel-1k-genome.html#cb148-41" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb148-42"><a href="reference-panel-1k-genome.html#cb148-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scatterplot3d&quot;</span>)</span>
<span id="cb148-43"><a href="reference-panel-1k-genome.html#cb148-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Source the function</span></span>
<span id="cb148-44"><a href="reference-panel-1k-genome.html#cb148-44" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;http://www.sthda.com/sthda/RDoc/functions/addgrids3d.r&#39;</span>)</span>
<span id="cb148-45"><a href="reference-panel-1k-genome.html#cb148-45" aria-hidden="true" tabindex="-1"></a><span class="co">#source(&#39;~/hubiC/Documents/R/function/addgrids3d.r&#39;)</span></span>
<span id="cb148-46"><a href="reference-panel-1k-genome.html#cb148-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-47"><a href="reference-panel-1k-genome.html#cb148-47" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/aver2-3dscatter-pairwise-mixture.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb148-48"><a href="reference-panel-1k-genome.html#cb148-48" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot3d</span>(out[, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">3</span>)], <span class="at">angle=</span><span class="dv">120</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">color=</span><span class="st">&quot;lightgrey&quot;</span>)</span>
<span id="cb148-49"><a href="reference-panel-1k-genome.html#cb148-49" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb148-50"><a href="reference-panel-1k-genome.html#cb148-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-51"><a href="reference-panel-1k-genome.html#cb148-51" aria-hidden="true" tabindex="-1"></a><span class="co"># plot aver2 by binned percentiles of aver2 for afr_eas------------------------</span></span>
<span id="cb148-52"><a href="reference-panel-1k-genome.html#cb148-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-53"><a href="reference-panel-1k-genome.html#cb148-53" aria-hidden="true" tabindex="-1"></a><span class="co"># bin aver2 for EUR_EAS mixture</span></span>
<span id="cb148-54"><a href="reference-panel-1k-genome.html#cb148-54" aria-hidden="true" tabindex="-1"></a>cutoff<span class="ot">=</span><span class="fu">quantile</span>(out<span class="sc">$</span>AFR_EAS, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb148-55"><a href="reference-panel-1k-genome.html#cb148-55" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>bin_afr_eas<span class="ot">=</span><span class="fu">cut</span>(out<span class="sc">$</span>AFR_EAS, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb148-56"><a href="reference-panel-1k-genome.html#cb148-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-57"><a href="reference-panel-1k-genome.html#cb148-57" aria-hidden="true" tabindex="-1"></a><span class="co"># set colors</span></span>
<span id="cb148-58"><a href="reference-panel-1k-genome.html#cb148-58" aria-hidden="true" tabindex="-1"></a><span class="co"># get 10 distinctive transparent colors </span></span>
<span id="cb148-59"><a href="reference-panel-1k-genome.html#cb148-59" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;RColorBrewer&quot;</span>)</span>
<span id="cb148-60"><a href="reference-panel-1k-genome.html#cb148-60" aria-hidden="true" tabindex="-1"></a>pallete<span class="ot">=</span><span class="fu">brewer.pal</span>(<span class="dv">10</span>, <span class="at">name=</span><span class="st">&quot;Spectral&quot;</span>)</span>
<span id="cb148-61"><a href="reference-panel-1k-genome.html#cb148-61" aria-hidden="true" tabindex="-1"></a>mycol<span class="ot">=</span><span class="fu">apply</span>(<span class="fu">col2rgb</span>(pallete), <span class="dv">2</span>, </span>
<span id="cb148-62"><a href="reference-panel-1k-genome.html#cb148-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(X) <span class="fu">rgb</span>(X[<span class="dv">1</span>], X[<span class="dv">2</span>], X[<span class="dv">3</span>], <span class="at">max=</span><span class="dv">255</span>, <span class="at">alpha=</span><span class="dv">200</span>))</span>
<span id="cb148-63"><a href="reference-panel-1k-genome.html#cb148-63" aria-hidden="true" tabindex="-1"></a>xrange<span class="ot">=</span><span class="fu">c</span>(<span class="fu">min</span>(out<span class="sc">$</span>EUR_AFR), <span class="fu">max</span>(out<span class="sc">$</span>EUR_AFR))</span>
<span id="cb148-64"><a href="reference-panel-1k-genome.html#cb148-64" aria-hidden="true" tabindex="-1"></a>yrange<span class="ot">=</span><span class="fu">c</span>(<span class="fu">min</span>(out<span class="sc">$</span>EUR_EAS), <span class="fu">max</span>(out<span class="sc">$</span>EUR_EAS))</span>
<span id="cb148-65"><a href="reference-panel-1k-genome.html#cb148-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-66"><a href="reference-panel-1k-genome.html#cb148-66" aria-hidden="true" tabindex="-1"></a><span class="co"># all bins in one plot</span></span>
<span id="cb148-67"><a href="reference-panel-1k-genome.html#cb148-67" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/aver2-by-afr-eas-bin.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">30</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb148-68"><a href="reference-panel-1k-genome.html#cb148-68" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb148-69"><a href="reference-panel-1k-genome.html#cb148-69" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlab=</span><span class="st">&quot;eur-afr&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;eur-eas&quot;</span>,</span>
<span id="cb148-70"><a href="reference-panel-1k-genome.html#cb148-70" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;ave r2_j by afr-eas&quot;</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">xlim=</span>xrange, <span class="at">ylim=</span>yrange)</span>
<span id="cb148-71"><a href="reference-panel-1k-genome.html#cb148-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb148-72"><a href="reference-panel-1k-genome.html#cb148-72" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>out[out<span class="sc">$</span>bin_afr_eas<span class="sc">==</span>i,]</span>
<span id="cb148-73"><a href="reference-panel-1k-genome.html#cb148-73" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(sel<span class="sc">$</span>EUR_AFR, sel<span class="sc">$</span>EUR_EAS, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>, </span>
<span id="cb148-74"><a href="reference-panel-1k-genome.html#cb148-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) </span>
<span id="cb148-75"><a href="reference-panel-1k-genome.html#cb148-75" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb148-76"><a href="reference-panel-1k-genome.html#cb148-76" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb148-77"><a href="reference-panel-1k-genome.html#cb148-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-78"><a href="reference-panel-1k-genome.html#cb148-78" aria-hidden="true" tabindex="-1"></a><span class="co"># bins in separate plots</span></span>
<span id="cb148-79"><a href="reference-panel-1k-genome.html#cb148-79" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;fig/aver2-by-afr-eas-bin-panel.png&quot;</span>, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">20</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb148-80"><a href="reference-panel-1k-genome.html#cb148-80" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb148-81"><a href="reference-panel-1k-genome.html#cb148-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb148-82"><a href="reference-panel-1k-genome.html#cb148-82" aria-hidden="true" tabindex="-1"></a> sel<span class="ot">=</span>out[out<span class="sc">$</span>bin_afr_eas<span class="sc">==</span>i,]</span>
<span id="cb148-83"><a href="reference-panel-1k-genome.html#cb148-83" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(sel<span class="sc">$</span>EUR_AFR, sel<span class="sc">$</span>EUR_EAS, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,</span>
<span id="cb148-84"><a href="reference-panel-1k-genome.html#cb148-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab=</span><span class="st">&quot;european-african&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;european-east asian&quot;</span>,</span>
<span id="cb148-85"><a href="reference-panel-1k-genome.html#cb148-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">bg=</span>mycol[i], <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb148-86"><a href="reference-panel-1k-genome.html#cb148-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlim=</span>xrange, <span class="at">ylim=</span>yrange, <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&quot;afr-eas bin &quot;</span>, i)) </span>
<span id="cb148-87"><a href="reference-panel-1k-genome.html#cb148-87" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb148-88"><a href="reference-panel-1k-genome.html#cb148-88" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="chisq-1-x-aver2" class="section level3" number="17.5.4">
<h3><span class="header-section-number">17.5.4</span> chisq ~ 1 x aver2</h3>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="reference-panel-1k-genome.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2 1kg by pop mixture: individual plots-----------------------</span></span>
<span id="cb149-2"><a href="reference-panel-1k-genome.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb149-3"><a href="reference-panel-1k-genome.html#cb149-3" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb149-4"><a href="reference-panel-1k-genome.html#cb149-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb149-5"><a href="reference-panel-1k-genome.html#cb149-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb149-6"><a href="reference-panel-1k-genome.html#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="reference-panel-1k-genome.html#cb149-7" aria-hidden="true" tabindex="-1"></a>pop<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;AFR-EAS&quot;</span>,<span class="st">&quot;EUR-AFR&quot;</span>,<span class="st">&quot;EUR-EAS&quot;</span>,<span class="st">&quot;EUR-EAS-AFR&quot;</span>)</span>
<span id="cb149-8"><a href="reference-panel-1k-genome.html#cb149-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-9"><a href="reference-panel-1k-genome.html#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> pop){</span>
<span id="cb149-10"><a href="reference-panel-1k-genome.html#cb149-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-11"><a href="reference-panel-1k-genome.html#cb149-11" aria-hidden="true" tabindex="-1"></a>plotnm<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-aver2-bin-bad-gwas-1kg-ref-&quot;</span>, j,<span class="st">&quot;.png&quot;</span>)</span>
<span id="cb149-12"><a href="reference-panel-1k-genome.html#cb149-12" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(plotnm, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb149-13"><a href="reference-panel-1k-genome.html#cb149-13" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb149-14"><a href="reference-panel-1k-genome.html#cb149-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-15"><a href="reference-panel-1k-genome.html#cb149-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb149-16"><a href="reference-panel-1k-genome.html#cb149-16" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb149-17"><a href="reference-panel-1k-genome.html#cb149-17" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/pairwise-mixture-out/&quot;</span>,trait,<span class="st">&quot;-&quot;</span>,j,<span class="st">&quot;.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb149-18"><a href="reference-panel-1k-genome.html#cb149-18" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[,<span class="fu">c</span>(<span class="st">&quot;ref&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)]</span>
<span id="cb149-19"><a href="reference-panel-1k-genome.html#cb149-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;aver2&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)</span>
<span id="cb149-20"><a href="reference-panel-1k-genome.html#cb149-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-21"><a href="reference-panel-1k-genome.html#cb149-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb149-22"><a href="reference-panel-1k-genome.html#cb149-22" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc,<span class="at">data=</span>dat)</span>
<span id="cb149-23"><a href="reference-panel-1k-genome.html#cb149-23" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb149-24"><a href="reference-panel-1k-genome.html#cb149-24" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb149-25"><a href="reference-panel-1k-genome.html#cb149-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-26"><a href="reference-panel-1k-genome.html#cb149-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb149-27"><a href="reference-panel-1k-genome.html#cb149-27" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb149-28"><a href="reference-panel-1k-genome.html#cb149-28" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb149-29"><a href="reference-panel-1k-genome.html#cb149-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-30"><a href="reference-panel-1k-genome.html#cb149-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb149-31"><a href="reference-panel-1k-genome.html#cb149-31" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb149-32"><a href="reference-panel-1k-genome.html#cb149-32" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb149-33"><a href="reference-panel-1k-genome.html#cb149-33" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb149-34"><a href="reference-panel-1k-genome.html#cb149-34" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb149-35"><a href="reference-panel-1k-genome.html#cb149-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-36"><a href="reference-panel-1k-genome.html#cb149-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb149-37"><a href="reference-panel-1k-genome.html#cb149-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb149-38"><a href="reference-panel-1k-genome.html#cb149-38" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb149-39"><a href="reference-panel-1k-genome.html#cb149-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb149-40"><a href="reference-panel-1k-genome.html#cb149-40" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb149-41"><a href="reference-panel-1k-genome.html#cb149-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb149-42"><a href="reference-panel-1k-genome.html#cb149-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb149-43"><a href="reference-panel-1k-genome.html#cb149-43" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb149-44"><a href="reference-panel-1k-genome.html#cb149-44" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb149-45"><a href="reference-panel-1k-genome.html#cb149-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb149-46"><a href="reference-panel-1k-genome.html#cb149-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-47"><a href="reference-panel-1k-genome.html#cb149-47" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb149-48"><a href="reference-panel-1k-genome.html#cb149-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-49"><a href="reference-panel-1k-genome.html#cb149-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-50"><a href="reference-panel-1k-genome.html#cb149-50" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2 | afr-eas-bin = 1------------------------------------------</span></span>
<span id="cb149-51"><a href="reference-panel-1k-genome.html#cb149-51" aria-hidden="true" tabindex="-1"></a><span class="co"># afr-eas-bin= snps for which Africans and East Asians are not different in MAF</span></span>
<span id="cb149-52"><a href="reference-panel-1k-genome.html#cb149-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-53"><a href="reference-panel-1k-genome.html#cb149-53" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb149-54"><a href="reference-panel-1k-genome.html#cb149-54" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb149-55"><a href="reference-panel-1k-genome.html#cb149-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb149-56"><a href="reference-panel-1k-genome.html#cb149-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb149-57"><a href="reference-panel-1k-genome.html#cb149-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-58"><a href="reference-panel-1k-genome.html#cb149-58" aria-hidden="true" tabindex="-1"></a>plotnm<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-aver2-bin-bad-gwas-1kg-ref-eur-eas-afr-eas-bin1.png&quot;</span>)</span>
<span id="cb149-59"><a href="reference-panel-1k-genome.html#cb149-59" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(plotnm, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb149-60"><a href="reference-panel-1k-genome.html#cb149-60" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb149-61"><a href="reference-panel-1k-genome.html#cb149-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-62"><a href="reference-panel-1k-genome.html#cb149-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb149-63"><a href="reference-panel-1k-genome.html#cb149-63" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb149-64"><a href="reference-panel-1k-genome.html#cb149-64" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/pairwise-mixture-out/&quot;</span>,trait,<span class="st">&quot;-all.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb149-65"><a href="reference-panel-1k-genome.html#cb149-65" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb149-66"><a href="reference-panel-1k-genome.html#cb149-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-67"><a href="reference-panel-1k-genome.html#cb149-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin aver2 for EUR_EAS mixture</span></span>
<span id="cb149-68"><a href="reference-panel-1k-genome.html#cb149-68" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>AFR_EAS, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb149-69"><a href="reference-panel-1k-genome.html#cb149-69" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin_afr_eas<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>AFR_EAS, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb149-70"><a href="reference-panel-1k-genome.html#cb149-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-71"><a href="reference-panel-1k-genome.html#cb149-71" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[dat<span class="sc">$</span>bin_afr_eas<span class="sc">==</span><span class="dv">1</span>,<span class="fu">c</span>(<span class="st">&quot;EUR_EAS&quot;</span>, <span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)]</span>
<span id="cb149-72"><a href="reference-panel-1k-genome.html#cb149-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;aver2&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)</span>
<span id="cb149-73"><a href="reference-panel-1k-genome.html#cb149-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-74"><a href="reference-panel-1k-genome.html#cb149-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb149-75"><a href="reference-panel-1k-genome.html#cb149-75" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc, <span class="at">data=</span>dat)</span>
<span id="cb149-76"><a href="reference-panel-1k-genome.html#cb149-76" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb149-77"><a href="reference-panel-1k-genome.html#cb149-77" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb149-78"><a href="reference-panel-1k-genome.html#cb149-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-79"><a href="reference-panel-1k-genome.html#cb149-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin a variable by quantile</span></span>
<span id="cb149-80"><a href="reference-panel-1k-genome.html#cb149-80" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>aver2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb149-81"><a href="reference-panel-1k-genome.html#cb149-81" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>aver2, <span class="at">breaks=</span>cutoff, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb149-82"><a href="reference-panel-1k-genome.html#cb149-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-83"><a href="reference-panel-1k-genome.html#cb149-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average chisq by bin values</span></span>
<span id="cb149-84"><a href="reference-panel-1k-genome.html#cb149-84" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">chisq_ave=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>chisq,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean))</span>
<span id="cb149-85"><a href="reference-panel-1k-genome.html#cb149-85" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>bin_val<span class="ot">=</span><span class="fu">tapply</span>(dat<span class="sc">$</span>aver2,<span class="at">INDEX=</span>dat<span class="sc">$</span>bin, mean)</span>
<span id="cb149-86"><a href="reference-panel-1k-genome.html#cb149-86" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(out<span class="sc">$</span>bin_val)</span>
<span id="cb149-87"><a href="reference-panel-1k-genome.html#cb149-87" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(out<span class="sc">$</span>chisq_ave)</span>
<span id="cb149-88"><a href="reference-panel-1k-genome.html#cb149-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-89"><a href="reference-panel-1k-genome.html#cb149-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb149-90"><a href="reference-panel-1k-genome.html#cb149-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(out<span class="sc">$</span>bin_val, out<span class="sc">$</span>chisq_ave,</span>
<span id="cb149-91"><a href="reference-panel-1k-genome.html#cb149-91" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2 bin&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;mean chisq&quot;</span>,</span>
<span id="cb149-92"><a href="reference-panel-1k-genome.html#cb149-92" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb149-93"><a href="reference-panel-1k-genome.html#cb149-93" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb149-94"><a href="reference-panel-1k-genome.html#cb149-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb149-95"><a href="reference-panel-1k-genome.html#cb149-95" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb149-96"><a href="reference-panel-1k-genome.html#cb149-96" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb149-97"><a href="reference-panel-1k-genome.html#cb149-97" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb149-98"><a href="reference-panel-1k-genome.html#cb149-98" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb149-99"><a href="reference-panel-1k-genome.html#cb149-99" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-100"><a href="reference-panel-1k-genome.html#cb149-100" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb149-101"><a href="reference-panel-1k-genome.html#cb149-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-102"><a href="reference-panel-1k-genome.html#cb149-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-103"><a href="reference-panel-1k-genome.html#cb149-103" aria-hidden="true" tabindex="-1"></a><span class="co"># plot chisq ~ aver2 | conditional plot------------------------------------------</span></span>
<span id="cb149-104"><a href="reference-panel-1k-genome.html#cb149-104" aria-hidden="true" tabindex="-1"></a><span class="co"># afr-eas-bin= snps for which Africans and East Asians are not different in MAF</span></span>
<span id="cb149-105"><a href="reference-panel-1k-genome.html#cb149-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-106"><a href="reference-panel-1k-genome.html#cb149-106" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb149-107"><a href="reference-panel-1k-genome.html#cb149-107" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb149-108"><a href="reference-panel-1k-genome.html#cb149-108" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb149-109"><a href="reference-panel-1k-genome.html#cb149-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb149-110"><a href="reference-panel-1k-genome.html#cb149-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-111"><a href="reference-panel-1k-genome.html#cb149-111" aria-hidden="true" tabindex="-1"></a>plotnm<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;fig/chisq-aver2-bin-bad-gwas-1kg-ref-eur-afr-conditional.png&quot;</span>)</span>
<span id="cb149-112"><a href="reference-panel-1k-genome.html#cb149-112" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(plotnm, <span class="at">res=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">50</span>, <span class="at">height=</span><span class="dv">30</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>)</span>
<span id="cb149-113"><a href="reference-panel-1k-genome.html#cb149-113" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">font.lab=</span><span class="dv">2</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>)</span>
<span id="cb149-114"><a href="reference-panel-1k-genome.html#cb149-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-115"><a href="reference-panel-1k-genome.html#cb149-115" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb149-116"><a href="reference-panel-1k-genome.html#cb149-116" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb149-117"><a href="reference-panel-1k-genome.html#cb149-117" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/pairwise-mixture-out/&quot;</span>,trait,<span class="st">&quot;-all.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb149-118"><a href="reference-panel-1k-genome.html#cb149-118" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb149-119"><a href="reference-panel-1k-genome.html#cb149-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-120"><a href="reference-panel-1k-genome.html#cb149-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bin aver2 for EUR_EAS mixture</span></span>
<span id="cb149-121"><a href="reference-panel-1k-genome.html#cb149-121" aria-hidden="true" tabindex="-1"></a>  cutoff1<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>EUR_AFR, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb149-122"><a href="reference-panel-1k-genome.html#cb149-122" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin1<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>EUR_AFR, <span class="at">breaks=</span>cutoff1, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff1)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb149-123"><a href="reference-panel-1k-genome.html#cb149-123" aria-hidden="true" tabindex="-1"></a>  cutoff2<span class="ot">=</span><span class="fu">quantile</span>(dat<span class="sc">$</span>AFR_EAS, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb149-124"><a href="reference-panel-1k-genome.html#cb149-124" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>bin2<span class="ot">=</span><span class="fu">cut</span>(dat<span class="sc">$</span>AFR_EAS, <span class="at">breaks=</span>cutoff2, <span class="at">labels=</span><span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cutoff2)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb149-125"><a href="reference-panel-1k-genome.html#cb149-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-126"><a href="reference-panel-1k-genome.html#cb149-126" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span>dat[dat<span class="sc">$</span>bin1<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>bin2<span class="sc">==</span><span class="dv">8</span> ,<span class="fu">c</span>(<span class="st">&quot;EUR_EAS&quot;</span>, <span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)]</span>
<span id="cb149-127"><a href="reference-panel-1k-genome.html#cb149-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;aver2&quot;</span>,<span class="st">&quot;chisq&quot;</span>, <span class="st">&quot;ldsc&quot;</span>)</span>
<span id="cb149-128"><a href="reference-panel-1k-genome.html#cb149-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-129"><a href="reference-panel-1k-genome.html#cb149-129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb149-130"><a href="reference-panel-1k-genome.html#cb149-130" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> aver2 <span class="sc">+</span> ldsc, <span class="at">data=</span>dat)</span>
<span id="cb149-131"><a href="reference-panel-1k-genome.html#cb149-131" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[,<span class="dv">4</span>][<span class="dv">2</span>]</span>
<span id="cb149-132"><a href="reference-panel-1k-genome.html#cb149-132" aria-hidden="true" tabindex="-1"></a>  p_sci<span class="ot">=</span><span class="fu">formatC</span>(p, <span class="at">format=</span><span class="st">&quot;e&quot;</span>, <span class="at">digit=</span><span class="dv">2</span>)</span>
<span id="cb149-133"><a href="reference-panel-1k-genome.html#cb149-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-134"><a href="reference-panel-1k-genome.html#cb149-134" aria-hidden="true" tabindex="-1"></a>  px<span class="ot">=</span><span class="fu">min</span>(dat<span class="sc">$</span>aver2)</span>
<span id="cb149-135"><a href="reference-panel-1k-genome.html#cb149-135" aria-hidden="true" tabindex="-1"></a>  py<span class="ot">=</span><span class="fu">max</span>(dat<span class="sc">$</span>chisq)</span>
<span id="cb149-136"><a href="reference-panel-1k-genome.html#cb149-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-137"><a href="reference-panel-1k-genome.html#cb149-137" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb149-138"><a href="reference-panel-1k-genome.html#cb149-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(dat<span class="sc">$</span>aver2, dat<span class="sc">$</span>chisq,</span>
<span id="cb149-139"><a href="reference-panel-1k-genome.html#cb149-139" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;ave r2&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;chisq&quot;</span>,</span>
<span id="cb149-140"><a href="reference-panel-1k-genome.html#cb149-140" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span>trait, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb149-141"><a href="reference-panel-1k-genome.html#cb149-141" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">pch=</span><span class="dv">21</span>,  <span class="at">bg=</span><span class="st">&quot;darkgray&quot;</span>, <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb149-142"><a href="reference-panel-1k-genome.html#cb149-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(chisq <span class="sc">~</span> aver2,<span class="at">data=</span>dat),<span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb149-143"><a href="reference-panel-1k-genome.html#cb149-143" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&lt;</span><span class="fl">0.01</span>){<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci),</span>
<span id="cb149-144"><a href="reference-panel-1k-genome.html#cb149-144" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb149-145"><a href="reference-panel-1k-genome.html#cb149-145" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">text</span>(px, py, <span class="fu">paste0</span>(<span class="st">&quot;p = &quot;</span>, p_sci), </span>
<span id="cb149-146"><a href="reference-panel-1k-genome.html#cb149-146" aria-hidden="true" tabindex="-1"></a>          <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">font=</span><span class="dv">2</span>)}</span>
<span id="cb149-147"><a href="reference-panel-1k-genome.html#cb149-147" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-148"><a href="reference-panel-1k-genome.html#cb149-148" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="chisq-multi-aver2" class="section level3" number="17.5.5">
<h3><span class="header-section-number">17.5.5</span> chisq ~ multi-aver2</h3>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="reference-panel-1k-genome.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># linear regression ------------------------------------------------------------</span></span>
<span id="cb150-2"><a href="reference-panel-1k-genome.html#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vroom)</span>
<span id="cb150-3"><a href="reference-panel-1k-genome.html#cb150-3" aria-hidden="true" tabindex="-1"></a>traits<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;awake&quot;</span>,<span class="st">&quot;bmi&quot;</span>,<span class="st">&quot;chron&quot;</span>,<span class="st">&quot;ever&quot;</span>,</span>
<span id="cb150-4"><a href="reference-panel-1k-genome.html#cb150-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;neur&quot;</span>,<span class="st">&quot;pulse&quot;</span>,<span class="st">&quot;quals&quot;</span>, <span class="st">&quot;fvc&quot;</span>, <span class="st">&quot;height&quot;</span>,<span class="st">&quot;imp&quot;</span>, </span>
<span id="cb150-5"><a href="reference-panel-1k-genome.html#cb150-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;reaction&quot;</span>,<span class="st">&quot;sbp&quot;</span>,<span class="st">&quot;snoring&quot;</span>,<span class="st">&quot;hyper&quot;</span>)</span>
<span id="cb150-6"><a href="reference-panel-1k-genome.html#cb150-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-7"><a href="reference-panel-1k-genome.html#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(traits)){</span>
<span id="cb150-8"><a href="reference-panel-1k-genome.html#cb150-8" aria-hidden="true" tabindex="-1"></a>  trait<span class="ot">=</span>traits[i]</span>
<span id="cb150-9"><a href="reference-panel-1k-genome.html#cb150-9" aria-hidden="true" tabindex="-1"></a>  dat<span class="ot">=</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(<span class="st">&quot;ref-1kg/pairwise-mixture-out/&quot;</span>,trait,<span class="st">&quot;-all.out&quot;</span>), <span class="at">col_names=</span>T)</span>
<span id="cb150-10"><a href="reference-panel-1k-genome.html#cb150-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-11"><a href="reference-panel-1k-genome.html#cb150-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear model</span></span>
<span id="cb150-12"><a href="reference-panel-1k-genome.html#cb150-12" aria-hidden="true" tabindex="-1"></a>  mod<span class="ot">=</span><span class="fu">lm</span>(chisq <span class="sc">~</span> AFR_EAS <span class="sc">+</span> EUR_AFR <span class="sc">+</span> EUR_EAS <span class="sc">+</span> ldsc, <span class="at">data=</span>dat)</span>
<span id="cb150-13"><a href="reference-panel-1k-genome.html#cb150-13" aria-hidden="true" tabindex="-1"></a>  est0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb150-14"><a href="reference-panel-1k-genome.html#cb150-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">AFR_EAS=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">1</span>],</span>
<span id="cb150-15"><a href="reference-panel-1k-genome.html#cb150-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">EUR_AFR=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="dv">3</span>,<span class="dv">1</span>],</span>
<span id="cb150-16"><a href="reference-panel-1k-genome.html#cb150-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">EUR_EAS=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="dv">4</span>,<span class="dv">1</span>])</span>
<span id="cb150-17"><a href="reference-panel-1k-genome.html#cb150-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb150-18"><a href="reference-panel-1k-genome.html#cb150-18" aria-hidden="true" tabindex="-1"></a>  p0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">trait=</span>trait,</span>
<span id="cb150-19"><a href="reference-panel-1k-genome.html#cb150-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">AFR_EAS=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>],</span>
<span id="cb150-20"><a href="reference-panel-1k-genome.html#cb150-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">EUR_AFR=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="dv">3</span>,<span class="dv">4</span>],</span>
<span id="cb150-21"><a href="reference-panel-1k-genome.html#cb150-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">EUR_EAS=</span><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="dv">4</span>,<span class="dv">4</span>])</span>
<span id="cb150-22"><a href="reference-panel-1k-genome.html#cb150-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-23"><a href="reference-panel-1k-genome.html#cb150-23" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){est<span class="ot">=</span>est0; p<span class="ot">=</span>p0} <span class="cf">else</span>{est<span class="ot">=</span><span class="fu">rbind</span>(est,est0); p<span class="ot">=</span><span class="fu">rbind</span>(p,p0)}</span>
<span id="cb150-24"><a href="reference-panel-1k-genome.html#cb150-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb150-25"><a href="reference-panel-1k-genome.html#cb150-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-26"><a href="reference-panel-1k-genome.html#cb150-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ridge regression -------------------------------------------------------------</span></span>
<span id="cb150-27"><a href="reference-panel-1k-genome.html#cb150-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb150-28"><a href="reference-panel-1k-genome.html#cb150-28" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">=</span>dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb150-29"><a href="reference-panel-1k-genome.html#cb150-29" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">=</span> <span class="fu">glmnet</span>(<span class="fu">as.matrix</span>(dat[,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>]), <span class="fu">as.matrix</span>(dat[,<span class="dv">2</span>]), </span>
<span id="cb150-30"><a href="reference-panel-1k-genome.html#cb150-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>, <span class="at">intercept =</span> F, <span class="at">alpha=</span><span class="dv">0</span>)</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="assortative-mating.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="fine-scale-population-stratification.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/08-ref-panel-1k-genome.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
